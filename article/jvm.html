<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; padding-bottom: 0px !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: "ï„¥"; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: "ï„£"; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: "ï„£"; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "âˆ’"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


:root {
    --monospace: "JetBrains Mono", HYZhengYuan, "Fira Code", Menlo, "Ubuntu Mono", Consolas; /*code font*/
    --text-font: var(--monospace); /*default font*/
    --title-font: var(--monospace); /*title font*/

    --bg-color: #283237;
    --text-color: #b3bec4;
    --control-text-color: var(--text-color);
    --meta-content-color: var(--text-color);
    --active-file-border-color: var(--drake-accent);
    --rawblock-edit-panel-bd: var(--code-block-bg-color);
    --item-hover-bg-color: #37474f;
    --active-file-bg-color: var(--item-hover-bg-color);

    --md-char-color: #535455;
    --side-bar-bg-color: var(--bg-color);
    --search-select-bg-color: #ffffff;
    --search-select-text-color: var(--bg-color);
    --select-text-bg-color: #3473B068;
    --window-border: 1px solid #282828;

    --drake-accent: #429488;
    --drake-highlight: #429488;
    --a-color: var(--drake-highlight);
    --variable-color: var(--drake-highlight);
    --outline-active-color: var(--a-color);
    --code-block-bg-color: #1b2529;
    --code-block-color: var(--text-color);
    --title-color: #bbc6d2;
    --blockquote-border-color: var(--drake-accent);
    --blockquote-color: var(--text-color);
    --blockquote-bg-color: #364149;
    --strong-color: var(--title-color);
    --h2-underline-color: var(--title-color);
    --horizontal-divider-color: var(--title-color);
    --height-light-color: var(--drake-highlight);
    --height-light-border-color: var(--drake-highlight);
    --yaml-color: #676773;
    --yaml-bg-color: var(--code-block-bg-color);
    --footnotes-bg-color: var(--item-hover-bg-color);
    --footnotes-highlight: #FFD760;
    --table-border-color: var(--item-hover-bg-color);
    --table-header-bg-color: #314549;
    --table-bg-color: var(--bg-color);
    --table-n2-bg-color: var(--table-header-bg-color);
    --input-bg-color: var(--item-hover-bg-color);
    --btn-hover-bg-color: var(--item-hover-bg-color);
    --checkbox-checked: url("data:image/svg+xml,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M425.984 726.016l384-384-59.99-61.995-324.01 324.011-152.021-152.021L213.973 512zm384-598.016q36.01 0 61.013 25.984T896 213.974v596.01q0 34.005-25.003 59.99t-61.013 25.983h-596.01q-36.011 0-61.014-25.984t-25.003-59.989v-596.01q0-34.006 25.003-59.99T213.973 128h596.011z' fill='%2365b73b'/%3E%3C/svg%3E");
    --checkbox-unchecked: url("data:image/svg+xml,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M810.667 213.333v597.334H213.333V213.333h597.334m0-85.333H213.333C166.4 128 128 166.4 128 213.333v597.334C128 857.6 166.4 896 213.333 896h597.334C857.6 896 896 857.6 896 810.667V213.333C896 166.4 857.6 128 810.667 128z' fill='%23acb7c4'/%3E%3C/svg%3E");
}

html {
    font-size: 12px;
}

body {
    font-family: var(--text-font) !important;
    color: var(--text-color);
    -webkit-font-feature-settings: "liga" on, "calt" on;
    -webkit-font-smoothing: subpixel-antialiased;
    text-rendering: optimizeLegibility;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
    line-height: 1.8rem;
    font-size: 13px;
}

/*code block*/
#write .md-fences {
    font-size: 1rem;
    padding: 0.5rem !important;
    border-radius: 2px;
    word-wrap: normal;
    background-color: var(--code-block-bg-color);
    color: var(--code-block-color);
    border: none;
}

/*code snippet*/
#write code, tt {
    margin: 0 2px;
    color: var(--drake-highlight);
}

/*variable*/
var {
    color: var(--variable-color);
    font-weight: bold;
}

/*raw block*/
.md-rawblock-control:not(.md-rawblock-tooltip) {
    border-radius: 2px 0 2px 2px;
    padding: 0.2rem !important;
}

.md-rawblock:hover > .md-rawblock-container {
    background: none;
}

.md-rawblock-input {
    font-size: 1rem;
}

.md-rawblock-tooltip-btn:hover {
    background: none;
}

.md-rawblock:hover > .md-rawblock-tooltip {
    border-radius: 2px 2px 0 0;
    margin-bottom: 2px !important;
}

.md-rawblock-tooltip.md-rawblock-control {
    border-radius: 2px 2px 0 0;
    color: var(--code-block-color);
}

.md-rawblock-tooltip-name {
    color: var(--code-block-color);
    opacity: 1;
}

/*quote block*/
blockquote:before {
    display: block;
    position: absolute;
    content: '';
    width: 4px;
    left: 0;
    top: 0;
    height: 100%;
    background-color: var(--blockquote-border-color);
    border-radius: 2px;
}

blockquote {
    color: var(--blockquote-color);
    border-radius: 2px;
    padding: 10px 16px;
    background-color: var(--blockquote-bg-color);
    position: relative;
    border-left: none;
}

#write strong {
    color: var(--strong-color);
    font-weight: bold;
}

#write blockquote strong {
    color: var(--blockquote-color);
}

/*link*/
#write a {
    color: var(--a-color);
    text-decoration: none;
}

#write a .md-plain, .md-htmlblock-container a:hover {
    border-bottom: .1rem solid var(--a-color);
}

[md-inline=link] a {
    margin: 0 .2rem;
}

a:any-link {
    color: var(--a-color);
}

img {
    border-left: none;
    border-right: none;
    vertical-align: baseline;
    border-radius: 2px;
}

#write {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px 30px 100px;
}

#typora-source .CodeMirror-lines {
    max-width: 1200px;
}

#write p {
    word-spacing: .05rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: var(--title-font);
    position: relative;
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: bold;
    cursor: text;
    color: var(--title-color);
}

h3.md-focus:before, h4.md-focus:before, h5.md-focus:before, h6.md-focus:before {
    visibility: hidden;
}

h1 {
    font-size: 1.6rem;
    text-align: center;
    margin-top: 0;
}

h2.md-end-block.md-heading {
    font-size: 1.6rem;
    display: inline-block;
}

h2.md-end-block.md-heading:after {
    display: block;
    content: '';
    height: 2px;
    margin-top: 4px;
    background-color: var(--h2-underline-color);
    border-radius: 2px;
}

h3 {
    font-size: 1.4rem;
}

h4 {
    font-size: 1.2rem;
}

h5 {
    font-size: 1rem;
}

h6 {
    font-size: 1rem;
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}

h2 tt,
h2 code {
    font-size: inherit !important;
}

h3 tt,
h3 code {
    font-size: inherit !important;
}

h4 tt,
h4 code {
    font-size: inherit !important;
}

h5 tt,
h5 code {
    font-size: inherit !important;
}

h6 tt,
h6 code {
    font-size: inherit !important;
}

blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

p {
    margin: 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: var(--horizontal-divider-color);
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul, ol {
    padding-inline-start: 2em;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

table {
    padding: 0;
    word-break: initial;
    background-color: var(--table-bg-color);
}

table tr {
    border-top: .1em solid var(--table-border-color);
    margin: 0;
    padding: 0;
}

table th {
    font-weight: bold;
    border: .1em solid var(--table-border-color);
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}

table td {
    border: .1em solid var(--table-border-color);
    margin: 0;
    padding: 6px 13px;
}

table thead {
    background-color: var(--table-header-bg-color);
}

table tr:nth-child(2n) {
    background-color: var(--table-n2-bg-color);
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

#write em {
    padding: 0 5px 0 2px;
}

#write table thead th {
    background-color: var(--table-header-bg-color);
}

/* height light */
#write mark {
    border: .1em solid var(--height-light-border-color);
    color: var(--height-light-color);
    background-color: transparent;
    padding: .1rem .5rem;
    border-radius: 2rem;
    margin: 0 .2rem;
    font-size: .95rem;
}

/*shortcut*/
kbd {
    border: .1em solid #5b5b5e;
    background: transparent;
    color: var(--text-color);
    margin: 0 .4rem;
    font-size: .95rem;
    padding: .3em .4em;
    border-radius: .4em;
    vertical-align: top;
    box-shadow: .1em .1em .2em rgba(0, 0, 0, 0.3);
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 12px;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

/*YAML*/
#write pre.md-meta-block {
    padding: 1rem;
    font-size: 1rem;
    background-color: var(--yaml-bg-color);
    border: 0;
    border-radius: 2px;
    color: var(--yaml-color);
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

#write > h3.md-focus:before {
    left: -1.5625rem;
    top: .375rem;
}

#write > h4.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write > h5.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write > h6.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

.md-image > .md-meta {
    border-radius: 2px;
    font-family: initial;
    padding: 2px 0 0 4px;
    color: inherit;
}

.md-tag {
    color: inherit;
}

.md-toc {
    margin-top: 20px;
    padding-bottom: 20px;
}

.typora-quick-open-item {
    font-size: 1rem !important;
    height: 50px;
    padding-left: 8px;
    padding-top: 4px;
    padding-bottom: 4px;
}

#typora-quick-open {
    box-shadow: 0 0 8px #00000045;
    padding: 0;
}

.ty-quick-open-category.ty-has-prev .ty-quick-open-category-title {
    border-top: none;
}

#typora-quick-open-input {
    margin: 8px;
    box-shadow: none;
    border-radius: 2px;
}

#typora-quick-open-input input {
    font-size: 1rem;
    box-shadow: none;
    padding-top: 2px;
    padding-left: 10px;
    padding-right: 10px;
    line-height: 32px;
    max-height: 32px;
    border: none;
}

.modal-dialog#typora-quick-open {
    border-radius: 8px;
}

.ty-quick-open-category-title {
    padding-left: 8px;
    color: #BEBEBE;
    font-size: 0.8rem;
    margin-bottom: 4px;
}

.typora-quick-open-item-path {
    font-size: 0.8rem;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin-top: 1px;
}

/*search input*/
.form-control {
    border: none;
    border-radius: 2px;
    box-shadow: none;
}

#md-searchpanel .btn {
    border-radius: 2px;
}

#search-panel-replaceall-btn {
    padding-right: 5px !important;
    text-align: center !important;
}

#search-panel-replace-btn {
    text-align: center !important;
}

#md-searchpanel input {
    background: var(--input-bg-color);
    border-radius: 2px;
}

.searchpanel-search-option-btn {
    border-radius: 2px;
    border: none;
    background: transparent;
    color: var(--text-color);
}

.searchpanel-search-option-btn.active {
    background: var(--text-color);
    color: var(--bg-color);
}

.form-control:focus {
    box-shadow: none;
}

#md-notification:before {
    top: 10px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: initial;
}

/*sidebar*/
.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

#typora-sidebar {
    font-size: 1.1rem;
}

.sidebar-tabs {
    border-bottom: none;
}

.file-list-item-summary, .file-list-item-parent-loc, .file-list-item-time, .file-list-item-summary {
    font-size: 0.9rem !important;
    font-family: var(--text-font);
}

.file-list-item-file-ext-part {
    display: none;
}

.outline-item {
    font-size: 1rem;
}

/*footnotes mark*/
#write .md-footnote {
    background-color: inherit;
    color: var(--drake-highlight);
    font-size: 0.9rem;
    border-radius: 0.9rem;
    padding-left: 0;
}

#write .md-footnote:before {
    content: "[";
}

#write .md-footnote:after {
    content: "]";
}

/*footnotes content*/
.md-hover-tip .code-tooltip-content {
    border-radius: 2px;
}

/*footnotes title*/
span.md-def-name {
    padding-right: 3ch;
    padding-left: 0;
    position: relative;
    font-weight: normal;
}

/*footnotes desc*/
.footnotes {
    font-size: 1rem;
    font-weight: normal;
    color: var(--text-color);
    position: relative;
}

/*footnotes tooltip text*/
.code-tooltip-content .md-plain {
    font-size: 0.9rem;
    font-family: inherit;
}

.code-tooltip-content code {
    padding: 0 2px;
    font-family: inherit;
    color: var(--footnotes-highlight);
    background-color: inherit;
}

.code-tooltip-content a {
    color: var(--footnotes-highlight);
}

div.code-tooltip-content {
    box-shadow: 0 0 8px #00000045;
    background: var(--footnotes-bg-color);
}

.footnotes {
    opacity: 1;
}

.md-def-name:after {
    content: ". ^";
    color: var(--text-color);
}

.md-def-footnote .md-def-name:before {
    content: "";
    color: var(--text-color);
    position: absolute;
}

.md-def-name:before {
    content: "";
    color: var(--text-color);
    position: absolute;
}

.md-content.md-url, .md-def-content.md-def-url.md-auto-disp {
    text-decoration: none;
    border-bottom: .1rem solid var(--text-color);
}

.CodeMirror-scroll::-webkit-scrollbar {
    display: none;
}

.file-list-item-summary {
    font-size: 1em;
}

.pin-outline #outline-content .outline-active strong, .pin-outline .outline-active {
    font-weight: 500;
    color: var(--outline-active-color);
}

.file-list-item.active {
    border-left: 4px solid var(--drake-accent);
}

#md-searchpanel .btn:not(.close-btn):hover {
    box-shadow: none;
    background: var(--btn-hover-bg-color);
}

/*checkbox*/
#write input[type=checkbox] {
    opacity: 0;
    height: 1.6rem;
    width: 1.6rem;
    margin-left: -2em;
    margin-top: 0;
    top: 0;
}

#write .ul-list li.md-task-list-item.task-list-done::before {
    content: "";
    background: var(--checkbox-checked) 0 0 no-repeat;
    background-size: 100%;
    display: inline-block;
    position: absolute;
    height: 1.6rem;
    width: 1.6rem;
    margin-left: -2em;
}

#write .ul-list li.md-task-list-item.task-list-not-done::before {
    content: "";
    background: var(--checkbox-unchecked) 0 0 no-repeat;
    background-size: 100%;
    display: inline-block;
    position: absolute;
    height: 1.6rem;
    width: 1.6rem;
    margin-left: -2em;
}

/*insert table*/
.btn {
    border-radius: 2px;
}

.modal-content {
    border-radius: 8px;
}

.btn-primary:hover, .btn-primary:active {
    background-color: var(--btn-hover-bg-color);
    color: var(--drake-highlight);
}

.btn-primary {
    background-color: transparent;
    color: var(--drake-highlight);
}

.btn-default {
    background-color: transparent;
}

.btn:active {
    box-shadow: none;
    border-color: transparent;
}

.modal-footer {
    border-top: none;
}

#table-insert-col, #table-insert-row {
    background: var(--input-bg-color);
    border-radius: 2px;
}

/*preference panel*/
#megamenu-content {
    background-image: none !important;
    background-color: var(--bg-color);
}

#top-titlebar {
    height: inherit;
    background-color: var(--bg-color);
}

#megamenu-menu-sidebar {
    background-color: var(--bg-color);
    color: var(--text-color);
}

.long-btn {
    width: inherit;
    min-width: 300px;
    border: 1px solid var(--text-color);
    border-radius: 6px;
}

.megamenu-menu-panel h1 {
    margin-bottom: 3rem;
    text-align: left;
}

.megamenu-menu-panel h1, .megamenu-menu-panel h2 {
    font-weight: normal;
}

#recent-file-panel-search-input {
    height: 45px;
    border: none;
    border-bottom: 1px solid var(--text-color);
    padding-left: 8px;
}

#recent-file-panel-search-input::placeholder {
    color: var(--text-color);
    opacity: .5;
}

.megamenu-menu-header {
    border-bottom: none;
}

#recent-file-panel-action-btn {
    background: none;
    border: none;
}

#recent-file-panel-action-btn-container {
    float: none;
    display: inline-block;
}

#top-titlebar .toolbar-icon.btn.hover, #top-titlebar .toolbar-icon.btn:hover {
    background-color: var(--btn-hover-bg-color);
    color: var(--text-color);
}

.megamenu-menu-panel .btn:hover {
    background-color: var(--btn-hover-bg-color) !important;
    color: var(--text-color);
}

#recent-file-panel tbody tr:nth-child(2n-1),
.megamenu-menu-panel table thead,
.megamenu-menu-panel table tr {
    background-color: transparent;
}

.megamenu-menu-panel table {
    font-weight: normal;
}

#megamenu-back-btn {
    color: var(--text-color);
    border: 1px solid var(--text-color);
}

.megamenu-menu-header #megamenu-menu-header-title {
    color: var(--text-color);
}

header, .context-menu, .megamenu-content, footer {
    font-family: var(--text-font);
}

.ty-preferences select {
    padding-left: 2px;
}

.preference-item-hint {
    font-size: 14px;
}

a.ty-link {
    color: var(--a-color);
    margin: 0 .2rem;
}

/*
  Name:       material
  Author:     Mattia Astorino (http://github.com/equinusocio)
  Website:    https://material-theme.site/
*/
.cm-s-inner.CodeMirror {
    background: none;
    color: var(--code-block-color);
}

.cm-s-inner .CodeMirror-gutters {
    border-right: none;
    border-radius: 2px;
    padding-left: 0.5rem;
    background: #263238;
    color: #546E7A;
}

.cm-s-inner .CodeMirror-guttermarker,
.cm-s-inner .CodeMirror-guttermarker-subtle,
.cm-s-inner .CodeMirror-linenumber {
    color: #546E7A;
}

.cm-s-inner .CodeMirror-line::selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span > span::selection {
    background: rgba(128, 203, 196, 0.2);
}

.cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
    background: rgba(128, 203, 196, 0.2);
}

.cm-s-inner .cm-keyword {
    color: #C792EA;
}

.cm-s-inner .cm-operator {
    color: #89DDFF;
}

.cm-s-inner .cm-variable-2 {
    color: var(--code-block-color);
}

.cm-s-inner .cm-variable-3,
.cm-s-inner .cm-type {
    color: #f07178;
}

.cm-s-inner .cm-builtin {
    color: #FFCB6B;
}

.cm-s-inner .cm-atom {
    color: #F78C6C;
}

.cm-s-inner .cm-number {
    color: #FF5370;
}

.cm-s-inner .cm-def {
    color: #82AAFF;
}

.cm-s-inner .cm-string {
    color: #C3E88D;
}

.cm-s-inner .cm-string-2 {
    color: #f07178;
}

.cm-s-inner .cm-comment {
    color: #546E7A;
}

.cm-s-inner .cm-variable {
    color: var(--code-block-color);
}

.cm-s-inner .cm-tag {
    color: #FF5370;
}

.cm-s-inner .cm-meta {
    color: #FFCB6B;
}

.cm-s-inner .cm-attribute {
    color: #C792EA;
}

.cm-s-inner .cm-property {
    color: #C792EA;
}

.cm-s-inner .cm-qualifier {
    color: #DECB6B;
}

.cm-s-inner .cm-variable-3,
.cm-s-inner .cm-type {
    color: #DECB6B;
}

.cm-s-inner .cm-error {
    color: rgba(255, 255, 255, 1.0);
    background-color: #FF5370;
}

.cm-s-inner .CodeMirror-matchingbracket {
    text-decoration: underline;
    color: white !important;
}

.cm-s-inner .CodeMirror-selected {
    background: #214283 !important;
}

.cm-s-inner .CodeMirror-selectedtext {
    background: #214283 !important;
}

.cm-s-typora-default .CodeMirror-selectedtext {
    background: var(--select-text-bg-color) !important;
}

.cm-overlay.CodeMirror-selectedtext {
    background: var(--select-text-bg-color) !important;
}

.cm-s-inner div.CodeMirror-cursor {
    border-left: 1px solid var(--code-block-color);
}


</style><title>JVM</title>
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n7"><a class="md-toc-inner" href="#classloader">Classloader</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n8"><a class="md-toc-inner" href="#ç±»åŠ è½½æœºåˆ¶">ç±»åŠ è½½æœºåˆ¶</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n31"><a class="md-toc-inner" href="#ç±»åŠ è½½å™¨">ç±»åŠ è½½å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n57"><a class="md-toc-inner" href="#åŒäº²å§”æ´¾">åŒäº²å§”æ´¾</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n72"><a class="md-toc-inner" href="#jvm">JVM</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n73"><a class="md-toc-inner" href="#javaå†…å­˜æ¨¡å‹">JAVAå†…å­˜æ¨¡å‹</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n97"><a class="md-toc-inner" href="#jvmå†…å­˜ç»“æ„">JVMå†…å­˜ç»“æ„</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n113"><a class="md-toc-inner" href="#jvmå†…å­˜æ¨¡å‹">JVMå†…å­˜æ¨¡å‹</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n135"><a class="md-toc-inner" href="#ç¨‹åºè®¡æ•°å™¨">ç¨‹åºè®¡æ•°å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n148"><a class="md-toc-inner" href="#javaè™šæ‹Ÿæœºæ ˆ">JAVAè™šæ‹Ÿæœºæ ˆ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n164"><a class="md-toc-inner" href="#æœ¬åœ°æ–¹æ³•æ ˆ">æœ¬åœ°æ–¹æ³•æ ˆ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n167"><a class="md-toc-inner" href="#æ–¹æ³•åŒº">æ–¹æ³•åŒº</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n183"><a class="md-toc-inner" href="#å †å†…å­˜">å †å†…å­˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n206"><a class="md-toc-inner" href="#jvmè¿è¡Œæ—¶å†…å­˜">JVMè¿è¡Œæ—¶å†…å­˜</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n216"><a class="md-toc-inner" href="#æ–°ç”Ÿä»£young-generationï¼‰">æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n248"><a class="md-toc-inner" href="#è€å¹´ä»£old-generationï¼‰">è€å¹´ä»£ï¼ˆOld Generationï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n254"><a class="md-toc-inner" href="#æ°¸ä¹…åŒºperm-generationï¼‰">æ°¸ä¹…åŒºï¼ˆPerm Generationï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n260"><a class="md-toc-inner" href="#å†…å­˜åˆ†é…ç­–ç•¥">å†…å­˜åˆ†é…ç­–ç•¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n331"><a class="md-toc-inner" href="#å¼•ç”¨çº§åˆ«">å¼•ç”¨çº§åˆ«</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n362"><a class="md-toc-inner" href="#å¼ºå¼•ç”¨strongreferenceï¼‰">å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n371"><a class="md-toc-inner" href="#è½¯å¼•ç”¨softreferenceï¼‰">è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n379"><a class="md-toc-inner" href="#å¼±å¼•ç”¨weakreferenceï¼‰">å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n390"><a class="md-toc-inner" href="#è™šå¼•ç”¨phantomreferenceï¼‰">è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n399"><a class="md-toc-inner" href="#oom">OOM</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n563"><a class="md-toc-inner" href="#gc-1">GC</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n564"><a class="md-toc-inner" href="#å¯»æ‰¾åƒåœ¾ç®—æ³•">å¯»æ‰¾åƒåœ¾ç®—æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n566"><a class="md-toc-inner" href="#å¼•ç”¨è®¡æ•°æ³•">å¼•ç”¨è®¡æ•°æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n573"><a class="md-toc-inner" href="#å¯è¾¾æ€§åˆ†æ">å¯è¾¾æ€§åˆ†æ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n614"><a class="md-toc-inner" href="#æ¸…ç†åƒåœ¾ç®—æ³•">æ¸…ç†åƒåœ¾ç®—æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n616"><a class="md-toc-inner" href="#æ ‡è®°markï¼‰">æ ‡è®°ï¼ˆMarkï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n621"><a class="md-toc-inner" href="#æ¸…é™¤sweepï¼‰">æ¸…é™¤ï¼ˆSweepï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n630"><a class="md-toc-inner" href="#å¤åˆ¶copyingï¼‰">å¤åˆ¶ï¼ˆCopyingï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n643"><a class="md-toc-inner" href="#æ•´ç†compactï¼‰">æ•´ç†ï¼ˆCompactï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n648"><a class="md-toc-inner" href="#æ‰©å±•å›æ”¶ç®—æ³•">æ‰©å±•å›æ”¶ç®—æ³•</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n660"><a class="md-toc-inner" href="#æ ‡è®°æ¸…é™¤mark-sweepï¼‰">æ ‡è®°æ¸…é™¤ï¼ˆMark-Sweepï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n670"><a class="md-toc-inner" href="#æ ‡è®°æ•´ç†mark-compactï¼‰">æ ‡è®°æ•´ç†ï¼ˆMark-Compactï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n682"><a class="md-toc-inner" href="#æ ‡è®°å¤åˆ¶mark-copingï¼‰">æ ‡è®°å¤åˆ¶ï¼ˆMark-Copingï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n692"><a class="md-toc-inner" href="#åˆ†ä»£æ”¶é›†generational-collectionï¼‰">åˆ†ä»£æ”¶é›†ï¼ˆGenerational Collectionï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n741"><a class="md-toc-inner" href="#åˆ†åŒºæ”¶é›†">åˆ†åŒºæ”¶é›†</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n744"><a class="md-toc-inner" href="#gcåƒåœ¾æ”¶é›†å™¨">GCåƒåœ¾æ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n763"><a class="md-toc-inner" href="#å¹´è½»ä»£æ”¶é›†å™¨">å¹´è½»ä»£æ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n764"><a class="md-toc-inner" href="#serialæ”¶é›†å™¨">Serialæ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n768"><a class="md-toc-inner" href="#parnewæ”¶é›†å™¨">ParNewæ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n772"><a class="md-toc-inner" href="#parallel-scavengeæ”¶é›†å™¨">Parallel Scavengeæ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n780"><a class="md-toc-inner" href="#è€å¹´ä»£æ”¶é›†å™¨">è€å¹´ä»£æ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n781"><a class="md-toc-inner" href="#serial-oldæ”¶é›†å™¨">Serial Oldæ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n785"><a class="md-toc-inner" href="#parallel-oldæ”¶é›†å™¨">Parallel Oldæ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n789"><a class="md-toc-inner" href="#cmsæ”¶é›†å™¨">CMSæ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n844"><a class="md-toc-inner" href="#æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ”¶é›†">æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ”¶é›†</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n845"><a class="md-toc-inner" href="#g1æ”¶é›†å™¨">G1æ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n921"><a class="md-toc-inner" href="#zgcæ”¶é›†å™¨">ZGCæ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n939"><a class="md-toc-inner" href="#shenandoahæ”¶é›†å™¨">Shenandoahæ”¶é›†å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n962"><a class="md-toc-inner" href="#gcæ—¥å¿—">GCæ—¥å¿—</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n963"><a class="md-toc-inner" href="#æ—¥å¿—æ ¼å¼">æ—¥å¿—æ ¼å¼</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n969"><a class="md-toc-inner" href="#æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n985"><a class="md-toc-inner" href="#gcåœºæ™¯">GCåœºæ™¯</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n986"><a class="md-toc-inner" href="#full-gcåœºæ™¯">Full GCåœºæ™¯</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1043"><a class="md-toc-inner" href="#cms-gcåœºæ™¯">CMS GCåœºæ™¯</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1264"><a class="md-toc-inner" href="#jvmæ€§èƒ½è°ƒä¼˜">JVMæ€§èƒ½è°ƒä¼˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1265"><a class="md-toc-inner" href="#ç£ç›˜ä¸è¶³æ’æŸ¥">ç£ç›˜ä¸è¶³æ’æŸ¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1274"><a class="md-toc-inner" href="#cpuè¿‡é«˜æ’æŸ¥">CPUè¿‡é«˜æ’æŸ¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1307"><a class="md-toc-inner" href="#å†…å­˜æ‰“æ»¡æ’æŸ¥">å†…å­˜æ‰“æ»¡æ’æŸ¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1334"><a class="md-toc-inner" href="#oomå¼‚å¸¸æ’æŸ¥">OOMå¼‚å¸¸æ’æŸ¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1375"><a class="md-toc-inner" href="#jvisualvm-1">Jvisualvm</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1377"><a class="md-toc-inner" href="#å†…å­˜é—®é¢˜">å†…å­˜é—®é¢˜</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1385"><a class="md-toc-inner" href="#cpuè€—æ—¶é—®é¢˜æ’æŸ¥">CPUè€—æ—¶é—®é¢˜æ’æŸ¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1392"><a class="md-toc-inner" href="#è°ƒä¼˜å †å†…å­˜åˆ†é…">è°ƒä¼˜å †å†…å­˜åˆ†é…</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1420"><a class="md-toc-inner" href="#å¹´è½»ä»£è°ƒä¼˜">å¹´è½»ä»£è°ƒä¼˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1455"><a class="md-toc-inner" href="#è€å¹´ä»£è°ƒä¼˜">è€å¹´ä»£è°ƒä¼˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1467"><a class="md-toc-inner" href="#æ ˆæº¢å‡º">æ ˆæº¢å‡º</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1471"><a class="md-toc-inner" href="#æ­»é”æ’æŸ¥">æ­»é”æ’æŸ¥</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1501"><a class="md-toc-inner" href="#è°ƒä¼˜å®æˆ˜">è°ƒä¼˜å®æˆ˜</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1531"><a class="md-toc-inner" href="#è°ƒä¼˜å‚æ•°">è°ƒä¼˜å‚æ•°</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1532"><a class="md-toc-inner" href="#å †">å †</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1549"><a class="md-toc-inner" href="#æ ˆ">æ ˆ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1554"><a class="md-toc-inner" href="#å…ƒç©ºé—´">å…ƒç©ºé—´</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1561"><a class="md-toc-inner" href="#ç›´æ¥å†…å­˜">ç›´æ¥å†…å­˜</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1566"><a class="md-toc-inner" href="#æ—¥å¿—">æ—¥å¿—</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1583"><a class="md-toc-inner" href="#gc-2">GC</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1584"><a class="md-toc-inner" href="#serialåƒåœ¾æ”¶é›†å™¨æ–°ç”Ÿä»£ï¼‰">Serialåƒåœ¾æ”¶é›†å™¨ï¼ˆæ–°ç”Ÿä»£ï¼‰</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1594"><a class="md-toc-inner" href="#parallel-scavengeæ”¶é›†å™¨æ–°ç”Ÿä»£ï¼‰å¼€å¯">Parallel Scavengeæ”¶é›†å™¨ï¼ˆæ–°ç”Ÿä»£ï¼‰å¼€å¯</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1601"><a class="md-toc-inner" href="#parallelolåƒåœ¾æ”¶é›†å™¨è€å¹´ä»£ï¼‰å¼€å¯">ParallelOlåƒåœ¾æ”¶é›†å™¨ï¼ˆè€å¹´ä»£ï¼‰å¼€å¯</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1608"><a class="md-toc-inner" href="#parnewåƒåœ¾æ”¶é›†å™¨æ–°ç”Ÿä»£ï¼‰å¼€å¯">ParNewåƒåœ¾æ”¶é›†å™¨ï¼ˆæ–°ç”Ÿä»£ï¼‰å¼€å¯</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1615"><a class="md-toc-inner" href="#cmsåƒåœ¾æ”¶é›†å™¨è€å¹´ä»£ï¼‰å¼€å¯">CMSåƒåœ¾æ”¶é›†å™¨ï¼ˆè€å¹´ä»£ï¼‰å¼€å¯</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1638"><a class="md-toc-inner" href="#g1åƒåœ¾æ”¶é›†å™¨å¼€å¯">G1åƒåœ¾æ”¶é›†å™¨å¼€å¯</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1649"><a class="md-toc-inner" href="#jdk-tools">JDK Tools</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1650"><a class="md-toc-inner" href="#jps">jps</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1654"><a class="md-toc-inner" href="#jstat">jstat</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1665"><a class="md-toc-inner" href="#jstack">jstack</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1719"><a class="md-toc-inner" href="#jmap">jmap</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1766"><a class="md-toc-inner" href="#jhat">jhat</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1770"><a class="md-toc-inner" href="#jconsole">jconsole</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1789"><a class="md-toc-inner" href="#jvisualvm-2">jvisualvm</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1802"><a class="md-toc-inner" href="#jmc">jmc</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1807"><a class="md-toc-inner" href="#å¯åŠ¨jfr">å¯åŠ¨JFR</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1841"><a class="md-toc-inner" href="#å¸¸ç”¨jfrå‘½ä»¤">å¸¸ç”¨JFRå‘½ä»¤</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1872"><a class="md-toc-inner" href="#å‘½ä»¤å¯åŠ¨jfræ¡ˆä¾‹">å‘½ä»¤å¯åŠ¨JFRæ¡ˆä¾‹</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1895"><a class="md-toc-inner" href="#jfræ¦‚å†µ">JFRæ¦‚å†µ</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1900"><a class="md-toc-inner" href="#jfrå†…å­˜è§†å›¾">JFRå†…å­˜è§†å›¾</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1904"><a class="md-toc-inner" href="#jfr-ä»£ç è§†å›¾">JFR ä»£ç è§†å›¾</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1908"><a class="md-toc-inner" href="#jfräº‹ä»¶è§†å›¾">JFRäº‹ä»¶è§†å›¾</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1912"><a class="md-toc-inner" href="#eclipsemat">EclipseMAT</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2097"><a class="md-toc-inner" href="#ğŸ”¥ç«ç„°å›¾">ğŸ”¥ç«ç„°å›¾</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2099"><a class="md-toc-inner" href="#ç¯å¢ƒå®‰è£…">ç¯å¢ƒå®‰è£…</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2101"><a class="md-toc-inner" href="#å®‰è£…perl">å®‰è£…Perl</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2105"><a class="md-toc-inner" href="#cç¼–è¯‘å™¨">C++ç¼–è¯‘å™¨</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2109"><a class="md-toc-inner" href="#cloneç›¸å…³é¡¹ç›®">cloneç›¸å…³é¡¹ç›®</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2113"><a class="md-toc-inner" href="#ç¼–è¯‘é¡¹ç›®">ç¼–è¯‘é¡¹ç›®</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2117"><a class="md-toc-inner" href="#ç”Ÿæˆæ–‡ä»¶">ç”Ÿæˆæ–‡ä»¶</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2118"><a class="md-toc-inner" href="#ç”Ÿæˆç«ç„°å›¾æ•°æ®">ç”Ÿæˆç«ç„°å›¾æ•°æ®</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2123"><a class="md-toc-inner" href="#ç”Ÿæˆsvgæ–‡ä»¶">ç”Ÿæˆsvgæ–‡ä»¶</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2128"><a class="md-toc-inner" href="#å±•ç¤ºç«ç„°å›¾">å±•ç¤ºç«ç„°å›¾</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2132"><a class="md-toc-inner" href="#ç«ç„°å›¾æ¡ˆä¾‹">ç«ç„°å›¾æ¡ˆä¾‹</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2135"><a class="md-toc-inner" href="#ç“¶é¢ˆç‚¹1">ç“¶é¢ˆç‚¹1</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2139"><a class="md-toc-inner" href="#ç“¶é¢ˆç‚¹2">ç“¶é¢ˆç‚¹2</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n2146"><a class="md-toc-inner" href="#ç“¶é¢ˆç‚¹3">ç“¶é¢ˆç‚¹3</a></span></p></div><p>&nbsp;</p><p><a href='https://mp.weixin.qq.com/s?__biz=MzI4NjI1OTI4Nw==&amp;mid=2247489183&amp;idx=1&amp;sn=02ab3551c473bd2c8429862e3689a94b&amp;chksm=ebdef7a7dca97eb17194c3d935c86ade240d3d96bbeaf036233a712832fb94af07adeafa098b&amp;mpshare=1&amp;scene=23&amp;srcid=0812OQ78gD47QJEguFGixUVa&amp;sharer_sharetime=1628761112690&amp;sharer_shareid=0f9991a2eb945ab493c13ed9bfb8bf4b#rd' target='_blank' class='url'>https://mp.weixin.qq.com/s?__biz=MzI4NjI1OTI4Nw==&mid=2247489183&idx=1&sn=02ab3551c473bd2c8429862e3689a94b&chksm=ebdef7a7dca97eb17194c3d935c86ade240d3d96bbeaf036233a712832fb94af07adeafa098b&mpshare=1&scene=23&srcid=0812OQ78gD47QJEguFGixUVa&sharer_sharetime=1628761112690&sharer_shareid=0f9991a2eb945ab493c13ed9bfb8bf4b#rd</a></p><p>&nbsp;</p><p><a href='https://mp.weixin.qq.com/s?__biz=MzI2MTE2MDY1Mw==&amp;mid=2247487806&amp;idx=1&amp;sn=c49eb3227c64ffcd0e70a68337f6ec7a&amp;chksm=ea5ffa9cdd28738a788dabd7298e469162890056911c03b89722745827091229bce967ca86e5&amp;mpshare=1&amp;scene=23&amp;srcid=0604attIgnqDFh2fzPnb4bxP&amp;sharer_sharetime=1654358575060&amp;sharer_shareid=58da8c00fa5081a53eb48d6699b00753%23rd' target='_blank' class='url'>https://mp.weixin.qq.com/s?__biz=MzI2MTE2MDY1Mw==&mid=2247487806&idx=1&sn=c49eb3227c64ffcd0e70a68337f6ec7a&chksm=ea5ffa9cdd28738a788dabd7298e469162890056911c03b89722745827091229bce967ca86e5&mpshare=1&scene=23&srcid=0604attIgnqDFh2fzPnb4bxP&sharer_sharetime=1654358575060&sharer_shareid=58da8c00fa5081a53eb48d6699b00753%23rd</a></p><p>&nbsp;</p><h1 id='classloader'><span>Classloader</span></h1><h2 id='ç±»åŠ è½½æœºåˆ¶'><span>ç±»åŠ è½½æœºåˆ¶</span></h2><p><span>JVMæŠŠæè¿°ç±»çš„æ•°æ®åŠ è½½åˆ°å†…å­˜é‡Œé¢ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå˜æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„classå¯¹è±¡ã€‚æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šåŠ è½½ï¼ˆLoadingï¼‰ã€éªŒè¯ï¼ˆVerificationï¼‰ã€å‡†å¤‡(Preparation)ã€è§£æ(Resolution)ã€åˆå§‹åŒ–(Initialization)ã€ä½¿ç”¨(Using)å’Œå¸è½½(Unloading)7ä¸ªé˜¶æ®µã€‚å…¶ä¸­å‡†å¤‡ã€éªŒè¯ã€è§£æ3ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆLinkingï¼‰ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250619.png" referrerpolicy="no-referrer" alt="JVMç±»åŠ è½½æœºåˆ¶"></p><p><span>ç±»åŠ è½½è¿‡ç¨‹å¦‚ä¸‹ï¼š</span></p><ul><li><p><span>åŠ è½½ã€‚åŠ è½½åˆ†ä¸ºä¸‰æ­¥ï¼š</span></p><ul><li><span>é€šè¿‡ç±»çš„å…¨é™å®šæ€§ç±»åè·å–è¯¥ç±»çš„äºŒè¿›åˆ¶æµ</span></li><li><span>å°†è¯¥äºŒè¿›åˆ¶æµçš„é™æ€å­˜å‚¨ç»“æ„è½¬ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</span></li><li><span>åœ¨å †ä¸­ä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªclasså¯¹è±¡</span></li></ul></li><li><p><span>éªŒè¯ï¼šéªŒè¯è¯¥classæ–‡ä»¶ä¸­çš„å­—èŠ‚æµä¿¡æ¯å¤åˆè™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œä¸ä¼šå¨èƒåˆ°jvmçš„å®‰å…¨</span></p></li><li><p><span>å‡†å¤‡ï¼šä¸ºclasså¯¹è±¡çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œåˆå§‹åŒ–å…¶åˆå§‹å€¼</span></p></li><li><p><span>è§£æï¼šè¯¥é˜¶æ®µä¸»è¦å®Œæˆç¬¦å·å¼•ç”¨è½¬åŒ–æˆç›´æ¥å¼•ç”¨</span></p></li><li><p><span>åˆå§‹åŒ–ï¼šåˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„javaä»£ç ï¼›åˆå§‹åŒ–é˜¶æ®µæ˜¯è°ƒç”¨ç±»æ„é€ å™¨çš„è¿‡ç¨‹</span></p></li></ul><p>&nbsp;</p><h2 id='ç±»åŠ è½½å™¨'><span>ç±»åŠ è½½å™¨</span></h2><p><span>è™šæ‹Ÿæœºè®¾è®¡å›¢é˜ŸæŠŠåŠ è½½åŠ¨ä½œæ”¾åˆ° JVM å¤–éƒ¨å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºå†³å®šå¦‚ä½•è·å–æ‰€éœ€çš„ç±»ï¼ŒJVM æä¾›äº† 3 ç§ç±»åŠ è½½å™¨ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250618.png" referrerpolicy="no-referrer" alt="Classloader"></p><ul><li><p><strong><span>å¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader)</span></strong></p><p><strong><span>ç”¨æ¥åŠ è½½javaæ ¸å¿ƒç±»åº“ï¼Œæ— æ³•è¢«javaç¨‹åºç›´æ¥å¼•ç”¨</span></strong><span>ã€‚è´Ÿè´£åŠ è½½ JAVA_HOME\lib ç›®å½•ä¸­çš„ï¼Œæˆ–é€šè¿‡-Xbootclasspath å‚æ•°æŒ‡å®šè·¯å¾„ä¸­çš„ï¼Œä¸”è¢«è™šæ‹Ÿæœºè®¤å¯ï¼ˆæŒ‰æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚ rt.jarï¼‰çš„ç±»ã€‚</span></p></li><li><p><strong><span>æ‰©å±•ç±»åŠ è½½å™¨(Extension ClassLoader)</span></strong></p><p><strong><span>ç”¨æ¥åŠ è½½javaçš„æ‰©å±•åº“ï¼Œjavaçš„è™šæ‹Ÿæœºå®ç°ä¼šæä¾›ä¸€ä¸ªæ‰©å±•åº“ç›®å½•ï¼Œè¯¥ç±»åŠ è½½å™¨åœ¨æ‰©å±•åº“ç›®å½•é‡Œé¢æŸ¥æ‰¾å¹¶åŠ è½½javaç±»</span></strong><span>ã€‚è´Ÿè´£åŠ è½½ JAVA_HOME\lib\ext ç›®å½•ä¸­çš„ï¼Œæˆ–é€šè¿‡ java.ext.dirs ç³»ç»Ÿå˜é‡æŒ‡å®šè·¯å¾„ä¸­çš„ç±»åº“ã€‚</span></p></li><li><p><strong><span>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨(Application ClassLoader)</span></strong></p><p><strong><span>å®ƒæ ¹æ®javaçš„ç±»è·¯å¾„æ¥åŠ è½½ç±»ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œjavaåº”ç”¨çš„ç±»éƒ½æ˜¯é€šè¿‡å®ƒæ¥åŠ è½½çš„</span></strong><span>ã€‚è´Ÿè´£åŠ è½½ç”¨æˆ·è·¯å¾„ï¼ˆclasspathï¼‰ä¸Šçš„ç±»åº“ã€‚JVM é€šè¿‡åŒäº²å§”æ´¾æ¨¡å‹è¿›è¡Œç±»çš„åŠ è½½ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿java.lang.ClassLoader å®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚</span></p></li><li><p><strong><span>è‡ªå®šä¹‰ç±»åŠ è½½å™¨(User ClassLoader)</span></strong></p><p><span>ç”±JAVAè¯­è¨€å®ç°ï¼Œç»§æ‰¿è‡ªClassLoaderã€‚</span></p></li></ul><p>&nbsp;</p><p><span>æ­¤å¤–æˆ‘ä»¬æ¯”è¾ƒéœ€è¦çŸ¥é“çš„å‡ ç‚¹ï¼š</span></p><ul><li><span>ä¸€ä¸ªç±»æ˜¯ç”± jvm åŠ è½½æ˜¯é€šè¿‡ç±»åŠ è½½å™¨+å…¨é™å®šç±»åç¡®å®šå”¯ä¸€æ€§çš„</span></li><li><span>åŒäº²å§”æ´¾ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œå­åŠ è½½å™¨ä¼šå°½é‡å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œçˆ¶åŠ è½½å™¨æ‰¾ä¸åˆ°å†è‡ªå·±åŠ è½½</span></li><li><span>çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½ï¼Œä¸ºäº†æ»¡è¶³ spi ç­‰éœ€æ±‚çªç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå½“é«˜å±‚ç±»åŠ è½½å™¨æƒ³åŠ è½½åº•å±‚ç±»æ—¶é€šè¿‡ Thread.contextClassLoader æ¥è·å–å½“å‰çº¿ç¨‹çš„ç±»åŠ è½½å™¨(å¾€å¾€æ˜¯åº•å±‚ç±»åŠ è½½å™¨)å»åŠ è½½ç±»</span></li></ul><p>&nbsp;</p><h2 id='åŒäº²å§”æ´¾'><span>åŒäº²å§”æ´¾</span></h2><p><span>å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°ä¸€ä¸ªç±»åŠ è½½çš„è¯·æ±‚ï¼Œä»–é¦–å…ˆä¸ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè€Œæ˜¯å°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ï¼Œåªæœ‰çˆ¶ç±»åŠ è½½å™¨åœ¨è‡ªå·±çš„æœç´¢èŒƒå›´ç±»æŸ¥æ‰¾ä¸åˆ°ç»™ç±»æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½è¯¥ç±»ã€‚</span></p><p><span>æ‰€æœ‰çš„åŠ è½½è¯·æ±‚éƒ½ä¼šä¼ é€åˆ°æ ¹åŠ è½½å™¨å»åŠ è½½ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šå»åŠ è½½ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250625.png" referrerpolicy="no-referrer" alt="åŒäº²å§”æ´¾"></p><p><strong><span>ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</span></strong></p><p><span>ä¸ºäº†é˜²æ­¢å†…å­˜ä¸­å‡ºç°å¤šä¸ªç›¸åŒçš„å­—èŠ‚ç ã€‚å› ä¸ºå¦‚æœæ²¡æœ‰åŒäº²å§”æ´¾çš„è¯ï¼Œç”¨æˆ·å°±å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªjava.lang.Stringç±»ï¼Œé‚£ä¹ˆå°±æ— æ³•ä¿è¯ç±»çš„å”¯ä¸€æ€§ã€‚</span></p><p><strong><span>é‚£æ€ä¹ˆæ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</span></strong></p><p><span>è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œç»§æ‰¿ClassLoaderç±»ï¼Œé‡å†™loadClassæ–¹æ³•å’ŒfindClassæ–¹æ³•ã€‚</span></p><p><strong><span>åŒäº²å§”æ´¾æ¨¡å‹çš„ä½œç”¨</span></strong></p><ul><li><span>é¿å…ç±»çš„é‡å¤åŠ è½½</span></li><li><span>ä¿è¯Javaæ ¸å¿ƒç±»åº“çš„å®‰å…¨</span></li></ul><p>&nbsp;</p><h1 id='jvm'><span>JVM</span></h1><h2 id='javaå†…å­˜æ¨¡å‹'><span>JAVAå†…å­˜æ¨¡å‹</span></h2><p><span>Javaè™šæ‹Ÿæœºè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰æ¥</span><strong><span>å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚</span></strong><span>ï¼Œä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250624.jpg" referrerpolicy="no-referrer" alt="JAVAå†…å­˜æ¨¡å‹"></p><p><span>JMMæè¿°äº†Javaç¨‹åºä¸­å„ç§å˜é‡ï¼ˆçº¿ç¨‹å…±äº«å˜é‡ï¼‰çš„è®¿é—®è§„åˆ™ï¼Œä»¥åŠåœ¨JVMä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜ä¸­è¯»å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å·¥ä½œå†…å­˜ï¼Œé‡Œé¢ä¿å­˜è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„å‰¯æœ¬ï¼ˆä¸»å†…å­˜ä¸­å˜é‡çš„ä¸€ä»½æ‹·è´ï¼‰ã€‚JMMçš„ä¸¤æ¡è§„å®šï¼š</span></p><ul><li><strong><span>çº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œä¸èƒ½ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å†™</span></strong></li><li><strong><span>ä¸åŒçš„çº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å…¶ä»–çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹å˜é‡å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ</span></strong></li></ul><p>&nbsp;</p><p><strong><span>Java å†…å­˜æ¨¡å‹</span></strong><span>ï¼ˆä¸‹æ–‡ç®€ç§° </span><strong><span>JMM</span></strong><span>ï¼‰å°±æ˜¯åœ¨åº•å±‚å¤„ç†å™¨å†…å­˜æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå®šä¹‰è‡ªå·±çš„å¤šçº¿ç¨‹è¯­ä¹‰ã€‚å®ƒæ˜ç¡®æŒ‡å®šäº†ä¸€ç»„æ’åºè§„åˆ™ï¼Œæ¥ä¿è¯çº¿ç¨‹é—´çš„å¯è§æ€§ã€‚è¿™ä¸€ç»„è§„åˆ™è¢«ç§°ä¸º </span><strong><span>Happens-Before</span></strong><span>, JMM è§„å®šï¼Œè¦æƒ³ä¿è¯ B æ“ä½œèƒ½å¤Ÿçœ‹åˆ° A æ“ä½œçš„ç»“æœï¼ˆæ— è®ºå®ƒä»¬æ˜¯å¦åœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œé‚£ä¹ˆ A å’Œ B ä¹‹é—´å¿…é¡»æ»¡è¶³ </span><strong><span>Happens-Before å…³ç³»</span></strong><span>ï¼š</span></p><ul><li><strong><span>å•çº¿ç¨‹è§„åˆ™</span></strong><span>ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªåŠ¨ä½œéƒ½ happens-before è¯¥çº¿ç¨‹ä¸­åç»­çš„æ¯ä¸ªåŠ¨ä½œ</span></li><li><strong><span>ç›‘è§†å™¨é”å®šè§„åˆ™</span></strong><span>ï¼šç›‘å¬å™¨çš„</span><strong><span>è§£é”</span></strong><span>åŠ¨ä½œ happens-before åç»­å¯¹è¿™ä¸ªç›‘å¬å™¨çš„</span><strong><span>é”å®š</span></strong><span>åŠ¨ä½œ</span></li><li><strong><span>volatile å˜é‡è§„åˆ™</span></strong><span>ï¼šå¯¹ volatile å­—æ®µçš„å†™å…¥åŠ¨ä½œ happens-before åç»­å¯¹è¿™ä¸ªå­—æ®µçš„æ¯ä¸ªè¯»å–åŠ¨ä½œ</span></li><li><strong><span>çº¿ç¨‹ start è§„åˆ™</span></strong><span>ï¼šçº¿ç¨‹ </span><strong><span>start()</span></strong><span> æ–¹æ³•çš„æ‰§è¡Œ happens-before ä¸€ä¸ªå¯åŠ¨çº¿ç¨‹å†…çš„ä»»æ„åŠ¨ä½œ</span></li><li><strong><span>çº¿ç¨‹ join è§„åˆ™</span></strong><span>ï¼šä¸€ä¸ªçº¿ç¨‹å†…çš„æ‰€æœ‰åŠ¨ä½œ happens-before ä»»æ„å…¶ä»–çº¿ç¨‹åœ¨è¯¥çº¿ç¨‹ </span><strong><span>join()</span></strong><span> æˆåŠŸè¿”å›ä¹‹å‰</span></li><li><strong><span>ä¼ é€’æ€§</span></strong><span>ï¼šå¦‚æœ A happens-before B, ä¸” B happens-before C, é‚£ä¹ˆ A happens-before C</span></li></ul><h2 id='jvmå†…å­˜ç»“æ„'><span>JVMå†…å­˜ç»“æ„</span></h2><p><span>JVMåŒ…å«</span><strong><span>å †</span></strong><span>ã€</span><strong><span>å…ƒç©ºé—´</span></strong><span>ã€</span><strong><span>Javaè™šæ‹Ÿæœºæ ˆ</span></strong><span>ã€</span><strong><span>æœ¬åœ°æ–¹æ³•æ ˆ</span></strong><span>ã€</span><strong><span>ç¨‹åºè®¡æ•°å™¨</span></strong><span>ç­‰å†…å­˜åŒºåŸŸï¼Œå…¶ä¸­</span><strong><span>å †</span></strong><span>æ˜¯å ç”¨å†…å­˜æœ€å¤§çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250629.png" referrerpolicy="no-referrer" alt="JVMæ¶æ„"></p><p>&nbsp;</p><p><strong><span>JVMå¸¸é‡æ± </span></strong></p><p><span>JVMå¸¸é‡æ± ä¸»è¦åˆ†ä¸º</span><strong><span>Classæ–‡ä»¶å¸¸é‡æ± ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€å…¨å±€å­—ç¬¦ä¸²å¸¸é‡æ± ã€ä»¥åŠåŸºæœ¬ç±»å‹åŒ…è£…ç±»å¯¹è±¡å¸¸é‡æ± </span></strong><span>ã€‚</span></p><ul><li><strong><span>Classæ–‡ä»¶å¸¸é‡æ± </span></strong><span>ï¼šclassæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥å­—èŠ‚ä¸ºå•ä½çš„äºŒè¿›åˆ¶æ•°æ®æµï¼Œåœ¨javaä»£ç çš„ç¼–è¯‘æœŸé—´ï¼Œæˆ‘ä»¬ç¼–å†™çš„javaæ–‡ä»¶å°±è¢«ç¼–è¯‘ä¸º.classæ–‡ä»¶æ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®å­˜æ”¾åœ¨ç£ç›˜ä¸­ï¼Œå…¶ä¸­å°±åŒ…æ‹¬classæ–‡ä»¶å¸¸é‡æ± ã€‚</span></li><li><strong><span>è¿è¡Œæ—¶å¸¸é‡æ± </span></strong><span>ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ç›¸å¯¹äºclasså¸¸é‡æ± ä¸€å¤§ç‰¹å¾å°±æ˜¯å…·æœ‰åŠ¨æ€æ€§ï¼Œjavaè§„èŒƒå¹¶ä¸è¦æ±‚å¸¸é‡åªèƒ½åœ¨è¿è¡Œæ—¶æ‰äº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯è¯´è¿è¡Œæ—¶å¸¸é‡æ± çš„å†…å®¹å¹¶ä¸å…¨éƒ¨æ¥è‡ªclasså¸¸é‡æ± ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡ä»£ç ç”Ÿæˆå¸¸é‡å¹¶å°†å…¶æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œè¿™ç§ç‰¹æ€§è¢«ç”¨çš„æœ€å¤šçš„å°±æ˜¯String.intern()ã€‚</span></li><li><strong><span>å…¨å±€å­—ç¬¦ä¸²å¸¸é‡æ± </span></strong><span>ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯JVMæ‰€ç»´æŠ¤çš„ä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨è¡¨ï¼Œåœ¨HotSpot VMä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«åšStringTableçš„å…¨å±€è¡¨ã€‚åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç»´æŠ¤çš„æ˜¯å­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨ï¼Œåº•å±‚C++å®ç°å°±æ˜¯ä¸€ä¸ªHashtableã€‚è¿™äº›è¢«ç»´æŠ¤çš„å¼•ç”¨æ‰€æŒ‡çš„å­—ç¬¦ä¸²å®ä¾‹ï¼Œè¢«ç§°ä½œâ€è¢«é©»ç•™çš„å­—ç¬¦ä¸²â€æˆ–â€interned stringâ€æˆ–é€šå¸¸æ‰€è¯´çš„â€è¿›å…¥äº†å­—ç¬¦ä¸²å¸¸é‡æ± çš„å­—ç¬¦ä¸²â€ã€‚</span></li><li><strong><span>åŸºæœ¬ç±»å‹åŒ…è£…ç±»å¯¹è±¡å¸¸é‡æ± </span></strong><span>ï¼šjavaä¸­åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»çš„å¤§éƒ¨åˆ†éƒ½å®ç°äº†å¸¸é‡æ± æŠ€æœ¯ï¼Œè¿™äº›ç±»æ˜¯Byte,Short,Integer,Long,Character,Boolean,å¦å¤–ä¸¤ç§æµ®ç‚¹æ•°ç±»å‹çš„åŒ…è£…ç±»åˆ™æ²¡æœ‰å®ç°ã€‚å¦å¤–ä¸Šé¢è¿™5ç§æ•´å‹çš„åŒ…è£…ç±»ä¹Ÿåªæ˜¯åœ¨å¯¹åº”å€¼å°äºç­‰äº127æ—¶æ‰å¯ä½¿ç”¨å¯¹è±¡æ± ï¼Œä¹Ÿå³å¯¹è±¡ä¸è´Ÿè´£åˆ›å»ºå’Œç®¡ç†å¤§äº127çš„è¿™äº›ç±»çš„å¯¹è±¡ã€‚</span></li></ul><p>&nbsp;</p><h2 id='jvmå†…å­˜æ¨¡å‹'><span>JVMå†…å­˜æ¨¡å‹</span></h2><p><span>JVMè¯•å›¾å®šä¹‰ä¸€ç§ç»Ÿä¸€çš„å†…å­˜æ¨¡å‹ï¼Œèƒ½å°†å„ç§åº•å±‚ç¡¬ä»¶ä»¥åŠæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚è¿›è¡Œå°è£…ï¼Œä½¿Javaç¨‹åºåœ¨ä¸åŒç¡¬ä»¶ä»¥åŠæ“ä½œç³»ç»Ÿä¸Šéƒ½èƒ½è¾¾åˆ°ç›¸åŒçš„å¹¶å‘æ•ˆæœã€‚</span><strong><span>å®ƒåˆ†ä¸ºå·¥ä½œå†…å­˜å’Œä¸»å†…å­˜ï¼Œçº¿ç¨‹æ— æ³•å¯¹ä¸»å­˜å‚¨å™¨ç›´æ¥è¿›è¡Œæ“ä½œï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è¦å’Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹é€šä¿¡ï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡ä¸»å­˜è¿›è¡Œäº¤æ¢</span></strong><span>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250632.png" referrerpolicy="no-referrer" alt="JVMå†…å­˜ç»“æ„ï¼ˆJDK1.6ï¼‰"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250890.png" referrerpolicy="no-referrer" alt="JVMå†…å­˜ç»“æ„ï¼ˆJDK1.7ï¼‰"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250894.png" referrerpolicy="no-referrer" alt="JVMå†…å­˜ç»“æ„ï¼ˆJDK1.8ï¼‰"></p><p><strong><span>çº¿ç¨‹éš”ç¦»æ•°æ®åŒºï¼š</span></strong></p><ul><li><strong><span>ç¨‹åºè®¡æ•°å™¨ï¼š</span></strong><span> ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå­˜å‚¨å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨</span></li><li><strong><span>è™šæ‹Ÿæœºæ ˆï¼š</span></strong><span> é‡Œé¢çš„å…ƒç´ å«æ ˆå¸§ï¼Œå­˜å‚¨ </span><strong><span>å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•è¿”å›åœ°å€</span></strong><span> ç­‰</span></li><li><strong><span>æœ¬åœ°æ–¹æ³•æ ˆï¼š</span></strong><span> ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„æœ¬åœ°Nativeæ–¹æ³•æœåŠ¡æ—¶çš„æ ˆå¸§ï¼Œå’Œè™šæ‹Ÿæœºæ ˆç±»ä¼¼</span></li></ul><p><strong><span>çº¿ç¨‹å…±äº«æ•°æ®åŒºï¼š</span></strong></p><ul><li><strong><span>æ–¹æ³•åŒºï¼š</span></strong><span> å­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„</span><strong><span>ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç </span></strong><span>ç­‰æ•°æ®</span></li><li><strong><span>å †ï¼š</span></strong><span> å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾</span><strong><span>å¯¹è±¡çš„å®ä¾‹</span></strong><span>ï¼Œæ˜¯åƒåœ¾å›æ”¶ç®¡ç†å™¨çš„ä¸»è¦åŒºåŸŸ</span></li><li><strong><span>å…ƒæ•°æ®åŒº</span></strong><span>ï¼šå¸¸é‡æ± ã€æ–¹æ³•å…ƒä¿¡æ¯ã€</span></li></ul><p>&nbsp;</p><h3 id='ç¨‹åºè®¡æ•°å™¨'><span>ç¨‹åºè®¡æ•°å™¨</span></h3><p><span>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ä¹Ÿå«PCå¯„å­˜å™¨ã€‚ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚JVMæ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ã€‚å€˜è‹¥å½“å‰æ‰§è¡Œçš„æ˜¯ JVM çš„æ–¹æ³•ï¼Œåˆ™è¯¥å¯„å­˜å™¨ä¸­ä¿å­˜å½“å‰æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€ï¼›å€˜è‹¥æ‰§è¡Œçš„æ˜¯native æ–¹æ³•ï¼Œåˆ™PCå¯„å­˜å™¨ä¸­ä¸ºç©º(undefined)ã€‚</span></p><ul><li><span>å½“å‰çº¿ç¨‹ç§æœ‰</span></li><li><span>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨</span></li><li><span>ä¸ä¼šå‡ºç°OutOfMemoryErroræƒ…å†µ</span></li><li><span>ä»¥ä¸€ç§æ•°æ®ç»“æ„çš„å½¢å¼æ”¾ç½®äºå†…å­˜ä¸­</span></li></ul><p><strong><span>æ³¨æ„</span></strong><span>ï¼šç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° </span><code>OutOfMemoryError</code><span> çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚</span></p><p>&nbsp;</p><h3 id='javaè™šæ‹Ÿæœºæ ˆ'><span>JAVAè™šæ‹Ÿæœºæ ˆ</span></h3><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250907.png" referrerpolicy="no-referrer" alt="JAVAè™šæ‹Ÿæœºæ ˆ"></p><p><span>JAVAè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰æ˜¯æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªç§æœ‰çš„æ ˆï¼Œéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹åŒè¿›åŒé€€ã€‚æ ˆé‡Œé¢å­˜ç€çš„æ˜¯ä¸€ç§å«â€œæ ˆå¸§â€çš„ä¸œè¥¿ï¼Œæ¯ä¸ªJavaæ–¹æ³•åœ¨è¢«è°ƒç”¨çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œä¸€æ—¦å®Œæˆè°ƒç”¨ï¼Œåˆ™å‡ºæ ˆã€‚æ‰€æœ‰çš„çš„æ ˆå¸§éƒ½å‡ºæ ˆåï¼Œçº¿ç¨‹ä¹Ÿå°±å®Œæˆäº†ä½¿å‘½ã€‚æ ˆå¸§ä¸­å­˜æ”¾äº†å±€éƒ¨å˜é‡è¡¨ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨ï¼‰ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥(æŒ‡å‘å½“å‰æ–¹æ³•æ‰€å±çš„ç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨ç­‰)ã€æ–¹æ³•å‡ºå£(æ–¹æ³•è¿”å›åœ°å€)ã€å’Œä¸€äº›é¢å¤–çš„é™„åŠ ä¿¡æ¯ã€‚æ ˆçš„å¤§å°å¯ä»¥å›ºå®šä¹Ÿå¯ä»¥åŠ¨æ€æ‰©å±•ã€‚å½“æ ˆè°ƒç”¨æ·±åº¦å¤§äºJVMæ‰€å…è®¸çš„èŒƒå›´ï¼Œä¼šæŠ›å‡ºStackOverflowErrorçš„é”™è¯¯ï¼Œä¸è¿‡è¿™ä¸ªæ·±åº¦èŒƒå›´ä¸æ˜¯ä¸€ä¸ªæ’å®šçš„å€¼ã€‚</span></p><ul><li><span>çº¿ç¨‹ç§æœ‰ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ</span></li><li><span>javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œæ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œå­˜å‚¨å±€éƒ¨å˜é‡è¡¨(åŸºæœ¬ç±»å‹ã€å¯¹è±¡å¼•ç”¨)ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯</span></li><li><code>StackOverflowError</code><span>ï¼šå½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦</span></li><li><code>OutOfMemoryError</code><span>ï¼šå¦‚æœæ ˆçš„æ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜</span></li></ul><blockquote><p><strong><span>ç›¸å…³å‚æ•°ï¼š</span></strong></p><p><span>-Xssï¼šè®¾ç½®æ–¹æ³•æ ˆçš„æœ€å¤§å€¼</span></p></blockquote><p>&nbsp;</p><h3 id='æœ¬åœ°æ–¹æ³•æ ˆ'><span>æœ¬åœ°æ–¹æ³•æ ˆ</span></h3><p><span>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰ä¸Javaæ ˆçš„ä½œç”¨å’ŒåŸç†éå¸¸ç›¸ä¼¼ã€‚åŒºåˆ«åªä¸è¿‡æ˜¯Javaæ ˆæ˜¯ä¸ºæ‰§è¡ŒJavaæ–¹æ³•æœåŠ¡çš„ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºæ‰§è¡Œæœ¬åœ°æ–¹æ³•ï¼ˆNative Methodï¼‰æœåŠ¡çš„ã€‚åœ¨JVMè§„èŒƒä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹æœ¬åœ°æ–¹æ³•æ ˆçš„å…·ä½“å®ç°æ–¹æ³•ä»¥åŠæ•°æ®ç»“æ„ä½œå¼ºåˆ¶è§„å®šï¼Œè™šæ‹Ÿæœºå¯ä»¥è‡ªç”±å®ç°å®ƒã€‚åœ¨HotSoptè™šæ‹Ÿæœºä¸­ç›´æ¥å°±æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’ŒJavaæ ˆåˆäºŒä¸ºä¸€ã€‚</span></p><p>&nbsp;</p><h3 id='æ–¹æ³•åŒº'><span>æ–¹æ³•åŒº</span></h3><p><span>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ç”¨äºå­˜æ”¾</span><strong><span>è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç </span></strong><span>ç­‰æ•°æ®ã€‚</span></p><ul><li><strong><span>åˆç§°ä¹‹ä¸ºï¼šéå †ï¼ˆNon-Heapï¼‰æˆ– æ°¸ä¹…åŒº</span></strong></li><li><strong><span>çº¿ç¨‹å…±äº«</span></strong></li><li><strong><span>ä¸»è¦å­˜å‚¨ï¼šç±»çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€ç±»å˜é‡å’ŒClassç±»çš„å¼•ç”¨ç­‰</span></strong></li><li><strong><span>Javaè™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼šå½“æ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸</span></strong></li></ul><blockquote><p><strong><span>ç›¸å…³å‚æ•°ï¼š</span></strong></p><p><span>-XX:PermSizeï¼šè®¾ç½®PermåŒºçš„åˆå§‹å¤§å°</span></p><p><span>-XX:MaxPermSizeï¼šè®¾ç½®PermåŒºçš„æœ€å¤§å€¼</span></p></blockquote><p>&nbsp;</p><h3 id='å †å†…å­˜'><span>å †å†…å­˜</span></h3><p><span>å †å†…å­˜ï¼ˆJAVA Heapï¼‰ã€‚æ˜¯è¢«çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„éƒ½ä¿å­˜åœ¨ Java å †å†…å­˜ä¸­ï¼Œä¹Ÿæ˜¯åƒåœ¾æ”¶é›†å™¨è¿›è¡Œåƒåœ¾æ”¶é›†çš„æœ€é‡è¦çš„å†…å­˜åŒºåŸŸã€‚ç”±äºç°ä»£ VM é‡‡ç”¨</span><strong><span>åˆ†ä»£æ”¶é›†ç®—æ³•</span></strong><span>, å› æ­¤ Java å †ä» GC çš„è§’åº¦è¿˜å¯ä»¥ç»†åˆ†ä¸º: </span><strong><span>æ–°ç”Ÿä»£</span></strong><span>(EdenåŒºã€From Survivor åŒºå’Œ To Survivor åŒº)å’Œè€å¹´ä»£ã€‚</span></p><ul><li><strong><span>çº¿ç¨‹å…±äº«</span></strong></li><li><strong><span>ä¸»è¦ç”¨äºå­˜å‚¨JAVAå®ä¾‹æˆ–å¯¹è±¡</span></strong></li><li><strong><span>GCå‘ç”Ÿçš„ä¸»è¦åŒºåŸŸ</span></strong></li><li><strong><span>æ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—</span></strong></li><li><strong><span>å½“å †ä¸­æ²¡æœ‰å†…å­˜èƒ½å®Œæˆå®ä¾‹åˆ†é…ï¼Œä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•ï¼Œåˆ™ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸</span></strong></li></ul><blockquote><p><strong><span>ç›¸å…³å‚æ•°ï¼š</span></strong></p><p><span>-Xmsï¼šè®¾ç½®å †å†…å­˜åˆå§‹å¤§å°</span></p><p><span>-Xmxï¼šè®¾ç½®å †å†…å­˜æœ€å¤§å€¼</span></p><p><span>-XX:MaxTenuringThresholdï¼šè®¾ç½®å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­å­˜æ´»çš„æ¬¡æ•°</span></p><p><span>-XX:PretenureSizeThresholdï¼šè®¾ç½®è¶…è¿‡æŒ‡å®šå¤§å°çš„å¤§å¯¹è±¡ç›´æ¥åˆ†é…åœ¨æ—§ç”Ÿä»£ä¸­</span></p><p><strong><span>æ–°ç”Ÿä»£ç›¸å…³å‚æ•°</span></strong><span>ï¼ˆæ³¨æ„ï¼šå½“æ–°ç”Ÿä»£è®¾ç½®å¾—å¤ªå°æ—¶ï¼Œä¹Ÿå¯èƒ½å¼•å‘å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°æ—§ç”Ÿä»£ï¼‰ï¼š</span></p><p><span>-Xmnï¼šè®¾ç½®æ–°ç”Ÿä»£å†…å­˜å¤§å°</span></p><p><span>-XX:SurvivorRatioï¼šè®¾ç½®Edenä¸Survivorç©ºé—´çš„å¤§å°æ¯”ä¾‹</span></p></blockquote><p>&nbsp;</p><h2 id='jvmè¿è¡Œæ—¶å†…å­˜'><span>JVMè¿è¡Œæ—¶å†…å­˜</span></h2><p><span>JVMè¿è¡Œæ—¶å†…å­˜åˆç§°å †å†…å­˜(Heap)ã€‚Java å †ä» GC çš„è§’åº¦è¿˜å¯ä»¥ç»†åˆ†ä¸º: æ–°ç”Ÿä»£(Eden åŒºã€From Survivor åŒºå’Œ To Survivor åŒº)å’Œè€å¹´ä»£ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250023.png" referrerpolicy="no-referrer" alt="RuntimeDataArea"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250031.png" referrerpolicy="no-referrer" alt="JVMå †å†…å­˜åˆ’åˆ†"></p><p><span>å½“ä»£ä¸»æµè™šæ‹Ÿæœºï¼ˆHotspot VMï¼‰çš„åƒåœ¾å›æ”¶éƒ½é‡‡ç”¨â€œåˆ†ä»£å›æ”¶â€çš„ç®—æ³•ã€‚â€œåˆ†ä»£å›æ”¶â€æ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œæ‰€ä»¥é’ˆå¯¹ä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¯ä»¥é‡‡å–ä¸åŒçš„å›æ”¶æ–¹å¼ï¼Œä»¥ä¾¿æé«˜å›æ”¶æ•ˆç‡ã€‚Hotspot VMå°†å†…å­˜åˆ’åˆ†ä¸ºä¸åŒçš„ç‰©ç†åŒºï¼Œå°±æ˜¯â€œåˆ†ä»£â€æ€æƒ³çš„ä½“ç°ã€‚</span></p><p>&nbsp;</p><p><strong><span>ä¸€ä¸ªå¯¹è±¡ä»å‡ºç”Ÿåˆ°æ¶ˆäº¡</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250377.png" referrerpolicy="no-referrer" alt="JVMå¯¹è±¡ç”³è¯·ç©ºé—´æµç¨‹"></p><p><span>ä¸€ä¸ªå¯¹è±¡äº§ç”Ÿä¹‹åé¦–å…ˆè¿›è¡Œæ ˆä¸Šåˆ†é…ï¼Œæ ˆä¸Šå¦‚æœåˆ†é…ä¸ä¸‹ä¼šè¿›å…¥ä¼Šç”¸åŒºï¼Œä¼Šç”¸åŒºç»è¿‡ä¸€æ¬¡åƒåœ¾å›æ”¶ä¹‹åè¿›å…¥surivivoråŒºï¼ŒsurvivoråŒºåœ¨ç»è¿‡ä¸€æ¬¡åƒåœ¾å›æ”¶ä¹‹ååˆè¿›å…¥å¦å¤–ä¸€ä¸ªsurvivorï¼Œä¸æ­¤åŒæ—¶ä¼Šç”¸åŒºçš„æŸäº›å¯¹è±¡ä¹Ÿè·Ÿç€è¿›å…¥å¦å¤–ä¸€ä¸ªsurvivotï¼Œä»€ä¹ˆæ—¶å€™å¹´é¾„å¤Ÿäº†å°±ä¼šè¿›å…¥oldåŒºï¼Œè¿™æ˜¯æ•´ä¸ªå¯¹è±¡çš„ä¸€ä¸ªé€»è¾‘ä¸Šçš„ç§»åŠ¨è¿‡ç¨‹ã€‚</span></p><p>&nbsp;</p><h3 id='æ–°ç”Ÿä»£young-generationï¼‰'><span>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</span></h3><p><strong><span>ä¸»è¦æ˜¯ç”¨æ¥å­˜æ”¾æ–°ç”Ÿçš„å¯¹è±¡</span></strong><span>ã€‚ä¸€èˆ¬å æ®å †çš„1/3ç©ºé—´ã€‚ç”±äºé¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œæ‰€ä»¥æ–°ç”Ÿä»£ä¼šé¢‘ç¹è§¦å‘MinorGCè¿›è¡Œåƒåœ¾å›æ”¶ã€‚æ–°ç”Ÿä»£åˆåˆ†ä¸º EdenåŒºã€ServivorFromã€ServivorToä¸‰ä¸ªåŒºã€‚</span></p><ul><li><strong><span>EdenåŒº</span></strong><span>ï¼šJavaæ–°å¯¹è±¡çš„å‡ºç”Ÿåœ°ï¼ˆå¦‚æœæ–°åˆ›å»ºçš„å¯¹è±¡å ç”¨å†…å­˜å¾ˆå¤§ï¼Œåˆ™ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼‰ã€‚å½“EdenåŒºå†…å­˜ä¸å¤Ÿçš„æ—¶å€™å°±ä¼šè§¦å‘MinorGCï¼Œå¯¹æ–°ç”Ÿä»£åŒºè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶</span></li><li><strong><span>ServivorTo</span></strong><span>ï¼šä¿ç•™äº†ä¸€æ¬¡MinorGCè¿‡ç¨‹ä¸­çš„å¹¸å­˜è€…</span></li><li><strong><span>ServivorFrom</span></strong><span>ï¼šä¸Šä¸€æ¬¡GCçš„å¹¸å­˜è€…ï¼Œä½œä¸ºè¿™ä¸€æ¬¡GCçš„è¢«æ‰«æè€…</span></li></ul><p>&nbsp;</p><p><strong><span>MinorGCæµç¨‹</span></strong></p><ul><li><strong><span>MinorGCé‡‡ç”¨å¤åˆ¶ç®—æ³•</span></strong></li><li><span>é¦–å…ˆæŠŠEdenå’ŒServivorFromåŒºåŸŸä¸­å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°ServicorToåŒºåŸŸï¼ˆå¦‚æœæœ‰å¯¹è±¡çš„å¹´é¾„ä»¥åŠè¾¾åˆ°äº†è€å¹´çš„æ ‡å‡†ï¼Œåˆ™å¤åˆ¶åˆ°è€å¹´ä»£åŒºï¼‰ï¼ŒåŒæ—¶æŠŠè¿™äº›å¯¹è±¡çš„å¹´é¾„+1ï¼ˆå¦‚æœServicorToä¸å¤Ÿä½ç½®äº†å°±æ”¾åˆ°è€å¹´åŒºï¼‰</span></li><li><span>ç„¶åæ¸…ç©ºEdenå’ŒServicorFromä¸­çš„å¯¹è±¡</span></li><li><span>æœ€åServicorToå’ŒServicorFromäº’æ¢ï¼ŒåŸServicorToæˆä¸ºä¸‹ä¸€æ¬¡GCæ—¶çš„ServicorFromåŒº</span></li></ul><p>&nbsp;</p><p><strong><span>ä¸ºä»€ä¹ˆ Survivor åˆ†åŒºä¸èƒ½æ˜¯ 0 ä¸ªï¼Ÿ</span></strong></p><p><span>å¦‚æœ Survivor æ˜¯ 0 çš„è¯ï¼Œä¹Ÿå°±æ˜¯è¯´æ–°ç”Ÿä»£åªæœ‰ä¸€ä¸ª Eden åˆ†åŒºï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶ä¹‹åï¼Œå­˜æ´»çš„å¯¹è±¡éƒ½ä¼šè¿›å…¥è€ç”Ÿä»£ï¼Œè¿™æ ·è€ç”Ÿä»£çš„å†…å­˜ç©ºé—´å¾ˆå¿«å°±è¢«å æ»¡äº†ï¼Œä»è€Œè§¦å‘æœ€è€—æ—¶çš„ Full GC ï¼Œæ˜¾ç„¶è¿™æ ·çš„æ”¶é›†å™¨çš„æ•ˆç‡æ˜¯æˆ‘ä»¬å®Œå…¨ä¸èƒ½æ¥å—çš„ã€‚</span></p><p><strong><span>ä¸ºä»€ä¹ˆ Survivor åˆ†åŒºä¸èƒ½æ˜¯ 1 ä¸ªï¼Ÿ</span></strong></p><p><span>å¦‚æœ Survivor åˆ†åŒºæ˜¯ 1 ä¸ªçš„è¯ï¼Œå‡è®¾æˆ‘ä»¬æŠŠä¸¤ä¸ªåŒºåŸŸåˆ†ä¸º 1:1ï¼Œé‚£ä¹ˆä»»ä½•æ—¶å€™éƒ½æœ‰ä¸€åŠçš„å†…å­˜ç©ºé—´æ˜¯é—²ç½®çš„ï¼Œæ˜¾ç„¶ç©ºé—´åˆ©ç”¨ç‡å¤ªä½ä¸æ˜¯æœ€ä½³çš„æ–¹æ¡ˆã€‚</span></p><p><span>ä½†å¦‚æœè®¾ç½®å†…å­˜ç©ºé—´çš„æ¯”ä¾‹æ˜¯ 8:2 ï¼Œåªæ˜¯çœ‹èµ·æ¥ä¼¼ä¹â€œå¾ˆå¥½â€ï¼Œå‡è®¾æ–°ç”Ÿä»£çš„å†…å­˜ä¸º 100 MBï¼ˆ Survivor å¤§å°ä¸º 20 MB ï¼‰ï¼Œç°åœ¨æœ‰ 70 MB å¯¹è±¡è¿›è¡Œåƒåœ¾å›æ”¶ä¹‹åï¼Œå‰©ä½™æ´»è·ƒçš„å¯¹è±¡ä¸º 15 MB è¿›å…¥ Survivor åŒºï¼Œè¿™ä¸ªæ—¶å€™æ–°ç”Ÿä»£å¯ç”¨çš„å†…å­˜ç©ºé—´åªå‰©äº† 5 MBï¼Œè¿™æ ·å¾ˆå¿«åˆè¦è¿›è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼Œæ˜¾ç„¶è¿™ç§åƒåœ¾å›æ”¶å™¨æœ€å¤§çš„é—®é¢˜å°±åœ¨äºï¼Œéœ€è¦é¢‘ç¹è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</span></p><p><strong><span>ä¸ºä»€ä¹ˆ Survivor åˆ†åŒºæ˜¯ 2 ä¸ªï¼Ÿ</span></strong></p><p><span>å¦‚æœSurvivoråˆ†åŒºæœ‰2ä¸ªåˆ†åŒºï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠ Edenã€From Survivorã€To Survivor åˆ†åŒºå†…å­˜æ¯”ä¾‹è®¾ç½®ä¸º 8:1:1 ï¼Œé‚£ä¹ˆä»»ä½•æ—¶å€™æ–°ç”Ÿä»£å†…å­˜çš„åˆ©ç”¨ç‡éƒ½ 90% ï¼Œè¿™æ ·ç©ºé—´åˆ©ç”¨ç‡åŸºæœ¬æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚å†è€…å°±æ˜¯è™šæ‹Ÿæœºçš„å¤§éƒ¨åˆ†å¯¹è±¡éƒ½ç¬¦åˆâ€œæœç”Ÿå¤•æ­»â€çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡æ–°å¯¹è±¡çš„äº§ç”Ÿéƒ½åœ¨ç©ºé—´å æ¯”æ¯”è¾ƒå¤§çš„EdenåŒºï¼Œåƒåœ¾å›æ”¶ä¹‹åå†æŠŠå­˜æ´»çš„å¯¹è±¡æ–¹æ³•å­˜å…¥SurvivoråŒºï¼Œå¦‚æœæ˜¯ SurvivoråŒºå­˜æ´»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆâ€œå¹´é¾„â€å°±+1ï¼Œå½“å¹´é¾„å¢é•¿åˆ°15ï¼ˆå¯é€šè¿‡ -XX:+MaxTenuringThreshold è®¾å®šï¼‰å¯¹è±¡å°±å‡çº§åˆ°è€ç”Ÿä»£ã€‚</span></p><p>&nbsp;</p><p><strong><span>æ€»ç»“</span></strong></p><p><span>æ ¹æ®ä¸Šé¢çš„åˆ†æå¯ä»¥å¾—çŸ¥ï¼Œå½“æ–°ç”Ÿä»£çš„ Survivor åˆ†åŒºä¸º 2 ä¸ªçš„æ—¶å€™ï¼Œä¸è®ºæ˜¯ç©ºé—´åˆ©ç”¨ç‡è¿˜æ˜¯ç¨‹åºè¿è¡Œçš„æ•ˆç‡éƒ½æ˜¯æœ€ä¼˜çš„ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Survivor åˆ†åŒºæ˜¯ 2 ä¸ªçš„åŸå› äº†ã€‚</span></p><p>&nbsp;</p><h3 id='è€å¹´ä»£old-generationï¼‰'><span>è€å¹´ä»£ï¼ˆOld Generationï¼‰</span></h3><p><strong><span>ä¸»è¦å­˜æ”¾åº”ç”¨ç¨‹åºä¸­ç”Ÿå‘½å‘¨æœŸé•¿çš„å†…å­˜å¯¹è±¡</span></strong><span>ã€‚è€å¹´ä»£çš„å¯¹è±¡æ¯”è¾ƒç¨³å®šï¼Œæ‰€ä»¥MajorGCä¸ä¼šé¢‘ç¹æ‰§è¡Œã€‚åœ¨è¿›è¡ŒMajorGCå‰ä¸€èˆ¬éƒ½å…ˆè¿›è¡Œäº†ä¸€æ¬¡MinorGCï¼Œä½¿å¾—æœ‰æ–°ç”Ÿä»£çš„å¯¹è±¡æ™‹èº«å…¥è€å¹´ä»£ï¼Œå¯¼è‡´ç©ºé—´ä¸å¤Ÿç”¨æ—¶æ‰è§¦å‘ã€‚å½“æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´åˆ†é…ç»™æ–°åˆ›å»ºçš„è¾ƒå¤§å¯¹è±¡æ—¶ä¹Ÿä¼šæå‰è§¦å‘ä¸€æ¬¡MajorGCè¿›è¡Œåƒåœ¾å›æ”¶è…¾å‡ºç©ºé—´ã€‚</span></p><p>&nbsp;</p><p><strong><span>MajorGCæµç¨‹</span></strong></p><p><span>MajorGCé‡‡ç”¨æ ‡è®°â€”æ¸…é™¤ç®—æ³•ã€‚é¦–å…ˆæ‰«æä¸€æ¬¡æ‰€æœ‰è€å¹´ä»£ï¼Œæ ‡è®°å‡ºå­˜æ´»çš„å¯¹è±¡ï¼Œç„¶åå›æ”¶æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡ã€‚MajorGCçš„è€—æ—¶æ¯”è¾ƒé•¿ï¼Œå› ä¸ºè¦æ‰«æå†å›æ”¶ã€‚MajorGCä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œä¸ºäº†å‡å°‘å†…å­˜æŸè€—ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦è¿›è¡Œåˆå¹¶æˆ–è€…æ ‡è®°å‡ºæ¥æ–¹ä¾¿ä¸‹æ¬¡ç›´æ¥åˆ†é…ã€‚å½“è€å¹´ä»£ä¹Ÿæ»¡äº†è£…ä¸ä¸‹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡ºOOMï¼ˆOut of Memoryï¼‰å¼‚å¸¸ã€‚</span></p><p>&nbsp;</p><h3 id='æ°¸ä¹…åŒºperm-generationï¼‰'><span>æ°¸ä¹…åŒºï¼ˆPerm Generationï¼‰</span></h3><p><span>æŒ‡å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸï¼Œ</span><strong><span>ä¸»è¦å­˜æ”¾å…ƒæ•°æ®</span></strong><span>ï¼Œä¾‹å¦‚Classã€Methodçš„å…ƒä¿¡æ¯ï¼Œä¸åƒåœ¾å›æ”¶è¦å›æ”¶çš„Javaå¯¹è±¡å…³ç³»ä¸å¤§ã€‚ç›¸å¯¹äºæ–°ç”Ÿä»£å’Œå¹´è€ä»£æ¥è¯´ï¼Œè¯¥åŒºåŸŸçš„åˆ’åˆ†å¯¹åƒåœ¾å›æ”¶å½±å“æ¯”è¾ƒå°ã€‚GCä¸ä¼šåœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸå¯¹æ°¸ä¹…åŒºåŸŸè¿›è¡Œæ¸…ç†ï¼Œæ‰€ä»¥è¿™ä¹Ÿå¯¼è‡´äº†æ°¸ä¹…ä»£çš„åŒºåŸŸä¼šéšç€åŠ è½½çš„Classçš„å¢å¤šè€Œèƒ€æ»¡ï¼Œæœ€ç»ˆæŠ›å‡ºOOMå¼‚å¸¸ã€‚</span></p><p>&nbsp;</p><p><strong><span>JAVA8ä¸å…ƒæ•°æ®</span></strong></p><p><span>åœ¨Java8ä¸­ï¼Œæ°¸ä¹…ä»£å·²ç»è¢«ç§»é™¤ï¼Œè¢«ä¸€ä¸ªç§°ä¸ºâ€œå…ƒæ•°æ®åŒºâ€ï¼ˆå…ƒç©ºé—´ï¼‰çš„åŒºåŸŸæ‰€å–ä»£ã€‚å…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹JVMè§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°ã€‚ä¸è¿‡å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼š</span><strong><span>å…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜</span></strong><span>ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ã€‚ç±»çš„å…ƒæ•°æ®æ”¾å…¥Native Memoryï¼Œå­—ç¬¦ä¸²æ± å’Œç±»çš„é™æ€å˜é‡æ”¾å…¥javaå †ä¸­ï¼Œè¿™æ ·å¯ä»¥åŠ è½½å¤šå°‘ç±»çš„å…ƒæ•°æ®å°±ä¸å†ç”±MaxPermSizeæ§åˆ¶ï¼Œè€Œç”±ç³»ç»Ÿçš„å®é™…å¯ç”¨ç©ºé—´æ¥æ§åˆ¶ã€‚</span></p><p>&nbsp;</p><h3 id='å†…å­˜åˆ†é…ç­–ç•¥'><span>å†…å­˜åˆ†é…ç­–ç•¥</span></h3><p><span>å †å†…å­˜å¸¸è§çš„åˆ†é…æµ‹è¯•å¦‚ä¸‹ï¼š</span></p><ul><li><span>å¯¹è±¡ä¼˜å…ˆåœ¨EdenåŒºåˆ†é…</span></li><li><span>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</span></li><li><span>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£</span></li></ul><figure><table><thead><tr><th style='text-align:left;' ><strong><span>å‚æ•°</span></strong></th><th><strong><span>è¯´æ˜ä¿¡æ¯</span></strong></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>-Xms</span></td><td><span>åˆå§‹å †å¤§å°ã€‚å¦‚ï¼š-Xms256m</span></td></tr><tr><td style='text-align:left;' ><span>-Xmx</span></td><td><span>æœ€å¤§å †å¤§å°ã€‚å¦‚ï¼š-Xmx512m</span></td></tr><tr><td style='text-align:left;' ><span>-Xmn</span></td><td><span>æ–°ç”Ÿä»£å¤§å°ã€‚é€šå¸¸ä¸ºXmxçš„1/3æˆ–1/4ã€‚æ–°ç”Ÿä»£=Eden+2ä¸ªSurvivorç©ºé—´ã€‚å®é™…å¯ç”¨ç©ºé—´ä¸º=Eden+1ä¸ªSurvivorï¼Œå³ 90%</span></td></tr><tr><td style='text-align:left;' ><span>-Xss</span></td><td><span>JDK1.5+æ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º 1Mï¼Œä¸€èˆ¬æ¥è¯´å¦‚æœæ ˆä¸æ˜¯å¾ˆæ·±çš„è¯ï¼Œ 1M æ˜¯ç»å¯¹å¤Ÿç”¨äº†çš„</span></td></tr><tr><td style='text-align:left;' ><span>-XX:NewRatio</span></td><td><span>æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹ã€‚å¦‚â€“XX:NewRatio=2ï¼Œåˆ™æ–°ç”Ÿä»£å æ•´ä¸ªå †ç©ºé—´çš„1/3ï¼Œè€å¹´ä»£å 2/3</span></td></tr><tr><td style='text-align:left;' ><span>-XX:SurvivorRatio</span></td><td><span>æ–°ç”Ÿä»£ä¸­Edenä¸Survivorçš„æ¯”å€¼ã€‚é»˜è®¤å€¼ä¸º 8ï¼Œå³Edenå æ–°ç”Ÿä»£ç©ºé—´çš„8/10ï¼Œå¦å¤–ä¸¤ä¸ªSurvivorå„å 1/10</span></td></tr><tr><td style='text-align:left;' ><span>-XX:PermSize</span></td><td><span>æ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºï¼‰çš„åˆå§‹å¤§å°</span></td></tr><tr><td style='text-align:left;' ><span>-XX:MaxPermSize</span></td><td><span>æ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºï¼‰çš„æœ€å¤§å€¼</span></td></tr><tr><td style='text-align:left;' ><span>-XX:+PrintGCDetails</span></td><td><span>æ‰“å°GCä¿¡æ¯</span></td></tr><tr><td style='text-align:left;' ><span>-XX:+HeapDumpOnOutOfMemoryError</span></td><td><span>è®©è™šæ‹Ÿæœºåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºæ—¶Dumpå‡ºå½“å‰çš„å†…å­˜å †è½¬å‚¨å¿«ç…§ï¼Œä»¥ä¾¿åˆ†æç”¨</span></td></tr></tbody></table></figure><p>&nbsp;</p><p><strong><span>å‚æ•°åŸºæœ¬ç­–ç•¥</span></strong></p><p><span>å„åˆ†åŒºçš„å¤§å°å¯¹GCçš„æ€§èƒ½å½±å“å¾ˆå¤§ã€‚å¦‚ä½•å°†å„åˆ†åŒºè°ƒæ•´åˆ°åˆé€‚çš„å¤§å°ï¼Œåˆ†ææ´»è·ƒæ•°æ®çš„å¤§å°æ˜¯å¾ˆå¥½çš„åˆ‡å…¥ç‚¹ã€‚</span></p><p><strong><span>æ´»è·ƒæ•°æ®çš„å¤§å°</span></strong><span>ï¼šæŒ‡åº”ç”¨ç¨‹åºç¨³å®šè¿è¡Œæ—¶é•¿æœŸå­˜æ´»å¯¹è±¡åœ¨å †ä¸­å ç”¨çš„ç©ºé—´å¤§å°ï¼Œå³Full GCåå †ä¸­è€å¹´ä»£å ç”¨ç©ºé—´çš„å¤§å°ã€‚</span></p><p><span>å¯ä»¥é€šè¿‡GCæ—¥å¿—ä¸­Full GCä¹‹åè€å¹´ä»£æ•°æ®å¤§å°å¾—å‡ºï¼Œæ¯”è¾ƒå‡†ç¡®çš„æ–¹æ³•æ˜¯åœ¨ç¨‹åºç¨³å®šåï¼Œå¤šæ¬¡è·å–GCæ•°æ®ï¼Œé€šè¿‡å–å¹³å‡å€¼çš„æ–¹å¼è®¡ç®—æ´»è·ƒæ•°æ®çš„å¤§å°ã€‚æ´»è·ƒæ•°æ®å’Œå„åˆ†åŒºä¹‹é—´çš„æ¯”ä¾‹å…³ç³»å¦‚ä¸‹ï¼š</span></p><figure><table><thead><tr><th><span>ç©ºé—´</span></th><th><span>å€æ•°</span></th></tr></thead><tbody><tr><td><span>æ€»å¤§å°</span></td><td><strong><span>3-4</span></strong><span> å€æ´»è·ƒæ•°æ®çš„å¤§å°</span></td></tr><tr><td><span>æ–°ç”Ÿä»£</span></td><td><strong><span>1-1.5</span></strong><span> æ´»è·ƒæ•°æ®çš„å¤§å°</span></td></tr><tr><td><span>è€å¹´ä»£</span></td><td><strong><span>2-3</span></strong><span> å€æ´»è·ƒæ•°æ®çš„å¤§å°</span></td></tr><tr><td><span>æ°¸ä¹…ä»£</span></td><td><strong><span>1.2-1.5</span></strong><span> å€Full GCåçš„æ°¸ä¹…ä»£ç©ºé—´å ç”¨</span></td></tr></tbody></table></figure><p><span>ä¾‹å¦‚ï¼Œæ ¹æ®GCæ—¥å¿—è·å¾—è€å¹´ä»£çš„æ´»è·ƒæ•°æ®å¤§å°ä¸º300Mï¼Œé‚£ä¹ˆå„åˆ†åŒºå¤§å°å¯ä»¥è®¾ä¸ºï¼š</span></p><blockquote><p><span>æ€»å †ï¼š1200MB = 300MB Ã— 4</span></p><p><span>æ–°ç”Ÿä»£ï¼š450MB = 300MB Ã— 1.5</span></p><p><span>è€å¹´ä»£ï¼š 750MB = 1200MB - 450MB</span></p></blockquote><p><span>è¿™éƒ¨åˆ†è®¾ç½®ä»…ä»…æ˜¯å †å¤§å°çš„åˆå§‹å€¼ï¼Œåé¢çš„ä¼˜åŒ–ä¸­ï¼Œå¯èƒ½ä¼šè°ƒæ•´è¿™äº›å€¼ï¼Œå…·ä½“æƒ…å†µå–å†³äºåº”ç”¨ç¨‹åºçš„ç‰¹æ€§å’Œéœ€æ±‚ã€‚</span></p><p>&nbsp;</p><h2 id='å¼•ç”¨çº§åˆ«'><span>å¼•ç”¨çº§åˆ«</span></h2><p><span>Javaä¸­4ç§å¼•ç”¨çš„çº§åˆ«å’Œå¼ºåº¦ç”±é«˜åˆ°ä½ä¾æ¬¡ä¸ºï¼š</span><strong><span>å¼ºå¼•ç”¨â†’è½¯å¼•ç”¨â†’å¼±å¼•ç”¨â†’è™šå¼•ç”¨</span></strong></p><p><span>å½“</span><strong><span>åƒåœ¾å›æ”¶å™¨</span></strong><span>å›æ”¶æ—¶ï¼ŒæŸäº›å¯¹è±¡ä¼šè¢«å›æ”¶ï¼ŒæŸäº›ä¸ä¼šè¢«å›æ”¶ã€‚åƒåœ¾å›æ”¶å™¨ä¼šä»</span><strong><span>æ ¹å¯¹è±¡</span></strong><code>Object</code><span>æ¥</span><strong><span>æ ‡è®°</span></strong><span>å­˜æ´»çš„å¯¹è±¡ï¼Œç„¶åå°†æŸäº›ä¸å¯è¾¾çš„å¯¹è±¡å’Œä¸€äº›å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</span></p><figure><table><thead><tr><th><span>å¼•ç”¨ç±»å‹</span></th><th><span>è¢«åƒåœ¾å›æ”¶æ—¶é—´</span></th><th><span>ç”¨é€”</span></th><th><span>ç”Ÿå­˜æ—¶é—´</span></th></tr></thead><tbody><tr><td><span>å¼ºå¼•ç”¨</span></td><td><span>ä»æ¥ä¸ä¼š</span></td><td><span>å¯¹è±¡çš„ä¸€èˆ¬çŠ¶æ€</span></td><td><span>JVMåœæ­¢è¿è¡Œæ—¶ç»ˆæ­¢</span></td></tr><tr><td><span>è½¯å¼•ç”¨</span></td><td><span>å½“å†…å­˜ä¸è¶³æ—¶</span></td><td><span>å¯¹è±¡ç¼“å­˜</span></td><td><span>å†…å­˜ä¸è¶³æ—¶ç»ˆæ­¢</span></td></tr><tr><td><span>å¼±å¼•ç”¨</span></td><td><span>æ­£å¸¸åƒåœ¾å›æ”¶æ—¶</span></td><td><span>å¯¹è±¡ç¼“å­˜</span></td><td><span>åƒåœ¾å›æ”¶åç»ˆæ­¢</span></td></tr><tr><td><span>è™šå¼•ç”¨</span></td><td><span>æ­£å¸¸åƒåœ¾å›æ”¶æ—¶</span></td><td><span>è·Ÿè¸ªå¯¹è±¡çš„åƒåœ¾å›æ”¶</span></td><td><span>åƒåœ¾å›æ”¶åç»ˆæ­¢</span></td></tr></tbody></table></figure><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250381.png" referrerpolicy="no-referrer" alt="å¼•ç”¨çº§åˆ«"></p><p>&nbsp;</p><h3 id='å¼ºå¼•ç”¨strongreferenceï¼‰'><span>å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰</span></h3><p><span>å¼ºå¼•ç”¨æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„å¯¹è±¡ï¼Œå®ƒå±äºä¸å¯å›æ”¶èµ„æºï¼Œåƒåœ¾å›æ”¶å™¨ï¼ˆåé¢ç®€ç§°GCï¼‰ç»å¯¹ä¸ä¼šå›æ”¶å®ƒï¼Œå³ä½¿æ˜¯å†…å­˜ä¸è¶³ï¼ŒJVMå®æ„¿æŠ›å‡º OutOfMemoryError å¼‚å¸¸ï¼Œä½¿ç¨‹åºç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šæ¥å›æ”¶å¼ºå¼•ç”¨å¯¹è±¡ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£</span><strong><span>åƒåœ¾å›æ”¶å™¨</span></strong><span>ç»ä¸ä¼šå›æ”¶å®ƒã€‚å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">Object</span> <span class="cm-variable">strongReference</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">Object</span>();</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>å½“</span><strong><span>å†…å­˜ç©ºé—´ä¸è¶³</span></strong><span>æ—¶ï¼Œ</span><code>Java</code><span>è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º</span><code>OutOfMemoryError</code><span>é”™è¯¯ï¼Œä½¿ç¨‹åº</span><strong><span>å¼‚å¸¸ç»ˆæ­¢</span></strong><span>ï¼Œä¹Ÿä¸ä¼šé éšæ„</span><strong><span>å›æ”¶</span></strong><span>å…·æœ‰</span><strong><span>å¼ºå¼•ç”¨</span></strong><span>çš„</span><strong><span>å¯¹è±¡</span></strong><span>æ¥è§£å†³å†…å­˜ä¸è¶³çš„é—®é¢˜ã€‚ å¦‚æœå¼ºå¼•ç”¨å¯¹è±¡</span><strong><span>ä¸ä½¿ç”¨æ—¶</span></strong><span>ï¼Œéœ€è¦å¼±åŒ–ä»è€Œä½¿</span><code>GC</code><span>èƒ½å¤Ÿå›æ”¶ï¼Œå¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">strongReference</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>æ˜¾å¼åœ°è®¾ç½®</span><code>strongReference</code><span>å¯¹è±¡ä¸º</span><code>null</code><span>ï¼Œæˆ–è®©å…¶</span><strong><span>è¶…å‡º</span></strong><span>å¯¹è±¡çš„</span><strong><span>ç”Ÿå‘½å‘¨æœŸ</span></strong><span>èŒƒå›´ï¼Œåˆ™</span><code>gc</code><span>è®¤ä¸ºè¯¥å¯¹è±¡</span><strong><span>ä¸å­˜åœ¨å¼•ç”¨</span></strong><span>ï¼Œè¿™æ—¶å°±å¯ä»¥å›æ”¶è¿™ä¸ªå¯¹è±¡ã€‚å…·ä½“ä»€ä¹ˆæ—¶å€™æ”¶é›†è¿™è¦å–å†³äº</span><code>GC</code><span>ç®—æ³•ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-def">test</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">Object</span> <span class="cm-variable">strongReference</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">Object</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// çœç•¥å…¶ä»–æ“ä½œ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 86px;"></div><div class="CodeMirror-gutters" style="display: none; height: 86px;"></div></div></div></pre><p><span>åœ¨ä¸€ä¸ª</span><strong><span>æ–¹æ³•çš„å†…éƒ¨</span></strong><span>æœ‰ä¸€ä¸ª</span><strong><span>å¼ºå¼•ç”¨</span></strong><span>ï¼Œè¿™ä¸ªå¼•ç”¨ä¿å­˜åœ¨</span><code>Java</code><strong><span>æ ˆ</span></strong><span>ä¸­ï¼Œè€ŒçœŸæ­£çš„å¼•ç”¨å†…å®¹(</span><code>Object</code><span>)ä¿å­˜åœ¨</span><code>Java</code><strong><span>å †</span></strong><span>ä¸­ã€‚ å½“è¿™ä¸ª</span><strong><span>æ–¹æ³•è¿è¡Œå®Œæˆ</span></strong><span>åï¼Œå°±ä¼šé€€å‡º</span><strong><span>æ–¹æ³•æ ˆ</span></strong><span>ï¼Œåˆ™å¼•ç”¨å¯¹è±¡çš„</span><strong><span>å¼•ç”¨æ•°</span></strong><span>ä¸º</span><code>0</code><span>ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¢«å›æ”¶ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸ª</span><code>strongReference</code><span>æ˜¯</span><strong><span>å…¨å±€å˜é‡</span></strong><span>æ—¶ï¼Œå°±éœ€è¦åœ¨ä¸ç”¨è¿™ä¸ªå¯¹è±¡æ—¶èµ‹å€¼ä¸º</span><code>null</code><span>ï¼Œå› ä¸º</span><strong><span>å¼ºå¼•ç”¨</span></strong><span>ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚</span></p><p>&nbsp;</p><h3 id='è½¯å¼•ç”¨softreferenceï¼‰'><span>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</span></h3><p><span>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰</span><strong><span>è½¯å¼•ç”¨</span></strong><span>ï¼Œåˆ™</span><strong><span>å†…å­˜ç©ºé—´å……è¶³</span></strong><span>æ—¶ï¼Œ</span><strong><span>åƒåœ¾å›æ”¶å™¨</span></strong><span>å°±</span><strong><span>ä¸ä¼š</span></strong><span>å›æ”¶å®ƒï¼›å¦‚æœ</span><strong><span>å†…å­˜ç©ºé—´ä¸è¶³</span></strong><span>äº†ï¼Œå°±ä¼š</span><strong><span>å›æ”¶</span></strong><span>è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// å¼ºå¼•ç”¨</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">strongReference</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">String</span>(<span class="cm-string">"abc"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// è½¯å¼•ç”¨</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">String</span>(<span class="cm-string">"abc"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">SoftReference</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">softReference</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">SoftReference</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span>(<span class="cm-variable">str</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 108px;"></div><div class="CodeMirror-gutters" style="display: none; height: 108px;"></div></div></div></pre><p><strong><span>è½¯å¼•ç”¨</span></strong><span>å¯ä»¥å’Œä¸€ä¸ª</span><strong><span>å¼•ç”¨é˜Ÿåˆ—</span></strong><span>(</span><code>ReferenceQueue</code><span>)è”åˆä½¿ç”¨ã€‚å¦‚æœ</span><strong><span>è½¯å¼•ç”¨</span></strong><span>æ‰€å¼•ç”¨å¯¹è±¡è¢«</span><strong><span>åƒåœ¾å›æ”¶</span></strong><span>ï¼Œ</span><code>JAVA</code><span>è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ª</span><strong><span>è½¯å¼•ç”¨</span></strong><span>åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„</span><strong><span>å¼•ç”¨é˜Ÿåˆ—</span></strong><span>ä¸­ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ReferenceQueue</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">referenceQueue</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ReferenceQueue</span><span class="cm-operator">&lt;&gt;</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">String</span>(<span class="cm-string">"abc"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">SoftReference</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">softReference</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">SoftReference</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-variable">str</span>, <span class="cm-variable">referenceQueue</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 86px;"></div><div class="CodeMirror-gutters" style="display: none; height: 86px;"></div></div></div></pre><p><strong><span>æ³¨æ„</span></strong><span>ï¼šè½¯å¼•ç”¨å¯¹è±¡æ˜¯åœ¨jvmå†…å­˜ä¸å¤Ÿæ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œæˆ‘ä»¬è°ƒç”¨System.gc()æ–¹æ³•åªæ˜¯èµ·é€šçŸ¥ä½œç”¨ï¼ŒJVMä»€ä¹ˆæ—¶å€™æ‰«æå›æ”¶å¯¹è±¡æ˜¯JVMè‡ªå·±çš„çŠ¶æ€å†³å®šçš„ã€‚å°±ç®—æ‰«æåˆ°è½¯å¼•ç”¨å¯¹è±¡ä¹Ÿä¸ä¸€å®šä¼šå›æ”¶å®ƒï¼Œåªæœ‰å†…å­˜ä¸å¤Ÿçš„æ—¶å€™æ‰ä¼šå›æ”¶ã€‚</span></p><p><strong><span>åƒåœ¾æ”¶é›†çº¿ç¨‹</span></strong><span>ä¼šåœ¨è™šæ‹ŸæœºæŠ›å‡º</span><code>OutOfMemoryError</code><span>ä¹‹å‰å›</span><strong><span>æ”¶è½¯å¼•ç”¨å¯¹è±¡</span></strong><span>ï¼Œè€Œ</span><strong><span>è™šæ‹Ÿæœº</span></strong><span>ä¼šå°½å¯èƒ½ä¼˜å…ˆå›æ”¶</span><strong><span>é•¿æ—¶é—´é—²ç½®ä¸ç”¨</span></strong><span>çš„</span><strong><span>è½¯å¼•ç”¨å¯¹è±¡</span></strong><span>ã€‚å¯¹é‚£äº›</span><strong><span>åˆšæ„å»º</span></strong><span>çš„æˆ–åˆšä½¿ç”¨è¿‡çš„</span><strong><span>&quot;è¾ƒæ–°çš„&quot;</span></strong><span>è½¯å¯¹è±¡ä¼šè¢«è™šæ‹Ÿæœºå°½å¯èƒ½</span><strong><span>ä¿ç•™</span></strong><span>ï¼Œè¿™å°±æ˜¯å¼•å…¥</span><strong><span>å¼•ç”¨é˜Ÿåˆ—</span></strong><code>ReferenceQueue</code><span>çš„åŸå› ã€‚</span></p><p>&nbsp;</p><h3 id='å¼±å¼•ç”¨weakreferenceï¼‰'><span>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</span></h3><p><span>å¼±å¼•ç”¨å¯¹è±¡ç›¸å¯¹è½¯å¼•ç”¨å¯¹è±¡å…·æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸï¼Œåªè¦ GC å‘ç°å®ƒä»…æœ‰å¼±å¼•ç”¨ï¼Œä¸ç®¡å†…å­˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶å®ƒï¼Œä¸è¿‡ GC æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œå› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›ä»…æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚</span></p><p><strong><span>å¼±å¼•ç”¨</span></strong><span>ä¸</span><strong><span>è½¯å¼•ç”¨</span></strong><span>çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰</span><strong><span>å¼±å¼•ç”¨</span></strong><span>çš„å¯¹è±¡æ‹¥æœ‰</span><strong><span>æ›´çŸ­æš‚</span></strong><span>çš„</span><strong><span>ç”Ÿå‘½å‘¨æœŸ</span></strong><span>ã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰</span><strong><span>å¼±å¼•ç”¨</span></strong><span>çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰</span><strong><span>å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦</span></strong><span>ï¼Œéƒ½ä¼š</span><strong><span>å›æ”¶</span></strong><span>å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ª</span><strong><span>ä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹</span></strong><span>ï¼Œå› æ­¤</span><strong><span>ä¸ä¸€å®š</span></strong><span>ä¼š</span><strong><span>å¾ˆå¿«</span></strong><span>å‘ç°é‚£äº›åªå…·æœ‰</span><strong><span>å¼±å¼•ç”¨</span></strong><span>çš„å¯¹è±¡ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">String</span>(<span class="cm-string">"abc"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">WeakReference</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">weakReference</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">WeakReference</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-variable">str</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 65px;"></div><div class="CodeMirror-gutters" style="display: none; height: 65px;"></div></div></div></pre><p><code>JVM</code><span>é¦–å…ˆå°†</span><strong><span>è½¯å¼•ç”¨</span></strong><span>ä¸­çš„</span><strong><span>å¯¹è±¡</span></strong><span>å¼•ç”¨ç½®ä¸º</span><code>null</code><span>ï¼Œç„¶åé€šçŸ¥</span><strong><span>åƒåœ¾å›æ”¶å™¨</span></strong><span>è¿›è¡Œå›æ”¶ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">gc</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre><p><strong><span>æ³¨æ„</span></strong><span>ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯å¶å°”(å¾ˆå°‘)çš„ä½¿ç”¨ï¼Œå¹¶ä¸”å¸Œæœ›åœ¨ä½¿ç”¨æ—¶éšæ—¶å°±èƒ½è·å–åˆ°ï¼Œä½†åˆä¸æƒ³å½±å“æ­¤å¯¹è±¡çš„åƒåœ¾æ”¶é›†ï¼Œé‚£ä¹ˆä½ åº”è¯¥ç”¨Weak Referenceæ¥è®°ä½æ­¤å¯¹è±¡ã€‚</span></p><p><span>ä¸‹é¢çš„ä»£ç ä¼šè®©ä¸€ä¸ª</span><strong><span>å¼±å¼•ç”¨</span></strong><span>å†æ¬¡å˜ä¸ºä¸€ä¸ª</span><strong><span>å¼ºå¼•ç”¨</span></strong><span>ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">String</span>(<span class="cm-string">"abc"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">WeakReference</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">weakReference</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">WeakReference</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-variable">str</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// å¼±å¼•ç”¨è½¬å¼ºå¼•ç”¨</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">strongReference</span> <span class="cm-operator">=</span> <span class="cm-variable">weakReference</span>.<span class="cm-variable">get</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 86px;"></div><div class="CodeMirror-gutters" style="display: none; height: 86px;"></div></div></div></pre><p><span>åŒæ ·ï¼Œ</span><strong><span>å¼±å¼•ç”¨</span></strong><span>å¯ä»¥å’Œä¸€ä¸ª</span><strong><span>å¼•ç”¨é˜Ÿåˆ—</span></strong><span>(</span><code>ReferenceQueue</code><span>)è”åˆä½¿ç”¨ï¼Œå¦‚æœ</span><strong><span>å¼±å¼•ç”¨</span></strong><span>æ‰€å¼•ç”¨çš„</span><strong><span>å¯¹è±¡</span></strong><span>è¢«</span><strong><span>åƒåœ¾å›æ”¶</span></strong><span>ï¼Œ</span><code>Java</code><span>è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ª</span><strong><span>å¼±å¼•ç”¨</span></strong><span>åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„</span><strong><span>å¼•ç”¨é˜Ÿåˆ—</span></strong><span>ä¸­ã€‚</span></p><p>&nbsp;</p><h3 id='è™šå¼•ç”¨phantomreferenceï¼‰'><span>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</span></h3><p><strong><span>è™šå¼•ç”¨</span></strong><span>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯</span><strong><span>å½¢åŒè™šè®¾</span></strong><span>ã€‚ä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œ</span><strong><span>è™šå¼•ç”¨</span></strong><span>å¹¶</span><strong><span>ä¸ä¼š</span></strong><span>å†³å®šå¯¹è±¡çš„</span><strong><span>ç”Ÿå‘½å‘¨æœŸ</span></strong><span>ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡</span><strong><span>ä»…æŒæœ‰è™šå¼•ç”¨</span></strong><span>ï¼Œé‚£ä¹ˆå®ƒå°±å’Œ</span><strong><span>æ²¡æœ‰ä»»ä½•å¼•ç”¨</span></strong><span>ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</span></p><p><strong><span>åº”ç”¨åœºæ™¯ï¼š</span></strong></p><p><strong><span>è™šå¼•ç”¨</span></strong><span>ä¸»è¦ç”¨æ¥</span><strong><span>è·Ÿè¸ªå¯¹è±¡</span></strong><span>è¢«åƒåœ¾å›æ”¶å™¨</span><strong><span>å›æ”¶</span></strong><span>çš„æ´»åŠ¨ã€‚ </span><strong><span>è™šå¼•ç”¨</span></strong><span>ä¸</span><strong><span>è½¯å¼•ç”¨</span></strong><span>å’Œ</span><strong><span>å¼±å¼•ç”¨</span></strong><span>çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼š</span></p><blockquote><p><span>è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—(ReferenceQueue)è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">String</span>(<span class="cm-string">"abc"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ReferenceQueue</span> <span class="cm-variable">queue</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ReferenceQueue</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// åˆ›å»ºè™šå¼•ç”¨ï¼Œè¦æ±‚å¿…é¡»ä¸ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—å…³è”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PhantomReference</span> <span class="cm-variable">pr</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">PhantomReference</span>(<span class="cm-variable">str</span>, <span class="cm-variable">queue</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 86px;"></div><div class="CodeMirror-gutters" style="display: none; height: 86px;"></div></div></div></pre><p><span>ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨</span><strong><span>é˜Ÿåˆ—</span></strong><span>ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†</span><strong><span>è™šå¼•ç”¨</span></strong><span>ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¿›è¡Œ</span><strong><span>åƒåœ¾å›æ”¶</span></strong><span>ã€‚å¦‚æœç¨‹åºå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„</span><strong><span>å†…å­˜è¢«å›æ”¶ä¹‹å‰</span></strong><span>é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚</span></p><p>&nbsp;</p><h2 id='oom'><span>OOM</span></h2><p><span>JVMå‘ç”ŸOOMçš„ä¹ç§åœºæ™¯å¦‚ä¸‹ï¼š</span></p><p><strong><span>åœºæ™¯ä¸€ï¼šJava heap space</span></strong></p><blockquote><p><span>å½“å †å†…å­˜ï¼ˆHeap Spaceï¼‰æ²¡æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡æ—¶ï¼Œå°±ä¼šæŠ›å‡º </span><code>java.lang.OutOfMemoryError:Javaheap space</code><span> é”™è¯¯ï¼ˆæ ¹æ®å®é™…ç”Ÿäº§ç»éªŒï¼Œå¯ä»¥å¯¹ç¨‹åºæ—¥å¿—ä¸­çš„ OutOfMemoryError é…ç½®å…³é”®å­—å‘Šè­¦ï¼Œä¸€ç»å‘ç°ï¼Œç«‹å³å¤„ç†ï¼‰ã€‚</span></p><p><strong><span>åŸå› åˆ†æ</span></strong></p><p><code>Javaheap space</code><span> é”™è¯¯äº§ç”Ÿçš„å¸¸è§åŸå› å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</span></p><ul><li><span>è¯·æ±‚åˆ›å»ºä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¤§æ•°ç»„</span></li><li><span>è¶…å‡ºé¢„æœŸçš„è®¿é—®é‡/æ•°æ®é‡ï¼Œé€šå¸¸æ˜¯ä¸Šæ¸¸ç³»ç»Ÿè¯·æ±‚æµé‡é£™å‡ï¼Œå¸¸è§äºå„ç±»ä¿ƒé”€/ç§’æ€æ´»åŠ¨ï¼Œå¯ä»¥ç»“åˆä¸šåŠ¡æµé‡æŒ‡æ ‡æ’æŸ¥æ˜¯å¦æœ‰å°–çŠ¶å³°å€¼</span></li><li><span>è¿‡åº¦ä½¿ç”¨ç»ˆç»“å™¨ï¼ˆFinalizerï¼‰ï¼Œè¯¥å¯¹è±¡æ²¡æœ‰ç«‹å³è¢« GC</span></li><li><span>å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰ï¼Œå¤§é‡å¯¹è±¡å¼•ç”¨æ²¡æœ‰é‡Šæ”¾ï¼ŒJVM æ— æ³•å¯¹å…¶è‡ªåŠ¨å›æ”¶ï¼Œå¸¸è§äºä½¿ç”¨äº† File ç­‰èµ„æºæ²¡æœ‰å›æ”¶</span></li></ul><p><strong><span>è§£å†³æ–¹æ¡ˆ</span></strong></p><p><span>é’ˆå¯¹å¤§éƒ¨åˆ†æƒ…å†µï¼Œé€šå¸¸åªéœ€é€šè¿‡ </span><code>-Xmx</code><span> å‚æ•°è°ƒé«˜ JVM å †å†…å­˜ç©ºé—´å³å¯ã€‚å¦‚æœä»ç„¶æ²¡æœ‰è§£å†³ï¼Œå¯å‚è€ƒä»¥ä¸‹æƒ…å†µåšè¿›ä¸€æ­¥å¤„ç†ï¼š</span></p><ul><li><span>å¦‚æœæ˜¯è¶…å¤§å¯¹è±¡ï¼Œå¯ä»¥æ£€æŸ¥å…¶åˆç†æ€§ï¼Œæ¯”å¦‚æ˜¯å¦ä¸€æ¬¡æ€§æŸ¥è¯¢äº†æ•°æ®åº“å…¨éƒ¨ç»“æœï¼Œè€Œæ²¡æœ‰åšç»“æœæ•°é™åˆ¶</span></li><li><span>å¦‚æœæ˜¯ä¸šåŠ¡å³°å€¼å‹åŠ›ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ æœºå™¨èµ„æºï¼Œæˆ–è€…åšé™æµé™çº§</span></li><li><span>å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œéœ€è¦æ‰¾åˆ°æŒæœ‰çš„å¯¹è±¡ï¼Œä¿®æ”¹ä»£ç è®¾è®¡ï¼Œæ¯”å¦‚å…³é—­æ²¡æœ‰é‡Šæ”¾çš„è¿æ¥</span></li></ul></blockquote><p><strong><span>åœºæ™¯äºŒï¼šGC overhead limit exceeded</span></strong></p><blockquote><p><span>å½“ Java è¿›ç¨‹èŠ±è´¹ 98% ä»¥ä¸Šçš„æ—¶é—´æ‰§è¡Œ GCï¼Œä½†åªæ¢å¤äº†ä¸åˆ° 2% çš„å†…å­˜ï¼Œä¸”è¯¥åŠ¨ä½œè¿ç»­é‡å¤äº† 5 æ¬¡ï¼Œå°±ä¼šæŠ›å‡º </span><code>java.lang.OutOfMemoryError:GC overhead limit exceeded</code><span> é”™è¯¯ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯åº”ç”¨ç¨‹åºå·²ç»åŸºæœ¬è€—å°½äº†æ‰€æœ‰å¯ç”¨å†…å­˜ï¼Œ GC ä¹Ÿæ— æ³•å›æ”¶ã€‚</span></p><p><span>æ­¤ç±»é—®é¢˜çš„åŸå› ä¸è§£å†³æ–¹æ¡ˆè·Ÿ </span><code>Javaheap space</code><span> éå¸¸ç±»ä¼¼ï¼Œå¯ä»¥å‚è€ƒä¸Šæ–‡ã€‚</span></p></blockquote><p><strong><span>åœºæ™¯ä¸‰ï¼šPermgen space</span></strong></p><blockquote><p><span>è¯¥é”™è¯¯è¡¨ç¤ºæ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰å·²ç”¨æ»¡ï¼Œé€šå¸¸æ˜¯å› ä¸ºåŠ è½½çš„ class æ•°ç›®å¤ªå¤šæˆ–ä½“ç§¯å¤ªå¤§ã€‚</span></p><p><strong><span>åŸå› åˆ†æ</span></strong></p><p><span>æ°¸ä¹…ä»£å­˜å‚¨å¯¹è±¡ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š</span></p><ul><li><span>åŠ è½½/ç¼“å­˜åˆ°å†…å­˜ä¸­çš„ class å®šä¹‰ï¼ŒåŒ…æ‹¬ç±»çš„åç§°ï¼Œå­—æ®µï¼Œæ–¹æ³•å’Œå­—èŠ‚ç </span></li><li><span>å¸¸é‡æ± </span></li><li><span>å¯¹è±¡æ•°ç»„/ç±»å‹æ•°ç»„æ‰€å…³è”çš„ class</span></li><li><span>JIT ç¼–è¯‘å™¨ä¼˜åŒ–åçš„ class ä¿¡æ¯</span></li></ul><p><span>PermGen çš„ä½¿ç”¨é‡ä¸åŠ è½½åˆ°å†…å­˜çš„ class çš„æ•°é‡/å¤§å°æ­£ç›¸å…³ã€‚</span></p><p><strong><span>è§£å†³æ–¹æ¡ˆ</span></strong></p><p><span>æ ¹æ® Permgen space æŠ¥é”™çš„æ—¶æœºï¼Œå¯ä»¥é‡‡ç”¨ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</span></p><ul><li><span>ç¨‹åºå¯åŠ¨æŠ¥é”™ï¼Œä¿®æ”¹ </span><code>-XX:MaxPermSize</code><span> å¯åŠ¨å‚æ•°ï¼Œè°ƒå¤§æ°¸ä¹…ä»£ç©ºé—´</span></li><li><span>åº”ç”¨é‡æ–°éƒ¨ç½²æ—¶æŠ¥é”™ï¼Œå¾ˆå¯èƒ½æ˜¯æ²¡æœ‰åº”ç”¨æ²¡æœ‰é‡å¯ï¼Œå¯¼è‡´åŠ è½½äº†å¤šä»½ class ä¿¡æ¯ï¼Œåªéœ€é‡å¯ JVM å³å¯è§£å†³</span></li><li><span>è¿è¡Œæ—¶æŠ¥é”™ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šåŠ¨æ€åˆ›å»ºå¤§é‡ classï¼Œè€Œè¿™äº› class çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­æš‚ï¼Œä½†æ˜¯ JVM é»˜è®¤ä¸ä¼šå¸è½½ classï¼Œå¯ä»¥è®¾ç½® </span><code>-XX:+CMSClassUnloadingEnabled</code><span> å’Œ </span><code>-XX:+UseConcMarkSweepGC</code><span> è¿™ä¸¤ä¸ªå‚æ•°å…è®¸ JVM å¸è½½ classã€‚</span></li></ul><p><span>å¦‚æœä¸Šè¿°æ–¹æ³•æ— æ³•è§£å†³ï¼Œå¯ä»¥é€šè¿‡ jmap å‘½ä»¤ dump å†…å­˜å¯¹è±¡ </span><code>jmap-dump:format=b,file=dump.hprof&lt;process-id&gt;</code><span> ï¼Œç„¶ååˆ©ç”¨ Eclipse MAT </span><a href='https://www.eclipse.org/mat' target='_blank' class='url'>https://www.eclipse.org/mat</a><span> åŠŸèƒ½é€ä¸€åˆ†æå¼€é”€æœ€å¤§çš„ classloader å’Œé‡å¤ classã€‚</span></p></blockquote><p><strong><span>åœºæ™¯å››ï¼šMetaspace</span></strong></p><blockquote><p><span>JDK 1.8 ä½¿ç”¨ Metaspace æ›¿æ¢äº†æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰ï¼Œè¯¥é”™è¯¯è¡¨ç¤º Metaspace å·²è¢«ç”¨æ»¡ï¼Œé€šå¸¸æ˜¯å› ä¸ºåŠ è½½çš„ class æ•°ç›®å¤ªå¤šæˆ–ä½“ç§¯å¤ªå¤§ã€‚</span></p><p><span>æ­¤ç±»é—®é¢˜çš„åŸå› ä¸è§£å†³æ–¹æ³•è·Ÿ </span><code>Permgenspace</code><span> éå¸¸ç±»ä¼¼ï¼Œå¯ä»¥å‚è€ƒä¸Šæ–‡ã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è°ƒæ•´ Metaspace ç©ºé—´å¤§å°çš„å¯åŠ¨å‚æ•°ä¸º </span><code>-XX:MaxMetaspaceSize</code><span>ã€‚</span></p></blockquote><p><strong><span>åœºæ™¯äº”ï¼šUnable to create new native thread</span></strong></p><blockquote><p><span>æ¯ä¸ª Java çº¿ç¨‹éƒ½éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œå½“ JVM å‘åº•å±‚æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„ native çº¿ç¨‹æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…å°±ä¼šæŠ¥æ­¤ç±»é”™è¯¯ã€‚</span></p><p><strong><span>åŸå› åˆ†æ</span></strong></p><p><span>JVM å‘ OS è¯·æ±‚åˆ›å»º native çº¿ç¨‹å¤±è´¥ï¼Œå°±ä¼šæŠ›å‡º </span><code>Unableto createnewnativethread</code><span>ï¼Œå¸¸è§çš„åŸå› åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š</span></p><ul><li><span>çº¿ç¨‹æ•°è¶…è¿‡æ“ä½œç³»ç»Ÿæœ€å¤§çº¿ç¨‹æ•° ulimit é™åˆ¶</span></li><li><span>çº¿ç¨‹æ•°è¶…è¿‡ kernel.pid_maxï¼ˆåªèƒ½é‡å¯ï¼‰</span></li><li><span>native å†…å­˜ä¸è¶³</span></li></ul><p><span>è¯¥é—®é¢˜å‘ç”Ÿçš„å¸¸è§è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ æ­¥ï¼š</span></p><ul><li><span>JVM å†…éƒ¨çš„åº”ç”¨ç¨‹åºè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„ Java çº¿ç¨‹</span></li><li><span>JVM native æ–¹æ³•ä»£ç†äº†è¯¥æ¬¡è¯·æ±‚ï¼Œå¹¶å‘æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ›å»ºä¸€ä¸ª native çº¿ç¨‹</span></li><li><span>æ“ä½œç³»ç»Ÿå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„ native çº¿ç¨‹ï¼Œå¹¶ä¸ºå…¶åˆ†é…å†…å­˜</span></li><li><span>å¦‚æœæ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜å·²è€—å°½ï¼Œæˆ–æ˜¯å—åˆ° 32 ä½è¿›ç¨‹çš„åœ°å€ç©ºé—´é™åˆ¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæ‹’ç»æœ¬æ¬¡ native å†…å­˜åˆ†é…</span></li><li><span>JVM å°†æŠ›å‡º </span><code>java.lang.OutOfMemoryError:Unableto createnewnativethread</code><span>é”™è¯¯</span></li></ul><p><strong><span>è§£å†³æ–¹æ¡ˆ</span></strong></p><ul><li><span>å‡çº§é…ç½®ï¼Œä¸ºæœºå™¨æä¾›æ›´å¤šçš„å†…å­˜</span></li><li><span>é™ä½ Java Heap Space å¤§å°</span></li><li><span>ä¿®å¤åº”ç”¨ç¨‹åºçš„çº¿ç¨‹æ³„æ¼é—®é¢˜</span></li><li><span>é™åˆ¶çº¿ç¨‹æ± å¤§å°</span></li><li><span>ä½¿ç”¨ -Xss å‚æ•°å‡å°‘çº¿ç¨‹æ ˆçš„å¤§å°</span></li><li><span>è°ƒé«˜ OS å±‚é¢çš„çº¿ç¨‹æœ€å¤§æ•°ï¼šæ‰§è¡Œ </span><code>ulimia-a</code><span> æŸ¥çœ‹æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ï¼Œä½¿ç”¨ </span><code>ulimit-u xxx</code><span> è°ƒæ•´æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶</span></li></ul></blockquote><p><strong><span>åœºæ™¯å…­ï¼šOut of swap spaceï¼Ÿ</span></strong></p><blockquote><p><span>è¯¥é”™è¯¯è¡¨ç¤ºæ‰€æœ‰å¯ç”¨çš„è™šæ‹Ÿå†…å­˜å·²è¢«è€—å°½ã€‚è™šæ‹Ÿå†…å­˜ï¼ˆVirtual Memoryï¼‰ç”±ç‰©ç†å†…å­˜ï¼ˆPhysical Memoryï¼‰å’Œäº¤æ¢ç©ºé—´ï¼ˆSwap Spaceï¼‰ä¸¤éƒ¨åˆ†ç»„æˆã€‚å½“è¿è¡Œæ—¶ç¨‹åºè¯·æ±‚çš„è™šæ‹Ÿå†…å­˜æº¢å‡ºæ—¶å°±ä¼šæŠ¥ </span><code>Outof swap space?</code><span> é”™è¯¯ã€‚</span></p><p><strong><span>åŸå› åˆ†æ</span></strong></p><p><span>è¯¥é”™è¯¯å‡ºç°çš„å¸¸è§åŸå› åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š</span></p><ul><li><span>åœ°å€ç©ºé—´ä¸è¶³</span></li><li><span>ç‰©ç†å†…å­˜å·²è€—å…‰</span></li><li><span>åº”ç”¨ç¨‹åºçš„æœ¬åœ°å†…å­˜æ³„æ¼ï¼ˆnative leakï¼‰ï¼Œä¾‹å¦‚ä¸æ–­ç”³è¯·æœ¬åœ°å†…å­˜ï¼Œå´ä¸é‡Šæ”¾</span></li><li><span>æ‰§è¡Œ </span><code>jmap-histo:live&lt;pid&gt;</code><span> å‘½ä»¤ï¼Œå¼ºåˆ¶æ‰§è¡Œ Full GCï¼›å¦‚æœå‡ æ¬¡æ‰§è¡Œåå†…å­˜æ˜æ˜¾ä¸‹é™ï¼Œåˆ™åŸºæœ¬ç¡®è®¤ä¸º Direct ByteBuffer é—®é¢˜</span></li></ul><p><strong><span>è§£å†³æ–¹æ¡ˆ</span></strong></p><p><span>æ ¹æ®é”™è¯¯åŸå› å¯ä»¥é‡‡å–å¦‚ä¸‹è§£å†³æ–¹æ¡ˆï¼š</span></p><ul><li><span>å‡çº§åœ°å€ç©ºé—´ä¸º 64 bit</span></li><li><span>ä½¿ç”¨ Arthas æ£€æŸ¥æ˜¯å¦ä¸º Inflater/Deflater è§£å‹ç¼©é—®é¢˜ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ˜¾å¼è°ƒç”¨ end æ–¹æ³•</span></li><li><span>Direct ByteBuffer é—®é¢˜å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•° </span><code>-XX:MaxDirectMemorySize</code><span> è°ƒä½é˜ˆå€¼</span></li><li><span>å‡çº§æœåŠ¡å™¨é…ç½®/éš”ç¦»éƒ¨ç½²ï¼Œé¿å…äº‰ç”¨</span></li></ul></blockquote><p><strong><span>åœºæ™¯ä¸ƒï¼šKill process or sacrifice child</span></strong></p><blockquote><p><span>æœ‰ä¸€ç§å†…æ ¸ä½œä¸šï¼ˆKernel Jobï¼‰åä¸º Out of Memory Killerï¼Œå®ƒä¼šåœ¨å¯ç”¨å†…å­˜æä½çš„æƒ…å†µä¸‹â€œæ€æ­»â€ï¼ˆkillï¼‰æŸäº›è¿›ç¨‹ã€‚OOM Killer ä¼šå¯¹æ‰€æœ‰è¿›ç¨‹è¿›è¡Œæ‰“åˆ†ï¼Œç„¶åå°†è¯„åˆ†è¾ƒä½çš„è¿›ç¨‹â€œæ€æ­»â€ï¼Œå…·ä½“çš„è¯„åˆ†è§„åˆ™å¯ä»¥å‚è€ƒ Surviving the Linux OOM Killerã€‚ä¸åŒäºå…¶å®ƒOOMé”™è¯¯ï¼Œ </span><code>Killprocessorsacrifice child</code><span> é”™è¯¯ä¸æ˜¯ç”± JVM å±‚é¢è§¦å‘çš„ï¼Œè€Œæ˜¯ç”±æ“ä½œç³»ç»Ÿå±‚é¢è§¦å‘çš„ã€‚</span></p><p><strong><span>åŸå› åˆ†æ</span></strong></p><p><span>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinux å†…æ ¸å…è®¸è¿›ç¨‹ç”³è¯·çš„å†…å­˜æ€»é‡å¤§äºç³»ç»Ÿå¯ç”¨å†…å­˜ï¼Œé€šè¿‡è¿™ç§â€œé”™å³°å¤ç”¨â€çš„æ–¹å¼å¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¼šæ— å¯é¿å…åœ°å¸¦æ¥ä¸€å®šçš„â€œè¶…å–â€é£é™©ã€‚ä¾‹å¦‚æŸäº›è¿›ç¨‹æŒç»­å ç”¨ç³»ç»Ÿå†…å­˜ï¼Œç„¶åå¯¼è‡´å…¶ä»–è¿›ç¨‹æ²¡æœ‰å¯ç”¨å†…å­˜ã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ¿€æ´» OOM Killerï¼Œå¯»æ‰¾è¯„åˆ†ä½çš„è¿›ç¨‹ï¼Œå¹¶å°†å…¶â€œæ€æ­»â€ï¼Œé‡Šæ”¾å†…å­˜èµ„æºã€‚</span></p><p><strong><span>è§£å†³æ–¹æ¡ˆ</span></strong></p><ul><li><span>å‡çº§æœåŠ¡å™¨é…ç½®/éš”ç¦»éƒ¨ç½²ï¼Œé¿å…äº‰ç”¨</span></li><li><span>OOM Killer è°ƒä¼˜</span></li></ul></blockquote><p><strong><span>åœºæ™¯å…«ï¼šRequested array size exceeds VM limit</span></strong></p><blockquote><p><span>JVM é™åˆ¶äº†æ•°ç»„çš„æœ€å¤§é•¿åº¦ï¼Œè¯¥é”™è¯¯è¡¨ç¤ºç¨‹åºè¯·æ±‚åˆ›å»ºçš„æ•°ç»„è¶…è¿‡æœ€å¤§é•¿åº¦é™åˆ¶ã€‚JVM åœ¨ä¸ºæ•°ç»„åˆ†é…å†…å­˜å‰ï¼Œä¼šæ£€æŸ¥è¦åˆ†é…çš„æ•°æ®ç»“æ„åœ¨ç³»ç»Ÿä¸­æ˜¯å¦å¯å¯»å€ï¼Œé€šå¸¸ä¸º </span><code>Integer.MAX_VALUE-2</code><span>ã€‚</span></p><p><span>æ­¤ç±»é—®é¢˜æ¯”è¾ƒç½•è§ï¼Œé€šå¸¸éœ€è¦æ£€æŸ¥ä»£ç ï¼Œç¡®è®¤ä¸šåŠ¡æ˜¯å¦éœ€è¦åˆ›å»ºå¦‚æ­¤å¤§çš„æ•°ç»„ï¼Œæ˜¯å¦å¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªå—ï¼Œåˆ†æ‰¹æ‰§è¡Œã€‚</span></p></blockquote><p><strong><span>åœºæ™¯ä¹ï¼šDirect buffer memory</span></strong></p><blockquote><p><span>Java å…è®¸åº”ç”¨ç¨‹åºé€šè¿‡ Direct ByteBuffer ç›´æ¥è®¿é—®å †å¤–å†…å­˜ï¼Œè®¸å¤šé«˜æ€§èƒ½ç¨‹åºé€šè¿‡ Direct ByteBuffer ç»“åˆå†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMemory Mapped Fileï¼‰å®ç°é«˜é€Ÿ IOã€‚</span></p><p><strong><span>åŸå› åˆ†æ</span></strong></p><p><span>Direct ByteBuffer çš„é»˜è®¤å¤§å°ä¸º 64 MBï¼Œä¸€æ—¦ä½¿ç”¨è¶…å‡ºé™åˆ¶ï¼Œå°±ä¼šæŠ›å‡º </span><code>Directbuffer memory</code><span> é”™è¯¯ã€‚</span></p><p><strong><span>è§£å†³æ–¹æ¡ˆ</span></strong></p><ul><li><span>Java åªèƒ½é€šè¿‡ ByteBuffer.allocateDirect æ–¹æ³•ä½¿ç”¨ Direct ByteBufferï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡ Arthas ç­‰åœ¨çº¿è¯Šæ–­å·¥å…·æ‹¦æˆªè¯¥æ–¹æ³•è¿›è¡Œæ’æŸ¥</span></li><li><span>æ£€æŸ¥æ˜¯å¦ç›´æ¥æˆ–é—´æ¥ä½¿ç”¨äº† NIOï¼Œå¦‚ nettyï¼Œjetty ç­‰</span></li><li><span>é€šè¿‡å¯åŠ¨å‚æ•° </span><code>-XX:MaxDirectMemorySize</code><span> è°ƒæ•´ Direct ByteBuffer çš„ä¸Šé™å€¼</span></li><li><span>æ£€æŸ¥ JVM å‚æ•°æ˜¯å¦æœ‰ </span><code>-XX:+DisableExplicitGC</code><span> é€‰é¡¹ï¼Œå¦‚æœæœ‰å°±å»æ‰ï¼Œå› ä¸ºè¯¥å‚æ•°ä¼šä½¿ </span><code>System.gc()</code><span> å¤±æ•ˆ</span></li><li><span>æ£€æŸ¥å †å¤–å†…å­˜ä½¿ç”¨ä»£ç ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ï¼›æˆ–è€…é€šè¿‡åå°„è°ƒç”¨ </span><code>sun.misc.Cleaner</code><span> çš„ </span><code>clean()</code><span> æ–¹æ³•æ¥ä¸»åŠ¨é‡Šæ”¾è¢« Direct ByteBuffer æŒæœ‰çš„å†…å­˜ç©ºé—´</span></li><li><span>å†…å­˜å®¹é‡ç¡®å®ä¸è¶³ï¼Œå‡çº§é…ç½®</span></li></ul></blockquote><p><strong><span>æœ€ä½³å®è·µ</span></strong></p><blockquote><p><span>â‘  OOMå‘ç”Ÿæ—¶è¾“å‡ºå †dumpï¼š</span></p><p><code>-XX:+HeapDumpOnOutOfMemoryError</code><span> </span><code>-XX:HeapDumpPath=$CATALINA_HOME/logs</code></p><p><span>â‘¡ OOMå‘ç”Ÿåçš„æ‰§è¡ŒåŠ¨ä½œï¼š</span></p><p><code>-XX:OnOutOfMemoryError=$CATALINA_HOME/bin/stop.sh</code><span> </span></p><p><code>-XX:OnOutOfMemoryError=$CATALINA_HOME/bin/restart.sh</code></p><p><span>OOMä¹‹åé™¤äº†ä¿ç•™å †dumpå¤–ï¼Œæ ¹æ®ç®¡ç†ç­–ç•¥é€‰æ‹©åˆé€‚çš„è¿è¡Œè„šæœ¬ã€‚</span></p></blockquote><p>&nbsp;</p><h1 id='gc-1'><span>GC</span></h1><h2 id='å¯»æ‰¾åƒåœ¾ç®—æ³•'><span>å¯»æ‰¾åƒåœ¾ç®—æ³•</span></h2><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250382.png" referrerpolicy="no-referrer" alt="å¯»æ‰¾åƒåœ¾ç®—æ³•"></p><h3 id='å¼•ç”¨è®¡æ•°æ³•'><span>å¼•ç”¨è®¡æ•°æ³•</span></h3><p><span>å¼•ç”¨è®¡æ•°æ³•ï¼ˆReference Countï¼‰ä¼šç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒçš„æ—¶å€™ï¼Œè®¡æ•°å™¨çš„å€¼å°± +1 ï¼Œå½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°± -1 ï¼Œè®¡æ•°å™¨çš„å€¼ä¸º 0 çš„å¯¹è±¡ä¸å¯èƒ½åœ¨è¢«ä½¿ç”¨ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ¤å®šè¿™ä¸ªå¯¹è±¡æ˜¯åƒåœ¾ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250386.png" referrerpolicy="no-referrer" alt="å¼•ç”¨è®¡æ•°æ³•"></p><p><span>å½“å›¾ä¸­çš„æ•°å€¼å˜æˆ0æ—¶ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•å°±å¯ä»¥åˆ¤å®šå®ƒæ˜¯åƒåœ¾äº†ï¼Œä½†æ˜¯å¼•ç”¨è®¡æ•°æ³•ä¸èƒ½è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“å¯¹è±¡æ˜¯å¾ªç¯å¼•ç”¨çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å€¼éƒ½ä¸ä¸º0ï¼Œè¿™ä¸ªæ—¶å€™å¼•ç”¨è®¡æ•°å™¨æ— æ³•é€šçŸ¥GCæ”¶é›†å™¨æ¥å›æ”¶ä»–ä»¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250388.png" referrerpolicy="no-referrer" alt="å¼•ç”¨è®¡æ•°æ³•-é—®é¢˜"></p><p><span>è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨åˆ°æˆ‘ä»¬çš„æ ¹å¯è¾¾ç®—æ³•ã€‚</span></p><p>&nbsp;</p><h3 id='å¯è¾¾æ€§åˆ†æ'><span>å¯è¾¾æ€§åˆ†æ</span></h3><p><span>æ ¹å¯è¾¾ç®—æ³•ï¼ˆRoot Searchingï¼‰çš„æ„æ€æ˜¯è¯´ä»æ ¹ä¸Šå¼€å§‹æœç´¢ï¼Œå½“ä¸€ä¸ªç¨‹åºå¯åŠ¨åï¼Œé©¬ä¸Šéœ€è¦çš„é‚£äº›ä¸ªå¯¹è±¡å°±å«åšæ ¹å¯¹è±¡ï¼Œæ‰€è°“çš„æ ¹å¯è¾¾ç®—æ³•å°±æ˜¯é¦–å…ˆæ‰¾åˆ°æ ¹å¯¹è±¡ï¼Œç„¶åè·Ÿç€è¿™æ ¹çº¿ä¸€ç›´å¾€å¤–æ‰¾åˆ°é‚£äº›æœ‰ç”¨çš„ã€‚å¸¸è§çš„GC rootså¦‚ä¸‹ï¼š</span></p><ul><li><strong><span>çº¿ç¨‹æ ˆå˜é‡ï¼š</span></strong><span> çº¿ç¨‹é‡Œé¢ä¼šæœ‰çº¿ç¨‹æ ˆå’Œmainæ ˆå¸§ï¼Œä»è¿™ä¸ªmain() é‡Œé¢å¼€å§‹çš„è¿™äº›å¯¹è±¡éƒ½æ˜¯æˆ‘ä»¬çš„æ ¹å¯¹è±¡</span></li><li><strong><span>é™æ€å˜é‡ï¼š</span></strong><span> ä¸€ä¸ªclass å®ƒæœ‰ä¸€ä¸ªé™æ€çš„å˜é‡ï¼Œloadåˆ°å†…å­˜ä¹‹åé©¬ä¸Šå°±å¾—å¯¹é™æ€å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥é™æ€å˜é‡åˆ°çš„å¯¹è±¡è¿™ä¸ªå«åšæ ¹å¯¹è±¡</span></li><li><strong><span>å¸¸é‡æ± ï¼š</span></strong><span> å¦‚æœä½ è¿™ä¸ªclassä¼šç”¨åˆ°å…¶ä»–çš„classçš„é‚£äº›ä¸ªç±»çš„å¯¹è±¡ï¼Œè¿™äº›å°±æ˜¯æ ¹å¯¹è±¡</span></li><li><strong><span>JNIï¼š</span></strong><span> å¦‚æœæˆ‘ä»¬è°ƒç”¨äº† Cå’ŒC++ å†™çš„é‚£äº›æœ¬åœ°æ–¹æ³•æ‰€ç”¨åˆ°çš„é‚£äº›ä¸ªç±»æˆ–è€…å¯¹è±¡</span></li></ul><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250391.png" referrerpolicy="no-referrer" alt="æ ¹å¯è¾¾ç®—æ³•"></p><p><span>å›¾ä¸­çš„ object5 å’Œobject6 è™½ç„¶ä»–ä»¬ä¹‹é—´äº’ç›¸å¼•ç”¨äº†ï¼Œä½†æ˜¯ä»æ ¹æ‰¾ä¸åˆ°å®ƒï¼Œæ‰€ä»¥å°±æ˜¯åƒåœ¾ï¼Œè€Œobject8æ²¡æœ‰ä»»ä½•å¼•ç”¨è‡ªç„¶è€Œç„¶ä¹Ÿæ˜¯åƒåœ¾ï¼Œå…¶ä»–çš„Objectå¯¹è±¡éƒ½æœ‰å¯ä»¥ä»æ ¹æ‰¾åˆ°çš„ï¼Œæ‰€ä»¥æ˜¯æœ‰ç”¨çš„ï¼Œä¸ä¼šè¢«åƒåœ¾å›æ”¶æ‰ã€‚</span></p><p>&nbsp;</p><p><strong><span>GC Root</span></strong></p><p><span>GC Roots æ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ã€‚ç”¨é€šä¿—çš„è¯æ¥è¯´ï¼Œå°±æ˜¯ç¨‹åºæ¥ä¸‹æ¥é€šè¿‡ç›´æ¥å¼•ç”¨æˆ–è€…é—´æ¥å¼•ç”¨ï¼Œèƒ½å¤Ÿè®¿é—®åˆ°çš„æ½œåœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚GC Roots åŒ…æ‹¬ï¼š</span></p><ul><li><strong><span>Java çº¿ç¨‹ä¸­ï¼Œå½“å‰æ‰€æœ‰æ­£åœ¨è¢«è°ƒç”¨çš„æ–¹æ³•çš„å¼•ç”¨ç±»å‹å‚æ•°ã€å±€éƒ¨å˜é‡ã€ä¸´æ—¶å€¼ç­‰ã€‚ä¹Ÿå°±æ˜¯ä¸æˆ‘ä»¬æ ˆå¸§ç›¸å…³çš„å„ç§å¼•ç”¨</span></strong></li><li><strong><span>æ‰€æœ‰å½“å‰è¢«åŠ è½½çš„ Java ç±»</span></strong></li><li><strong><span>Java ç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡</span></strong></li><li><strong><span>è¿è¡Œæ—¶å¸¸é‡æ± é‡Œçš„å¼•ç”¨ç±»å‹å¸¸é‡ï¼ˆString æˆ– Class ç±»å‹ï¼‰</span></strong></li><li><strong><span>JVM å†…éƒ¨æ•°æ®ç»“æ„çš„ä¸€äº›å¼•ç”¨ï¼Œæ¯”å¦‚ sun.jvm.hotspot.memory.Universe ç±»</span></strong></li><li><strong><span>ç”¨äºåŒæ­¥çš„ç›‘æ§å¯¹è±¡ï¼Œæ¯”å¦‚è°ƒç”¨äº†å¯¹è±¡çš„ wait() æ–¹æ³•</span></strong></li><li><strong><span>JNI handlesï¼ŒåŒ…æ‹¬ global handles å’Œ local handles</span></strong></li></ul><p>&nbsp;</p><p><span>GC Roots å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</span></p><ul><li><strong><span>æ´»åŠ¨çº¿ç¨‹ç›¸å…³çš„å„ç§å¼•ç”¨</span></strong></li><li><strong><span>ç±»çš„é™æ€å˜é‡çš„å¼•ç”¨</span></strong></li><li><strong><span>JNI å¼•ç”¨</span></strong></li></ul><p>&nbsp;</p><h2 id='æ¸…ç†åƒåœ¾ç®—æ³•'><span>æ¸…ç†åƒåœ¾ç®—æ³•</span></h2><p><span>æ¸…ç†åƒåœ¾ç®—æ³•åˆå«å†…å­˜å›æ”¶ç®—æ³•ã€‚</span></p><h3 id='æ ‡è®°markï¼‰'><span>æ ‡è®°ï¼ˆMarkï¼‰</span></h3><p><span>åƒåœ¾å›æ”¶çš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯æ‰¾å‡ºæ´»è·ƒçš„å¯¹è±¡ã€‚æ ¹æ® GC Roots éå†æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å«ä½œæ ‡è®°ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250716.png" referrerpolicy="no-referrer" alt="æ ‡è®°ï¼ˆMarkï¼‰"></p><p><span>å¦‚å›¾æ‰€ç¤ºï¼Œåœ†åœˆä»£è¡¨çš„æ˜¯å¯¹è±¡ã€‚ç»¿è‰²çš„ä»£è¡¨ GC Rootsï¼Œçº¢è‰²çš„ä»£è¡¨å¯ä»¥è¿½æº¯åˆ°çš„å¯¹è±¡ã€‚å¯ä»¥çœ‹åˆ°æ ‡è®°ä¹‹åï¼Œä»ç„¶æœ‰å¤šä¸ªç°è‰²çš„åœ†åœˆï¼Œå®ƒä»¬éƒ½æ˜¯è¢«å›æ”¶çš„å¯¹è±¡ã€‚</span></p><p>&nbsp;</p><h3 id='æ¸…é™¤sweepï¼‰'><span>æ¸…é™¤ï¼ˆSweepï¼‰</span></h3><p><span>æ¸…é™¤é˜¶æ®µå°±æ˜¯æŠŠæœªè¢«æ ‡è®°çš„å¯¹è±¡å›æ”¶æ‰ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250723.png" referrerpolicy="no-referrer" alt="æ¸…é™¤ï¼ˆSweepï¼‰"></p><p><span>ä½†æ˜¯è¿™ç§ç®€å•çš„æ¸…é™¤æ–¹å¼ï¼Œæœ‰ä¸€ä¸ªæ˜æ˜¾çš„å¼Šç«¯ï¼Œé‚£å°±æ˜¯ç¢ç‰‡é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ç”³è¯·äº† 1kã€2kã€3kã€4kã€5k çš„å†…å­˜ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250739.jpg" referrerpolicy="no-referrer" alt="æ¸…é™¤ï¼ˆSweepï¼‰-å†…å­˜"></p><p><span>ç”±äºæŸç§åŸå›  ï¼Œ2k å’Œ 4k çš„å†…å­˜ï¼Œæˆ‘ä¸å†ä½¿ç”¨ï¼Œå°±éœ€è¦äº¤ç»™åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250743.jpg" referrerpolicy="no-referrer" alt="æ¸…é™¤ï¼ˆSweepï¼‰-å›æ”¶"></p><p><span>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘åº”è¯¥æœ‰è¶³è¶³ 6k çš„ç©ºé—²ç©ºé—´ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘æ‰“ç®—ç”³è¯·å¦å¤–ä¸€ä¸ª 5k çš„ç©ºé—´ï¼Œç»“æœç³»ç»Ÿå‘Šè¯‰æˆ‘å†…å­˜ä¸è¶³äº†ã€‚ç³»ç»Ÿè¿è¡Œæ—¶é—´è¶Šé•¿ï¼Œè¿™ç§ç¢ç‰‡å°±è¶Šå¤šã€‚åœ¨å¾ˆä¹…ä¹‹å‰ä½¿ç”¨ Windows ç³»ç»Ÿæ—¶ï¼Œæœ‰ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå°±æ˜¯å†…å­˜æ•´ç†å’Œç£ç›˜æ•´ç†ï¼Œè¿è¡Œä¹‹åæœ‰å¯èƒ½ä¼šæ˜¾è‘—æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚è¿™ä¸ªå‡ºå‘ç‚¹æ˜¯ä¸€æ ·çš„ã€‚</span></p><p>&nbsp;</p><h3 id='å¤åˆ¶copyingï¼‰'><span>å¤åˆ¶ï¼ˆCopyingï¼‰</span></h3><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250745.png" referrerpolicy="no-referrer" alt="å¤åˆ¶(Copying)ç®—æ³•"></p><p><strong><span>ä¼˜ç‚¹</span></strong></p><ul><li><span>å› ä¸ºæ˜¯å¯¹æ•´ä¸ªåŠåŒºè¿›è¡Œå†…å­˜å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰æƒ…å†µã€‚å®ç°ç®€å•ï¼Œæ•ˆç‡è¾ƒé«˜</span></li></ul><p><strong><span>ä¸è¶³ä¹‹å¤„</span></strong></p><ul><li><span>æ—¢ç„¶è¦å¤åˆ¶ï¼Œéœ€è¦æå‰é¢„ç•™å†…å­˜ç©ºé—´ï¼Œæœ‰ä¸€å®šçš„æµªè´¹</span></li><li><span>åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶ï¼Œéœ€è¦å¤åˆ¶çš„å¯¹è±¡è¾ƒå¤šï¼Œæ•ˆç‡å°†ä¼šå˜ä½</span></li></ul><p>&nbsp;</p><h3 id='æ•´ç†compactï¼‰'><span>æ•´ç†ï¼ˆCompactï¼‰</span></h3><p><span>å…¶å®ï¼Œä¸ç”¨åˆ†é…ä¸€ä¸ªå¯¹ç­‰çš„é¢å¤–ç©ºé—´ï¼Œä¹Ÿæ˜¯å¯ä»¥å®Œæˆå†…å­˜çš„æ•´ç†å·¥ä½œã€‚å¯ä»¥æŠŠå†…å­˜æƒ³è±¡æˆä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„ï¼Œæ ¹æ®éšæœºçš„ index åˆ é™¤äº†ä¸€äº›æ•°æ®ã€‚é‚£ä¹ˆå¯¹æ•´ä¸ªæ•°ç»„çš„æ¸…ç†ï¼Œå…¶å®æ˜¯ä¸éœ€è¦å¦å¤–ä¸€ä¸ªæ•°ç»„æ¥è¿›è¡Œæ”¯æŒçš„ï¼Œä½¿ç”¨ç¨‹åºå°±å¯ä»¥å®ç°ã€‚å®ƒçš„ä¸»è¦æ€è·¯ï¼Œå°±æ˜¯ç§»åŠ¨æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œä¸”æŒ‰ç…§å†…å­˜åœ°å€é¡ºåºä¾æ¬¡æ’åˆ—ï¼Œç„¶åå°†æœ«ç«¯å†…å­˜åœ°å€ä»¥åçš„å†…å­˜å…¨éƒ¨å›æ”¶ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250748.png" referrerpolicy="no-referrer" alt="æ•´ç†ï¼ˆCompactï¼‰"></p><p><span>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç†æƒ³çŠ¶æ€ã€‚å¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸€èˆ¬éƒ½æ˜¯éå¸¸å¤æ‚çš„ï¼Œæˆ‘ä»¬è¿™é‡Œä¸å¯¹å…·ä½“çš„ç®—æ³•è¿›è¡Œæè¿°ã€‚ä½ åªéœ€è¦äº†è§£ï¼Œä»æ•ˆç‡ä¸Šæ¥è¯´ï¼Œä¸€èˆ¬æ•´ç†ç®—æ³•æ˜¯è¦ä½äºå¤åˆ¶ç®—æ³•çš„ã€‚</span></p><p>&nbsp;</p><h3 id='æ‰©å±•å›æ”¶ç®—æ³•'><span>æ‰©å±•å›æ”¶ç®—æ³•</span></h3><p><a href='https://juejin.cn/post/6896035896916148237' target='_blank' class='url'>https://juejin.cn/post/6896035896916148237</a></p><p><span>ç›®å‰JVMçš„åƒåœ¾å›æ”¶å™¨éƒ½æ˜¯å¯¹å‡ ç§æœ´ç´ ç®—æ³•çš„å‘æ‰¬å…‰å¤§ï¼ˆæ²¡æœ‰æœ€ä¼˜çš„ç®—æ³•ï¼Œåªæœ‰æœ€åˆé€‚çš„ç®—æ³•ï¼‰ï¼š</span></p><ul><li><strong><span>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</span></strong><span>ï¼šå¤åˆ¶ç®—æ³•æ˜¯æ‰€æœ‰ç®—æ³•é‡Œé¢æ•ˆç‡æœ€é«˜çš„ï¼Œç¼ºç‚¹æ˜¯ä¼šé€ æˆä¸€å®šçš„ç©ºé—´æµªè´¹</span></li><li><strong><span>æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰</span></strong><span>ï¼šæ•ˆç‡ä¸€èˆ¬ï¼Œç¼ºç‚¹æ˜¯ä¼šé€ æˆå†…å­˜ç¢ç‰‡é—®é¢˜</span></li><li><strong><span>æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰</span></strong><span>ï¼šæ•ˆç‡æ¯”å‰ä¸¤è€…è¦å·®ï¼Œä½†æ²¡æœ‰ç©ºé—´æµªè´¹ï¼Œä¹Ÿæ¶ˆé™¤äº†å†…å­˜ç¢ç‰‡é—®é¢˜</span></li></ul><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250018.png" referrerpolicy="no-referrer" alt="æ”¶é›†ç®—æ³•"></p><p>&nbsp;</p><h4 id='æ ‡è®°æ¸…é™¤mark-sweepï¼‰'><span>æ ‡è®°æ¸…é™¤ï¼ˆMark-Sweepï¼‰</span></h4><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250158.png" referrerpolicy="no-referrer" alt="æ ‡è®°æ¸…é™¤(Mark-Sweep)ç®—æ³•"></p><p><span>é¦–å…ˆä» GC Root å¼€å§‹éå†å¯¹è±¡å›¾ï¼Œå¹¶æ ‡è®°ï¼ˆMarkï¼‰æ‰€é‡åˆ°çš„æ¯ä¸ªå¯¹è±¡ï¼Œæ ‡è¯†å‡ºæ‰€æœ‰è¦å›æ”¶çš„å¯¹è±¡ã€‚ç„¶åå›æ”¶å™¨æ£€æŸ¥å †ä¸­æ¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚</span></p><p><strong><span>ä¸è¶³ä¹‹å¤„</span></strong></p><ul><li><span>æ ‡è®°ã€æ¸…é™¤çš„æ•ˆç‡éƒ½ä¸é«˜</span></li><li><span>æ¸…é™¤åäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šä¼šå¯¼è‡´åœ¨åˆ†é…å¤§å¯¹è±¡æ—¶æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­å†…å­˜ï¼Œä»è€Œä¸å¾—ä¸è§¦å‘å¦ä¸€æ¬¡åƒåœ¾å›æ”¶åŠ¨ä½œ</span></li></ul><p>&nbsp;</p><h4 id='æ ‡è®°æ•´ç†mark-compactï¼‰'><span>æ ‡è®°æ•´ç†ï¼ˆMark-Compactï¼‰</span></h4><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250164.png" referrerpolicy="no-referrer" alt="æ ‡è®°æ•´ç†(Mark-Compact)ç®—æ³•"></p><p><span>ä¸æ ‡è®°æ¸…é™¤ç®—æ³•ç±»ä¼¼ï¼Œä½†ä¸æ˜¯åœ¨æ ‡è®°å®Œæˆåå¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯å°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</span></p><p><strong><span>ä¼˜ç‚¹</span></strong></p><ul><li><span>æ¶ˆé™¤äº†æ ‡è®°æ¸…é™¤å¯¼è‡´çš„å†…å­˜åˆ†æ•£é—®é¢˜ï¼Œä¹Ÿæ¶ˆé™¤äº†å¤åˆ¶ç®—æ³•ä¸­å†…å­˜å‡åŠçš„é«˜é¢ä»£ä»·</span></li></ul><p><strong><span>ä¸è¶³ä¹‹å¤„</span></strong></p><ul><li><span>æ•ˆç‡ä½ä¸‹ï¼Œéœ€è¦æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡ï¼Œè¿˜è¦æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚æ•ˆç‡ä¸Šä½äºå¤åˆ¶ç®—æ³•</span></li></ul><p>&nbsp;</p><h4 id='æ ‡è®°å¤åˆ¶mark-copingï¼‰'><span>æ ‡è®°å¤åˆ¶ï¼ˆMark-Copingï¼‰</span></h4><p><span>æ ‡è®°-å¤åˆ¶ç®—æ³•å°†å†…å­˜åˆ†ä¸ºä¸¤å—ç›¸åŒå¤§å°çš„åŒºåŸŸï¼ˆæ¯”å¦‚æ–°ç”Ÿä»£çš„SurvivoråŒºï¼‰ï¼Œæ¯æ¬¡åœ¨å…¶ä¸­ä¸€å—åŒºåŸŸåˆ†é…å…ƒç´ ï¼Œå½“è¿™å—åŒºåŸŸå†…å­˜å æ»¡æ—¶ï¼Œå°±ä¼šå°†å­˜æ´»ä¸‹æ¥çš„å…ƒç´ å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜åŒºåŸŸå¹¶æ¸…ç©ºå½“å‰å†…å­˜åŒºåŸŸã€‚</span></p><ul><li><span>ç¼ºç‚¹ï¼šæµªè´¹ä¸€åŠçš„å†…å­˜ç©ºé—´</span></li><li><span>ä¼˜ç‚¹ï¼šç®€å•é«˜æ•ˆ</span></li></ul><p><strong><span>JVMåœ¨EdenåŒºä¿å­˜æ–°å¯¹è±¡ï¼Œåœ¨GCæ—¶ï¼Œå°†Edenå’ŒSurvivorä¸­å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Survivorçš„å¦ä¸€ä¸ªåˆ†åŒºã€‚è¿™æ˜¯JVMå¯¹å¤åˆ¶ç®—æ³•çš„ä¸€ä¸ªä¼˜åŒ–ã€‚åªæµªè´¹äº†1/10çš„å†…å­˜ç©ºé—´ã€JVMçš„EdenåŒºå’ŒSurvivoråŒºçš„æ¯”ä¾‹ä¸º 8:2ã€‘</span></strong></p><p><span> </span><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250163.jpg" referrerpolicy="no-referrer" alt="æ ‡è®°å¤åˆ¶"></p><p>&nbsp;</p><h4 id='åˆ†ä»£æ”¶é›†generational-collectionï¼‰'><span>åˆ†ä»£æ”¶é›†ï¼ˆGenerational Collectionï¼‰</span></h4><p><span>åˆ†ä»£æ”¶é›†å°±æ˜¯æ ¹æ®å¯¹è±¡çš„å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚</span></p><ul><li><strong><span>æ–°ç”Ÿä»£</span></strong><span>å¯¹è±¡â€œæœç”Ÿå¤•æ­»â€ï¼Œæ¯æ¬¡æ”¶é›†éƒ½æœ‰å¤§é‡å¯¹è±¡ï¼ˆ99%ï¼‰æ­»å»ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©</span><strong><span>æ ‡è®°-å¤åˆ¶ç®—æ³•</span></strong><span>ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ¯æ¬¡åƒåœ¾æ”¶é›†</span></li><li><strong><span>è€å¹´ä»£</span></strong><span>å¯¹è±¡ç”Ÿå­˜å‡ ç‡æ¯”è¾ƒé«˜ï¼Œå­˜æ´»å¯¹è±¡æ¯”è¾ƒå¤šï¼Œå¦‚æœé€‰æ‹©å¤åˆ¶ç®—æ³•éœ€è¦ä»˜å‡ºè¾ƒé«˜çš„IOæˆæœ¬ï¼Œè€Œä¸”æ²¡ç”¨é¢å¤–çš„ç©ºé—´å¯ä»¥ç”¨äºå¤åˆ¶ï¼Œæ­¤æ—¶é€‰æ‹©</span><strong><span>æ ‡è®°-æ¸…é™¤</span></strong><span>æˆ–è€…</span><strong><span>æ ‡è®°-æ•´ç†</span></strong><span>å°±æ¯”è¾ƒåˆç†</span></li></ul><p>&nbsp;</p><p><span>ç ”ç©¶è¡¨æ˜å¤§éƒ¨åˆ†å¯¹è±¡å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</span></p><ul><li><span>å¤§éƒ¨åˆ†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸéƒ½å¾ˆçŸ­</span></li><li><span>å…¶ä»–å¯¹è±¡åˆ™å¾ˆå¯èƒ½ä¼šå­˜æ´»å¾ˆé•¿æ—¶é—´</span></li></ul><p><span>æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ã€‚å¯¹ä¸åŒå‘¨æœŸçš„å¯¹è±¡é‡‡å–ä¸åŒçš„æ”¶é›†ç®—æ³•ï¼š</span></p><ul><li><strong><span>æ–°ç”Ÿä»£</span></strong><span>ï¼šæ¯æ¬¡åƒåœ¾æ”¶é›†ä¼šæœ‰å¤§æ‰¹å¯¹è±¡å›æ”¶ï¼Œæ‰€ä»¥é‡‡å–å¤åˆ¶ç®—æ³•</span></li><li><strong><span>è€å¹´ä»£</span></strong><span>ï¼šå¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œé‡‡å–æ ‡è®°æ¸…ç†æˆ–è€…æ ‡è®°æ•´ç†ç®—æ³•</span></li></ul><p>&nbsp;</p><p><strong><span>â‘  å¹´è½»ä»£ï¼ˆYoung Generationï¼‰</span></strong></p><p><span>å¹´è½»ä»£ä½¿ç”¨çš„åƒåœ¾å›æ”¶ç®—æ³•æ˜¯å¤åˆ¶ç®—æ³•ã€‚å› ä¸ºå¹´è½»ä»£å‘ç”Ÿ GC åï¼Œåªä¼šæœ‰éå¸¸å°‘çš„å¯¹è±¡å­˜æ´»ï¼Œå¤åˆ¶è¿™éƒ¨åˆ†å¯¹è±¡æ˜¯éå¸¸é«˜æ•ˆçš„ã€‚ä½†å¤åˆ¶ç®—æ³•ä¼šé€ æˆä¸€å®šçš„ç©ºé—´æµªè´¹ï¼Œæ‰€ä»¥å¹´è½»ä»£ä¸­é—´ä¹Ÿä¼šåˆ†å¾ˆå¤šåŒºåŸŸã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250172.jpg" referrerpolicy="no-referrer" alt="å¹´è½»ä»£"></p><p><span>å¦‚å›¾æ‰€ç¤ºï¼Œå¹´è½»ä»£åˆ†ä¸ºï¼š</span><strong><span>1ä¸ªä¼Šç”¸å›­ç©ºé—´ï¼ˆEden ï¼‰</span></strong><span>ï¼Œ</span><strong><span>2ä¸ªå¹¸å­˜è€…ç©ºé—´ï¼ˆSurvivor ï¼‰</span></strong><span>ã€‚å½“å¹´è½»ä»£ä¸­çš„ Eden åŒºåˆ†é…æ»¡çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘å¹´è½»ä»£çš„ GCï¼ˆMinor GCï¼‰ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</span></p><ul><li><span>åœ¨ Eden åŒºæ‰§è¡Œäº†ç¬¬ä¸€æ¬¡ GC ä¹‹åï¼Œå­˜æ´»çš„å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°å…¶ä¸­ä¸€ä¸ª Survivor åˆ†åŒºï¼ˆä»¥ä¸‹ç®€ç§°fromï¼‰</span></li><li><span>Eden åŒºå†æ¬¡ GCï¼Œè¿™æ—¶ä¼šé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œå°† Eden å’Œ from åŒºä¸€èµ·æ¸…ç†ã€‚å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ° to åŒºï¼Œç„¶ååªéœ€è¦æ¸…ç©º from åŒºå°±å¯ä»¥äº†</span></li></ul><p><span>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ€»ä¼šæœ‰1ä¸ª Survivor åˆ†åŒºæ˜¯ç©ºç½®çš„ã€‚Edenã€fromã€to çš„é»˜è®¤æ¯”ä¾‹æ˜¯ 8:1:1ï¼Œæ‰€ä»¥åªä¼šé€ æˆ 10% çš„ç©ºé—´æµªè´¹ã€‚è¿™ä¸ªæ¯”ä¾‹ï¼Œæ˜¯ç”±å‚æ•° </span><strong><span>-XX:SurvivorRatio</span></strong><span> è¿›è¡Œé…ç½®çš„ï¼ˆé»˜è®¤ä¸º 8ï¼‰ã€‚</span></p><p>&nbsp;</p><p><strong><span>â‘¡ è€å¹´ä»£ï¼ˆOld/Tenured Generationï¼‰</span></strong></p><p><span>è€å¹´ä»£ä¸€èˆ¬ä½¿ç”¨â€œ</span><strong><span>æ ‡è®°-æ¸…é™¤</span></strong><span>â€ã€â€œ</span><strong><span>æ ‡è®°-æ•´ç†</span></strong><span>â€ç®—æ³•ï¼Œå› ä¸ºè€å¹´ä»£çš„å¯¹è±¡å­˜æ´»ç‡ä¸€èˆ¬æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œç©ºé—´åˆæ¯”è¾ƒå¤§ï¼Œæ‹·è´èµ·æ¥å¹¶ä¸åˆ’ç®—ï¼Œè¿˜ä¸å¦‚é‡‡å–å°±åœ°æ”¶é›†çš„æ–¹å¼ã€‚å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„é€”å¾„å¦‚ä¸‹ï¼š</span></p><ul><li><p><strong><span>æå‡ï¼ˆPromotionï¼‰</span></strong></p><p><span>å¦‚æœå¯¹è±¡å¤Ÿè€ï¼Œä¼šé€šè¿‡â€œæå‡â€è¿›å…¥è€å¹´ä»£</span></p></li><li><p><strong><span>åˆ†é…æ‹…ä¿</span></strong></p><p><span>å¹´è½»ä»£å›æ”¶åå­˜æ´»çš„å¯¹è±¡å¤§äº10%æ—¶ï¼Œå› Survivorç©ºé—´ä¸å¤Ÿå­˜å‚¨ï¼Œå¯¹è±¡å°±ä¼šç›´æ¥åœ¨è€å¹´ä»£ä¸Šåˆ†é…</span></p></li><li><p><strong><span>å¤§å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…</span></strong></p><p><span>è¶…å‡ºæŸä¸ªå¤§å°çš„å¯¹è±¡å°†ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…</span></p></li><li><p><strong><span>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š</span></strong></p><p><span>æœ‰çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå¹¶ä¸è¦æ±‚ age å¿…é¡»è¾¾åˆ° 15 æ‰èƒ½æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå®ƒä¼šä½¿ç”¨ä¸€äº›åŠ¨æ€çš„è®¡ç®—æ–¹æ³•ã€‚</span></p><p><span>æ¯”å¦‚ï¼Œå¦‚æœå¹¸å­˜åŒºä¸­ç›¸åŒå¹´é¾„å¯¹è±¡å¤§å°çš„å’Œï¼Œå¤§äºå¹¸å­˜åŒºçš„ä¸€åŠï¼Œå¤§äºæˆ–ç­‰äº age çš„å¯¹è±¡å°†ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</span></p></li></ul><p>&nbsp;</p><h4 id='åˆ†åŒºæ”¶é›†'><span>åˆ†åŒºæ”¶é›†</span></h4><p>&nbsp;</p><p>&nbsp;</p><h2 id='gcåƒåœ¾æ”¶é›†å™¨'><span>GCåƒåœ¾æ”¶é›†å™¨</span></h2><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250175.jpg" referrerpolicy="no-referrer" alt="æ”¶é›†å™¨"></p><p><span>GCåƒåœ¾æ”¶é›†å™¨çš„JVMé…ç½®å‚æ•°ï¼š</span></p><ul><li><strong><span>-XX:+UseSerialGC</span></strong><span>ï¼šå¹´è½»ä»£å’Œè€å¹´ä»£éƒ½ç”¨ä¸²è¡Œæ”¶é›†å™¨</span></li><li><strong><span>-XX:+UseParNewGC</span></strong><span>ï¼šå¹´è½»ä»£ä½¿ç”¨ ParNewï¼Œè€å¹´ä»£ä½¿ç”¨ Serial Old</span></li><li><strong><span>-XX:+UseParallelGC</span></strong><span>ï¼šå¹´è½»ä»£ä½¿ç”¨ ParallerGCï¼Œè€å¹´ä»£ä½¿ç”¨ Serial Old</span></li><li><strong><span>-XX:+UseParallelOldGC</span></strong><span>ï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨</span></li><li><strong><span>-XX:+UseConcMarkSweepGC</span></strong><span>ï¼šè¡¨ç¤ºå¹´è½»ä»£ä½¿ç”¨ ParNewï¼Œè€å¹´ä»£çš„ç”¨ CMS</span></li><li><strong><span>-XX:+UseG1GC</span></strong><span>ï¼šä½¿ç”¨ G1åƒåœ¾å›æ”¶å™¨</span></li><li><strong><span>-XX:+UseZGC</span></strong><span>ï¼šä½¿ç”¨ ZGC åƒåœ¾å›æ”¶å™¨</span></li></ul><p>&nbsp;</p><h3 id='å¹´è½»ä»£æ”¶é›†å™¨'><span>å¹´è½»ä»£æ”¶é›†å™¨</span></h3><h4 id='serialæ”¶é›†å™¨'><span>Serialæ”¶é›†å™¨</span></h4><p><span>å¤„ç†GCçš„åªæœ‰ä¸€æ¡çº¿ç¨‹ï¼Œå¹¶ä¸”åœ¨åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­æš‚åœä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ã€‚æœ€ç®€å•çš„åƒåœ¾å›æ”¶å™¨ï¼Œä½†åƒä¸‡åˆ«ä»¥ä¸ºå®ƒæ²¡æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚å› ä¸ºç®€å•ï¼Œæ‰€ä»¥é«˜æ•ˆï¼Œå®ƒé€šå¸¸ç”¨åœ¨å®¢æˆ·ç«¯åº”ç”¨ä¸Šã€‚å› ä¸ºå®¢æˆ·ç«¯åº”ç”¨ä¸ä¼šé¢‘ç¹åˆ›å»ºå¾ˆå¤šå¯¹è±¡ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šæ„Ÿè§‰å‡ºæ˜æ˜¾çš„å¡é¡¿ã€‚ç›¸åï¼Œå®ƒä½¿ç”¨çš„èµ„æºæ›´å°‘ï¼Œä¹Ÿæ›´è½»é‡çº§ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250476.jpg" referrerpolicy="no-referrer" alt="Serialæ”¶é›†å™¨"></p><p>&nbsp;</p><h4 id='parnewæ”¶é›†å™¨'><span>ParNewæ”¶é›†å™¨</span></h4><p><span>ParNewæ˜¯Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚ç”±å¤šæ¡GCçº¿ç¨‹å¹¶è¡Œåœ°è¿›è¡Œåƒåœ¾æ¸…ç†ã€‚æ¸…ç†è¿‡ç¨‹ä¾ç„¶è¦åœæ­¢ç”¨æˆ·çº¿ç¨‹ã€‚ParNew è¿½æ±‚â€œä½åœé¡¿æ—¶é—´â€ï¼Œä¸ Serial å”¯ä¸€åŒºåˆ«å°±æ˜¯ä½¿ç”¨äº†å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œåœ¨å¤š CPU ç¯å¢ƒä¸‹æ€§èƒ½æ¯” Serial ä¼šæœ‰ä¸€å®šç¨‹åº¦çš„æå‡ï¼›ä½†çº¿ç¨‹åˆ‡æ¢éœ€è¦é¢å¤–çš„å¼€é”€ï¼Œå› æ­¤åœ¨å• CPU ç¯å¢ƒä¸­è¡¨ç°ä¸å¦‚ Serialã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250482.jpg" referrerpolicy="no-referrer" alt="ParNewæ”¶é›†å™¨"></p><p>&nbsp;</p><h4 id='parallel-scavengeæ”¶é›†å™¨'><span>Parallel Scavengeæ”¶é›†å™¨</span></h4><p><span>å¦ä¸€ä¸ªå¤šçº¿ç¨‹ç‰ˆæœ¬çš„åƒåœ¾å›æ”¶å™¨ã€‚å®ƒä¸ParNewçš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š</span></p><ul><li><strong><span>Parallel Scavenge</span></strong><span>ï¼šè¿½æ±‚CPUååé‡ï¼Œèƒ½å¤Ÿåœ¨è¾ƒçŸ­æ—¶é—´å®Œæˆä»»åŠ¡ï¼Œé€‚åˆæ²¡æœ‰äº¤äº’çš„åå°è®¡ç®—ã€‚å¼±äº¤äº’å¼ºè®¡ç®—</span></li><li><strong><span>ParNew</span></strong><span>ï¼šè¿½æ±‚é™ä½ç”¨æˆ·åœé¡¿æ—¶é—´ï¼Œé€‚åˆäº¤äº’å¼åº”ç”¨ã€‚å¼ºäº¤äº’å¼±è®¡ç®—</span></li></ul><p>&nbsp;</p><h3 id='è€å¹´ä»£æ”¶é›†å™¨'><span>è€å¹´ä»£æ”¶é›†å™¨</span></h3><h4 id='serial-oldæ”¶é›†å™¨'><span>Serial Oldæ”¶é›†å™¨</span></h4><p><span>ä¸å¹´è½»ä»£çš„ Serial åƒåœ¾æ”¶é›†å™¨å¯¹åº”ï¼Œéƒ½æ˜¯å•çº¿ç¨‹ç‰ˆæœ¬ï¼ŒåŒæ ·é€‚åˆå®¢æˆ·ç«¯ä½¿ç”¨ã€‚å¹´è½»ä»£çš„ Serialï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ã€‚è€å¹´ä»£çš„ Old Serialï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250483.jpg" referrerpolicy="no-referrer" alt="SerialOldæ”¶é›†å™¨"></p><p>&nbsp;</p><h4 id='parallel-oldæ”¶é›†å™¨'><span>Parallel Oldæ”¶é›†å™¨</span></h4><p><span>Parallel Old æ”¶é›†å™¨æ˜¯ Parallel Scavenge çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œè¿½æ±‚ CPU ååé‡ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250490.jpg" referrerpolicy="no-referrer" alt="ParallelOldæ”¶é›†å™¨"></p><p>&nbsp;</p><h4 id='cmsæ”¶é›†å™¨'><span>CMSæ”¶é›†å™¨</span></h4><p><strong><span>å¹¶å‘æ ‡è®°æ¸…é™¤(Concurrent Mark Sweep,CMS)åƒåœ¾å›æ”¶å™¨</span></strong><span>ï¼Œæ˜¯ä¸€æ¬¾è‡´åŠ›äºè·å–æœ€çŸ­åœé¡¿æ—¶é—´çš„æ”¶é›†å™¨ï¼Œä½¿ç”¨å¤šä¸ªçº¿ç¨‹æ¥æ‰«æå †å†…å­˜å¹¶æ ‡è®°å¯è¢«æ¸…é™¤çš„å¯¹è±¡ï¼Œç„¶åæ¸…é™¤æ ‡è®°çš„å¯¹è±¡ã€‚åœ¨ä¸‹é¢ä¸¤ç§æƒ…å½¢ä¸‹ä¼šæš‚åœå·¥ä½œçº¿ç¨‹ï¼š</span></p><ul><li><span>åœ¨è€å¹´ä»£ä¸­æ ‡è®°å¼•ç”¨å¯¹è±¡çš„æ—¶å€™</span></li><li><span>åœ¨åšåƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­å †å†…å­˜ä¸­æœ‰å˜åŒ–å‘ç”Ÿ</span></li></ul><p><span>å¯¹æ¯”ä¸å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼ŒCMSå›æ”¶å™¨ä½¿ç”¨æ›´å¤šçš„CPUæ¥ä¿è¯æ›´é«˜çš„ååé‡ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥æœ‰æ›´å¤šçš„CPUç”¨æ¥æå‡æ€§èƒ½ï¼Œé‚£ä¹ˆCMSåƒåœ¾å›æ”¶å™¨æ˜¯æ¯”å¹¶è¡Œå›æ”¶å™¨æ›´å¥½çš„é€‰æ‹©ã€‚ä½¿ç”¨ </span><code>-XX:+UseParNewGCJVM</code><span> å‚æ•°æ¥å¼€å¯ä½¿ç”¨CMSåƒåœ¾å›æ”¶å™¨ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250493.png" referrerpolicy="no-referrer" alt="CMSæ”¶é›†å™¨"></p><p><strong><span>ä¸»è¦æµç¨‹å¦‚ä¸‹</span></strong><span>ï¼š</span></p><ul><li><strong><span>åˆå§‹æ ‡è®°(CMS initial mark)</span></strong><span>ï¼šä»…æ ‡è®°å‡ºGC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ã€‚éœ€è¦Stop-the-world</span></li><li><strong><span>å¹¶å‘æ ‡è®°(CMS concurrenr mark)</span></strong><span>ï¼šè¿›è¡ŒGC Rootséå†çš„è¿‡ç¨‹ï¼Œå¯»æ‰¾å‡ºæ‰€æœ‰å¯è¾¾å¯¹è±¡</span></li><li><strong><span>é‡æ–°æ ‡è®°(CMS remark)</span></strong><span>ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚éœ€è¦Stop-the-world</span></li><li><strong><span>å¹¶å‘æ¸…é™¤(CMS concurrent sweep)</span></strong><span>ï¼šæ¸…å‡ºåƒåœ¾</span></li></ul><p>&nbsp;</p><p><strong><span>CMSè§¦å‘æœºåˆ¶</span></strong><span>ï¼šå½“è€å¹´ä»£çš„ä½¿ç”¨ç‡è¾¾åˆ°80%æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡CMS GCã€‚</span></p><ul><li><code>-XX:CMSInitiatingOccupancyFraction=80</code></li><li><code>-XX:+UseCMSInitiatingOccupancyOnly</code></li></ul><p>&nbsp;</p><p><strong><span>ä¼˜ç‚¹</span></strong></p><ul><li><span>å¹¶å‘æ”¶é›†</span></li><li><span>åœé¡¿æ—¶é—´æœ€çŸ­</span></li></ul><p>&nbsp;</p><p><strong><span>ç¼ºç‚¹</span></strong></p><ul><li><p><strong><span>å¹¶å‘å›æ”¶å¯¼è‡´CPUèµ„æºç´§å¼ </span></strong></p><p><span>åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œä½†å´ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œé™ä½ç¨‹åºæ€»ååé‡ã€‚CMSé»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯ï¼šï¼ˆCPUæ ¸æ•° + 3ï¼‰/ 4ï¼Œå½“CPUæ ¸æ•°ä¸è¶³å››ä¸ªæ—¶ï¼ŒCMSå¯¹ç”¨æˆ·ç¨‹åºçš„å½±å“å°±å¯èƒ½å˜å¾—å¾ˆå¤§ã€‚</span></p></li><li><p><strong><span>æ— æ³•æ¸…ç†æµ®åŠ¨åƒåœ¾</span></strong></p><p><span>åœ¨CMSçš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…ç†é˜¶æ®µï¼Œç”¨æˆ·çº¿ç¨‹è¿˜åœ¨ç»§ç»­è¿è¡Œï¼Œå°±è¿˜ä¼šä¼´éšæœ‰æ–°çš„åƒåœ¾å¯¹è±¡ä¸æ–­äº§ç”Ÿï¼Œä½†è¿™ä¸€éƒ¨åˆ†åƒåœ¾å¯¹è±¡æ˜¯å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ç»“æŸä»¥åï¼ŒCMSæ— æ³•åœ¨å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬ï¼Œåªå¥½ç•™åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†æ—¶å†æ¸…ç†æ‰ã€‚è¿™ä¸€éƒ¨åˆ†åƒåœ¾ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€ã€‚</span></p></li><li><p><strong><span>å¹¶å‘å¤±è´¥ï¼ˆConcurrent Mode Failureï¼‰</span></strong></p><p><span>ç”±äºåœ¨åƒåœ¾å›æ”¶é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜åœ¨å¹¶å‘è¿è¡Œï¼Œé‚£å°±è¿˜éœ€è¦é¢„ç•™è¶³å¤Ÿçš„å†…å­˜ç©ºé—´æä¾›ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨ï¼Œå› æ­¤CMSä¸èƒ½åƒå…¶ä»–å›æ”¶å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œå›æ”¶ï¼Œå¿…é¡»é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ä¾›å¹¶å‘å›æ”¶æ—¶çš„ç¨‹åºè¿è¡Œä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“è€å¹´ä»£ä½¿ç”¨äº† 80% çš„ç©ºé—´åå°±ä¼šè§¦å‘ CMS åƒåœ¾å›æ”¶ï¼Œè¿™ä¸ªå€¼å¯ä»¥é€šè¿‡ -XX</span><strong><span>:</span></strong><span> CMSInitiatingOccupancyFraction å‚æ•°æ¥è®¾ç½®ã€‚</span></p><p><span>è¿™é‡Œä¼šæœ‰ä¸€ä¸ªé£é™©ï¼šè¦æ˜¯CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºåˆ†é…æ–°å¯¹è±¡çš„éœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡â€œå¹¶å‘å¤±è´¥â€ï¼ˆConcurrent Mode Failureï¼‰ï¼Œè¿™æ—¶å€™è™šæ‹Ÿæœºå°†ä¸å¾—ä¸å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šStop The Worldï¼Œä¸´æ—¶å¯ç”¨ Serial Old æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶ï¼Œè¿™æ ·ä¸€æ¥åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚</span></p></li><li><p><strong><span>å†…å­˜ç¢ç‰‡é—®é¢˜</span></strong></p><p><span>CMSæ˜¯ä¸€æ¬¾åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„å›æ”¶å™¨ï¼Œè¿™æ„å‘³ç€å›æ”¶ç»“æŸæ—¶ä¼šæœ‰å†…å­˜ç¢ç‰‡äº§ç”Ÿã€‚å†…å­˜ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œå°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥éº»çƒ¦ï¼Œå¾€å¾€ä¼šå‡ºç°è€å¹´ä»£è¿˜æœ‰å¾ˆå¤šå‰©ä½™ç©ºé—´ï¼Œä½†å°±æ˜¯æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œè€Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡ Full GC çš„æƒ…å†µã€‚</span></p><p><span>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCMSæ”¶é›†å™¨æä¾›äº†ä¸€ä¸ª -XX:+UseCMSCompactAtFullCollection å¼€å…³å‚æ•°ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œç”¨äºåœ¨ Full GC æ—¶å¼€å¯å†…å­˜ç¢ç‰‡çš„åˆå¹¶æ•´ç†è¿‡ç¨‹ï¼Œç”±äºè¿™ä¸ªå†…å­˜æ•´ç†å¿…é¡»ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ˜¯æ— æ³•å¹¶å‘çš„ï¼Œè¿™æ ·åœé¡¿æ—¶é—´å°±ä¼šå˜é•¿ã€‚è¿˜æœ‰å¦å¤–ä¸€ä¸ªå‚æ•° -XX:CMSFullGCsBeforeCompactionï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯è¦æ±‚CMSåœ¨æ‰§è¡Œè¿‡è‹¥å¹²æ¬¡ä¸æ•´ç†ç©ºé—´çš„ Full GC ä¹‹åï¼Œä¸‹ä¸€æ¬¡è¿›å…¥ Full GC å‰ä¼šå…ˆè¿›è¡Œç¢ç‰‡æ•´ç†ï¼ˆé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºæ¯æ¬¡è¿›å…¥ Full GC æ—¶éƒ½è¿›è¡Œç¢ç‰‡æ•´ç†ï¼‰ã€‚</span></p></li></ul><p>&nbsp;</p><p><strong><span>ä½œç”¨å†…å­˜åŒºåŸŸ</span></strong><span>ï¼šè€å¹´ä»£</span></p><p><strong><span>é€‚ç”¨åœºæ™¯</span></strong><span>ï¼šå¯¹åœé¡¿æ—¶é—´æ•æ„Ÿçš„åœºåˆ</span></p><p><strong><span>ç®—æ³•ç±»å‹</span></strong><span>ï¼šæ ‡è®°-æ¸…é™¤</span></p><p>&nbsp;</p><h3 id='æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ”¶é›†'><span>æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ”¶é›†</span></h3><h4 id='g1æ”¶é›†å™¨'><span>G1æ”¶é›†å™¨</span></h4><p><span>G1ï¼ˆGarbage Firstï¼‰å›æ”¶å™¨é‡‡ç”¨é¢å‘å±€éƒ¨æ”¶é›†çš„è®¾è®¡æ€è·¯å’ŒåŸºäºRegionçš„å†…å­˜å¸ƒå±€å½¢å¼ï¼Œæ˜¯ä¸€æ¬¾ä¸»è¦é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾å›æ”¶å™¨ã€‚G1è®¾è®¡åˆè¡·å°±æ˜¯æ›¿æ¢ CMSï¼Œæˆä¸ºä¸€ç§å…¨åŠŸèƒ½æ”¶é›†å™¨ã€‚G1 åœ¨JDK9 ä¹‹åæˆä¸ºæœåŠ¡ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤åƒåœ¾å›æ”¶å™¨ï¼Œå–ä»£äº† Parallel Scavenge åŠ  Parallel Old çš„é»˜è®¤ç»„åˆï¼Œè€Œ CMS è¢«å£°æ˜ä¸ºä¸æ¨èä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨ã€‚G1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäº æ ‡è®°-æ•´ç† ç®—æ³•å®ç°çš„å›æ”¶å™¨ï¼Œä½†ä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionä¹‹é—´ï¼‰ä¸Šçœ‹åˆæ˜¯åŸºäº æ ‡è®°-å¤åˆ¶ ç®—æ³•å®ç°çš„ã€‚</span><strong><span>G1 å›æ”¶è¿‡ç¨‹</span></strong><span>ï¼ŒG1 å›æ”¶å™¨çš„è¿ä½œè¿‡ç¨‹å¤§è‡´å¯åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š</span></p><ul><li><strong><span>åˆå§‹æ ‡è®°ï¼ˆä¼šSTWï¼‰</span></strong><span>ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSæŒ‡é’ˆçš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½æ­£ç¡®åœ°åœ¨å¯ç”¨çš„Regionä¸­åˆ†é…æ–°å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ï¼Œè€Œä¸”æ˜¯å€Ÿç”¨è¿›è¡ŒMinor GCçš„æ—¶å€™åŒæ­¥å®Œæˆçš„ï¼Œæ‰€ä»¥G1æ”¶é›†å™¨åœ¨è¿™ä¸ªé˜¶æ®µå®é™…å¹¶æ²¡æœ‰é¢å¤–çš„åœé¡¿ã€‚</span></li><li><strong><span>å¹¶å‘æ ‡è®°</span></strong><span>ï¼šä» GC Roots å¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾ï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚å½“å¯¹è±¡å›¾æ‰«æå®Œæˆä»¥åï¼Œè¿˜è¦é‡æ–°å¤„ç†åœ¨å¹¶å‘æ—¶æœ‰å¼•ç”¨å˜åŠ¨çš„å¯¹è±¡ã€‚</span></li><li><strong><span>æœ€ç»ˆæ ‡è®°ï¼ˆä¼šSTWï¼‰</span></strong><span>ï¼šå¯¹ç”¨æˆ·çº¿ç¨‹åšçŸ­æš‚çš„æš‚åœï¼Œå¤„ç†å¹¶å‘é˜¶æ®µç»“æŸåä»æœ‰å¼•ç”¨å˜åŠ¨çš„å¯¹è±¡ã€‚</span></li><li><strong><span>æ¸…ç†é˜¶æ®µï¼ˆä¼šSTWï¼‰</span></strong><span>ï¼šæ›´æ–°Regionçš„ç»Ÿè®¡æ•°æ®ï¼Œå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œå¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„å¤šä¸ªRegionæ„æˆå›æ”¶é›†ï¼Œç„¶åæŠŠå†³å®šå›æ”¶çš„é‚£ä¸€éƒ¨åˆ†Regionçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„Regionä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§Regionçš„å…¨éƒ¨ç©ºé—´ã€‚è¿™é‡Œçš„æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œå¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç”±å¤šæ¡å›æ”¶å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆçš„ã€‚</span></li></ul><p>&nbsp;</p><p><span>G1æ”¶é›†å™¨ä¸­çš„å †å†…å­˜è¢«åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„å†…å­˜å—ï¼ˆRegionï¼‰ï¼Œæ¯ä¸ªRegionæ˜¯é€»è¾‘è¿ç»­çš„ä¸€æ®µå†…å­˜ï¼Œç»“æ„å¦‚ä¸‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250801.png" referrerpolicy="no-referrer" alt="G1-Region"></p><p><span>æ¯ä¸ªRegionè¢«æ ‡è®°äº†Eã€Sã€Oå’ŒHï¼Œè¯´æ˜æ¯ä¸ªRegionåœ¨è¿è¡Œæ—¶éƒ½å……å½“äº†ä¸€ç§è§’è‰²ï¼Œå…¶ä¸­Hæ˜¯ä»¥å¾€ç®—æ³•ä¸­æ²¡æœ‰çš„ï¼Œå®ƒä»£è¡¨Humongousï¼ˆå·¨å¤§çš„ï¼‰ï¼Œè¿™è¡¨ç¤ºè¿™äº›Regionå­˜å‚¨çš„æ˜¯å·¨å‹å¯¹è±¡ï¼ˆhumongous objectï¼ŒH-objï¼‰ï¼Œå½“æ–°å»ºå¯¹è±¡å¤§å°è¶…è¿‡Regionå¤§å°ä¸€åŠæ—¶ï¼Œç›´æ¥åœ¨æ–°çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­Regionä¸­åˆ†é…ï¼Œå¹¶æ ‡è®°ä¸ºHã€‚</span></p><p>&nbsp;</p><p><strong><span>Region</span></strong></p><p><span>å †å†…å­˜ä¸­ä¸€ä¸ªRegionçš„å¤§å°å¯ä»¥é€šè¿‡ </span><code>-XX:G1HeapRegionSize</code><span>å‚æ•°æŒ‡å®šï¼Œå¤§å°åŒºé—´åªèƒ½æ˜¯1Mã€2Mã€4Mã€8Mã€16Må’Œ32Mï¼Œæ€»ä¹‹æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚å¦‚æœG1HeapRegionSizeä¸ºé»˜è®¤å€¼ï¼Œåˆ™åœ¨å †åˆå§‹åŒ–æ—¶è®¡ç®—Regionçš„å®é™…å¤§å°ï¼Œé»˜è®¤æŠŠå †å†…å­˜æŒ‰ç…§2048ä»½å‡åˆ†ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªåˆç†çš„å¤§å°ã€‚</span></p><p>&nbsp;</p><p><strong><span>GCæ¨¡å¼</span></strong></p><ul><li><p><strong><span>young gc</span></strong></p><p><span>å‘ç”Ÿåœ¨å¹´è½»ä»£çš„GCç®—æ³•ï¼Œä¸€èˆ¬å¯¹è±¡ï¼ˆé™¤äº†å·¨å‹å¯¹è±¡ï¼‰éƒ½æ˜¯åœ¨eden regionä¸­åˆ†é…å†…å­˜ï¼Œå½“æ‰€æœ‰eden regionè¢«è€—å°½æ— æ³•ç”³è¯·å†…å­˜æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡young gcï¼Œè¿™ç§è§¦å‘æœºåˆ¶å’Œä¹‹å‰çš„young gcå·®ä¸å¤šï¼Œæ‰§è¡Œå®Œä¸€æ¬¡young gcï¼Œæ´»è·ƒå¯¹è±¡ä¼šè¢«æ‹·è´åˆ°survivor regionæˆ–è€…æ™‹å‡åˆ°old regionä¸­ï¼Œç©ºé—²çš„regionä¼šè¢«æ”¾å…¥ç©ºé—²åˆ—è¡¨ä¸­ï¼Œç­‰å¾…ä¸‹æ¬¡è¢«ä½¿ç”¨ã€‚</span></p><ul><li><code>-XX:MaxGCPauseMillis</code><span>ï¼šè®¾ç½®G1æ”¶é›†è¿‡ç¨‹ç›®æ ‡æ—¶é—´ï¼Œé»˜è®¤å€¼</span><code>200ms</code></li><li><code>-XX:G1NewSizePercent</code><span>ï¼šæ–°ç”Ÿä»£æœ€å°å€¼ï¼Œé»˜è®¤å€¼</span><code>5%</code></li><li><code>-XX:G1MaxNewSizePercent</code><span>ï¼šæ–°ç”Ÿä»£æœ€å¤§å€¼ï¼Œé»˜è®¤å€¼</span><code>60%</code></li></ul></li><li><p><strong><span>mixed gc</span></strong></p><p><span>å½“è¶Šæ¥è¶Šå¤šçš„å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£old regionæ—¶ï¼Œä¸ºäº†é¿å…å †å†…å­˜è¢«è€—å°½ï¼Œè™šæ‹Ÿæœºä¼šè§¦å‘ä¸€ä¸ªæ··åˆçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå³mixed gcï¼Œè¯¥ç®—æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªold gcï¼Œé™¤äº†å›æ”¶æ•´ä¸ªyoung regionï¼Œè¿˜ä¼šå›æ”¶ä¸€éƒ¨åˆ†çš„old regionï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼š</span><strong><span>æ˜¯ä¸€éƒ¨åˆ†è€å¹´ä»£ï¼Œè€Œä¸æ˜¯å…¨éƒ¨è€å¹´ä»£</span></strong><span>ï¼Œå¯ä»¥é€‰æ‹©å“ªäº›old regionè¿›è¡Œæ”¶é›†ï¼Œä»è€Œå¯ä»¥å¯¹åƒåœ¾å›æ”¶çš„è€—æ—¶æ—¶é—´è¿›è¡Œæ§åˆ¶</span></p></li><li><p><strong><span>full gc</span></strong></p><ul><li><span>å¦‚æœå¯¹è±¡å†…å­˜åˆ†é…é€Ÿåº¦è¿‡å¿«ï¼Œmixed gcæ¥ä¸åŠå›æ”¶ï¼Œå¯¼è‡´è€å¹´ä»£è¢«å¡«æ»¡ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡full gcï¼ŒG1çš„full gcç®—æ³•å°±æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„serial old gcï¼Œä¼šå¯¼è‡´å¼‚å¸¸é•¿æ—¶é—´çš„æš‚åœæ—¶é—´ï¼Œéœ€è¦è¿›è¡Œä¸æ–­çš„è°ƒä¼˜ï¼Œå°½å¯èƒ½çš„é¿å…full gc</span></li></ul></li></ul><p>&nbsp;</p><p><strong><span>G1åƒåœ¾å›æ”¶å™¨</span></strong><span> åº”ç”¨äºå¤§çš„å †å†…å­˜ç©ºé—´ã€‚å®ƒå°†å †å†…å­˜ç©ºé—´åˆ’åˆ†ä¸ºä¸åŒçš„åŒºåŸŸï¼Œå¯¹å„ä¸ªåŒºåŸŸå¹¶è¡Œåœ°åšå›æ”¶å·¥ä½œã€‚G1åœ¨å›æ”¶å†…å­˜ç©ºé—´åè¿˜ç«‹å³å¯¹ç©ºé—²ç©ºé—´åšæ•´åˆå·¥ä½œä»¥å‡å°‘ç¢ç‰‡ã€‚CMSå´æ˜¯åœ¨å…¨éƒ¨åœæ­¢(stop the world,STW)æ—¶æ‰§è¡Œå†…å­˜æ•´åˆå·¥ä½œã€‚å¯¹äºä¸åŒçš„åŒºåŸŸG1æ ¹æ®åƒåœ¾çš„æ•°é‡å†³å®šä¼˜å…ˆçº§ã€‚ä½¿ç”¨ </span><code>-XX:UseG1GCJVM</code><span> å‚æ•°æ¥å¼€å¯ä½¿ç”¨G1åƒåœ¾å›æ”¶å™¨ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250806.jpg" referrerpolicy="no-referrer" alt="G1æ”¶é›†å™¨"></p><p><strong><span>ä¸»è¦æµç¨‹å¦‚ä¸‹</span></strong><span>ï¼š</span></p><ul><li><span>åˆå§‹æ ‡è®°(Initial Marking)ï¼šæ ‡è®°ä»GC Rootå¯è¾¾çš„å¯¹è±¡ã€‚ä¼šå‘ç”ŸSTW</span></li><li><span>å¹¶å‘æ ‡è®°(Concurrenr Marking)ï¼šæ ‡è®°å‡ºGC Rootå¯è¾¾å¯¹è±¡è¡ç”Ÿå‡ºå»çš„å­˜æ´»å¯¹è±¡ï¼Œå¹¶æ”¶é›†å„ä¸ªRegionçš„å­˜æ´»å¯¹è±¡ä¿¡æ¯ã€‚æ•´ä¸ªè¿‡ç¨‹gc collectorçº¿ç¨‹ä¸åº”ç”¨çº¿ç¨‹å¯ä»¥å¹¶è¡Œæ‰§è¡Œ</span></li><li><strong><span>æœ€ç»ˆæ ‡è®°(Final Marking)</span></strong><span>ï¼šæ ‡è®°å‡ºåœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­é—æ¼çš„ï¼Œæˆ–å†…éƒ¨å¼•ç”¨å‘ç”Ÿå˜åŒ–çš„å¯¹è±¡ã€‚ä¼šå‘ç”ŸSTW</span></li><li><span>ç­›é€‰å›æ”¶(Live Data Counting And Evacution)ï¼šåƒåœ¾æ¸…é™¤è¿‡ç¨‹ï¼Œå¦‚æœå‘ç°ä¸€ä¸ªRegionä¸­æ²¡æœ‰å­˜æ´»å¯¹è±¡ï¼Œåˆ™æŠŠè¯¥RegionåŠ å…¥åˆ°ç©ºé—²åˆ—è¡¨ä¸­</span></li></ul><p>&nbsp;</p><p><span> </span><code>-XX:InitiatingHeapOccupancyPercent</code><span>ï¼šå½“è€å¹´ä»£å¤§å°å æ•´ä¸ªå †å¤§å°ç™¾åˆ†æ¯”è¾¾åˆ°è¯¥é˜ˆå€¼æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡mixed gcã€‚</span></p><p>&nbsp;</p><p><strong><span>ä¼˜ç‚¹</span></strong><span>ï¼š</span></p><ul><li><span>å¹¶è¡Œä¸å¹¶å‘ï¼Œå……åˆ†å‘æŒ¥å¤šæ ¸ä¼˜åŠ¿</span></li><li><span>åˆ†ä»£æ”¶é›†ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¸å…¶å®ƒæ”¶é›†å™¨é…åˆå³å¯å·¥ä½œ</span></li><li><span>ç©ºé—´æ•´åˆï¼Œæ•´ä½“æ¥çœ‹åŸºäºâ€æ ‡è®°-æ•´ç†ç®—æ³•â€œï¼Œå±€éƒ¨é‡‡ç”¨â€å¤åˆ¶ç®—æ³•â€œéƒ½ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</span></li><li><span>å¯ä»¥æŒ‡å®šGCæœ€å¤§åœé¡¿æ—¶é•¿</span></li></ul><p><strong><span>ç¼ºç‚¹</span></strong><span>ï¼š</span></p><ul><li><span>éœ€è¦è®°å¿†é›†æ¥è®°å½•æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¹‹é—´çš„å¼•ç”¨å…³ç³»</span></li><li><span>éœ€è¦å ç”¨å¤§é‡çš„å†…å­˜ï¼Œå¯èƒ½è¾¾åˆ°æ•´ä¸ªå †å†…å­˜å®¹é‡çš„20%ç”šè‡³æ›´å¤š</span></li></ul><p>&nbsp;</p><p><strong><span>ä½œç”¨å†…å­˜åŒºåŸŸ</span></strong><span>ï¼šè·¨ä»£</span></p><p><strong><span>é€‚ç”¨åœºæ™¯</span></strong><span>ï¼šä½œä¸ºå…³æ³¨åœé¡¿æ—¶é—´çš„åœºæ™¯çš„æ”¶é›†å™¨å¤‡é€‰æ–¹æ¡ˆ</span></p><p><strong><span>ç®—æ³•ç±»å‹</span></strong><span>ï¼šæ•´ä½“æ¥çœ‹åŸºäºâ€æ ‡è®°-æ•´ç†ç®—æ³•â€œï¼Œå±€éƒ¨é‡‡ç”¨&quot;å¤åˆ¶ç®—æ³•&quot;</span></p><p>&nbsp;</p><h4 id='zgcæ”¶é›†å™¨'><span>ZGCæ”¶é›†å™¨</span></h4><p><span>Z Garbage Collectorï¼Œç®€ç§° ZGCï¼Œæ˜¯ JDK 11 ä¸­æ–°åŠ å…¥çš„å°šåœ¨å®éªŒé˜¶æ®µçš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ã€‚å®ƒå’Œ Shenandoah åŒå±äºè¶…ä½å»¶è¿Ÿçš„åƒåœ¾æ”¶é›†å™¨ï¼Œä½†åœ¨ååé‡ä¸Šæ¯” Shenandoah æœ‰æ›´ä¼˜ç§€çš„è¡¨ç°ï¼Œç”šè‡³è¶…è¿‡äº† G1ï¼Œæ¥è¿‘äº†â€œååé‡ä¼˜å…ˆâ€çš„ Parallel æ”¶é›†å™¨ç»„åˆï¼Œå¯ä»¥è¯´è¿‘ä¹å®ç°äº†â€œé±¼ä¸ç†ŠæŒå…¼å¾—â€ã€‚</span></p><p><span>ä¸CMSä¸­çš„ParNewå’ŒG1ç±»ä¼¼ï¼ŒZGCä¹Ÿé‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œä¸è¿‡ZGCå¯¹è¯¥ç®—æ³•åšäº†é‡å¤§æ”¹è¿›ï¼šZGCåœ¨æ ‡è®°ã€è½¬ç§»å’Œé‡å®šä½é˜¶æ®µå‡ ä¹éƒ½æ˜¯å¹¶å‘çš„ï¼Œè¿™æ˜¯ZGCå®ç°åœé¡¿æ—¶é—´å°äº10msç›®æ ‡çš„æœ€å…³é”®åŸå› ã€‚ZGCåƒåœ¾å›æ”¶å‘¨æœŸå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250749.jpg" referrerpolicy="no-referrer" alt="ZGCæ”¶é›†å™¨"></p><p><span>ZGCåªæœ‰ä¸‰ä¸ªSTWé˜¶æ®µï¼š</span><strong><span>åˆå§‹æ ‡è®°</span></strong><span>ï¼Œ</span><strong><span>å†æ ‡è®°</span></strong><span>ï¼Œ</span><strong><span>åˆå§‹è½¬ç§»</span></strong><span>ã€‚å…¶ä¸­ï¼Œåˆå§‹æ ‡è®°å’Œåˆå§‹è½¬ç§»åˆ†åˆ«éƒ½åªéœ€è¦æ‰«ææ‰€æœ‰GC Rootsï¼Œå…¶å¤„ç†æ—¶é—´å’ŒGC Rootsçš„æ•°é‡æˆæ­£æ¯”ï¼Œä¸€èˆ¬æƒ…å†µè€—æ—¶éå¸¸çŸ­ï¼›å†æ ‡è®°é˜¶æ®µSTWæ—¶é—´å¾ˆçŸ­ï¼Œæœ€å¤š1msï¼Œè¶…è¿‡1msåˆ™å†æ¬¡è¿›å…¥å¹¶å‘æ ‡è®°é˜¶æ®µã€‚å³ï¼ŒZGCå‡ ä¹æ‰€æœ‰æš‚åœéƒ½åªä¾èµ–äºGC Rootsé›†åˆå¤§å°ï¼Œåœé¡¿æ—¶é—´ä¸ä¼šéšç€å †çš„å¤§å°æˆ–è€…æ´»è·ƒå¯¹è±¡çš„å¤§å°è€Œå¢åŠ ã€‚ä¸ZGCå¯¹æ¯”ï¼ŒG1çš„è½¬ç§»é˜¶æ®µå®Œå…¨STWçš„ï¼Œä¸”åœé¡¿æ—¶é—´éšå­˜æ´»å¯¹è±¡çš„å¤§å°å¢åŠ è€Œå¢åŠ ã€‚</span></p><p>&nbsp;</p><p><strong><span>ZGC çš„å†…å­˜å¸ƒå±€</span></strong></p><p><span>ä¸ Shenandoah å’Œ G1 ä¸€æ ·ï¼ŒZGC ä¹Ÿé‡‡ç”¨åŸºäº Region çš„å †å†…å­˜å¸ƒå±€ï¼Œä½†ä¸å®ƒä»¬ä¸åŒçš„æ˜¯ï¼Œ ZGC çš„ Region å…·æœ‰åŠ¨æ€æ€§ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åŠ¨æ€åˆ›å»ºå’Œé”€æ¯ï¼Œå®¹é‡å¤§å°ä¹Ÿæ˜¯åŠ¨æ€çš„ï¼Œæœ‰å¤§ã€ä¸­ã€å°ä¸‰ç±»å®¹é‡:</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250751.jpg" referrerpolicy="no-referrer" alt="ZGCå†…å­˜å¸ƒå±€"></p><ul><li><span>å°å‹ Region (Small Region)ï¼šå®¹é‡å›ºå®šä¸º 2MBï¼Œç”¨äºæ”¾ç½®å°äº 256KB çš„å°å¯¹è±¡</span></li><li><span>ä¸­å‹ Region (M edium Region)ï¼šå®¹é‡å›ºå®šä¸º 32MBï¼Œç”¨äºæ”¾ç½®å¤§äºç­‰äº 256KB ä½†å°äº 4MB çš„å¯¹è±¡</span></li><li><span>å¤§å‹ Region (Large Region)ï¼šå®¹é‡ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œä½†å¿…é¡»ä¸º 2MB çš„æ•´æ•°å€ï¼Œç”¨äºæ”¾ç½® 4MB æˆ–ä»¥ä¸Šçš„å¤§å¯¹è±¡ã€‚æ¯ä¸ªå¤§å‹ Region ä¸­åªä¼šå­˜æ”¾ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œè¿™ä¹Ÿé¢„ç¤ºç€è™½ç„¶åå­—å«ä½œâ€œå¤§å‹ Regionâ€ï¼Œä½†å®ƒçš„å®é™…å®¹é‡å®Œå…¨æœ‰å¯èƒ½å°äºä¸­å‹ Regionï¼Œæœ€å°å®¹é‡å¯ä½è‡³ 4MB</span></li></ul><p><span>åœ¨ JDK 11 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°å¼€å¯ ZGCï¼š</span><code>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC</code><span> ã€‚</span></p><p>&nbsp;</p><h4 id='shenandoahæ”¶é›†å™¨'><span>Shenandoahæ”¶é›†å™¨</span></h4><p><span>Shenandoah ä¸ G1 æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œæ¯”å¦‚éƒ½æ˜¯åŸºäº Region çš„å†…å­˜å¸ƒå±€ï¼Œéƒ½æœ‰ç”¨äºå­˜æ”¾å¤§å¯¹è±¡çš„ Humongous Regionï¼Œé»˜è®¤å›æ”¶ç­–ç•¥ä¹Ÿæ˜¯ä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æœ€å¤§çš„ Regionã€‚ä¸è¿‡ä¹Ÿæœ‰ä¸‰ä¸ªé‡å¤§çš„åŒºåˆ«ï¼š</span></p><ul><li><span>Shenandoahæ”¯æŒå¹¶å‘çš„æ•´ç†ç®—æ³•ï¼ŒG1æ•´ç†é˜¶æ®µè™½æ˜¯å¤šçº¿ç¨‹å¹¶è¡Œï¼Œä½†æ— æ³•ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œ</span></li><li><span>é»˜è®¤ä¸ä½¿ç”¨åˆ†ä»£æ”¶é›†ç†è®º</span></li><li><span>ä½¿ç”¨è¿æ¥çŸ©é˜µ (Connection Matrix)è®°å½•è·¨Regionçš„å¼•ç”¨å…³ç³»ï¼Œæ›¿æ¢æ‰äº†G1ä¸­çš„è®°å¿†çº§(Remembered Set)ï¼Œå†…å­˜å’Œè®¡ç®—æˆæœ¬æ›´ä½</span></li></ul><p><span>Shenandoah æ”¶é›†å™¨çš„å·¥ä½œåŸç†ç›¸æ¯” G1 è¦å¤æ‚ä¸å°‘ï¼Œå…¶è¿è¡Œæµç¨‹ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250756.jpg" referrerpolicy="no-referrer" alt="Shenandoahæ”¶é›†å™¨è¿è¡Œæµç¨‹"></p><p><span>å¯è§Shenandoahçš„å¹¶å‘ç¨‹åº¦æ˜æ˜¾æ¯”G1æ›´é«˜ï¼Œåªéœ€è¦åœ¨åˆå§‹æ ‡è®°ã€æœ€ç»ˆæ ‡è®°ã€åˆå§‹å¼•ç”¨æ›´æ–°å’Œæœ€ç»ˆå¼•ç”¨æ›´æ–°è¿™å‡ ä¸ªé˜¶æ®µè¿›è¡ŒçŸ­æš‚çš„â€œStop The Worldâ€ï¼Œå…¶ä»–é˜¶æ®µçš†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œå…¶ä¸­æœ€é‡è¦çš„å¹¶å‘æ ‡è®°ã€å¹¶å‘å›æ”¶å’Œå¹¶å‘å¼•ç”¨æ›´æ–°è¯¦æƒ…å¦‚ä¸‹ï¼š</span></p><ul><li><strong><span>å¹¶å‘æ ‡è®°( Concurrent Marking)</span></strong></li><li><strong><span>å¹¶å‘å›æ”¶( Concurrent Evacuation)</span></strong></li><li><strong><span>å¹¶å‘å¼•ç”¨æ›´æ–°( Concurrent Update Reference)</span></strong></li></ul><p><span>Shenandoah çš„é«˜å¹¶å‘åº¦è®©å®ƒå®ç°äº†è¶…ä½çš„åœé¡¿æ—¶é—´ï¼Œä½†æ˜¯æ›´é«˜çš„å¤æ‚åº¦ä¹Ÿä¼´éšç€æ›´é«˜çš„ç³»ç»Ÿå¼€é”€ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“ååé‡ï¼Œä¸‹å›¾æ˜¯ Shenandoah ä¸ä¹‹å‰å„ç§æ”¶é›†å™¨åœ¨åœé¡¿æ—¶é—´ç»´åº¦å’Œç³»ç»Ÿå¼€é”€ç»´åº¦ä¸Šçš„å¯¹æ¯”ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250757.png" referrerpolicy="no-referrer" alt="æ”¶é›†å™¨åœé¡¿æ—¶é—´å’Œç³»ç»Ÿå¼€é”€å¯¹æ¯”"></p><p><span>OracleJDK å¹¶ä¸æ”¯æŒ Shenandoahï¼Œå¦‚æœä½ ç”¨çš„æ˜¯ OpenJDK 12 æˆ–æŸäº›æ”¯æŒ Shenandoah ç§»æ¤ç‰ˆçš„ JDK çš„è¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°å¼€å¯ Shenandoahï¼š</span><code>-XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC</code><span> ã€‚</span></p><p>&nbsp;</p><h2 id='gcæ—¥å¿—'><span>GCæ—¥å¿—</span></h2><h3 id='æ—¥å¿—æ ¼å¼'><span>æ—¥å¿—æ ¼å¼</span></h3><p><strong><span>ParallelGC YoungGCæ—¥å¿—</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250757.jpg" referrerpolicy="no-referrer" alt="ParallelGCYoungGCæ—¥å¿—"></p><p><strong><span>ParallelGC FullGCæ—¥å¿—</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250766.jpg" referrerpolicy="no-referrer" alt="ParallelGCFullGCæ—¥å¿—"></p><p>&nbsp;</p><h3 id='æœ€ä½³å®è·µ'><span>æœ€ä½³å®è·µ</span></h3><p><span>åœ¨ä¸åŒçš„ JVM çš„ä¸åƒåœ¾å›æ”¶å™¨ä¸Šï¼Œçœ‹å‚æ•°é»˜è®¤æ˜¯ä»€ä¹ˆï¼Œä¸è¦è½»ä¿¡åˆ«äººçš„å»ºè®®ï¼Œå‘½ä»¤è¡Œç¤ºä¾‹å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">java <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintFlagsFinal <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseG1GC &nbsp;<span class="cm-number">2</span>&gt;&amp;1 | <span class="cm-builtin">grep</span> UseAdaptiveSizePolicy</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre><p><span>PrintCommandLineFlagsï¼šé€šè¿‡å®ƒï¼Œä½ èƒ½å¤ŸæŸ¥çœ‹å½“å‰æ‰€ä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨å’Œä¸€äº›é»˜è®¤çš„å€¼ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># java -XX:+PrintCommandLineFlags -version</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:InitialHeapSize</span><span class="cm-operator">=</span><span class="cm-number">127905216</span> <span class="cm-attribute">-XX</span><span class="cm-def">:MaxHeapSize</span><span class="cm-operator">=</span><span class="cm-number">2046483456</span> <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintCommandLineFlags <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCompressedClassPointers <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCompressedOops <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseParallelGC</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">openjdk version <span class="cm-string">"1.8.0_41"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">OpenJDK Runtime Environment (build <span class="cm-number">1</span>.8.0_41-b04)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">OpenJDK <span class="cm-number">64</span><span class="cm-attribute">-Bit</span> Server VM (build <span class="cm-number">25</span>.40-b25, mixed mode)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 151px;"></div><div class="CodeMirror-gutters" style="display: none; height: 151px;"></div></div></div></pre><p>&nbsp;</p><p><span>G1åƒåœ¾æ”¶é›†å™¨JVMå‚æ•°æœ€ä½³å®è·µï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>â€‹</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 1.åŸºæœ¬å‚æ•°</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-server</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># æœåŠ¡å™¨æ¨¡å¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-Xmx12g</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># åˆå§‹å †å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-Xms12g</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># æœ€å¤§å †å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-Xss256k</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># æ¯ä¸ªçº¿ç¨‹çš„æ ˆå†…å­˜å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseG1GC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># ä½¿ç”¨ G1 (Garbage First) åƒåœ¾æ”¶é›†å™¨ &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:MetaspaceSize</span><span class="cm-operator">=</span>256m &nbsp; <span class="cm-comment"># å…ƒç©ºé—´åˆå§‹å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:MaxMetaspaceSize</span><span class="cm-operator">=</span>1g &nbsp;<span class="cm-comment"># å…ƒç©ºé—´æœ€å¤§å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:MaxGCPauseMillis</span><span class="cm-operator">=</span><span class="cm-number">200</span> <span class="cm-comment"># æ¯æ¬¡YGC / MixedGC çš„æœ€å¤šåœé¡¿æ—¶é—´ (æœŸæœ›æœ€é•¿åœé¡¿æ—¶é—´)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 2.å¿…å¤‡å‚æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDetails &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># è¾“å‡ºè¯¦ç»†GCæ—¥å¿—</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDateStamps &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚ 2013-05-04T21:53:59.234+0800ï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintTenuringDistribution <span class="cm-comment"># æ‰“å°å¯¹è±¡åˆ†å¸ƒï¼šä¸ºäº†åˆ†æGCæ—¶çš„æ™‹å‡æƒ…å†µå’Œæ™‹å‡å¯¼è‡´çš„é«˜æš‚åœï¼Œçœ‹å¯¹è±¡å¹´é¾„åˆ†å¸ƒæ—¥å¿—</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintHeapAtGC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># åœ¨è¿›è¡ŒGCçš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintReferenceGC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># æ‰“å°Referenceå¤„ç†ä¿¡æ¯:å¼ºå¼•ç”¨/å¼±å¼•ç”¨/è½¯å¼•ç”¨/è™šå¼•ç”¨/finalizeæ–¹æ³•ä¸‡ä¸€æœ‰é—®é¢˜</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCApplicationStoppedTime <span class="cm-comment"># æ‰“å°STWæ—¶é—´</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCApplicationConCurrentTime <span class="cm-comment"># æ‰“å°GCé—´éš”çš„æœåŠ¡è¿è¡Œæ—¶é•¿</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 3.æ—¥å¿—åˆ†å‰²å‚æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseGCLogFileRotation &nbsp; <span class="cm-comment"># å¼€å¯æ—¥å¿—æ–‡ä»¶åˆ†å‰²</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:NumberOfGCLogFiles</span><span class="cm-operator">=</span><span class="cm-number">14</span> &nbsp; <span class="cm-comment"># æœ€å¤šåˆ†å‰²å‡ ä¸ªæ–‡ä»¶ï¼Œè¶…è¿‡ä¹‹åä»å¤´æ–‡ä»¶å¼€å§‹å†™</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:GCLogFileSize</span><span class="cm-operator">=</span>32M &nbsp; &nbsp; &nbsp; <span class="cm-comment"># æ¯ä¸ªæ–‡ä»¶ä¸Šé™å¤§å°ï¼Œè¶…è¿‡å°±è§¦å‘åˆ†å‰²</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-Xloggc</span>:/path/to/gc-%t.log &nbsp;<span class="cm-comment"># GCæ—¥å¿—è¾“å‡ºçš„æ–‡ä»¶è·¯å¾„,ä½¿ç”¨%tä½œä¸ºæ—¥å¿—æ–‡ä»¶å,å³gc-2021-03-29_20-41-47.log</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 626px;"></div><div class="CodeMirror-gutters" style="display: none; height: 626px;"></div></div></div></pre><p><span>CMSåƒåœ¾æ”¶é›†å™¨JVMå‚æ•°æœ€ä½³å®è·µï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 1.åŸºæœ¬å‚æ•°</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-server</span> &nbsp; <span class="cm-comment"># æœåŠ¡å™¨æ¨¡å¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-Xmx4g</span> &nbsp; &nbsp;<span class="cm-comment"># JVMæœ€å¤§å…è®¸åˆ†é…çš„å †å†…å­˜ï¼ŒæŒ‰éœ€åˆ†é…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-Xms4g</span> &nbsp; &nbsp;<span class="cm-comment"># JVMåˆå§‹åˆ†é…çš„å †å†…å­˜ï¼Œä¸€èˆ¬å’ŒXmxé…ç½®æˆä¸€æ ·ä»¥é¿å…æ¯æ¬¡gcåJVMé‡æ–°åˆ†é…å†…å­˜</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-Xmn256m</span> &nbsp;<span class="cm-comment"># å¹´è½»ä»£å†…å­˜å¤§å°ï¼Œæ•´ä¸ªJVMå†…å­˜=å¹´è½»ä»£ + å¹´è€ä»£ + æŒä¹…ä»£</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-Xss512k</span> &nbsp;<span class="cm-comment"># è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>DisableExplicitGC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># å¿½ç•¥æ‰‹åŠ¨è°ƒç”¨GC, System.gc()çš„è°ƒç”¨å°±ä¼šå˜æˆä¸€ä¸ªç©ºè°ƒç”¨ï¼Œå®Œå…¨ä¸è§¦å‘GC</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseConcMarkSweepGC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># ä½¿ç”¨ CMS åƒåœ¾æ”¶é›†å™¨</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSParallelRemarkEnabled &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># é™ä½æ ‡è®°åœé¡¿</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCMSCompactAtFullCollection &nbsp; &nbsp;<span class="cm-comment"># åœ¨FULL GCçš„æ—¶å€™å¯¹å¹´è€ä»£çš„å‹ç¼©</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseFastAccessorMethods &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># åŸå§‹ç±»å‹çš„å¿«é€Ÿä¼˜åŒ–</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCMSInitiatingOccupancyOnly &nbsp; &nbsp;<span class="cm-comment"># ä½¿ç”¨æ‰‹åŠ¨å®šä¹‰åˆå§‹åŒ–å®šä¹‰å¼€å§‹CMSæ”¶é›†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:LargePageSizeInBytes</span><span class="cm-operator">=</span>128m &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># å†…å­˜é¡µçš„å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:CMSInitiatingOccupancyFraction</span><span class="cm-operator">=</span><span class="cm-number">70</span> <span class="cm-comment"># ä½¿ç”¨cmsä½œä¸ºåƒåœ¾å›æ”¶ä½¿ç”¨70ï¼…åå¼€å§‹CMSæ”¶é›†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 2.å¿…å¤‡å‚æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDetails &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># è¾“å‡ºè¯¦ç»†GCæ—¥å¿—</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDateStamps &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚ 2013-05-04T21:53:59.234+0800ï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintTenuringDistribution &nbsp; &nbsp; <span class="cm-comment"># æ‰“å°å¯¹è±¡åˆ†å¸ƒï¼šä¸ºåˆ†æGCæ—¶çš„æ™‹å‡æƒ…å†µå’Œæ™‹å‡å¯¼è‡´çš„é«˜æš‚åœï¼Œçœ‹å¯¹è±¡å¹´é¾„åˆ†å¸ƒ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintHeapAtGC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># åœ¨è¿›è¡ŒGCçš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintReferenceGC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># æ‰“å°Referenceå¤„ç†ä¿¡æ¯:å¼ºå¼•ç”¨/å¼±å¼•ç”¨/è½¯å¼•ç”¨/è™šå¼•ç”¨/finalizeæ–¹æ³•ä¸‡ä¸€æœ‰é—®é¢˜</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCApplicationStoppedTime <span class="cm-comment"># æ‰“å°STWæ—¶é—´</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCApplicationConCurrentTime <span class="cm-comment"># æ‰“å°GCé—´éš”çš„æœåŠ¡è¿è¡Œæ—¶é•¿</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 3.æ—¥å¿—åˆ†å‰²å‚æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseGCLogFileRotation &nbsp; <span class="cm-comment"># å¼€å¯æ—¥å¿—æ–‡ä»¶åˆ†å‰²</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:NumberOfGCLogFiles</span><span class="cm-operator">=</span><span class="cm-number">14</span> &nbsp; <span class="cm-comment"># æœ€å¤šåˆ†å‰²å‡ ä¸ªæ–‡ä»¶ï¼Œè¶…è¿‡ä¹‹åä»å¤´æ–‡ä»¶å¼€å§‹å†™</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span><span class="cm-def">:GCLogFileSize</span><span class="cm-operator">=</span>32M &nbsp; &nbsp; &nbsp; <span class="cm-comment"># æ¯ä¸ªæ–‡ä»¶ä¸Šé™å¤§å°ï¼Œè¶…è¿‡å°±è§¦å‘åˆ†å‰²</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-Xloggc</span>:/path/to/gc-%t.log &nbsp;<span class="cm-comment"># GCæ—¥å¿—è¾“å‡ºçš„æ–‡ä»¶è·¯å¾„,ä½¿ç”¨%tä½œä¸ºæ—¥å¿—æ–‡ä»¶å,å³gc-2021-03-29_20-41-47.log</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 799px;"></div><div class="CodeMirror-gutters" style="display: none; height: 799px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>testã€stage ç¯å¢ƒjvmä½¿ç”¨CMS å‚æ•°é…ç½®ï¼ˆjdk8ï¼‰</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-server</span> <span class="cm-attribute">-Xms256M</span> <span class="cm-attribute">-Xmx256M</span> <span class="cm-attribute">-Xss512k</span> <span class="cm-attribute">-Xmn96M</span> <span class="cm-attribute">-XX</span><span class="cm-def">:MetaspaceSize</span><span class="cm-operator">=</span>128M <span class="cm-attribute">-XX</span><span class="cm-def">:MaxMetaspaceSize</span><span class="cm-operator">=</span>128M <span class="cm-attribute">-XX</span><span class="cm-def">:InitialHeapSize</span><span class="cm-operator">=</span>256M <span class="cm-attribute">-XX</span><span class="cm-def">:MaxHeapSize</span><span class="cm-operator">=</span>256M &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintCommandLineFlags <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseConcMarkSweepGC <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCMSInitiatingOccupancyOnly <span class="cm-attribute">-XX</span><span class="cm-def">:CMSInitiatingOccupancyFraction</span><span class="cm-operator">=</span><span class="cm-number">80</span> <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSClassUnloadingEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSParallelRemarkEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSScavengeBeforeRemark <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCMSCompactAtFullCollection <span class="cm-attribute">-XX</span><span class="cm-def">:CMSFullGCsBeforeCompaction</span><span class="cm-operator">=</span><span class="cm-number">2</span> <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSParallelInitialMarkEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSParallelRemarkEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UnlockDiagnosticVMOptions <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>ParallelRefProcEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>AlwaysPreTouch <span class="cm-attribute">-XX</span><span class="cm-def">:MaxTenuringThreshold</span><span class="cm-operator">=</span><span class="cm-number">8</span> &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCompressedClassPointers <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCompressedOops <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGC <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCApplicationConcurrentTime <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCApplicationStoppedTime <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDateStamps <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDetails <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCTimeStamps <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintHeapAtGC &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintTenuringDistribution &nbsp;<span class="cm-attribute">-XX</span><span class="cm-def">:SurvivorRatio</span><span class="cm-operator">=</span><span class="cm-number">8</span> <span class="cm-attribute">-Xloggc</span>:../logs/gc.log <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>HeapDumpOnOutOfMemoryError <span class="cm-attribute">-XX</span><span class="cm-def">:HeapDumpPath</span><span class="cm-operator">=</span>../dump</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 367px;"></div><div class="CodeMirror-gutters" style="display: none; height: 367px;"></div></div></div></pre><p><strong><span>online ç¯å¢ƒjvmä½¿ç”¨CMSå‚æ•°é…ç½®ï¼ˆjdk8ï¼‰</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-server</span> <span class="cm-attribute">-Xms4G</span> <span class="cm-attribute">-Xmx4G</span> <span class="cm-attribute">-Xss512k</span> &nbsp;<span class="cm-attribute">-Xmn1536M</span> <span class="cm-attribute">-XX</span><span class="cm-def">:MetaspaceSize</span><span class="cm-operator">=</span>128M <span class="cm-attribute">-XX</span><span class="cm-def">:MaxMetaspaceSize</span><span class="cm-operator">=</span>128M <span class="cm-attribute">-XX</span><span class="cm-def">:InitialHeapSize</span><span class="cm-operator">=</span>4G <span class="cm-attribute">-XX</span><span class="cm-def">:MaxHeapSize</span><span class="cm-operator">=</span>4G &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintCommandLineFlags <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseConcMarkSweepGC <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCMSInitiatingOccupancyOnly <span class="cm-attribute">-XX</span><span class="cm-def">:CMSInitiatingOccupancyFraction</span><span class="cm-operator">=</span><span class="cm-number">80</span> <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSClassUnloadingEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSParallelRemarkEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSScavengeBeforeRemark <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCMSCompactAtFullCollection <span class="cm-attribute">-XX</span><span class="cm-def">:CMSFullGCsBeforeCompaction</span><span class="cm-operator">=</span><span class="cm-number">2</span> <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSParallelInitialMarkEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>CMSParallelRemarkEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UnlockDiagnosticVMOptions <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>ParallelRefProcEnabled <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>AlwaysPreTouch <span class="cm-attribute">-XX</span><span class="cm-def">:MaxTenuringThreshold</span><span class="cm-operator">=</span><span class="cm-number">10</span> &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCompressedClassPointers <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseCompressedOops <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGC <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCApplicationConcurrentTime <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCApplicationStoppedTime <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDateStamps <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDetails <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCTimeStamps <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintHeapAtGC &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintTenuringDistribution &nbsp;<span class="cm-attribute">-XX</span><span class="cm-def">:SurvivorRatio</span><span class="cm-operator">=</span><span class="cm-number">8</span> <span class="cm-attribute">-Xloggc</span>:../logs/gc.log <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>HeapDumpOnOutOfMemoryError <span class="cm-attribute">-XX</span><span class="cm-def">:HeapDumpPath</span><span class="cm-operator">=</span>../dump</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 367px;"></div><div class="CodeMirror-gutters" style="display: none; height: 367px;"></div></div></div></pre><p>&nbsp;</p><h2 id='gcåœºæ™¯'><span>GCåœºæ™¯</span></h2><h3 id='full-gcåœºæ™¯'><span>Full GCåœºæ™¯</span></h3><p><strong><span>åœºæ™¯ä¸€ï¼šSystem.gc()æ–¹æ³•çš„è°ƒç”¨</span></strong></p><p><span>æ­¤æ–¹æ³•çš„è°ƒç”¨æ˜¯å»ºè®®JVMè¿›è¡ŒFull GC,è™½ç„¶åªæ˜¯å»ºè®®è€Œéä¸€å®š,ä½†å¾ˆå¤šæƒ…å†µä¸‹å®ƒä¼šè§¦å‘ Full GC,ä»è€Œå¢åŠ Full GCçš„é¢‘ç‡,ä¹Ÿå³å¢åŠ äº†é—´æ­‡æ€§åœé¡¿çš„æ¬¡æ•°ã€‚å¼ºçƒˆå½±å“ç³»å»ºè®®èƒ½ä¸ä½¿ç”¨æ­¤æ–¹æ³•å°±åˆ«ä½¿ç”¨ï¼Œè®©è™šæ‹Ÿæœºè‡ªå·±å»ç®¡ç†å®ƒçš„å†…å­˜ï¼Œå¯é€šè¿‡é€šè¿‡ </span><code>-XX:+ DisableExplicitGC</code><span> æ¥ç¦æ­¢RMIè°ƒç”¨System.gc()ã€‚</span></p><p>&nbsp;</p><p><strong><span>åœºæ™¯äºŒï¼šè€å¹´ä»£ä»£ç©ºé—´ä¸è¶³</span></strong></p><ul><li><p><span>åŸå› åˆ†æï¼šæ–°ç”Ÿä»£å¯¹è±¡è½¬å…¥è€å¹´ä»£ã€åˆ›å»ºå¤§å¯¹è±¡æˆ–æ•°ç»„æ—¶ï¼Œæ‰§è¡ŒFullGCåä»ç©ºé—´ä¸è¶³</span></p></li><li><p><span>æŠ›å‡ºé”™è¯¯ï¼š</span><code>Java.lang.OutOfMemoryError: Java heap space</code></p></li><li><p><span>è§£å†³åŠæ³•ï¼š</span></p><ul><li><span>å°½é‡è®©å¯¹è±¡åœ¨YoungGCæ—¶è¢«å›æ”¶</span></li><li><span>è®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»ä¸€æ®µæ—¶é—´</span></li><li><span>ä¸è¦åˆ›å»ºè¿‡å¤§çš„å¯¹è±¡æˆ–æ•°ç»„</span></li></ul></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯ä¸‰ï¼šæ°¸ç”ŸåŒºç©ºé—´ä¸è¶³</span></strong></p><ul><li><p><span>åŸå› åˆ†æï¼šJVMæ–¹æ³•åŒºå› ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤šè€Œå¯èƒ½ä¼šè¢«å æ»¡</span></p></li><li><p><span>æŠ›å‡ºé”™è¯¯ï¼š</span><code>java.lang.OutOfMemoryError: PermGen space</code></p></li><li><p><span>è§£å†³åŠæ³•ï¼š</span></p><ul><li><span>å¢å¤§è€å¹´ä»£ç©ºé—´å¤§å°</span></li><li><span>ä½¿ç”¨CMS GC</span></li></ul></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯å››ï¼šCMS GCæ—¶å‡ºç°promotion failedå’Œconcurrent mode failure</span></strong></p><ul><li><p><span>åŸå› åˆ†æï¼š</span></p><ul><li><code>promotion failed</code><span>ï¼šæ˜¯åœ¨è¿›è¡ŒMinor GCæ—¶ï¼Œsurvivor spaceæ”¾ä¸ä¸‹ã€å¯¹è±¡åªèƒ½æ”¾å…¥è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹é€ æˆ</span></li><li><code>concurrent mode failure</code><span>ï¼šæ˜¯åœ¨æ‰§è¡ŒCMS GCçš„è¿‡ç¨‹ä¸­åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾å…¥è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸è¶³é€ æˆçš„</span></li></ul></li><li><p><span>æŠ›å‡ºé”™è¯¯ï¼šGCæ—¥å¿—ä¸­å­˜åœ¨</span><code>promotion failed</code><span>å’Œ</span><code>concurrent mode</code></p></li><li><p><span>è§£å†³åŠæ³•ï¼šå¢å¤§å¹¸å­˜åŒºæˆ–è€å¹´ä»£</span></p></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯äº”ï¼šå †ä¸­åˆ†é…å¾ˆå¤§çš„å¯¹è±¡</span></strong></p><ul><li><span>åŸå› åˆ†æï¼šåˆ›å»ºå¤§å¯¹è±¡æˆ–é•¿æ•°æ®æ—¶ï¼Œæ­¤å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œè€Œè€å¹´ä»£è™½æœ‰å¾ˆå¤§å‰©ä½™ç©ºé—´ï¼Œä½†æ²¡æœ‰è¶³å¤Ÿçš„è¿ç»­ç©ºé—´æ¥å­˜å‚¨</span></li><li><span>æŠ›å‡ºé”™è¯¯ï¼šè§¦å‘FullGC</span></li><li><span>è§£å†³åŠæ³•ï¼šé…ç½®-XX:+UseCMSCompactAtFullCollectionå¼€å…³å‚æ•°ï¼Œç”¨äºäº«å—ç”¨å®ŒFullGCåé¢å¤–å…è´¹èµ é€çš„ç¢ç‰‡æ•´ç†è¿‡ç¨‹ï¼Œä½†åŒæ—¶åœé¡¿æ—¶é—´ä¸å¾—ä¸å˜é•¿ã€‚å¯ä»¥ä½¿ç”¨-XX:CMSFullGCsBeforeCompactionå‚æ•°æ¥æŒ‡å®šæ‰§è¡Œå¤šå°‘æ¬¡ä¸å‹ç¼©çš„FullGCåæ‰æ‰§è¡Œä¸€æ¬¡å‹ç¼©</span></li></ul><p>&nbsp;</p><h3 id='cms-gcåœºæ™¯'><span>CMS GCåœºæ™¯</span></h3><p><strong><span>åœºæ™¯ä¸€ï¼šåŠ¨æ€æ‰©å®¹å¼•èµ·çš„ç©ºé—´éœ‡è¡</span></strong></p><ul><li><p><strong><span>ç°è±¡</span></strong></p><p><span>æœåŠ¡</span><strong><span>åˆšåˆšå¯åŠ¨æ—¶ GC æ¬¡æ•°è¾ƒå¤š</span></strong><span>ï¼Œæœ€å¤§ç©ºé—´å‰©ä½™å¾ˆå¤šä½†æ˜¯ä¾ç„¶å‘ç”Ÿ GCï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯Ÿ GC æ—¥å¿—æˆ–è€…é€šè¿‡ç›‘æ§å·¥å…·æ¥è§‚å¯Ÿå †çš„ç©ºé—´å˜åŒ–æƒ…å†µå³å¯ã€‚GC Cause ä¸€èˆ¬ä¸º Allocation Failureï¼Œä¸”åœ¨ GC æ—¥å¿—ä¸­ä¼šè§‚å¯Ÿåˆ°ç»å†ä¸€æ¬¡ GC ï¼Œå †å†…å„ä¸ªç©ºé—´çš„å¤§å°ä¼šè¢«è°ƒæ•´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250089.png" referrerpolicy="no-referrer" alt="åŠ¨æ€æ‰©å®¹å¼•èµ·çš„ç©ºé—´éœ‡è¡"></p></li><li><p><strong><span>åŸå› </span></strong></p><p><span>åœ¨ JVM çš„å‚æ•°ä¸­ </span><code>-Xms</code><span> å’Œ </span><code>-Xmx</code><span> è®¾ç½®çš„ä¸ä¸€è‡´ï¼Œåœ¨åˆå§‹åŒ–æ—¶åªä¼šåˆå§‹ </span><code>-Xms</code><span> å¤§å°çš„ç©ºé—´å­˜å‚¨ä¿¡æ¯ï¼Œæ¯å½“ç©ºé—´ä¸å¤Ÿç”¨æ—¶å†å‘æ“ä½œç³»ç»Ÿç”³è¯·ï¼Œè¿™æ ·çš„è¯å¿…ç„¶è¦è¿›è¡Œä¸€æ¬¡ GCã€‚å¦å¤–ï¼Œå¦‚æœç©ºé—´å‰©ä½™å¾ˆå¤šæ—¶ä¹Ÿä¼šè¿›è¡Œç¼©å®¹æ“ä½œï¼ŒJVM é€šè¿‡ </span><code>-XX:MinHeapFreeRatio</code><span> å’Œ </span><code>-XX:MaxHeapFreeRatio</code><span> æ¥æ§åˆ¶æ‰©å®¹å’Œç¼©å®¹çš„æ¯”ä¾‹ï¼Œè°ƒèŠ‚è¿™ä¸¤ä¸ªå€¼ä¹Ÿå¯ä»¥æ§åˆ¶ä¼¸ç¼©çš„æ—¶æœºã€‚æ•´ä¸ªä¼¸ç¼©çš„æ¨¡å‹ç†è§£å¯ä»¥çœ‹è¿™ä¸ªå›¾ï¼Œå½“ committed çš„ç©ºé—´å¤§å°è¶…è¿‡äº†ä½æ°´ä½/é«˜æ°´ä½çš„å¤§å°ï¼Œcapacity ä¹Ÿä¼šéšä¹‹è°ƒæ•´ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250120.png" referrerpolicy="no-referrer" alt="JVMå†…å­˜ä¼¸ç¼©æ¨¡å‹"></p></li><li><p><strong><span>ç­–ç•¥</span></strong><span> </span></p><p><span>è§‚å¯Ÿ CMS GC è§¦å‘æ—¶é—´ç‚¹ Old/MetaSpace åŒºçš„ committed å æ¯”æ˜¯ä¸æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œæˆ–è€…åƒä¸Šæ–‡æåˆ°çš„è§‚å¯Ÿæ€»çš„å†…å­˜ä½¿ç”¨ç‡ä¹Ÿå¯ä»¥ã€‚å°½é‡ </span><strong><span>å°†æˆå¯¹å‡ºç°çš„ç©ºé—´å¤§å°é…ç½®å‚æ•°è®¾ç½®æˆå›ºå®šçš„</span></strong><span> ï¼Œå¦‚ </span><code>-Xms</code><span> å’Œ </span><code>-Xmx</code><span>ï¼Œ</span><code>-XX:MaxNewSize</code><span> å’Œ </span><code>-XX:NewSize</code><span>ï¼Œ</span><code>-XX:MetaSpaceSize</code><span> å’Œ </span><code>-XX:MaxMetaSpaceSize</code><span> ç­‰ã€‚</span></p></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯äºŒï¼šæ˜¾å¼GCçš„å»ä¸ç•™</span></strong></p><ul><li><p><strong><span>ç°è±¡</span></strong></p><p><span>é™¤äº†æ‰©å®¹ç¼©å®¹ä¼šè§¦å‘ CMS GC ä¹‹å¤–ï¼Œè¿˜æœ‰ Old åŒºè¾¾åˆ°å›æ”¶é˜ˆå€¼ã€MetaSpace ç©ºé—´ä¸è¶³ã€Young åŒºæ™‹å‡å¤±è´¥ã€å¤§å¯¹è±¡æ‹…ä¿å¤±è´¥ç­‰å‡ ç§è§¦å‘æ¡ä»¶ï¼Œå¦‚æœè¿™äº›æƒ…å†µéƒ½æ²¡æœ‰å‘ç”Ÿå´è§¦å‘äº† GC ï¼Ÿè¿™ç§æƒ…å†µæœ‰å¯èƒ½æ˜¯ä»£ç ä¸­æ‰‹åŠ¨è°ƒç”¨äº† System.gc æ–¹æ³•ï¼Œæ­¤æ—¶å¯ä»¥æ‰¾åˆ° GC æ—¥å¿—ä¸­çš„ GC Cause ç¡®è®¤ä¸‹ã€‚</span></p></li><li><p><strong><span>åŸå› </span></strong></p><p><strong><span>ä¿ç•™ System.gc</span></strong><span>ï¼šCMSä¸­ä½¿ç”¨ Foreground Collector æ—¶å°†ä¼šå¸¦æ¥éå¸¸é•¿çš„ STWï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­ System.gc è¢«é¢‘ç¹è°ƒç”¨ï¼Œé‚£å°±éå¸¸å±é™©ã€‚å¢åŠ  </span><code>-XX:+DisableExplicitGC</code><span> å‚æ•°åˆ™å¯ä»¥ç¦ç”¨ã€‚</span><strong><span>å»æ‰ System.gc</span></strong><span>ï¼šç¦ç”¨æ‰åä¼šå¸¦æ¥å¦ä¸€ä¸ªå†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œä¸º DirectByteBuffer åˆ†é…ç©ºé—´è¿‡ç¨‹ä¸­ä¼šæ˜¾å¼è°ƒç”¨ System.gc ï¼Œå¸Œæœ›é€šè¿‡ Full GC æ¥å¼ºè¿«å·²ç»æ— ç”¨çš„ DirectByteBuffer å¯¹è±¡é‡Šæ”¾æ‰å®ƒä»¬å…³è”çš„ Native Memoryï¼Œå¦‚Nettyç­‰ã€‚</span></p></li><li><p><strong><span>ç­–ç•¥</span></strong></p><p><span>æ— è®ºæ˜¯ä¿ç•™è¿˜æ˜¯å»æ‰éƒ½ä¼šæœ‰ä¸€å®šçš„é£é™©ç‚¹ï¼Œä¸è¿‡ç›®å‰äº’è”ç½‘ä¸­çš„ RPC é€šä¿¡ä¼šå¤§é‡ä½¿ç”¨ NIOï¼Œæ‰€ä»¥å»ºè®®ä¿ç•™ã€‚æ­¤å¤– JVM è¿˜æä¾›äº† </span><code>-XX:+ExplicitGCInvokesConcurrent</code><span> å’Œ </span><code>-XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses</code><span> å‚æ•°æ¥å°† System.gc çš„è§¦å‘ç±»å‹ä» Foreground æ”¹ä¸º Backgroundï¼ŒåŒæ—¶ Background ä¹Ÿä¼šåš Reference Processingï¼Œè¿™æ ·çš„è¯å°±èƒ½å¤§å¹…é™ä½äº† STW å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šå‘ç”Ÿ NIO Direct Memory OOMã€‚</span></p></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯ä¸‰ï¼šMetaSpaceåŒºOOM</span></strong></p><ul><li><p><strong><span>ç°è±¡</span></strong></p><p><span>JVM åœ¨å¯åŠ¨åæˆ–è€…æŸä¸ªæ—¶é—´ç‚¹å¼€å§‹ï¼Œ </span><strong><span>MetaSpace çš„å·²ä½¿ç”¨å¤§å°åœ¨æŒç»­å¢é•¿ï¼ŒåŒæ—¶æ¯æ¬¡ GC ä¹Ÿæ— æ³•é‡Šæ”¾ï¼Œè°ƒå¤§ MetaSpace ç©ºé—´ä¹Ÿæ— æ³•å½»åº•è§£å†³</span></strong><span> ã€‚</span></p></li><li><p><strong><span>åŸå› </span></strong></p><p><span>åœ¨è®¨è®ºä¸ºä»€ä¹ˆä¼š OOM ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåŒºé‡Œé¢ä¼šå­˜ä»€ä¹ˆæ•°æ®ï¼ŒJava 7 ä¹‹å‰å­—ç¬¦ä¸²å¸¸é‡æ± è¢«æ”¾åˆ°äº† Perm åŒºï¼Œæ‰€æœ‰è¢« intern çš„ String éƒ½ä¼šè¢«å­˜åœ¨è¿™é‡Œï¼Œç”±äº String.intern æ˜¯ä¸å—æ§çš„ï¼Œæ‰€ä»¥ </span><code>-XX:MaxPermSize</code><span> çš„å€¼ä¹Ÿä¸å¤ªå¥½è®¾ç½®ï¼Œç»å¸¸ä¼šå‡ºç° </span><code>java.lang.OutOfMemoryError: PermGen space</code><span> å¼‚å¸¸ï¼Œæ‰€ä»¥åœ¨ Java 7 ä¹‹åå¸¸é‡æ± ç­‰å­—é¢é‡ï¼ˆLiteralï¼‰ã€ç±»é™æ€å˜é‡ï¼ˆClass Staticï¼‰ã€ç¬¦å·å¼•ç”¨ï¼ˆSymbols Referenceï¼‰ç­‰å‡ é¡¹è¢«ç§»åˆ° Heap ä¸­ã€‚è€Œ Java 8 ä¹‹å PermGen ä¹Ÿè¢«ç§»é™¤ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ MetaSpaceã€‚ç”±åœºæ™¯ä¸€å¯çŸ¥ï¼Œä¸ºäº†é¿å…å¼¹æ€§ä¼¸ç¼©å¸¦æ¥çš„é¢å¤– GC æ¶ˆè€—ï¼Œæˆ‘ä»¬ä¼šå°† </span><code>-XX:MetaSpaceSize</code><span> å’Œ </span><code>-XX:MaxMetaSpaceSize</code><span> ä¸¤ä¸ªå€¼è®¾ç½®ä¸ºå›ºå®šçš„ï¼Œä½†è¿™æ ·ä¹Ÿä¼šå¯¼è‡´åœ¨ç©ºé—´ä¸å¤Ÿçš„æ—¶å€™æ— æ³•æ‰©å®¹ï¼Œç„¶åé¢‘ç¹åœ°è§¦å‘ GCï¼Œæœ€ç»ˆ OOMã€‚æ‰€ä»¥å…³é”®åŸå› æ˜¯ </span><strong><span>ClassLoaderä¸åœåœ°åœ¨å†…å­˜ä¸­loadäº†æ–°çš„Class ï¼Œä¸€èˆ¬è¿™ç§é—®é¢˜éƒ½å‘ç”Ÿåœ¨åŠ¨æ€ç±»åŠ è½½ç­‰æƒ…å†µä¸Šã€‚</span></strong></p></li><li><p><strong><span>ç­–ç•¥</span></strong></p><p><span>å¯ä»¥ dump å¿«ç…§ä¹‹åé€šè¿‡ JProfiler æˆ– MAT è§‚å¯Ÿ Classes çš„ Histogramï¼ˆç›´æ–¹å›¾ï¼‰ å³å¯ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡å‘½ä»¤å³å¯å®šä½ï¼Œ jcmd æ‰“å‡ æ¬¡ Histogram çš„å›¾ï¼Œçœ‹ä¸€ä¸‹å…·ä½“æ˜¯å“ªä¸ªåŒ…ä¸‹çš„ Class å¢åŠ è¾ƒå¤šå°±å¯ä»¥å®šä½ã€‚å¦‚æœæ— æ³•ä»æ•´ä½“çš„è§’åº¦å®šä½ï¼Œå¯ä»¥æ·»åŠ  </span><code>-XX:+TraceClassLoading</code><span> å’Œ </span><code>-XX:+TraceClassUnLoading</code><span> å‚æ•°è§‚å¯Ÿè¯¦ç»†çš„ç±»åŠ è½½å’Œå¸è½½ä¿¡æ¯ã€‚</span></p></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯å››ï¼šè¿‡æ—©æ™‹å‡</span></strong></p><ul><li><p><strong><span>ç°è±¡</span></strong></p><p><span>è¿™ç§åœºæ™¯ä¸»è¦å‘ç”Ÿåœ¨åˆ†ä»£çš„æ”¶é›†å™¨ä¸Šé¢ï¼Œä¸“ä¸šçš„æœ¯è¯­ç§°ä¸ºâ€œPremature Promotionâ€ã€‚90% çš„å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œåªæœ‰åœ¨ Young åŒºç»å†è¿‡å‡ æ¬¡ GC çš„æ´—ç¤¼åæ‰ä¼šæ™‹å‡åˆ° Old åŒºï¼Œæ¯ç»å†ä¸€æ¬¡ GC å¯¹è±¡çš„ GC Age å°±ä¼šå¢é•¿ 1ï¼Œæœ€å¤§é€šè¿‡ </span><code>-XX:MaxTenuringThreshold</code><span> æ¥æ§åˆ¶ã€‚è¿‡æ—©æ™‹å‡ä¸€èˆ¬ä¸ä¼šç›´æ¥å½±å“ GCï¼Œæ€»ä¼šä¼´éšç€æµ®åŠ¨åƒåœ¾ã€å¤§å¯¹è±¡æ‹…ä¿å¤±è´¥ç­‰é—®é¢˜ï¼Œä½†è¿™äº›é—®é¢˜ä¸æ˜¯ç«‹åˆ»å‘ç”Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä»¥ä¸‹å‡ ç§ç°è±¡æ¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†è¿‡æ—©æ™‹å‡ï¼š</span></p><ul><li><p><strong><span>åˆ†é…é€Ÿç‡æ¥è¿‘äºæ™‹å‡é€Ÿç‡</span></strong><span> ï¼Œå¯¹è±¡æ™‹å‡å¹´é¾„è¾ƒå°ã€‚</span></p><p><span>GC æ—¥å¿—ä¸­å‡ºç°â€œDesired survivor size 107347968 bytes, </span><strong><span>new threshold 1(max 6)</span></strong><span> â€ç­‰ä¿¡æ¯ï¼Œè¯´æ˜æ­¤æ—¶ç»å†è¿‡ä¸€æ¬¡ GC å°±ä¼šæ”¾åˆ° Old åŒºã€‚</span></p></li><li><p><strong><span>Full GC æ¯”è¾ƒé¢‘ç¹</span></strong><span> ï¼Œä¸”ç»å†è¿‡ä¸€æ¬¡ GC ä¹‹å Old åŒºçš„ </span><strong><span>å˜åŒ–æ¯”ä¾‹éå¸¸å¤§</span></strong><span> ã€‚</span></p><p><span>å¦‚OldåŒºè§¦å‘å›æ”¶é˜ˆå€¼æ˜¯80%ï¼Œç»å†ä¸€æ¬¡GCä¹‹åä¸‹é™åˆ°äº†10%ï¼Œè¿™è¯´æ˜OldåŒº70%çš„å¯¹è±¡å­˜æ´»æ—¶é—´å…¶å®å¾ˆçŸ­ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250123.png" referrerpolicy="no-referrer" alt="FullGCå˜åŒ–æ¯”ä¾‹å¤§"></p></li></ul><p><span>è¿‡æ—©æ™‹å‡çš„å±å®³ï¼š</span></p><ul><li><span>Young GC é¢‘ç¹ï¼Œæ€»çš„ååé‡ä¸‹é™</span></li><li><span>Full GC é¢‘ç¹ï¼Œå¯èƒ½ä¼šæœ‰è¾ƒå¤§åœé¡¿</span></li></ul></li><li><p><strong><span>åŸå› </span></strong></p><p><span>ä¸»è¦çš„åŸå› æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</span></p><ul><li><strong><span>Young/Eden åŒºè¿‡å°</span></strong><span>ï¼š è¿‡å°çš„ç›´æ¥åæœå°±æ˜¯ Eden è¢«è£…æ»¡çš„æ—¶é—´å˜çŸ­ï¼Œæœ¬åº”è¯¥å›æ”¶çš„å¯¹è±¡å‚ä¸äº† GC å¹¶æ™‹å‡ï¼ŒYoung GC é‡‡ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼Œç”±åŸºç¡€ç¯‡æˆ‘ä»¬çŸ¥é“ copying è€—æ—¶è¿œå¤§äº markï¼Œä¹Ÿå°±æ˜¯ Young GC è€—æ—¶æœ¬è´¨ä¸Šå°±æ˜¯ copy çš„æ—¶é—´ï¼ˆCMS æ‰«æ Card Table æˆ– G1 æ‰«æ Remember Set å‡ºé—®é¢˜çš„æƒ…å†µå¦è¯´ï¼‰ï¼Œæ²¡æ¥åŠå›æ”¶çš„å¯¹è±¡å¢å¤§äº†å›æ”¶çš„ä»£ä»·ï¼Œæ‰€ä»¥ Young GC æ—¶é—´å¢åŠ ï¼ŒåŒæ—¶åˆæ— æ³•å¿«é€Ÿé‡Šæ”¾ç©ºé—´ï¼ŒYoung GC æ¬¡æ•°ä¹Ÿè·Ÿç€å¢åŠ </span></li><li><strong><span>åˆ†é…é€Ÿç‡è¿‡å¤§</span></strong><span>ï¼š å¯ä»¥è§‚å¯Ÿå‡ºé—®é¢˜å‰å Mutator çš„åˆ†é…é€Ÿç‡ï¼Œå¦‚æœæœ‰æ˜æ˜¾æ³¢åŠ¨å¯ä»¥å°è¯•è§‚å¯Ÿç½‘å¡æµé‡ã€å­˜å‚¨ç±»ä¸­é—´ä»¶æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ä¿¡æ¯ï¼Œçœ‹æ˜¯å¦æœ‰å¤§é‡æ•°æ®è¢«åŠ è½½åˆ°å†…å­˜ä¸­</span></li></ul></li><li><p><strong><span>ç­–ç•¥</span></strong></p><ul><li><p><span>å¦‚æœæ˜¯ </span><strong><span>Young/Eden åŒºè¿‡å°</span></strong><span> ï¼Œå¯ä»¥åœ¨æ€»çš„ Heap å†…å­˜ä¸å˜çš„æƒ…å†µä¸‹é€‚å½“å¢å¤§YoungåŒºã€‚ä¸€èˆ¬æƒ…å†µä¸‹Oldçš„å¤§å°åº”å½“ä¸ºæ´»è·ƒå¯¹è±¡çš„2~3å€å·¦å³ï¼Œè€ƒè™‘åˆ°æµ®åŠ¨åƒåœ¾é—®é¢˜æœ€å¥½åœ¨3å€å·¦å³ï¼Œå‰©ä¸‹çš„éƒ½å¯ä»¥åˆ†ç»™YoungåŒº</span></p></li><li><p><span>è¿‡æ—©æ™‹å‡ä¼˜åŒ–æ¥çœ‹ï¼ŒåŸé…ç½®ä¸ºYoung 1.2G+Old 2.8Gï¼Œé€šè¿‡è§‚å¯ŸCMS GCçš„æƒ…å†µæ‰¾åˆ°å­˜æ´»å¯¹è±¡å¤§æ¦‚ä¸º 300~400Mï¼Œäºæ˜¯è°ƒæ•´Old 1.5Gå·¦å³ï¼Œå‰©ä¸‹2.5Gåˆ†ç»™Young åŒºã€‚ä»…ä»…è°ƒäº†ä¸€ä¸ªYoungåŒºå¤§å°å‚æ•°ï¼ˆ</span><code>-Xmn</code><span>ï¼‰ï¼Œæ•´ä¸ª JVM ä¸€åˆ†é’ŸYoung GCä»26æ¬¡é™ä½åˆ°äº†11æ¬¡ï¼Œå•æ¬¡æ—¶é—´ä¹Ÿæ²¡æœ‰å¢åŠ ï¼Œæ€»çš„GCæ—¶é—´ä»1100msé™ä½åˆ°äº†500msï¼ŒCMS GCæ¬¡æ•°ä¹Ÿä»40åˆ†é’Ÿå·¦å³ä¸€æ¬¡é™ä½åˆ°äº†7å°æ—¶30åˆ†é’Ÿä¸€æ¬¡ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250131.png" referrerpolicy="no-referrer" alt="è¿‡æ—©æ™‹å‡ä¼˜åŒ–GC"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250235.png" referrerpolicy="no-referrer" alt="è¿‡æ—©æ™‹å‡ä¼˜åŒ–Oldgen"></p><p><span>å¦‚æœæ˜¯åˆ†é…é€Ÿç‡è¿‡å¤§ï¼š</span></p><ul><li><strong><span>å¶å‘è¾ƒå¤§</span></strong><span> ï¼šé€šè¿‡å†…å­˜åˆ†æå·¥å…·æ‰¾åˆ°é—®é¢˜ä»£ç ï¼Œä»ä¸šåŠ¡é€»è¾‘ä¸Šåšä¸€äº›ä¼˜åŒ–</span></li><li><strong><span>ä¸€ç›´è¾ƒå¤§</span></strong><span> ï¼šå½“å‰çš„ Collector å·²ç»ä¸æ»¡è¶³ Mutator çš„æœŸæœ›äº†ï¼Œè¿™ç§æƒ…å†µè¦ä¹ˆæ‰©å®¹ Mutator çš„ VMï¼Œè¦ä¹ˆè°ƒæ•´ GC æ”¶é›†å™¨ç±»å‹æˆ–åŠ å¤§ç©ºé—´</span></li></ul></li></ul></li><li><p><strong><span>å°ç»“</span></strong></p><p><span>è¿‡æ—©æ™‹å‡é—®é¢˜ä¸€èˆ¬ä¸ä¼šç‰¹åˆ«æ˜æ˜¾ï¼Œä½†æ—¥ç§¯æœˆç´¯ä¹‹åå¯èƒ½ä¼šçˆ†å‘ä¸€æ³¢æ”¶é›†å™¨é€€åŒ–ä¹‹ç±»çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯è¦æå‰é¿å…æ‰çš„ï¼Œå¯ä»¥çœ‹çœ‹è‡ªå·±ç³»ç»Ÿé‡Œé¢æ˜¯å¦æœ‰è¿™äº›ç°è±¡ï¼Œå¦‚æœæ¯”è¾ƒåŒ¹é…çš„è¯ï¼Œå¯ä»¥å°è¯•ä¼˜åŒ–ä¸€ä¸‹ã€‚ä¸€è¡Œä»£ç ä¼˜åŒ–çš„ ROI è¿˜æ˜¯å¾ˆé«˜çš„ã€‚å¦‚æœåœ¨è§‚å¯Ÿ Old åŒºå‰åæ¯”ä¾‹å˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¯ä»¥å›æ”¶çš„æ¯”ä¾‹éå¸¸å°ï¼Œå¦‚ä» 80% åªå›æ”¶åˆ°äº† 60%ï¼Œè¯´æ˜æˆ‘ä»¬å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼ŒOld åŒºçš„ç©ºé—´å¯ä»¥é€‚å½“è°ƒå¤§äº›ã€‚</span></p></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯äº”ï¼šCMS Old GCé¢‘ç¹</span></strong></p><ul><li><p><strong><span>ç°è±¡</span></strong></p><p><span>Old åŒºé¢‘ç¹çš„åš CMS GCï¼Œä½†æ˜¯æ¯æ¬¡è€—æ—¶ä¸æ˜¯ç‰¹åˆ«é•¿ï¼Œæ•´ä½“æœ€å¤§ STW ä¹Ÿåœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œä½†ç”±äº GC å¤ªé¢‘ç¹å¯¼è‡´ååä¸‹é™æ¯”è¾ƒå¤šã€‚</span></p></li><li><p><strong><span>åŸå› </span></strong></p><p><span>è¿™ç§æƒ…å†µæ¯”è¾ƒå¸¸è§ï¼ŒåŸºæœ¬éƒ½æ˜¯ä¸€æ¬¡ Young GC å®Œæˆåï¼Œè´Ÿè´£å¤„ç† CMS GC çš„ä¸€ä¸ªåå°çº¿ç¨‹ concurrentMarkSweepThread ä¼šä¸æ–­åœ°è½®è¯¢ï¼Œä½¿ç”¨ </span><code>shouldConcurrentCollect()</code><span> æ–¹æ³•åšä¸€æ¬¡æ£€æµ‹ï¼Œåˆ¤æ–­æ˜¯å¦è¾¾åˆ°äº†å›æ”¶æ¡ä»¶ã€‚å¦‚æœè¾¾åˆ°æ¡ä»¶ï¼Œä½¿ç”¨ </span><code>collect_in_background()</code><span> å¯åŠ¨ä¸€æ¬¡ Background æ¨¡å¼ GCã€‚è½®è¯¢çš„åˆ¤æ–­æ˜¯ä½¿ç”¨ </span><code>sleepBeforeNextCycle()</code><span> æ–¹æ³•ï¼Œé—´éš”å‘¨æœŸä¸º </span><code>-XX:CMSWaitDuration</code><span> å†³å®šï¼Œé»˜è®¤ä¸º 2sã€‚</span></p></li><li><p><strong><span>ç­–ç•¥</span></strong></p><p><span>å¤„ç†è¿™ç§å¸¸è§„å†…å­˜æ³„æ¼é—®é¢˜åŸºæœ¬æ˜¯ä¸€ä¸ªæ€è·¯ï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250519.png" referrerpolicy="no-referrer" alt="CMSOldGCé¢‘ç¹"></p><p><span>Dump Diff å’Œ Leak Suspects æ¯”è¾ƒç›´è§‚ï¼Œè¿™é‡Œè¯´ä¸‹å…¶å®ƒå‡ ä¸ªå…³é”®ç‚¹ï¼š</span></p><ul><li><strong><span>å†…å­˜ Dump</span></strong><span>ï¼š ä½¿ç”¨ jmapã€arthas ç­‰ dump å †è¿›è¡Œå¿«ç…§æ—¶è®°å¾—æ‘˜æ‰æµé‡ï¼ŒåŒæ—¶ </span><strong><span>åˆ†åˆ«åœ¨ CMS GC çš„å‘ç”Ÿå‰ååˆ†åˆ« dump ä¸€æ¬¡</span></strong><span> </span></li><li><strong><span>åˆ†æ Top Component</span></strong><span>ï¼š è¦è®°å¾—æŒ‰ç…§å¯¹è±¡ã€ç±»ã€ç±»åŠ è½½å™¨ã€åŒ…ç­‰å¤šä¸ªç»´åº¦è§‚å¯ŸHistogramï¼ŒåŒæ—¶ä½¿ç”¨ outgoingå’Œincomingåˆ†æå…³è”çš„å¯¹è±¡ï¼Œå…¶æ¬¡Soft Referenceå’ŒWeak Referenceã€Finalizer ç­‰ä¹Ÿè¦çœ‹ä¸€ä¸‹</span></li><li><strong><span>åˆ†æ Unreachable</span></strong><span>ï¼š é‡ç‚¹çœ‹ä¸€ä¸‹è¿™ä¸ªï¼Œå…³æ³¨ä¸‹ Shallow å’Œ Retained çš„å¤§å°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä¸€æ¬¡ GC ä¼˜åŒ–ï¼Œå°±æ ¹æ® Unreachable Objects å‘ç°äº† Hystrix çš„æ»‘åŠ¨çª—å£é—®é¢˜ã€‚</span></li></ul><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250528.png" referrerpolicy="no-referrer" alt="åˆ†æUnreachable"></p><p>&nbsp;</p></li></ul><p><strong><span>åœºæ™¯å…­ï¼šå•æ¬¡CMS Old GCè€—æ—¶é•¿</span></strong></p><ul><li><p><strong><span>ç°è±¡</span></strong></p><p><span>CMS GC å•æ¬¡ STW æœ€å¤§è¶…è¿‡ 1000msï¼Œä¸ä¼šé¢‘ç¹å‘ç”Ÿï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºæœ€é•¿è¾¾åˆ°äº† 8000msã€‚æŸäº›åœºæ™¯ä¸‹ä¼šå¼•èµ·â€œé›ªå´©æ•ˆåº”â€ï¼Œè¿™ç§åœºæ™¯éå¸¸å±é™©ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…å‡ºç°ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250538.png" referrerpolicy="no-referrer" alt="CMSGCå•æ¬¡STWé•¿"></p></li><li><p><strong><span>åŸå› </span></strong></p><p><span>CMSåœ¨å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼ŒSTWçš„é˜¶æ®µä¸»è¦æ˜¯ Init Mark å’Œ Final Remark è¿™ä¸¤ä¸ªé˜¶æ®µï¼Œä¹Ÿæ˜¯å¯¼è‡´CMS Old GC æœ€å¤šçš„åŸå› ï¼Œå¦å¤–æœ‰äº›æƒ…å†µå°±æ˜¯åœ¨STWå‰ç­‰å¾…Mutatorçš„çº¿ç¨‹åˆ°è¾¾SafePointä¹Ÿä¼šå¯¼è‡´æ—¶é—´è¿‡é•¿ï¼Œä½†è¿™ç§æƒ…å†µè¾ƒå°‘ã€‚</span></p></li><li><p><strong><span>ç­–ç•¥</span></strong></p><p><span>çŸ¥é“äº†ä¸¤ä¸ª STW è¿‡ç¨‹æ‰§è¡Œæµç¨‹ï¼Œæˆ‘ä»¬åˆ†æè§£å†³å°±æ¯”è¾ƒç®€å•äº†ï¼Œç”±äºå¤§éƒ¨åˆ†é—®é¢˜éƒ½å‡ºåœ¨ Final Remark è¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿæ‹¿è¿™ä¸ªåœºæ™¯æ¥ä¸¾ä¾‹ï¼Œä¸»è¦æ­¥éª¤ï¼š</span></p><ul><li><strong><span>ã€æ–¹å‘ã€‘</span></strong><span> è§‚å¯Ÿè¯¦ç»† GC æ—¥å¿—ï¼Œæ‰¾åˆ°å‡ºé—®é¢˜æ—¶ Final Remark æ—¥å¿—ï¼Œåˆ†æä¸‹ Reference å¤„ç†å’Œå…ƒæ•°æ®å¤„ç† real è€—æ—¶æ˜¯å¦æ­£å¸¸ï¼Œè¯¦ç»†ä¿¡æ¯éœ€è¦é€šè¿‡ </span><code>-XX:+PrintReferenceGC</code><span> å‚æ•°å¼€å¯ã€‚ </span><strong><span>åŸºæœ¬åœ¨æ—¥å¿—é‡Œé¢å°±èƒ½å®šä½åˆ°å¤§æ¦‚æ˜¯å“ªä¸ªæ–¹å‘å‡ºäº†é—®é¢˜ï¼Œè€—æ—¶è¶…è¿‡ 10% çš„å°±éœ€è¦å…³æ³¨</span></strong><span> ã€‚</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2019</span><span class="cm-attribute">-02-27T19</span>:55:37.920<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">516952</span>.915: [GC (CMS Final Remark) <span class="cm-number">516952</span>.915: [ParNew516952.939: [SoftReference, <span class="cm-number">0</span> refs, <span class="cm-number">0</span>.0003857 secs]516952.939: [WeakReference, <span class="cm-number">1362</span> refs, <span class="cm-number">0</span>.0002415 secs]516952.940: [FinalReference, <span class="cm-number">146</span> refs, <span class="cm-number">0</span>.0001233 secs]516952.940: [PhantomReference, <span class="cm-number">0</span> refs, <span class="cm-number">57</span> refs, <span class="cm-number">0</span>.0002369 secs]516952.940: [JNI Weak Reference, <span class="cm-number">0</span>.0000662 secs]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[class unloading, <span class="cm-number">0</span>.1770490 secs]516953.329: [scrub symbol table, <span class="cm-number">0</span>.0442567 secs]516953.373: [scrub string table, <span class="cm-number">0</span>.0036072 secs][1 CMS-remark: 1638504K(2048000K)] 1667558K(4352000K), <span class="cm-number">0</span>.5269311 secs] [Times: <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-number">1</span>.20 <span class="cm-def">sys</span><span class="cm-operator">=</span><span class="cm-number">0</span>.03, <span class="cm-def">real</span><span class="cm-operator">=</span><span class="cm-number">0</span>.53 secs]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 216px;"></div><div class="CodeMirror-gutters" style="display: none; height: 216px;"></div></div></div></pre><ul><li><p><strong><span>ã€æ ¹å› ã€‘</span></strong><span> æœ‰äº†å…·ä½“çš„æ–¹å‘æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæ·±å…¥çš„åˆ†æï¼Œä¸€èˆ¬æ¥è¯´æœ€å®¹æ˜“å‡ºé—®é¢˜çš„åœ°æ–¹å°±æ˜¯ Reference ä¸­çš„ FinalReference å’Œå…ƒæ•°æ®ä¿¡æ¯å¤„ç†ä¸­çš„ scrub symbol table ä¸¤ä¸ªé˜¶æ®µï¼Œæƒ³è¦æ‰¾åˆ°å…·ä½“é—®é¢˜ä»£ç å°±éœ€è¦å†…å­˜åˆ†æå·¥å…· MAT æˆ– JProfiler äº†ï¼Œæ³¨æ„è¦ dump å³å°†å¼€å§‹ CMS GC çš„å †ã€‚åœ¨ç”¨ MAT ç­‰å·¥å…·å‰ä¹Ÿå¯ä»¥å…ˆç”¨å‘½ä»¤è¡Œçœ‹ä¸‹å¯¹è±¡ Histogramï¼Œæœ‰å¯èƒ½ç›´æ¥å°±èƒ½å®šä½é—®é¢˜ã€‚</span></p><ul><li><span>å¯¹ FinalReference çš„åˆ†æä¸»è¦è§‚å¯Ÿ </span><code>java.lang.ref.Finalizer</code><span> å¯¹è±¡çš„ dominator treeï¼Œæ‰¾åˆ°æ³„æ¼çš„æ¥æºã€‚ç»å¸¸ä¼šå‡ºç°é—®é¢˜çš„å‡ ä¸ªç‚¹æœ‰ Socket çš„ </span><code>SocksSocketImpl</code><span> ã€Jersey çš„ </span><code>ClientRuntime</code><span>ã€MySQL çš„ </span><code>ConnectionImpl</code><span> ç­‰ç­‰</span></li><li><span>scrub symbol table è¡¨ç¤ºæ¸…ç†å…ƒæ•°æ®ç¬¦å·å¼•ç”¨è€—æ—¶ï¼Œç¬¦å·å¼•ç”¨æ˜¯ Java ä»£ç è¢«ç¼–è¯‘æˆå­—èŠ‚ç æ—¶ï¼Œæ–¹æ³•åœ¨ JVM ä¸­çš„è¡¨ç°å½¢å¼ï¼Œç”Ÿå‘½å‘¨æœŸä¸€èˆ¬ä¸ Class ä¸€è‡´ï¼Œå½“ </span><code>_should_unload_classes</code><span> è¢«è®¾ç½®ä¸º true æ—¶åœ¨ </span><code>CMSCollector::refProcessingWork()</code><span> ä¸­ä¸ Class Unloadã€String Table ä¸€èµ·è¢«å¤„ç†</span></li></ul></li><li><p><strong><span>ã€ç­–ç•¥ã€‘</span></strong><span> çŸ¥é“ GC è€—æ—¶çš„æ ¹å› å°±æ¯”è¾ƒå¥½å¤„ç†äº†ï¼Œè¿™ç§é—®é¢˜ä¸ä¼šå¤§é¢ç§¯åŒæ—¶çˆ†å‘ï¼Œä¸è¿‡æœ‰å¾ˆå¤šæ—¶å€™å•å° STW çš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿ï¼Œå¦‚æœä¸šåŠ¡å½±å“æ¯”è¾ƒå¤§ï¼ŒåŠæ—¶æ‘˜æ‰æµé‡ï¼Œå…·ä½“åç»­ä¼˜åŒ–ç­–ç•¥å¦‚ä¸‹ï¼š</span></p><ul><li><span>FinalReferenceï¼šæ‰¾åˆ°å†…å­˜æ¥æºåé€šè¿‡ä¼˜åŒ–ä»£ç çš„æ–¹å¼æ¥è§£å†³ï¼Œå¦‚æœçŸ­æ—¶é—´æ— æ³•å®šä½å¯ä»¥å¢åŠ  </span><code>-XX:+ParallelRefProcEnabled</code><span> å¯¹ Reference è¿›è¡Œå¹¶è¡Œå¤„ç†</span></li><li><span>symbol tableï¼šè§‚å¯Ÿ MetaSpace åŒºçš„å†å²ä½¿ç”¨å³°å€¼ï¼Œä»¥åŠæ¯æ¬¡ GC å‰åçš„å›æ”¶æƒ…å†µï¼Œä¸€èˆ¬æ²¡æœ‰ä½¿ç”¨åŠ¨æ€ç±»åŠ è½½æˆ–è€… DSL å¤„ç†ç­‰ï¼ŒMetaSpace çš„ä½¿ç”¨ç‡ä¸Šä¸ä¼šæœ‰ä»€ä¹ˆå˜åŒ–ï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡ </span><code>-XX:-CMSClassUnloadingEnabled</code><span> æ¥é¿å… MetaSpace çš„å¤„ç†ï¼ŒJDK8 ä¼šé»˜è®¤å¼€å¯ CMSClassUnloadingEnabledï¼Œè¿™ä¼šä½¿å¾— CMS åœ¨ CMS-Remark é˜¶æ®µå°è¯•è¿›è¡Œç±»çš„å¸è½½</span></li></ul></li></ul></li><li><p><strong><span>å°ç»“</span></strong></p><p><span>æ­£å¸¸æƒ…å†µè¿›è¡Œçš„ Background CMS GCï¼Œå‡ºç°é—®é¢˜åŸºæœ¬éƒ½é›†ä¸­åœ¨ Reference å’Œ Class ç­‰å…ƒæ•°æ®å¤„ç†ä¸Šï¼Œåœ¨ Reference ç±»çš„é—®é¢˜å¤„ç†æ–¹é¢ï¼Œä¸ç®¡æ˜¯ FinalReferenceï¼Œè¿˜æ˜¯ SoftReferenceã€WeakReference æ ¸å¿ƒçš„æ‰‹æ®µå°±æ˜¯æ‰¾å‡†æ—¶æœº dumpå¿«ç…§ï¼Œç„¶åç”¨å†…å­˜åˆ†æå·¥å…·æ¥åˆ†æã€‚Classå¤„ç†æ–¹é¢ç›®å‰é™¤äº†å…³é—­ç±»å¸è½½å¼€å…³ï¼Œæ²¡æœ‰å¤ªå¥½çš„æ–¹æ³•ã€‚åœ¨ G1 ä¸­åŒæ ·æœ‰ Reference çš„é—®é¢˜ï¼Œå¯ä»¥è§‚å¯Ÿæ—¥å¿—ä¸­çš„ Ref Procï¼Œå¤„ç†æ–¹æ³•ä¸ CMS ç±»ä¼¼ã€‚</span></p></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯ä¸ƒï¼šå†…å­˜ç¢ç‰‡&amp;æ”¶é›†å™¨é€€åŒ–</span></strong></p><ul><li><p><strong><span>ç°è±¡</span></strong></p><p><span>å¹¶å‘çš„ CMS GC ç®—æ³•ï¼Œé€€åŒ–ä¸º Foreground å•çº¿ç¨‹ä¸²è¡Œ GC æ¨¡å¼ï¼ŒSTW æ—¶é—´è¶…é•¿ï¼Œæœ‰æ—¶ä¼šé•¿è¾¾åå‡ ç§’ã€‚å…¶ä¸­ CMS æ”¶é›†å™¨é€€åŒ–åå•çº¿ç¨‹ä¸²è¡Œ GC ç®—æ³•æœ‰ä¸¤ç§ï¼š</span></p><ul><li><span>å¸¦å‹ç¼©åŠ¨ä½œçš„ç®—æ³•ï¼Œç§°ä¸º MSCï¼Œä¸Šé¢æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œä½¿ç”¨æ ‡è®°-æ¸…ç†-å‹ç¼©ï¼Œå•çº¿ç¨‹å…¨æš‚åœçš„æ–¹å¼ï¼Œå¯¹æ•´ä¸ªå †è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ Full GCï¼Œæš‚åœæ—¶é—´è¦é•¿äºæ™®é€š CMS</span></li><li><span>ä¸å¸¦å‹ç¼©åŠ¨ä½œçš„ç®—æ³•ï¼Œæ”¶é›† Old åŒºï¼Œå’Œæ™®é€šçš„ CMS ç®—æ³•æ¯”è¾ƒç›¸ä¼¼ï¼Œæš‚åœæ—¶é—´ç›¸å¯¹ MSC ç®—æ³•çŸ­ä¸€äº›</span></li></ul></li><li><p><strong><span>åŸå› </span></strong></p><p><span>CMS å‘ç”Ÿæ”¶é›†å™¨é€€åŒ–ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</span></p><ul><li><strong><span>æ™‹å‡å¤±è´¥ï¼ˆPromotion Failedï¼‰</span></strong></li><li><strong><span>å¢é‡æ”¶é›†æ‹…ä¿å¤±è´¥</span></strong></li><li><strong><span>æ˜¾å¼ GC</span></strong></li><li><strong><span>å¹¶å‘æ¨¡å¼å¤±è´¥ï¼ˆConcurrent Mode Failureï¼‰</span></strong></li></ul></li><li><p><strong><span>ç­–ç•¥</span></strong></p><p><span>åˆ†æåˆ°å…·ä½“åŸå› åï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹æ€§è§£å†³äº†ï¼Œå…·ä½“æ€è·¯è¿˜æ˜¯ä»æ ¹å› å‡ºå‘ï¼Œå…·ä½“è§£å†³ç­–ç•¥ï¼š</span></p><ul><li><strong><span>å†…å­˜ç¢ç‰‡</span></strong><span>ï¼š é€šè¿‡é…ç½® </span><code>-XX:UseCMSCompactAtFullCollection=true</code><span> æ¥æ§åˆ¶ Full GC çš„è¿‡ç¨‹ä¸­æ˜¯å¦è¿›è¡Œç©ºé—´çš„æ•´ç†ï¼ˆé»˜è®¤å¼€å¯ï¼Œæ³¨æ„æ˜¯ Full GCï¼Œä¸æ˜¯æ™®é€š CMS GCï¼‰ï¼Œä»¥åŠ </span><code>-XX: CMSFullGCsBeforeCompaction=n</code><span> æ¥æ§åˆ¶å¤šå°‘æ¬¡ Full GC åè¿›è¡Œä¸€æ¬¡å‹ç¼©</span></li><li><strong><span>å¢é‡æ”¶é›†</span></strong><span>ï¼š é™ä½è§¦å‘ CMS GC çš„é˜ˆå€¼ï¼Œå³å‚æ•° </span><code>-XX:CMSInitiatingOccupancyFraction</code><span> çš„å€¼ï¼Œè®© CMS GC å°½æ—©æ‰§è¡Œï¼Œä»¥ä¿è¯æœ‰è¶³å¤Ÿçš„è¿ç»­ç©ºé—´ï¼Œä¹Ÿå‡å°‘ Old åŒºç©ºé—´çš„ä½¿ç”¨å¤§å°ï¼Œå¦å¤–éœ€è¦ä½¿ç”¨ </span><code>-XX:+UseCMSInitiatingOccupancyOnly</code><span> æ¥é…åˆä½¿ç”¨ï¼Œä¸ç„¶ JVM ä»…åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨è®¾å®šå€¼ï¼Œåç»­åˆ™è‡ªåŠ¨è°ƒæ•´</span></li><li><strong><span>æµ®åŠ¨åƒåœ¾</span></strong><span>ï¼š è§†æƒ…å†µæ§åˆ¶æ¯æ¬¡æ™‹å‡å¯¹è±¡çš„å¤§å°ï¼Œæˆ–è€…ç¼©çŸ­æ¯æ¬¡ CMS GC çš„æ—¶é—´ï¼Œå¿…è¦æ—¶å¯è°ƒèŠ‚ NewRatio çš„å€¼ã€‚å¦å¤–ä½¿ç”¨ </span><code>-XX:+CMSScavengeBeforeRemark</code><span> åœ¨è¿‡ç¨‹ä¸­æå‰è§¦å‘ä¸€æ¬¡Young GCï¼Œé˜²æ­¢åç»­æ™‹å‡è¿‡å¤šå¯¹è±¡</span></li></ul></li><li><p><strong><span>å°ç»“</span></strong></p><p><span>æ­£å¸¸æƒ…å†µä¸‹è§¦å‘å¹¶å‘æ¨¡å¼çš„ CMS GCï¼Œåœé¡¿éå¸¸çŸ­ï¼Œå¯¹ä¸šåŠ¡å½±å“å¾ˆå°ï¼Œä½† CMS GC é€€åŒ–åï¼Œå½±å“ä¼šéå¸¸å¤§ï¼Œå»ºè®®å‘ç°ä¸€æ¬¡åå°±å½»åº•æ ¹æ²»ã€‚åªè¦èƒ½å®šä½åˆ°å†…å­˜ç¢ç‰‡ã€æµ®åŠ¨åƒåœ¾ã€å¢é‡æ”¶é›†ç›¸å…³ç­‰å…·ä½“äº§ç”ŸåŸå› ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¥½è§£å†³çš„ï¼Œå…³äºå†…å­˜ç¢ç‰‡è¿™å—ï¼Œå¦‚æœ </span><code>-XX:CMSFullGCsBeforeCompaction</code><span> çš„å€¼ä¸å¥½é€‰å–çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ </span><code>-XX:PrintFLSStatistics</code><span> æ¥è§‚å¯Ÿå†…å­˜ç¢ç‰‡ç‡æƒ…å†µï¼Œç„¶åå†è®¾ç½®å…·ä½“çš„å€¼ã€‚æœ€åå°±æ˜¯åœ¨ç¼–ç çš„æ—¶å€™ä¹Ÿè¦é¿å…éœ€è¦è¿ç»­åœ°å€ç©ºé—´çš„å¤§å¯¹è±¡çš„äº§ç”Ÿï¼Œå¦‚è¿‡é•¿çš„å­—ç¬¦ä¸²ï¼Œç”¨äºå­˜æ”¾é™„ä»¶ã€åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–çš„ byte æ•°ç»„ç­‰ï¼Œè¿˜æœ‰å°±æ˜¯è¿‡æ—©æ™‹å‡é—®é¢˜å°½é‡åœ¨çˆ†å‘é—®é¢˜å‰å°±é¿å…æ‰ã€‚</span></p></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯å…«ï¼šå †å¤–å†…å­˜OOM</span></strong></p><ul><li><p><strong><span>ç°è±¡</span></strong></p><p><span>å†…å­˜ä½¿ç”¨ç‡ä¸æ–­ä¸Šå‡ï¼Œç”šè‡³å¼€å§‹ä½¿ç”¨ SWAP å†…å­˜ï¼ŒåŒæ—¶å¯èƒ½å‡ºç° GC æ—¶é—´é£™å‡ï¼Œçº¿ç¨‹è¢« Block ç­‰ç°è±¡ï¼Œ </span><strong><span>é€šè¿‡ top å‘½ä»¤å‘ç° Java è¿›ç¨‹çš„ RES ç”šè‡³è¶…è¿‡äº†</span></strong><span> </span><code>**-Xmx**</code><span> </span><strong><span>çš„å¤§å°</span></strong><span> ã€‚å‡ºç°è¿™äº›ç°è±¡æ—¶ï¼ŒåŸºæœ¬å¯ç¡®å®šæ˜¯å‡ºç°å †å¤–å†…å­˜æ³„æ¼ã€‚</span></p></li><li><p><strong><span>åŸå› </span></strong></p><p><span>JVM çš„å †å¤–å†…å­˜æ³„æ¼ï¼Œä¸»è¦æœ‰ä¸¤ç§çš„åŸå› ï¼š</span></p><ul><li><span>é€šè¿‡ </span><code>UnSafe#allocateMemory</code><span>ï¼Œ</span><code>ByteBuffer#allocateDirect</code><span> ä¸»åŠ¨ç”³è¯·äº†å †å¤–å†…å­˜è€Œæ²¡æœ‰é‡Šæ”¾ï¼Œå¸¸è§äº NIOã€Netty ç­‰ç›¸å…³ç»„ä»¶</span></li><li><span>ä»£ç ä¸­æœ‰é€šè¿‡ JNI è°ƒç”¨ Native Code ç”³è¯·çš„å†…å­˜æ²¡æœ‰é‡Šæ”¾</span></li></ul></li><li><p><strong><span>ç­–ç•¥</span></strong></p><p><strong><span>åŸå› ä¸€ï¼šä¸»åŠ¨ç”³è¯·æœªé‡Šæ”¾</span></strong></p><p><strong><span>åŸå› äºŒï¼šé€šè¿‡ JNI è°ƒç”¨çš„ Native Code ç”³è¯·çš„å†…å­˜æœªé‡Šæ”¾</span></strong></p></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯ä¹ï¼šJNIå¼•å‘çš„GCé—®é¢˜</span></strong></p><ul><li><p><strong><span>ç°è±¡</span></strong></p><p><span>åœ¨ GC æ—¥å¿—ä¸­ï¼Œå‡ºç° GC Cause ä¸º GCLocker Initiated GCã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2020</span><span class="cm-attribute">-09-23T16</span>:49:09.727<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">504426</span>.742: [GC (GCLocker Initiated GC) <span class="cm-number">504426</span>.742: [ParNew (promotion failed): 209716K-&gt;6042K(1887488K), <span class="cm-number">0</span>.0843330 secs] 1449487K-&gt;1347626K(3984640K), <span class="cm-number">0</span>.0848963 secs] [Times: <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-number">0</span>.19 <span class="cm-def">sys</span><span class="cm-operator">=</span><span class="cm-number">0</span>.00, <span class="cm-def">real</span><span class="cm-operator">=</span><span class="cm-number">0</span>.09 secs]2020-09-23T16:49:09.812<span class="cm-operator">+</span><span class="cm-number">0800</span>: <span class="cm-number">504426</span>.827: [Full GC (GCLocker Initiated GC) <span class="cm-number">504426</span>.827: [CMS: 1341583K-&gt;419699K(2097152K), <span class="cm-number">1</span>.8482275 secs] 1347626K-&gt;419699K(3984640K), [Metaspace: 297780K-&gt;297780K(1329152K)], <span class="cm-number">1</span>.8490564 secs] [Times: <span class="cm-def">user</span><span class="cm-operator">=</span><span class="cm-number">1</span>.62 <span class="cm-def">sys</span><span class="cm-operator">=</span><span class="cm-number">0</span>.20, <span class="cm-def">real</span><span class="cm-operator">=</span><span class="cm-number">1</span>.85 secs]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 194px;"></div><div class="CodeMirror-gutters" style="display: none; height: 194px;"></div></div></div></pre></li><li><p><strong><span>åŸå› </span></strong></p><p><span>JNIï¼ˆJava Native Interfaceï¼‰æ„ä¸º Java æœ¬åœ°è°ƒç”¨ï¼Œå®ƒå…è®¸ Java ä»£ç å’Œå…¶ä»–è¯­è¨€å†™çš„ Native ä»£ç è¿›è¡Œäº¤äº’ã€‚JNI å¦‚æœéœ€è¦è·å– JVM ä¸­çš„ String æˆ–è€…æ•°ç»„ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</span></p><ul><li><span>æ‹·è´ä¼ é€’</span></li><li><span>å…±äº«å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ï¼Œæ€§èƒ½æ›´é«˜</span></li></ul><p><span>ç”±äº Native ä»£ç ç›´æ¥ä½¿ç”¨äº† JVM å †åŒºçš„æŒ‡é’ˆï¼Œå¦‚æœè¿™æ—¶å‘ç”Ÿ GCï¼Œå°±ä¼šå¯¼è‡´æ•°æ®é”™è¯¯ã€‚å› æ­¤ï¼Œåœ¨å‘ç”Ÿæ­¤ç±» JNI è°ƒç”¨æ—¶ï¼Œç¦æ­¢ GC çš„å‘ç”Ÿï¼ŒåŒæ—¶é˜»æ­¢å…¶ä»–çº¿ç¨‹è¿›å…¥ JNI ä¸´ç•ŒåŒºï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹é€€å‡ºä¸´ç•ŒåŒºæ—¶è§¦å‘ä¸€æ¬¡ GCã€‚</span></p></li><li><p><strong><span>ç­–ç•¥</span></strong></p><ul><li><span>æ·»åŠ  </span><code>-XX+PrintJNIGCStalls</code><span> å‚æ•°ï¼Œå¯ä»¥æ‰“å°å‡ºå‘ç”Ÿ JNI è°ƒç”¨æ—¶çš„çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥åˆ†æï¼Œæ‰¾åˆ°å¼•å‘é—®é¢˜çš„ JNI è°ƒç”¨</span></li><li><span>JNI è°ƒç”¨éœ€è¦è°¨æ…ï¼Œä¸ä¸€å®šå¯ä»¥æå‡æ€§èƒ½ï¼Œåè€Œå¯èƒ½é€ æˆ GC é—®é¢˜</span></li><li><span>å‡çº§ JDK ç‰ˆæœ¬åˆ° 14ï¼Œé¿å… </span><a href='https://bugs.openjdk.java.net/browse/JDK-8048556'><span>JDK-8048556</span></a><span> å¯¼è‡´çš„é‡å¤ GC</span></li></ul></li></ul><p>&nbsp;</p><h1 id='jvmæ€§èƒ½è°ƒä¼˜'><span>JVMæ€§èƒ½è°ƒä¼˜</span></h1><h2 id='ç£ç›˜ä¸è¶³æ’æŸ¥'><span>ç£ç›˜ä¸è¶³æ’æŸ¥</span></h2><p><span>å…¶å®ï¼Œç£ç›˜ä¸è¶³æ’æŸ¥ç®—æ˜¯ç³»ç»Ÿã€ç¨‹åºå±‚é¢çš„é—®é¢˜æ’æŸ¥ï¼Œå¹¶ä¸ç®—æ˜¯JVMï¼Œä½†æ˜¯å¦ä¸€æ–¹é¢è€ƒè™‘è¿‡æ¥å°±æ˜¯ï¼Œç³»ç»Ÿç£ç›˜çš„ä¸è¶³ï¼Œä¹Ÿä¼šå¯¼è‡´JVMçš„è¿è¡Œå¼‚å¸¸ï¼Œæ‰€ä»¥ä¹ŸæŠŠç£ç›˜ä¸è¶³ç®—è¿›æ¥äº†ã€‚å¹¶ä¸”æ’æŸ¥ç£ç›˜ä¸è¶³ï¼Œæ˜¯æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å‡ ä¸ªå‘½ä»¤ï¼Œç„¶åå°±æ˜¯é€å±‚çš„æ’æŸ¥ï¼Œé¦–å…ˆç¬¬ä¸€ä¸ªå‘½ä»¤å°±æ˜¯</span><strong><span>df -h</span></strong><span>ï¼ŒæŸ¥è¯¢ç£ç›˜çš„çŠ¶æ€ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250540.jpg" referrerpolicy="no-referrer" alt="JVM-ç£ç›˜ä¸è¶³æ’æŸ¥"><span> </span></p><p><span>ä»ä¸Šé¢çš„æ˜¾ç¤ºä¸­å…¶ä¸­ç¬¬ä¸€è¡Œä½¿ç”¨çš„2.8Gæœ€å¤§ï¼Œç„¶åæ˜¯æŒ‚è½½åœ¨ </span><strong><span>/</span></strong><span> ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥</span><strong><span>cd /</span></strong><span>ã€‚ç„¶åé€šè¿‡æ‰§è¡Œï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">du <span class="cm-attribute">-sh</span> *</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>æŸ¥çœ‹å„ä¸ªæ–‡ä»¶çš„å¤§å°ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€å¤§çš„ï¼Œæˆ–è€…è¯´å­˜å‚¨é‡çº§å·®ä¸å¤šçš„å¹¶ä¸”éƒ½éå¸¸å¤§çš„æ–‡ä»¶ï¼ŒæŠŠé‚£äº›æ²¡ç”¨çš„å¤§æ–‡ä»¶åˆ é™¤å°±å¥½ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250543.jpg" referrerpolicy="no-referrer" alt="JVM-ç£ç›˜ä¸è¶³æ’æŸ¥-du-sh"><span> </span></p><p><span>ç„¶åï¼Œå°±æ˜¯ç›´æ¥cdåˆ°å¯¹åº”çš„ç›®å½•ä¹Ÿæ˜¯æ‰§è¡Œï¼šdu -sh *ï¼Œå°±è¿™æ ·ä¸€å±‚ä¸€å±‚çš„æ‰§è¡Œï¼Œæ‰¾åˆ°å¯¹åº”çš„æ²¡ç”¨çš„ï¼Œç„¶åæ–‡ä»¶åˆæ¯”è¾ƒå¤§çš„ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ã€‚</span></p><p>&nbsp;</p><h2 id='cpuè¿‡é«˜æ’æŸ¥'><span>CPUè¿‡é«˜æ’æŸ¥</span></h2><p><strong><span>æ’æŸ¥è¿‡ç¨‹</span></strong></p><ul><li><span>ä½¿ç”¨</span><code>top</code><span>æŸ¥æ‰¾è¿›ç¨‹id</span></li><li><span>ä½¿ç”¨</span><code>top -Hp &lt;pid&gt;</code><span>æŸ¥æ‰¾è¿›ç¨‹ä¸­è€—cpuæ¯”è¾ƒé«˜çš„çº¿ç¨‹id</span></li><li><span>ä½¿ç”¨</span><code>printf %x &lt;pid&gt;</code><span>å°†çº¿ç¨‹idåè¿›åˆ¶è½¬åå…­è¿›åˆ¶</span></li><li><span>ä½¿ç”¨</span><code>jstack -pid | grep -A 20 &lt;pid&gt;</code><span>è¿‡æ»¤å‡ºçº¿ç¨‹idé”å…³è”çš„æ ˆä¿¡æ¯</span></li><li><span>æ ¹æ®æ ˆä¿¡æ¯ä¸­çš„è°ƒç”¨é“¾å®šä½ä¸šåŠ¡ä»£ç </span></li></ul><p>&nbsp;</p><p><span>æ¡ˆä¾‹ä»£ç å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">CPUSoaring</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span> <span class="cm-variable">thread1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Runnable</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (;;){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"I am children-thread1"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },<span class="cm-string">"children-thread1"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">Thread</span> <span class="cm-variable">thread2</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Runnable</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (;;){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"I am children-thread2"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },<span class="cm-string">"children-thread2"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">thread1</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">thread2</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">err</span>.<span class="cm-variable">println</span>(<span class="cm-string">"I am is main thread!!!!!!!!"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 605px;"></div><div class="CodeMirror-gutters" style="display: none; height: 605px;"></div></div></div></pre><ul><li><p><span>ç¬¬ä¸€æ­¥ï¼šé¦–å…ˆé€šè¿‡</span><strong><span>top</span></strong><span>å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°idä¸º</span><strong><span>3806</span></strong><span>çš„è¿›ç¨‹æ‰€å çš„CPUæœ€é«˜ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250954.jpg" referrerpolicy="no-referrer" alt="CPUè¿‡é«˜æ’æŸ¥-top"></p></li><li><p><span>ç¬¬äºŒæ­¥ï¼šç„¶åé€šè¿‡</span><strong><span>top -Hp pid</span></strong><span>å‘½ä»¤ï¼Œæ‰¾åˆ°å ç”¨CPUæœ€é«˜çš„çº¿ç¨‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250960.jpg" referrerpolicy="no-referrer" alt="CPUè¿‡é«˜æ’æŸ¥-top-Hp-pid"></p></li><li><p><span>ç¬¬ä¸‰æ­¥ï¼šæ¥ç€é€šè¿‡ï¼š</span><strong><span>printf &#39;%x\n&#39; tid</span></strong><span>å‘½ä»¤å°†çº¿ç¨‹çš„tidè½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼šxidï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250983.jpg" referrerpolicy="no-referrer" alt="CPUè¿‡é«˜æ’æŸ¥-printf"></p></li><li><p><span>ç¬¬å››æ­¥ï¼šæœ€åé€šè¿‡ï¼š</span><strong><span>jstack pid|grep xid -A 30</span></strong><span>å‘½ä»¤å°±æ˜¯è¾“å‡ºçº¿ç¨‹çš„å †æ ˆä¿¡æ¯ï¼Œçº¿ç¨‹æ‰€åœ¨çš„ä½ç½®ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250992.jpg" referrerpolicy="no-referrer" alt="CPUè¿‡é«˜æ’æŸ¥-jstack"></p></li><li><p><span>ç¬¬äº”æ­¥ï¼šè¿˜å¯ä»¥é€šè¿‡</span><strong><span>jstack -l pid &gt; æ–‡ä»¶åç§°.txt</span></strong><span> å‘½ä»¤å°†çº¿ç¨‹å †æ ˆä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œçº¿ä¸‹æŸ¥çœ‹ã€‚</span></p><p><span>è¿™å°±æ˜¯ä¸€ä¸ªCPUé£™é«˜çš„æ’æŸ¥è¿‡ç¨‹ï¼Œç›®çš„å°±æ˜¯è¦</span><strong><span>æ‰¾åˆ°å ç”¨CPUæœ€é«˜çš„çº¿ç¨‹æ‰€åœ¨çš„ä½ç½®</span></strong><span>ï¼Œç„¶åå°±æ˜¯</span><strong><span>review</span></strong><span>ä½ çš„ä»£ç ï¼Œå®šä½åˆ°é—®é¢˜çš„æ‰€åœ¨ã€‚ä½¿ç”¨Arthasçš„å·¥å…·æ’æŸ¥ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œé¦–å…ˆè¦ä½¿ç”¨topå‘½ä»¤æ‰¾åˆ°å ç”¨CPUæœ€é«˜çš„Javaè¿›ç¨‹ï¼Œç„¶åä½¿ç”¨Arthasè¿›å…¥è¯¥è¿›ç¨‹å†…ï¼Œ</span><strong><span>ä½¿ç”¨dashboardå‘½ä»¤æ’æŸ¥å ç”¨CPUæœ€é«˜çš„çº¿ç¨‹ã€‚</span></strong><span>ï¼Œæœ€åé€šè¿‡</span><strong><span>thread</span></strong><span>å‘½ä»¤çº¿ç¨‹çš„ä¿¡æ¯ã€‚</span></p></li></ul><p>&nbsp;</p><h2 id='å†…å­˜æ‰“æ»¡æ’æŸ¥'><span>å†…å­˜æ‰“æ»¡æ’æŸ¥</span></h2><p><strong><span>æ’æŸ¥è¿‡ç¨‹</span></strong></p><ul><li><span>æŸ¥æ‰¾è¿›ç¨‹idï¼š</span><code>top -d 2 -c</code></li><li><span>æŸ¥çœ‹JVMå †å†…å­˜åˆ†é…æƒ…å†µï¼š</span><code>jmap -heap pid</code></li><li><span>æŸ¥çœ‹å ç”¨å†…å­˜æ¯”è¾ƒå¤šçš„å¯¹è±¡ï¼š</span><code>jmap -histo pid | head -n 100</code></li><li><span>æŸ¥çœ‹å ç”¨å†…å­˜æ¯”è¾ƒå¤šçš„å­˜æ´»å¯¹è±¡ï¼š</span><code>jmap -histo:live pid | head -n 100</code></li></ul><p>&nbsp;</p><p><strong><span>ç¤ºä¾‹</span></strong></p><ul><li><p><span>ç¬¬ä¸€æ­¥ï¼štop -d 2 -c </span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250997.png" referrerpolicy="no-referrer" alt="img"></p></li><li><p><span>ç¬¬äºŒæ­¥ï¼šjmap -heap 8338</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250001.png" referrerpolicy="no-referrer" alt="img"></p></li><li><p><span>ç¬¬ä¸‰æ­¥ï¼šå®šä½å ç”¨å†…å­˜æ¯”ä»·å¤šçš„å¯¹è±¡</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250170.png" referrerpolicy="no-referrer" alt="img"></p><p><span>è¿™é‡Œå°±èƒ½çœ‹åˆ°å¯¹è±¡ä¸ªæ•°ä»¥åŠå¯¹è±¡å¤§å°â€¦â€¦</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250165.png" referrerpolicy="no-referrer" alt="img"></p><p><span>è¿™é‡Œçœ‹åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®šä½åˆ°å…·ä½“å¯¹è±¡ï¼Œçœ‹çœ‹è¿™ä¸ªå¯¹è±¡åœ¨é‚£äº›åœ°æ–¹æœ‰ä½¿ç”¨ã€ä¸ºä½•ä¼šæœ‰å¤§é‡çš„å¯¹è±¡å­˜åœ¨ã€‚</span></p></li></ul><p>&nbsp;</p><h2 id='oomå¼‚å¸¸æ’æŸ¥'><span>OOMå¼‚å¸¸æ’æŸ¥</span></h2><p><span>OOMçš„å¼‚å¸¸æ’æŸ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆæœåŠ¡ä¸Šçº¿çš„æ—¶å€™ï¼Œè¦å…ˆè®¾ç½®è¿™ä¸¤ä¸ªå‚æ•°ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>HeapDumpOnOutOfMemoryError <span class="cm-attribute">-XX</span><span class="cm-def">:HeapDumpPath</span><span class="cm-operator">=</span><span class="cm-def">${ç›®å½•}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>æŒ‡å®šé¡¹ç›®å‡ºç°OOMå¼‚å¸¸çš„æ—¶å€™è‡ªåŠ¨å¯¼å‡ºå †è½¬å‚¨æ–‡ä»¶ï¼Œç„¶åé€šè¿‡å†…å­˜åˆ†æå·¥å…·ï¼ˆ</span><strong><span>Visual VM</span></strong><span>ï¼‰æ¥è¿›è¡Œçº¿ä¸‹çš„åˆ†æã€‚</span></p><p><span>é¦–å…ˆæˆ‘ä»¬æ¥èŠä¸€èŠï¼Œå“ªäº›åŸå› ä¼šå¯¼è‡´OOMå¼‚å¸¸ï¼Œç«™åœ¨JVMçš„åˆ†åŒºçš„è§’åº¦ï¼š</span></p><ul><li><strong><span>Javaå †</span></strong></li><li><strong><span>æ–¹æ³•åŒº</span></strong></li><li><strong><span>è™šæ‹Ÿæœºæ ˆ</span></strong></li><li><strong><span>æœ¬åœ°æ–¹æ³•æ ˆ</span></strong></li><li><strong><span>ç¨‹åºè®¡æ•°å™¨</span></strong></li><li><strong><span>ç›´æ¥å†…å­˜</span></strong></li></ul><p><span>åªæœ‰</span><strong><span>ç¨‹åºè®¡æ•°å™¨</span></strong><span>åŒºåŸŸä¸ä¼šå‡ºç°OOMï¼Œåœ¨Java 8åŠä»¥ä¸Šçš„</span><strong><span>å…ƒç©ºé—´</span></strong><span>ï¼ˆæœ¬åœ°å†…å­˜ï¼‰éƒ½ä¼šå‡ºç°OOMã€‚</span></p><p><span>è€Œç«™åœ¨ç¨‹åºä»£ç çš„è§’åº¦æ¥çœ‹ï¼Œæ€»ç»“äº†å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ä¼šå¯¼è‡´OOMå¼‚å¸¸ï¼š</span></p><ul><li><strong><span>å†…å­˜æ³„éœ²</span></strong></li><li><strong><span>å¯¹è±¡è¿‡å¤§ã€è¿‡å¤š</span></strong></li><li><strong><span>æ–¹æ³•è¿‡é•¿</span></strong></li><li><strong><span>è¿‡åº¦ä½¿ç”¨ä»£ç†æ¡†æ¶ï¼Œç”Ÿæˆå¤§é‡çš„ç±»ä¿¡æ¯</span></strong></li></ul><p><span>æ¥ä¸‹æ¥æˆ‘ä»¬å±‹æ¥çœ‹çœ‹OOMçš„æ’æŸ¥ï¼Œå‡ºç°OOMå¼‚å¸¸ådumpå‡ºäº†å †è½¬å‚¨æ–‡ä»¶ï¼Œç„¶åæ‰“å¼€jdkè‡ªå¸¦çš„Visual VMå·¥å…·ï¼Œå¯¼å…¥å †è½¬å‚¨æ–‡ä»¶ï¼Œé¦–å…ˆæˆ‘ä½¿ç”¨çš„OOMå¼‚å¸¸ä»£ç å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">ArrayList</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">List</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">OOM</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-keyword">class</span> <span class="cm-def">User</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">age</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">User</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">age</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">age</span> <span class="cm-operator">=</span> <span class="cm-variable">age</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">InterruptedException</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">User</span><span class="cm-operator">&gt;</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ArrayList</span><span class="cm-operator">&lt;&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-3">Integer</span>.<span class="cm-variable">MAX_VALUE</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">1000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">User</span> <span class="cm-variable">user</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">User</span>(<span class="cm-string">"zhangsan"</span><span class="cm-operator">+</span><span class="cm-variable">i</span>,<span class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">list</span>.<span class="cm-variable">add</span>(<span class="cm-variable">user</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 561px;"></div><div class="CodeMirror-gutters" style="display: none; height: 561px;"></div></div></div></pre><p><span>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯å¾€é›†åˆé‡Œé¢ä¸æ–­åœ°addå¯¹è±¡ï¼Œå¸¦å…¥å †è½¬å‚¨æ–‡ä»¶åï¼Œåœ¨ç±»å’Œå®ä¾‹é‚£æ å°±å¯ä»¥çœ‹åˆ°å®ä¾‹æœ€å¤šçš„ç±»ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250174.jpg" referrerpolicy="no-referrer" alt="OOMå¼‚å¸¸æ’æŸ¥-æŸ¥çœ‹å®ä¾‹æœ€å¤šçš„ç±»"></p><p><span>è¿™æ ·å°±æ‰¾åˆ°å¯¼è‡´OOMå¼‚å¸¸çš„ç±»ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æŸ¥çœ‹å¯¼è‡´OOMå¼‚å¸¸çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œæ‰¾åˆ°å¯¹åº”å¼‚å¸¸çš„ä»£ç æ®µã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250294.jpg" referrerpolicy="no-referrer" alt="OOMå¼‚å¸¸æ’æŸ¥-æŸ¥çœ‹å¼‚å¸¸ä»£ç "></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250784.jpg" referrerpolicy="no-referrer" alt="OOMå¼‚å¸¸æ’æŸ¥-æŸ¥çœ‹å¼‚å¸¸ä»£ç å †æ ˆ"></p><p><span>ä¸Šé¢çš„æ–¹æ³•æ˜¯æ’æŸ¥å·²ç»å‡ºç°äº†OOMå¼‚å¸¸çš„æ–¹æ³•ï¼Œè‚¯å®šæ˜¯é˜²çº¿çš„æœ€åä¸€æ­¥ï¼Œé‚£ä¹ˆåœ¨æ­¤ä¹‹å‰æ€ä¹ˆé˜²æ­¢å‡ºç°OOMå¼‚å¸¸å‘¢ï¼Ÿ</span></p><p><span>ä¸€èˆ¬å¤§å‚éƒ½ä¼šæœ‰è‡ªå·±çš„ç›‘æ§å¹³å°ï¼Œèƒ½å¤Ÿå®æ–½çš„</span><strong><span>ç›‘æ§æµ‹è¯•ç¯å¢ƒã€é¢„è§ˆç¯å¢ƒã€çº¿ä¸Šå®æ–½çš„æœåŠ¡å¥åº·çŠ¶å†µï¼ˆCPUã€å†…å­˜ï¼‰</span></strong><span> ç­‰ä¿¡æ¯ï¼Œå¯¹äºé¢‘ç¹GCï¼Œå¹¶ä¸”GCåå†…å­˜çš„å›æ”¶ç‡å¾ˆå·®çš„ï¼Œå°±è¦å¼•èµ·æˆ‘ä»¬çš„æ³¨æ„äº†ã€‚</span></p><p><span>å› ä¸ºä¸€èˆ¬æ–¹æ³•çš„é•¿åº¦åˆç†ï¼Œ95%ä»¥ä¸Šçš„å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»ï¼Œåœ¨</span><strong><span>Minor GC</span></strong><span>ååªå‰©å°‘é‡çš„å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨ä»£ç å±‚é¢ä¸Šåº”è¯¥é¿å…</span><strong><span>æ–¹æ³•è¿‡é•¿ã€å¤§å¯¹è±¡</span></strong><span>çš„ç°è±¡ã€‚</span></p><p><span>æ¯æ¬¡è‡ªå·±å†™å®Œä»£ç ï¼Œè‡ªå·±æ£€æŸ¥åï¼Œéƒ½å¯ä»¥æäº¤ç»™æ¯”è‡ªå·±é«˜çº§åˆ«çš„å·¥ç¨‹å¸ˆ</span><strong><span>review</span></strong><span>è‡ªå·±çš„ä»£ç ï¼Œå°±èƒ½åŠæ—¶çš„å‘ç°ä»£ç çš„é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šä»£ç æ²¡é—®é¢˜ï¼Œç™¾åˆ†ä¹‹ä¹åä»¥ä¸Šçš„é—®é¢˜éƒ½èƒ½é¿å…ï¼Œè¿™ä¹Ÿæ˜¯å¤§å‚æ³¨é‡ä»£ç è´¨é‡ï¼Œå¹¶ä¸”æ—¶åˆ»</span><strong><span>review</span></strong><span>ä»£ç çš„ä¹ æƒ¯ã€‚</span></p><p>&nbsp;</p><h2 id='jvisualvm-1'><span>Jvisualvm</span></h2><p><span>é¡¹ç›®é¢‘ç¹YGC ã€FGCé—®é¢˜æ’æŸ¥</span></p><h3 id='å†…å­˜é—®é¢˜'><span>å†…å­˜é—®é¢˜</span></h3><p><span>å¯¹è±¡å†…å­˜å ç”¨ã€å®ä¾‹ä¸ªæ•°ç›‘æ§</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250788.png" referrerpolicy="no-referrer" alt="img"></p><p><span>å¯¹è±¡å†…å­˜å ç”¨ã€å¹´é¾„å€¼ç›‘æ§</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250796.png" referrerpolicy="no-referrer" alt="img"></p><p><span>é€šè¿‡ä¸Šé¢ä¸¤å¼ å›¾å‘ç°è¿™äº›å¯¹è±¡å ç”¨å†…å­˜æ¯”è¾ƒå¤§è€Œä¸”å­˜æ´»æ—¶é—´ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸ï¼Œæ‰€ä»¥survivor ä¸­çš„ç©ºé—´è¢«è¿™äº›å¯¹è±¡å ç”¨ï¼Œè€Œå¦‚æœç¼“å­˜å†æ¬¡åˆ·æ–°åˆ™ä¼šåˆ›å»ºåŒæ ·å¤§å°å¯¹è±¡æ¥æ›¿æ¢è€æ•°æ®ï¼Œè¿™æ—¶å‘ç°edenå†…å­˜ç©ºé—´ä¸è¶³ï¼Œå°±ä¼šè§¦å‘yonggc å¦‚æœyonggc ç»“æŸåå‘ç°edenç©ºé—´è¿˜æ˜¯ä¸å¤Ÿåˆ™ä¼šç›´æ¥æ”¾åˆ°è€å¹´ä»£ï¼Œæ‰€ä»¥è¿™æ ·å°±äº§ç”Ÿäº†å¤§å¯¹è±¡çš„æå‰æ™‹å‡ï¼Œå¯¼è‡´fgcå¢åŠ â€¦â€¦</span></p><p><strong><span>ä¼˜åŒ–åŠæ³•</span></strong><span>ï¼šä¼˜åŒ–ä¸¤ä¸ªç¼“å­˜å¯¹è±¡ï¼Œå°†ç¼“å­˜å¯¹è±¡å¤§å°å‡å°ã€‚ä¼˜åŒ–ä¸€ä¸‹ä¸¤ä¸ªå¯¹è±¡ï¼Œç¼“å­˜å…³é”®ä¿¡æ¯ï¼</span></p><p>&nbsp;</p><h3 id='cpuè€—æ—¶é—®é¢˜æ’æŸ¥'><span>CPUè€—æ—¶é—®é¢˜æ’æŸ¥</span></h3><p><span>Cpuä½¿ç”¨è€—æ—¶ç›‘æ§ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250794.png" referrerpolicy="no-referrer" alt="img"></p><p><span>è€—æ—¶ã€è°ƒç”¨æ¬¡æ•°ç›‘æ§ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250802.png" referrerpolicy="no-referrer" alt="img"></p><p><span>ä»ä¸Šé¢ç›‘æ§å›¾å¯ä»¥çœ‹åˆ°ä¸»è¦è€—æ—¶è¿˜æ˜¯åœ¨ç½‘ç»œè¯·æ±‚ï¼Œæ²¡æœ‰çœ‹åˆ°å…·ä½“ä¸šåŠ¡ä»£ç æ¶ˆè€—è¿‡é”™cpuâ€¦â€¦</span></p><p>&nbsp;</p><h2 id='è°ƒä¼˜å †å†…å­˜åˆ†é…'><span>è°ƒä¼˜å †å†…å­˜åˆ†é…</span></h2><p><strong><span>åˆå§‹å †ç©ºé—´å¤§å°è®¾ç½®</span></strong></p><ul><li><span>ä½¿ç”¨ç³»ç»Ÿé»˜è®¤é…ç½®åœ¨ç³»ç»Ÿç¨³å®šè¿è¡Œä¸€æ®µæ—¶é—´åæŸ¥çœ‹è®°å½•å†…å­˜ä½¿ç”¨æƒ…å†µï¼šEdenã€survivor0 ã€survivor1 ã€oldã€metaspace</span></li><li><span>æŒ‰ç…§é€šç”¨æ³•åˆ™é€šè¿‡gcä¿¡æ¯åˆ†é…è°ƒæ•´å¤§å°ï¼Œæ•´ä¸ªå †å¤§å°æ˜¯Full GCåè€å¹´ä»£ç©ºé—´å ç”¨å¤§å°çš„3-4å€</span></li><li><span>è€å¹´ä»£å¤§å°ä¸ºFull GCåè€å¹´ä»£ç©ºé—´å ç”¨å¤§å°çš„2-3å€</span></li><li><span>æ–°ç”Ÿä»£å¤§å°ä¸ºFull GCåè€å¹´ä»£ç©ºé—´å ç”¨å¤§å°çš„1-1.5å€ </span></li><li><span>å…ƒæ•°æ®ç©ºé—´å¤§å°ä¸ºFull GCåå…ƒæ•°æ®ç©ºé—´å ç”¨å¤§å°çš„1.2-1.5å€</span></li></ul><p><span>æ´»è·ƒæ•°å¤§å°æ˜¯åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ç¨³å®šæ€æ—¶ï¼Œé•¿æœŸå­˜æ´»çš„å¯¹è±¡åœ¨javaå †ä¸­å ç”¨çš„ç©ºé—´å¤§å°ã€‚ä¹Ÿå°±æ˜¯åœ¨åº”ç”¨è¶‹äºç¨³å¤ªæ—¶FullGCä¹‹åJavaå †ä¸­å­˜æ´»å¯¹è±¡å ç”¨ç©ºé—´å¤§å°ã€‚ï¼ˆæ³¨æ„åœ¨jdk8ä¸­å°†jdk7ä¸­çš„æ°¸ä¹…ä»£æ”¹ä¸ºå…ƒæ•°æ®åŒºï¼Œmetaspace ä½¿ç”¨çš„ç‰©ç†å†…å­˜ï¼Œä¸å ç”¨å †å†…å­˜ï¼‰</span></p><p>&nbsp;</p><p><strong><span>å †å¤§å°è°ƒæ•´çš„ç€æ‰‹ç‚¹ã€åˆ†æç‚¹</span></strong></p><ul><li><span>ç»Ÿè®¡Minor GC æŒç»­æ—¶é—´</span></li><li><span>ç»Ÿè®¡Minor GC çš„æ¬¡æ•°</span></li><li><span>ç»Ÿè®¡Full GCçš„æœ€é•¿æŒç»­æ—¶é—´</span></li><li><span>ç»Ÿè®¡æœ€å·®æƒ…å†µä¸‹Full GCé¢‘ç‡</span></li><li><span>ç»Ÿè®¡GCæŒç»­æ—¶é—´å’Œé¢‘ç‡å¯¹ä¼˜åŒ–å †çš„å¤§å°æ˜¯ä¸»è¦ç€æ‰‹ç‚¹ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸šåŠ¡ç³»ç»Ÿå¯¹å»¶è¿Ÿå’Œååé‡çš„éœ€æ±‚ï¼Œåœ¨æŒ‰ç…§è¿™äº›åˆ†ææˆ‘ä»¬å¯ä»¥è¿›è¡Œå„ä¸ªåŒºå¤§å°çš„è°ƒæ•´</span></li></ul><p>&nbsp;</p><h2 id='å¹´è½»ä»£è°ƒä¼˜'><span>å¹´è½»ä»£è°ƒä¼˜</span></h2><p><strong><span>å¹´è½»ä»£è°ƒä¼˜è§„åˆ™</span></strong></p><ul><li><span>è€å¹´ä»£ç©ºé—´å¤§å°ä¸åº”è¯¥å°äºæ´»è·ƒæ•°å¤§å°1.5å€ã€‚è€å¹´ä»£ç©ºé—´å¤§å°åº”ä¸ºè€å¹´ä»£æ´»è·ƒæ•°2-3å€</span></li><li><span>æ–°ç”Ÿä»£ç©ºé—´è‡³å°‘ä¸ºjavaå †å†…å­˜å¤§å°çš„10% ã€‚æ–°ç”Ÿä»£ç©ºé—´å¤§å°åº”ä¸º1-1.5å€çš„è€å¹´ä»£æ´»è·ƒæ•°</span></li><li><span>åœ¨è°ƒå°å¹´è½»ä»£ç©ºé—´æ—¶åº”ä¿æŒè€å¹´ä»£ç©ºé—´ä¸å˜</span></li></ul><p>&nbsp;</p><p><span>MinorGCæ˜¯æ”¶é›†eden+from survivor åŒºåŸŸçš„ï¼Œå½“ä¸šåŠ¡ç³»ç»ŸåŒ€é€Ÿç”Ÿæˆå¯¹è±¡çš„æ—¶å€™å¦‚æœå¹´è½»å¸¦åˆ†é…å†…å­˜åå°ä¼šå‘ç”Ÿé¢‘ç¹çš„MinorGCï¼Œå¦‚æœåˆ†é…å†…å­˜è¿‡å¤§åˆ™ä¼šå¯¼è‡´MinorGCåœé¡¿æ—¶é—´è¿‡é•¿ï¼Œæ— æ³•æ»¡è¶³ä¸šåŠ¡å»¶è¿Ÿæ€§è¦æ±‚ã€‚æ‰€ä»¥æŒ‰ç…§å †åˆ†é…ç©ºé—´åˆ†é…ä¹‹ååˆ†ægcæ—¥å¿—ï¼Œçœ‹çœ‹MinorGCçš„é¢‘ç‡å’Œåœé¡¿æ—¶é—´æ˜¯å¦æ»¡è¶³ä¸šåŠ¡è¦æ±‚ã€‚</span></p><ul><li><strong><span>MinorGCé¢‘ç¹åŸå› </span></strong>
<span>MinorGC æ¯”è¾ƒé¢‘ç¹è¯´æ˜edenå†…å­˜åˆ†é…è¿‡å°ï¼Œåœ¨æ’å®šçš„å¯¹è±¡äº§å‡ºçš„æƒ…å†µä¸‹å¾ˆå¿«æ— ç©ºé—²ç©ºé—´æ¥å­˜æ”¾æ–°å¯¹è±¡æ‰€ä»¥äº§ç”Ÿäº†MinorGC,æ‰€ä»¥edenåŒºé—´éœ€è¦è°ƒå¤§ã€‚</span></li><li><strong><span>å¹´è½»ä»£å¤§å°è°ƒæ•´</span></strong>
<span>Edenè°ƒæ•´åˆ°å¤šå¤§é‚£ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹GCæ—¥å¿—æŸ¥çœ‹ä¸šåŠ¡å¤šé•¿æ—¶é—´å¡«æ»¡äº†edenç©ºé—´ï¼Œç„¶åæŒ‰ç…§ä¸šåŠ¡èƒ½æ‰¿å—çš„æ”¶é›†é¢‘ç‡æ¥è®¡ç®—edenç©ºé—´å¤§å°ã€‚æ¯”å¦‚edenç©ºé—´å¤§å°ä¸º128Mæ¯5ç§’æ”¶é›†ä¸€æ¬¡ï¼Œåˆ™æˆ‘ä»¬ä¸ºäº†è¾¾åˆ°10ç§’æ”¶é›†ä¸€æ¬¡åˆ™å¯ä»¥è°ƒå¤§edenç©ºé—´ä¸º256Mè¿™æ ·èƒ½é™ä½æ”¶é›†é¢‘ç‡ã€‚å¹´è½»ä»£è°ƒå¤§çš„åŒæ—¶ç›¸åº”çš„ä¹Ÿè¦è°ƒå¤§è€å¹´ä»£ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šå‡ºç°é¢‘ç¹çš„concurrent model  failed  ä»è€Œå¯¼è‡´Full GC ã€‚</span></li><li><strong><span>MinorGCåœé¡¿æ—¶é—´è¿‡é•¿</span></strong>
<span>MinorGC æ”¶é›†è¿‡ç¨‹æ˜¯è¦äº§ç”ŸSTWçš„ã€‚å¦‚æœå¹´è½»ä»£ç©ºé—´å¤ªå¤§ï¼Œåˆ™gcæ”¶é›†æ—¶è€—æ—¶æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬æŒ‰ä¸šåŠ¡å¯¹åœé¡¿çš„è¦æ±‚å‡å°‘å†…å­˜ï¼Œæ¯”å¦‚ç°åœ¨ä¸€æ¬¡MinorGC è€—æ—¶12.8æ¯«ç§’ï¼Œedenå†…å­˜å¤§å°192M ,æˆ‘ä»¬ä¸ºäº†å‡å°‘MinorGC è€—æ—¶æˆ‘ä»¬è¦å‡å°‘å†…å­˜ã€‚æ¯”å¦‚æˆ‘ä»¬MinorGC è€—æ—¶æ ‡å‡†ä¸º10æ¯«ç§’ï¼Œè¿™æ ·è€—æ—¶å‡å°‘16.6% åŒæ ·å¹´è½»ä»£å†…å­˜ä¹Ÿè¦å‡å°‘16.6% å³192*0.1661 = 31.89M ã€‚å¹´è½»ä»£å†…å­˜ä¸º192-31.89=160.11M,åœ¨å‡å°‘å¹´è½»ä»£å¤§å°ï¼Œè€Œè¦ä¿æŒè€å¹´ä»£å¤§å°ä¸å˜åˆ™è¦å‡å°‘å †å†…å­˜å¤§å°è‡³512-31.89=480.11M</span></li></ul><p>&nbsp;</p><p><span>å †å†…å­˜ï¼š512M å¹´è½»ä»£: 192M  æ”¶é›†11æ¬¡è€—æ—¶141æ¯«ç§’ 12.82æ¯«ç§’/æ¬¡</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250118.png" referrerpolicy="no-referrer" alt="img"></p><p><span>å †å†…å­˜ï¼š512M å¹´è½»ä»£ï¼š192M æ”¶é›†12æ¬¡è€—æ—¶151æ¯«ç§’   12.85æ¯«ç§’/æ¬¡</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250680.png" referrerpolicy="no-referrer" alt="img"></p><p><strong><span>æŒ‰ç…§ä¸Šé¢è®¡ç®—è°ƒä¼˜</span></strong>
<span>å †å†…å­˜ï¼š 480M å¹´è½»å¸¦ï¼š 160M æ”¶é›†14æ¬¡ è€—æ—¶154æ¯«ç§’  11æ¯«ç§’/æ¬¡ ç›¸æ¯”ä¹‹å‰çš„ 12.82æ¯«ç§’/æ¬¡ åœé¡¿æ—¶é—´å‡å°‘1.82æ¯«ç§’</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250685.png" referrerpolicy="no-referrer" alt="img"></p><p><strong><span>ä½†æ˜¯è¿˜æ²¡è¾¾åˆ°10æ¯«ç§’çš„è¦æ±‚ï¼Œç»§ç»­æŒ‰ç…§è¿™æ ·çš„é€»è¾‘è¿›è¡Œ  11-10=1 ï¼›1/11= 0.909 å³ 0.09 æ‰€ä»¥è€—æ—¶è¿˜è¦é™ä½9%ã€‚</span></strong>
<span>å¹´è½»ä»£å‡å°‘ï¼š160*0.09 = 14.545=14.55 M;  160-14.55 =145.45=145M </span>
<span>å †å¤§å°ï¼š 480-14.55 = 465.45=465M</span>
<span>ä½†æ˜¯åœ¨è¿™æ ·è°ƒæ•´åä½¿ç”¨jmap -heap æŸ¥çœ‹çš„æ—¶å€™å¹´è½»ä»£å¤§å°å’Œå®é™…é…ç½®æ•°æ®æœ‰å‡ºå…¥ï¼ˆå¹´è½»ä»£å¤§å°ä¸º150Må¤§äºé…ç½®çš„145Mï¼‰ï¼Œè¿™æ˜¯å› ä¸º-XX:NewRatio é»˜è®¤2 å³å¹´è½»ä»£å’Œè€å¹´ä»£1ï¼š2çš„å…³ç³»ï¼Œæ‰€ä»¥è¿™é‡Œå°†-XX:NewRatio è®¾ç½®ä¸º3 å³å¹´è½»ä»£ã€è€å¹´å¤§å°æ¯”ä¸º1ï¼š3 ï¼Œæœ€ç»ˆå †å†…å­˜å¤§å°ä¸ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250695.png" referrerpolicy="no-referrer" alt="img"></p><p><span>MinorGCè€—æ—¶ 159/16=9.93æ¯«ç§’</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250690.png" referrerpolicy="no-referrer" alt="img"></p><p><span>MinorGCè€—æ—¶ 185/18=10.277=10.28æ¯«ç§’</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250694.png" referrerpolicy="no-referrer" alt="img"></p><p><span>MinorGCè€—æ—¶ 205/20=10.25æ¯«ç§’</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250699.png" referrerpolicy="no-referrer" alt="img"></p><p><span>Ok è¿™æ ·MinorGCåœé¡¿æ—¶é—´è¿‡é•¿é—®é¢˜è§£å†³ï¼ŒMinorGCè¦ä¹ˆæ¯”è¾ƒé¢‘ç¹è¦ä¹ˆåœé¡¿æ—¶é—´æ¯”è¾ƒé•¿ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜å°±æ˜¯è°ƒæ•´å¹´è½»ä»£å¤§å°ï¼Œä½†æ˜¯è°ƒæ•´çš„æ—¶å€™è¿˜æ˜¯è¦éµå®ˆè¿™äº›è§„åˆ™ã€‚</span></p><p>&nbsp;</p><h2 id='è€å¹´ä»£è°ƒä¼˜'><span>è€å¹´ä»£è°ƒä¼˜</span></h2><p><span>æŒ‰ç…§åŒæ ·çš„æ€è·¯å¯¹è€å¹´ä»£è¿›è¡Œè°ƒä¼˜ï¼ŒåŒæ ·åˆ†æFullGC é¢‘ç‡å’Œåœé¡¿æ—¶é—´ï¼ŒæŒ‰ç…§ä¼˜åŒ–è®¾å®šçš„ç›®æ ‡è¿›è¡Œè€å¹´ä»£å¤§å°è°ƒæ•´ã€‚</span></p><p><strong><span>è€å¹´ä»£è°ƒä¼˜æµç¨‹</span></strong></p><ul><li><span>åˆ†ææ¯æ¬¡MinorGC ä¹‹åè€å¹´ä»£ç©ºé—´å ç”¨å˜åŒ–ï¼Œè®¡ç®—æ¯æ¬¡MinorGCä¹‹åæ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§å°</span></li><li><span>æŒ‰ç…§MinorGCé¢‘ç‡å’Œæ™‹å‡è€å¹´ä»£å¯¹è±¡å¤§å°è®¡ç®—æå‡ç‡å³æ¯ç§’é’Ÿèƒ½æœ‰å¤šå°‘å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£</span></li><li><span>FullGCä¹‹åç»Ÿè®¡è€å¹´ä»£ç©ºé—´è¢«å ç”¨å¤§å°è®¡ç®—è€å¹´å¸¦ç©ºé—²ç©ºé—´ï¼Œå†æŒ‰ç…§ç¬¬2éƒ¨è®¡ç®—çš„æ™‹å‡ç‡è®¡ç®—è¯¥è€å¹´ä»£ç©ºé—²ç©ºé—´å¤šä¹…ä¼šè¢«å¡«æ»¡è€Œå†æ¬¡å‘ç”ŸFullGCï¼ŒåŒæ ·è§‚å¯ŸFullGC æ—¥å¿—ä¿¡æ¯ï¼Œè®¡ç®—FullGCé¢‘ç‡ï¼Œå¦‚æœé¢‘ç‡è¿‡é«˜åˆ™å¯ä»¥å¢å¤§è€å¹´ä»£ç©ºé—´å¤§å°è€è§£å†³ï¼Œå¢å¤§è€å¹´ä»£ç©ºé—´å¤§å°åº”ä¿æŒå¹´è½»ä»£ç©ºé—´å¤§å°ä¸å˜</span></li><li><span>å¦‚æœåœ¨FullGC é¢‘ç‡æ»¡è¶³ä¼˜åŒ–ç›®æ ‡è€Œåœé¡¿æ—¶é—´æ¯”è¾ƒé•¿çš„æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨CMSã€G1æ”¶é›†å™¨ã€‚å¹¶å‘æ”¶é›†å‡å°‘åœé¡¿æ—¶é—´</span></li></ul><h2 id='æ ˆæº¢å‡º'><span>æ ˆæº¢å‡º</span></h2><p><span>æ ˆæº¢å‡ºå¼‚å¸¸çš„æ’æŸ¥ï¼ˆåŒ…æ‹¬</span><strong><span>è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ</span></strong><span>ï¼‰åŸºæœ¬å’ŒOOMçš„ä¸€åœºæ’æŸ¥æ˜¯ä¸€æ ·çš„ï¼Œå¯¼å‡ºå¼‚å¸¸çš„å †æ ˆä¿¡æ¯ï¼Œç„¶åä½¿ç”¨matæˆ–è€…Visual VMå·¥å…·è¿›è¡Œçº¿ä¸‹åˆ†æï¼Œæ‰¾åˆ°å‡ºç°å¼‚å¸¸çš„ä»£ç æˆ–è€…æ–¹æ³•ã€‚</span></p><p><span>å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ ˆæ‰€å…è®¸çš„å¤§å°æ—¶ï¼Œå°±ä¼šå‡ºç°</span><strong><span>StackOverflowError</span></strong><span>å¼‚å¸¸ï¼ŒäºŒä»ä»£ç çš„è§’åº¦æ¥çœ‹ï¼Œå¯¼è‡´çº¿ç¨‹è¯·æ±‚çš„æ·±åº¦è¿‡å¤§çš„åŸå› å¯èƒ½æœ‰ï¼š</span><strong><span>æ–¹æ³•æ ˆä¸­å¯¹è±¡è¿‡å¤§ï¼Œæˆ–è€…è¿‡å¤šï¼Œæ–¹æ³•è¿‡é•¿ä»è€Œå¯¼è‡´å±€éƒ¨å˜é‡è¡¨è¿‡å¤§ï¼Œè¶…è¿‡äº†-Xsså‚æ•°çš„è®¾ç½®</span></strong><span>ã€‚</span></p><p>&nbsp;</p><h2 id='æ­»é”æ’æŸ¥'><span>æ­»é”æ’æŸ¥</span></h2><p><span>æ­»é”çš„æ¡ˆä¾‹æ¼”ç¤ºçš„ä»£ç å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">DeadLock</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">lock1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">Object</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">lock2</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">Object</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Thread</span> <span class="cm-variable">a</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Lock1</span>(),<span class="cm-string">"DeadLock1"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Thread</span> <span class="cm-variable">b</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Lock2</span>(),<span class="cm-string">"DeadLock2"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">a</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">b</span>.<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Lock1</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Runnable</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">try</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span>(<span class="cm-atom">true</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">synchronized</span>(<span class="cm-variable">DeadLock</span>.<span class="cm-variable">lock1</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Waiting for lock2"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">3000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">synchronized</span>(<span class="cm-variable">DeadLock</span>.<span class="cm-variable">lock2</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Lock1 acquired lock1 and lock2 "</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}<span class="cm-keyword">catch</span>(<span class="cm-variable">Exception</span> <span class="cm-variable">e</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Lock2</span> <span class="cm-keyword">implements</span> <span class="cm-variable">Runnable</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-meta">@Override</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">try</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span>(<span class="cm-atom">true</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">synchronized</span>(<span class="cm-variable">DeadLock</span>.<span class="cm-variable">lock2</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Waiting for lock1"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">3000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">synchronized</span>(<span class="cm-variable">DeadLock</span>.<span class="cm-variable">lock1</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"Lock2 acquired lock1 and lock2"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}<span class="cm-keyword">catch</span>(<span class="cm-variable">Exception</span> <span class="cm-variable">e</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1080px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1080px;"></div></div></div></pre><p><span>ä¸Šé¢çš„ä»£ç éå¸¸çš„ç®€å•ï¼Œå°±æ˜¯ä¸¤ä¸ªç±»çš„å®ä¾‹ä½œä¸ºé”èµ„æºï¼Œç„¶ååˆ†åˆ«å¼€å¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸åŒé¡ºåºçš„å¯¹é”èµ„æºèµ„æºè¿›è¡ŒåŠ é”ï¼Œå¹¶ä¸”è·å–ä¸€ä¸ªé”èµ„æºåï¼Œç­‰å¾…ä¸‰ç§’ï¼Œæ˜¯ä¸ºäº†è®©å¦ä¸€ä¸ªçº¿ç¨‹æœ‰è¶³å¤Ÿçš„æ—¶é—´è·å–å¦ä¸€ä¸ªé”å¯¹è±¡ã€‚</span></p><p><span>è¿è¡Œä¸Šé¢çš„ä»£ç åï¼Œå°±ä¼šé™·å…¥æ­»é”çš„åƒµå±€ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250193.jpg" referrerpolicy="no-referrer" alt="æ­»é”æ’æŸ¥-æ­»é”è¿è¡Œç»“æœç¤ºä¾‹"></p><p><span>å¯¹äºæ­»é”çš„æ’æŸ¥ï¼Œè‹¥æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒæˆ–è€…æœ¬åœ°ï¼Œç›´æ¥å°±å¯ä»¥ä½¿ç”¨Visual VMè¿æ¥åˆ°è¯¥è¿›ç¨‹ï¼Œå¦‚ä¸‹ç•Œé¢å°±ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ­»é”çš„å­˜åœ¨</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250196.jpg" referrerpolicy="no-referrer" alt="æ­»é”æ’æŸ¥-æ£€æµ‹æ­»é”"></p><p><span>å¹¶ä¸”æŸ¥çœ‹çº¿ç¨‹çš„å †æ ˆä¿¡æ¯ã€‚å°±èƒ½çœ‹åˆ°å…·ä½“çš„æ­»é”çš„çº¿ç¨‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250205.jpg" referrerpolicy="no-referrer" alt="æ­»é”æ’æŸ¥-æŸ¥çœ‹çº¿ç¨‹å †æ ˆä¿¡æ¯"></p><p><span>çº¿ä¸Šçš„è¯å¯ä»¥ä¸Šç”¨Arthasä¹Ÿå¯ä»¥ä½¿ç”¨åŸå§‹çš„å‘½ä»¤è¿›è¡Œæ’æŸ¥ï¼ŒåŸå§‹å‘½ä»¤å¯ä»¥å…ˆä½¿ç”¨</span><strong><span>jps</span></strong><span>æŸ¥çœ‹å…·ä½“çš„Javaè¿›ç¨‹çš„IDï¼Œç„¶åå†é€šè¿‡</span><strong><span>jstack ID</span></strong><span>æŸ¥çœ‹è¿›ç¨‹çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œä»–ä¹Ÿä¼šè‡ªåŠ¨ç»™ä½ æç¤ºæœ‰æ­»é”çš„å­˜åœ¨ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250556.jpg" referrerpolicy="no-referrer" alt="æ­»é”æ’æŸ¥-jstackæŸ¥çœ‹çº¿ç¨‹å †æ ˆ"></p><p><span>Arthaså·¥å…·å¯ä»¥ä½¿ç”¨</span><strong><span>thread</span></strong><span>å‘½ä»¤æ’æŸ¥æ­»é”ï¼Œè¦å…³æ³¨çš„æ˜¯</span><strong><span>BLOCKED</span></strong><span>çŠ¶æ€çš„çº¿ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250566.jpg" referrerpolicy="no-referrer" alt="æ­»é”æ’æŸ¥-ArthasæŸ¥çœ‹æ­»é”"></p><p><span>å…·ä½“threadçš„è¯¦ç»†å‚æ•°å¯ä»¥å‚è€ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250569.jpg" referrerpolicy="no-referrer" alt="æ­»é”æ’æŸ¥-Threadè¯¦ç»†å‚æ•°"></p><p>&nbsp;</p><p><strong><span>å¦‚ä½•é¿å…æ­»é”</span></strong></p><p><span>ä¸Šé¢æˆ‘ä»¬èŠäº†å¦‚ä½•æ’æŸ¥æ­»é”ï¼Œä¸‹é¢æˆ‘ä»¬æ¥èŠä¸€èŠå¦‚ä½•é¿å…æ­»é”çš„å‘ç”Ÿï¼Œä»ä¸Šé¢çš„æ¡ˆä¾‹ä¸­å¯ä»¥å‘ç°ï¼Œæ­»é”çš„å‘ç”Ÿä¸¤ä¸ªçº¿ç¨‹åŒæ—¶éƒ½æŒæœ‰å¯¹æ–¹ä¸é‡Šæ”¾çš„èµ„æºè¿›å…¥åƒµå±€ã€‚æ‰€ä»¥ï¼Œåœ¨ä»£ç å±‚é¢ï¼Œè¦é¿å…æ­»é”çš„å‘ç”Ÿï¼Œä¸»è¦å¯ä»¥ä»ä¸‹é¢çš„å››ä¸ªæ–¹é¢è¿›è¡Œå…¥æ‰‹ï¼š</span></p><ul><li><strong><span>é¦–å…ˆé¿å…çº¿ç¨‹çš„å¯¹äºèµ„æºçš„åŠ é”é¡ºåºè¦ä¿æŒä¸€è‡´</span></strong></li><li><strong><span>å¹¶ä¸”è¦é¿å…åŒä¸€ä¸ªçº¿ç¨‹å¯¹å¤šä¸ªèµ„æºè¿›è¡Œèµ„æºçš„äº‰æŠ¢</span></strong></li><li><strong><span>å¦å¤–çš„è¯ï¼Œå¯¹äºå·²ç»è·å–åˆ°çš„é”èµ„æºï¼Œå°½é‡è®¾ç½®å¤±æ•ˆæ—¶é—´ï¼Œé¿å…å¼‚å¸¸ï¼Œæ²¡æœ‰é‡Šæ”¾é”èµ„æºï¼Œå¯ä»¥ä½¿ç”¨acquire() æ–¹æ³•åŠ é”æ—¶å¯æŒ‡å®š timeout å‚æ•°</span></strong></li><li><strong><span>æœ€åï¼Œå°±æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å·¥å…·æ£€æµ‹æ­»é”ï¼Œé¢„é˜²çº¿ä¸Šæ­»é”çš„å‘ç”Ÿ</span></strong></li></ul><p><span>æ­»é”çš„æ’æŸ¥å·²ç»è¯´å®Œäº†ï¼Œä¸Šé¢çš„åŸºæœ¬å°±æ˜¯é—®é¢˜çš„æ’æŸ¥ï¼Œä¹Ÿå¯ä»¥ç®—æ˜¯è°ƒä¼˜çš„ä¸€éƒ¨åˆ†å§ï¼Œä½†æ˜¯å¯¹äºJVMè°ƒä¼˜æ¥è¯´ï¼Œé‡å¤´æˆåº”è¯¥æ˜¯åœ¨</span><strong><span>Javaå †</span></strong><span>ï¼Œè¿™éƒ¨åˆ†çš„è°ƒä¼˜æ‰æ˜¯é‡ä¸­ä¹‹é‡ã€‚</span></p><p>&nbsp;</p><h2 id='è°ƒä¼˜å®æˆ˜'><span>è°ƒä¼˜å®æˆ˜</span></h2><p><span>ä¸Šé¢è¯´å®Œäº†è°ƒä¼˜çš„ç›®çš„å’Œè°ƒä¼˜çš„æŒ‡æ ‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥å®æˆ˜è°ƒä¼˜ï¼Œé¦–å…ˆå‡†å¤‡æˆ‘çš„æ¡ˆä¾‹ä»£ç ï¼Œå¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">ArrayList</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">List</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">OOM</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">static</span> <span class="cm-keyword">class</span> <span class="cm-def">User</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">age</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-variable">User</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">age</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">this</span>.<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">this</span>.<span class="cm-variable">age</span> <span class="cm-operator">=</span> <span class="cm-variable">age</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">InterruptedException</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">User</span><span class="cm-operator">&gt;</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ArrayList</span><span class="cm-operator">&lt;&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-3">Integer</span>.<span class="cm-variable">MAX_VALUE</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp; <span class="cm-variable">Tread</span>.<span class="cm-variable">sleep</span>(<span class="cm-number">1000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">System</span>.<span class="cm-variable">err</span>.<span class="cm-variable">println</span>(<span class="cm-variable">Thread</span>.<span class="cm-variable">currentThread</span>().<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">User</span> <span class="cm-variable">user</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">User</span>(<span class="cm-string">"zhangsan"</span><span class="cm-operator">+</span><span class="cm-variable">i</span>,<span class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">list</span>.<span class="cm-variable">add</span>(<span class="cm-variable">user</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 583px;"></div><div class="CodeMirror-gutters" style="display: none; height: 583px;"></div></div></div></pre><p><span>æ¡ˆä¾‹ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸æ–­çš„å¾€ä¸€ä¸ªé›†åˆé‡Œé‡Œé¢æ·»åŠ å¯¹è±¡ï¼Œé¦–å…ˆåˆæ¬¡æˆ‘ä»¬å¯åŠ¨çš„å‘½ä»¤ä¸ºï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">java &nbsp; <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDetails <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDateStamps <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseGCLogFileRotation <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintHeapAtGC <span class="cm-attribute">-XX</span><span class="cm-def">:NumberOfGCLogFiles</span><span class="cm-operator">=</span><span class="cm-number">5</span> <span class="cm-attribute">-XX</span><span class="cm-def">:GCLogFileSize</span><span class="cm-operator">=</span>50M <span class="cm-attribute">-Xloggc</span>:./logs/emps-gc-%t.log <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>HeapDumpOnOutOfMemoryError <span class="cm-attribute">-XX</span><span class="cm-def">:HeapDumpPath</span><span class="cm-operator">=</span>./logs/emps-heap.dump OOM</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 108px;"></div><div class="CodeMirror-gutters" style="display: none; height: 108px;"></div></div></div></pre><p><span>å°±æ˜¯çº¯ç²¹çš„è®¾ç½®äº†ä¸€äº›GCçš„æ‰“å°æ—¥å¿—ï¼Œç„¶åé€šè¿‡Visual VMæ¥çœ‹GCçš„æ˜¾ç¤ºå¦‚ä¸‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250576.jpg" referrerpolicy="no-referrer" alt="è°ƒä¼˜å®æˆ˜-VisualVMæŸ¥çœ‹GCæ˜¾ç¤º"></p><p><span>å¯ä»¥çœ‹åˆ°ä¸€æ®µæ—¶é—´åå‡ºç°4æ¬¡Minor GCï¼Œä½¿ç”¨çš„æ—¶é—´æ˜¯29.648msï¼Œå‘ç”Ÿä¸€æ¬¡Full GCä½¿ç”¨çš„æ—¶é—´æ˜¯41.944msã€‚</span></p><p><span>Minor GCéå¸¸é¢‘ç¹ï¼ŒFull GCä¹Ÿæ˜¯ï¼Œåœ¨çŸ­æ—¶é—´å†…å°±å‘ç”Ÿäº†å‡ æ¬¡ï¼Œè§‚å¯Ÿè¾“å‡ºçš„æ—¥å¿—å‘ç°ä»¥åŠVisual VMçš„æ˜¾ç¤ºæ¥çœ‹ï¼Œéƒ½æ˜¯å› ä¸ºå†…å­˜æ²¡æœ‰è®¾ç½®ï¼Œå¤ªå°ï¼Œå¯¼è‡´Minor GCé¢‘ç¹ã€‚</span></p><p><span>å› æ­¤ï¼Œæˆ‘ä»¬ç¬¬äºŒæ¬¡é€‚å½“çš„å¢å¤§Javaå †çš„å¤§å°ï¼Œè°ƒä¼˜è®¾ç½®çš„å‚æ•°ä¸ºï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">java <span class="cm-attribute">-Xmx2048m</span> <span class="cm-attribute">-Xms2048m</span> <span class="cm-attribute">-Xmn1024m</span> <span class="cm-attribute">-Xss256k</span> &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseConcMarkSweepGC &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDetails <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDateStamps <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseGCLogFileRotation <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintHeapAtGC <span class="cm-attribute">-XX</span><span class="cm-def">:NumberOfGCLogFiles</span><span class="cm-operator">=</span><span class="cm-number">5</span> <span class="cm-attribute">-XX</span><span class="cm-def">:GCLogFileSize</span><span class="cm-operator">=</span>50M <span class="cm-attribute">-Xloggc</span>:./logs/emps-gc-%t.log <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>HeapDumpOnOutOfMemoryError <span class="cm-attribute">-XX</span><span class="cm-def">:HeapDumpPath</span><span class="cm-operator">=</span>./logs/emps-heap.dump OOM</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 108px;"></div><div class="CodeMirror-gutters" style="display: none; height: 108px;"></div></div></div></pre><p><span>è§‚å¯Ÿä¸€æ®µæ—¶é—´åï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250270.jpg" referrerpolicy="no-referrer" alt="è°ƒä¼˜å®æˆ˜-ä¸€æ®µæ—¶é—´åVisualVMæŸ¥çœ‹GCæ˜¾ç¤º"></p><p><span>å¯ä»¥å‘ç°Minor GCæ¬¡æ•°æ˜æ˜¾ä¸‹é™ï¼Œä½†æ˜¯è¿˜æ˜¯å‘ç”Ÿäº†Full GCï¼Œæ ¹æ®æ‰“å°çš„æ—¥å¿—æ¥çœ‹ï¼Œæ˜¯å› ä¸ºå…ƒç©ºé—´çš„å†…å­˜ä¸è¶³ï¼Œçœ‹äº†ä¸Šé¢çš„Visual VMå…ƒç©ºé—´çš„å†…å­˜å›¾ï¼Œä¹Ÿæ˜¯ä¸€æ ·ï¼ŒåŸºæœ¬éƒ½åˆ°é¡¶äº†ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250275.jpg" referrerpolicy="no-referrer" alt="è°ƒä¼˜å®æˆ˜-å…ƒç©ºé—´ä¸è¶³"></p><p><span>å› æ­¤ç¬¬ä¸‰æ¬¡å¯¹äºå…ƒç©ºé—´çš„åŒºåŸŸè®¾ç½®å¤§ä¸€äº›ï¼Œå¹¶ä¸”å°†GCå›æ”¶å™¨æ¢æˆæ˜¯CMSçš„ï¼Œè®¾ç½®çš„å‚æ•°å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">java <span class="cm-attribute">-Xmx2048m</span> <span class="cm-attribute">-Xms2048m</span> <span class="cm-attribute">-Xmn1024m</span> <span class="cm-attribute">-Xss256k</span> <span class="cm-attribute">-XX</span><span class="cm-def">:MetaspaceSize</span><span class="cm-operator">=</span>100m <span class="cm-attribute">-XX</span><span class="cm-def">:MaxMetaspaceSize</span><span class="cm-operator">=</span>100m <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseConcMarkSweepGC &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDetails <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDateStamps <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseGCLogFileRotation <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintHeapAtGC <span class="cm-attribute">-XX</span><span class="cm-def">:NumberOfGCLogFiles</span><span class="cm-operator">=</span><span class="cm-number">5</span> <span class="cm-attribute">-XX</span><span class="cm-def">:GCLogFileSize</span><span class="cm-operator">=</span>50M <span class="cm-attribute">-Xloggc</span>:./logs/emps-gc-%t.log <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>HeapDumpOnOutOfMemoryError <span class="cm-attribute">-XX</span><span class="cm-def">:HeapDumpPath</span><span class="cm-operator">=</span>./logs/emps-heap.dump OOM</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="display: none; height: 130px;"></div></div></div></pre><p><span>è§‚å¯Ÿç›¸åŒçš„æ—¶é—´åï¼ŒVisual VMçš„æ˜¾ç¤ºå›¾å¦‚ä¸‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250276.jpg" referrerpolicy="no-referrer" alt="è°ƒä¼˜å®æˆ˜-å…ƒç©ºé—´è°ƒååVisualVMæŸ¥çœ‹GCæ˜¾ç¤º"></p><p><span>åŒæ ·çš„æ—¶é—´ï¼Œä¸€æ¬¡Minor GCå’ŒFull GCéƒ½æ²¡æœ‰å‘ç”Ÿï¼Œæ‰€ä»¥è¿™æ ·æˆ‘è§‰å¾—ä¹Ÿç®—æ˜¯å·²ç»è°ƒä¼˜äº†ã€‚</span></p><p><span>ä½†æ˜¯è°ƒä¼˜å¹¶ä¸æ˜¯ä¸€å‘³çš„è°ƒå¤§å†…å­˜ï¼Œæ˜¯è¦åœ¨å„ä¸ªåŒºåŸŸä¹‹é—´å–å¾—å¹³è¡¡ï¼Œå¯ä»¥é€‚å½“çš„è°ƒå¤§å†…å­˜ï¼Œä»¥åŠæ›´æ¢GCç§ç±»ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“æŠŠä¸Šé¢çš„æ¡ˆä¾‹ä»£ç çš„Thread.sleep(1000)ç»™å»æ‰ã€‚</span></p><p><span>ç„¶åå†æ¥çœ‹Visual VMçš„å›¾ï¼Œå¦‚ä¸‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250283.jpg" referrerpolicy="no-referrer" alt="è°ƒä¼˜å®æˆ˜-å»æ‰çº¿ç¨‹ä¼‘çœ VisualVMæ˜¾ç¤º"></p><p><span>å¯ä»¥çœ‹åˆ°Minor GCä¹Ÿæ˜¯éå¸¸é¢‘ç¹çš„ï¼Œå› ä¸ºè¿™æ®µä»£ç æœ¬èº«å°±æ˜¯ä¸æ–­çš„å¢å¤§å†…å­˜ï¼Œç›´åˆ°OOMå¼‚å¸¸ï¼ŒçœŸæ­£çš„å®é™…å¹¶ä¸ä¼šè¿™æ ·ï¼Œå¯èƒ½å½“å†…å­˜å¢å¤§åˆ°ä¸€å®šä¸¤çº§åï¼Œå°±ä¼šåœ¨ä¸€æ®µèŒƒå›´å¹³è¡¡ã€‚</span></p><p><span>å½“æˆ‘ä»¬å°†ä¸Šé¢çš„æƒ…å†µï¼Œå†é€‚å½“çš„å¢å¤§å†…å­˜ï¼ŒJVMå‚æ•°å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">java <span class="cm-attribute">-Xmx4048m</span> <span class="cm-attribute">-Xms4048m</span> <span class="cm-attribute">-Xmn2024m</span> <span class="cm-attribute">-XX</span><span class="cm-def">:SurvivorRatio</span><span class="cm-operator">=</span><span class="cm-number">7</span> &nbsp;<span class="cm-attribute">-Xss256k</span> <span class="cm-attribute">-XX</span><span class="cm-def">:MetaspaceSize</span><span class="cm-operator">=</span>300m <span class="cm-attribute">-XX</span><span class="cm-def">:MaxMetaspaceSize</span><span class="cm-operator">=</span>100m <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseConcMarkSweepGC &nbsp;<span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDetails <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintGCDateStamps <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>UseGCLogFileRotation <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>PrintHeapAtGC <span class="cm-attribute">-XX</span><span class="cm-def">:NumberOfGCLogFiles</span><span class="cm-operator">=</span><span class="cm-number">5</span> <span class="cm-attribute">-XX</span><span class="cm-def">:GCLogFileSize</span><span class="cm-operator">=</span>50M <span class="cm-attribute">-Xloggc</span>:./logs/emps-gc-%t.log <span class="cm-attribute">-XX</span>:<span class="cm-operator">+</span>HeapDumpOnOutOfMemoryError <span class="cm-attribute">-XX</span><span class="cm-def">:HeapDumpPath</span><span class="cm-operator">=</span>./logs/emps-heap.dump OOM</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 151px;"></div><div class="CodeMirror-gutters" style="display: none; height: 151px;"></div></div></div></pre><p><span>å¯ä»¥çœ‹åˆ°ç›¸åŒæ—¶é—´å†…ï¼Œç¡®å®Minor GCå‡å°‘äº†ï¼Œä½†æ˜¯æ—¶é—´å¢å¤§äº†ï¼Œå› ä¸ºå¤åˆ¶ç®—æ³•ï¼ŒåŸºæœ¬éƒ½æ˜¯å­˜æ´»çš„ï¼Œå¤åˆ¶éœ€è¦è€—è´¹å¤§é‡çš„æ€§èƒ½å’Œæ—¶é—´ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250286.jpg" referrerpolicy="no-referrer" alt="è°ƒä¼˜å®æˆ˜-å‡å°‘MinorGCåVisualVMæ˜¾ç¤º"></p><p><span>æ‰€ä»¥ï¼Œè°ƒä¼˜è¦æœ‰å–èˆï¼Œå–å¾—ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œæ€§èƒ½ã€çŠ¶æ€è¾¾åˆ°ä½³å°±OKäº†ï¼Œå¹¶æ²¡æœ€ä½³çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯è°ƒä¼˜çš„åŸºæœ¬æ³•åˆ™ï¼Œè€Œä¸”è°ƒä¼˜ä¹Ÿæ˜¯ä¸€ä¸ªç»†æ´»ï¼Œæ‰€è°“æ…¢å·¥å‡ºç»†æ´»ï¼Œéœ€è¦è€—è´¹å¤§é‡çš„æ—¶é—´ï¼Œæ…¢æ…¢è°ƒï¼Œä¸æ–­çš„åšå¯¹æ¯”ã€‚</span></p><p>&nbsp;</p><h2 id='è°ƒä¼˜å‚æ•°'><span>è°ƒä¼˜å‚æ•°</span></h2><h3 id='å †'><span>å †</span></h3><ul><li><span>-Xms1024m è®¾ç½®å †çš„åˆå§‹å¤§å°</span></li><li><span>-Xmx1024m è®¾ç½®å †çš„æœ€å¤§å¤§å°</span></li><li><span>-XX:NewSize=1024m è®¾ç½®å¹´è½»ä»£çš„åˆå§‹å¤§å°</span></li><li><span>-XX:MaxNewSize=1024m è®¾ç½®å¹´è½»ä»£çš„æœ€å¤§å€¼</span></li><li><span>-XX:SurvivorRatio=8 Edenå’ŒSåŒºçš„æ¯”ä¾‹</span></li><li><span>-XX:NewRatio=4 è®¾ç½®è€å¹´ä»£å’Œæ–°ç”Ÿä»£çš„æ¯”ä¾‹</span></li><li><span>-XX:MaxTenuringThreshold=10 è®¾ç½®æ™‹å‡è€å¹´ä»£çš„å¹´é¾„æ¡ä»¶</span></li></ul><p>&nbsp;</p><h3 id='æ ˆ'><span>æ ˆ</span></h3><ul><li><span>-Xss128k</span></li></ul><p>&nbsp;</p><h3 id='å…ƒç©ºé—´'><span>å…ƒç©ºé—´</span></h3><ul><li><span>-XX:MetasapceSize=200m è®¾ç½®åˆå§‹å…ƒç©ºé—´å¤§å°</span></li><li><span>-XX:MaxMatespaceSize=200m è®¾ç½®æœ€å¤§å…ƒç©ºé—´å¤§å° é»˜è®¤æ— é™åˆ¶</span></li></ul><p>&nbsp;</p><h3 id='ç›´æ¥å†…å­˜'><span>ç›´æ¥å†…å­˜</span></h3><ul><li><span>-XX:MaxDirectMemorySize è®¾ç½®ç›´æ¥å†…å­˜çš„å®¹é‡ï¼Œé»˜è®¤ä¸å †æœ€å¤§å€¼ä¸€æ ·</span></li></ul><p>&nbsp;</p><h3 id='æ—¥å¿—'><span>æ—¥å¿—</span></h3><ul><li><span>-Xloggc:/opt/app/ard-user/ard-user-gc-%t.log   è®¾ç½®æ—¥å¿—ç›®å½•å’Œæ—¥å¿—åç§°</span></li><li><span>-XX:+UseGCLogFileRotation           å¼€å¯æ»šåŠ¨ç”Ÿæˆæ—¥å¿—</span></li><li><span>-XX:NumberOfGCLogFiles=5            æ»šåŠ¨GCæ—¥å¿—æ–‡ä»¶æ•°ï¼Œé»˜è®¤0ï¼Œä¸æ»šåŠ¨</span></li><li><span>-XX:GCLogFileSize=20M               GCæ–‡ä»¶æ»šåŠ¨å¤§å°ï¼Œéœ€å¼€ UseGCLogFileRotation</span></li><li><span>-XX:+PrintGCDetails      å¼€å¯è®°å½•GCæ—¥å¿—è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬GCç±»å‹ã€å„ä¸ªæ“ä½œä½¿ç”¨çš„æ—¶é—´ï¼‰,å¹¶ä¸”åœ¨ç¨‹åºè¿è¡Œç»“æŸæ‰“å°å‡ºJVMçš„å†…å­˜å ç”¨æƒ…å†µ</span></li><li><span>-XX:+ PrintGCDateStamps             è®°å½•ç³»ç»Ÿçš„GCæ—¶é—´</span></li><li><span>-XX:+PrintGCCause                   äº§ç”ŸGCçš„åŸå› (é»˜è®¤å¼€å¯)</span></li></ul><p>&nbsp;</p><h3 id='gc-2'><span>GC</span></h3><h4 id='serialåƒåœ¾æ”¶é›†å™¨æ–°ç”Ÿä»£ï¼‰'><span>Serialåƒåœ¾æ”¶é›†å™¨ï¼ˆæ–°ç”Ÿä»£ï¼‰</span></h4><p><span>å¼€å¯</span></p><ul><li><span>-XX:+UseSerialGC</span></li></ul><p><span>å…³é—­ï¼š</span></p><ul><li><span>-XX:-UseSerialGC //æ–°ç”Ÿä»£ä½¿ç”¨Serial  è€å¹´ä»£åˆ™ä½¿ç”¨SerialOld</span></li></ul><p>&nbsp;</p><h4 id='parallel-scavengeæ”¶é›†å™¨æ–°ç”Ÿä»£ï¼‰å¼€å¯'><span>Parallel Scavengeæ”¶é›†å™¨ï¼ˆæ–°ç”Ÿä»£ï¼‰å¼€å¯</span></h4><ul><li><span>-XX:+UseParallelOldGC å…³é—­</span></li><li><span>-XX:-UseParallelOldGC  æ–°ç”Ÿä»£ä½¿ç”¨åŠŸèƒ½Parallel Scavenge è€å¹´ä»£å°†ä¼šä½¿ç”¨Parallel Oldæ”¶é›†å™¨</span></li></ul><p>&nbsp;</p><h4 id='parallelolåƒåœ¾æ”¶é›†å™¨è€å¹´ä»£ï¼‰å¼€å¯'><span>ParallelOlåƒåœ¾æ”¶é›†å™¨ï¼ˆè€å¹´ä»£ï¼‰å¼€å¯</span></h4><ul><li><span>-XX:+UseParallelGC å…³é—­</span></li><li><span>-XX:-UseParallelGC æ–°ç”Ÿä»£ä½¿ç”¨åŠŸèƒ½Parallel Scavenge è€å¹´ä»£å°†ä¼šä½¿ç”¨Parallel Oldæ”¶é›†å™¨</span></li></ul><p>&nbsp;</p><h4 id='parnewåƒåœ¾æ”¶é›†å™¨æ–°ç”Ÿä»£ï¼‰å¼€å¯'><span>ParNewåƒåœ¾æ”¶é›†å™¨ï¼ˆæ–°ç”Ÿä»£ï¼‰å¼€å¯</span></h4><ul><li><span>-XX:+UseParNewGC å…³é—­</span></li><li><span>-XX:-UseParNewGC //æ–°ç”Ÿä»£ä½¿ç”¨åŠŸèƒ½ParNew è€å¹´ä»£åˆ™ä½¿ç”¨åŠŸèƒ½CMS</span></li></ul><p>&nbsp;</p><h4 id='cmsåƒåœ¾æ”¶é›†å™¨è€å¹´ä»£ï¼‰å¼€å¯'><span>CMSåƒåœ¾æ”¶é›†å™¨ï¼ˆè€å¹´ä»£ï¼‰å¼€å¯</span></h4><ul><li><span>-XX:+UseConcMarkSweepGC å…³é—­</span></li><li><span>-XX:-UseConcMarkSweepGC</span></li><li><span>-XX:MaxGCPauseMillis  GCåœé¡¿æ—¶é—´ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šå°è¯•ç”¨å„ç§æ‰‹æ®µè¾¾åˆ°è¿™ä¸ªæ—¶é—´ï¼Œæ¯”å¦‚å‡å°å¹´è½»ä»£</span></li><li><span>-XX:+UseCMSCompactAtFullCollection ç”¨äºåœ¨CMSæ”¶é›†å™¨ä¸å¾—ä¸è¿›è¡ŒFullGCæ—¶å¼€å¯å†…å­˜ç¢ç‰‡çš„åˆå¹¶æ•´ç†è¿‡ç¨‹ï¼Œç”±äºè¿™ä¸ªå†…å­˜æ•´ç†å¿…é¡»ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œï¼ˆåœ¨Shenandoahå’ŒZGCå‡ºç°å‰ï¼‰æ˜¯æ— æ³•å¹¶å‘çš„</span></li><li><span>-XXï¼šCMSFullGCsBefore-Compaction å¤šå°‘æ¬¡FullGCä¹‹åå‹ç¼©ä¸€æ¬¡ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºæ¯æ¬¡è¿›å…¥FullGCæ—¶éƒ½è¿›è¡Œç¢ç‰‡æ•´ç†ï¼‰</span></li><li><span>-XX:CMSInitiatingOccupancyFraction å½“è€å¹´ä»£ä½¿ç”¨è¾¾åˆ°è¯¥æ¯”ä¾‹æ—¶ä¼šè§¦å‘FullGCï¼Œé»˜è®¤æ˜¯92</span></li><li><span>-XX:+UseCMSInitiatingOccupancyOnly è¿™ä¸ªå‚æ•°æ­é…ä¸Šé¢é‚£ä¸ªç”¨ï¼Œè¡¨ç¤ºæ˜¯ä¸æ˜¯è¦ä¸€ç›´ä½¿ç”¨ä¸Šé¢çš„æ¯”ä¾‹è§¦å‘FullGCï¼Œå¦‚æœè®¾ç½®åˆ™åªä¼šåœ¨ç¬¬ä¸€æ¬¡FullGCçš„æ—¶å€™ä½¿ç”¨-XX:CMSInitiatingOccupancyFractionçš„å€¼ï¼Œä¹‹åä¼šè¿›è¡Œè‡ªåŠ¨è°ƒæ•´</span></li><li><span>-XX:+CMSScavengeBeforeRemark åœ¨FullGCå‰å¯åŠ¨ä¸€æ¬¡MinorGCï¼Œç›®çš„åœ¨äºå‡å°‘è€å¹´ä»£å¯¹å¹´è½»ä»£çš„å¼•ç”¨ï¼Œé™ä½CMSGCçš„æ ‡è®°é˜¶æ®µæ—¶çš„å¼€é”€ï¼Œä¸€èˆ¬CMSçš„GCè€—æ—¶80%éƒ½åœ¨æ ‡è®°é˜¶æ®µ</span></li><li><span>-XX:+CMSParallellnitialMarkEnabled é»˜è®¤æƒ…å†µä¸‹åˆå§‹æ ‡è®°æ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥è®©ä»–å¤šçº¿ç¨‹æ‰§è¡Œï¼Œå¯ä»¥å‡å°‘STW</span></li><li><span>-XX:+CMSParallelRemarkEnabled ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œé‡æ–°æ ‡è®°ï¼Œç›®çš„ä¹Ÿæ˜¯ä¸ºäº†å‡å°‘STW</span></li></ul><p>&nbsp;</p><h4 id='g1åƒåœ¾æ”¶é›†å™¨å¼€å¯'><span>G1åƒåœ¾æ”¶é›†å™¨å¼€å¯</span></h4><ul><li><span>-XX:+UseG1GC å…³é—­</span></li><li><span>-XX:-UseG1GC</span></li><li><span>-XXï¼šG1HeapRegionSize è®¾ç½®æ¯ä¸ªRegionçš„å¤§å°ï¼Œå–å€¼èŒƒå›´ä¸º1MBï½32MB</span></li><li><span>-XXï¼šMaxGCPauseMillis è®¾ç½®åƒåœ¾æ”¶é›†å™¨çš„åœé¡¿æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯200æ¯«ç§’ï¼Œé€šå¸¸æŠŠæœŸæœ›åœé¡¿æ—¶é—´è®¾ç½®ä¸ºä¸€ä¸¤ç™¾æ¯«ç§’æˆ–è€…ä¸¤ä¸‰ç™¾æ¯«ç§’ä¼šæ˜¯æ¯”è¾ƒåˆç†çš„</span></li></ul><p>&nbsp;</p><h1 id='jdk-tools'><span>JDK Tools</span></h1><h2 id='jps'><span>jps</span></h2><p><span>ç”¨äºæ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¸‹çš„æ‰€æœ‰javaè¿›ç¨‹ä¿¡æ¯ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># jps [options] [hostid] </span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># q:ä»…è¾“å‡ºVMæ ‡è¯†ç¬¦, m: è¾“å‡ºmain methodçš„å‚æ•°,l:è¾“å‡ºå®Œå…¨çš„åŒ…å, v:è¾“å‡ºjvmå‚æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[root@localhost ~]<span class="cm-comment"># jps -l</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">28729</span> sun.tools.jps.Jps</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">23789</span> cn.ms.test.DemoMain</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">23651</span> cn.ms.test.TestMain</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 151px;"></div><div class="CodeMirror-gutters" style="display: none; height: 151px;"></div></div></div></pre><p>&nbsp;</p><h2 id='jstat'><span>jstat</span></h2><p><span>ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯ï¼ˆç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ï¼‰ï¼š</span></p><p><strong><span>-gc</span></strong><span>ï¼šåƒåœ¾å›æ”¶ç»Ÿè®¡ï¼ˆå¤§å°ï¼‰</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ¯éš”2000msè¾“å‡º&lt;pid&gt;è¿›ç¨‹çš„gcæƒ…å†µï¼Œä¸€å…±è¾“å‡º2æ¬¡</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[root@localhost ~]<span class="cm-comment"># jstat -gc &lt;pid&gt; 2000 2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ¯éš”2sè¾“å‡º&lt;pid&gt;è¿›ç¨‹çš„gcæƒ…å†µï¼Œæ¯ä¸ª3æ¡è®°å½•å°±æ‰“å°éšè—åˆ—æ ‡é¢˜</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[root@localhost ~]<span class="cm-comment"># jstat -gc -t -h3 &lt;pid&gt; 2s</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Timestamp &nbsp; &nbsp; &nbsp;  S0C &nbsp;  S1C &nbsp;  S0U &nbsp;  S1U &nbsp;  ... YGC &nbsp; &nbsp; YGCT &nbsp;  FGC &nbsp;  FGCT &nbsp; &nbsp; GCT &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">1021</span>.6 <span class="cm-number">1024</span>.0 <span class="cm-number">1024</span>.0 &nbsp;<span class="cm-number">0</span>.0 &nbsp; <span class="cm-number">1024</span>.0  ... &nbsp;<span class="cm-number">1</span> &nbsp; &nbsp;<span class="cm-number">0</span>.012 &nbsp; <span class="cm-number">0</span> &nbsp; &nbsp; &nbsp;<span class="cm-number">0</span>.000 &nbsp; &nbsp;<span class="cm-number">0</span>.012</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">1023</span>.7 <span class="cm-number">1024</span>.0 <span class="cm-number">1024</span>.0 &nbsp;<span class="cm-number">0</span>.0 &nbsp; <span class="cm-number">1024</span>.0  ... &nbsp;<span class="cm-number">1</span> &nbsp; &nbsp;<span class="cm-number">0</span>.012 &nbsp; <span class="cm-number">0</span> &nbsp; &nbsp; &nbsp;<span class="cm-number">0</span>.000 &nbsp; &nbsp;<span class="cm-number">0</span>.012</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">1025</span>.7 <span class="cm-number">1024</span>.0 <span class="cm-number">1024</span>.0 &nbsp;<span class="cm-number">0</span>.0 &nbsp; <span class="cm-number">1024</span>.0  ... &nbsp;<span class="cm-number">1</span> &nbsp; &nbsp;<span class="cm-number">0</span>.012 &nbsp; <span class="cm-number">0</span> &nbsp; &nbsp; &nbsp;<span class="cm-number">0</span>.000 &nbsp; &nbsp;<span class="cm-number">0</span>.012</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Timestamp &nbsp; &nbsp; &nbsp;  S0C &nbsp;  S1C &nbsp;  S0U &nbsp;  S1U &nbsp;  ... YGC &nbsp; &nbsp; YGCT &nbsp;  FGC &nbsp;  FGCT &nbsp; &nbsp; GCT &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">1027</span>.7 <span class="cm-number">1024</span>.0 <span class="cm-number">1024</span>.0 &nbsp;<span class="cm-number">0</span>.0 &nbsp; <span class="cm-number">1024</span>.0  ... &nbsp;<span class="cm-number">1</span> &nbsp; &nbsp;<span class="cm-number">0</span>.012 &nbsp; <span class="cm-number">0</span> &nbsp; &nbsp; &nbsp;<span class="cm-number">0</span>.000 &nbsp; &nbsp;<span class="cm-number">0</span>.012</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">1029</span>.7 <span class="cm-number">1024</span>.0 <span class="cm-number">1024</span>.0 &nbsp;<span class="cm-number">0</span>.0 &nbsp; <span class="cm-number">1024</span>.0  ... &nbsp;<span class="cm-number">1</span> &nbsp; &nbsp;<span class="cm-number">0</span>.012 &nbsp; <span class="cm-number">0</span> &nbsp; &nbsp; &nbsp;<span class="cm-number">0</span>.000 &nbsp; &nbsp;<span class="cm-number">0</span>.012</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç»“æœè¯´æ˜: Cå³Capacity æ€»å®¹é‡ï¼ŒUå³Used å·²ä½¿ç”¨çš„å®¹é‡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##########################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># S0Cï¼šå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># S1Cï¼šå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># S0Uï¼šå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># S1Uï¼šå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ECï¼šå¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># EUï¼šå¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># OCï¼šOldä»£çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># OUï¼šOldä»£ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># PCï¼šPerm(æŒä¹…ä»£)çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># PUï¼šPerm(æŒä¹…ä»£)ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># YGCï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ¬¡æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># YGCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ‰€ç”¨æ—¶é—´(s)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># FGCï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ¬¡æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># FGCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ‰€ç”¨æ—¶é—´(s)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># GCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶gcç”¨çš„æ€»æ—¶é—´(s)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 756px;"></div><div class="CodeMirror-gutters" style="display: none; height: 756px;"></div></div></div></pre><p><strong><span>-gcutil</span></strong><span>ï¼šåƒåœ¾å›æ”¶ç»Ÿè®¡ï¼ˆç™¾åˆ†æ¯”ï¼‰</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[root@localhost bin]<span class="cm-comment"># jstat -gcutil &lt;pid&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  S0 &nbsp; &nbsp; S1 &nbsp; &nbsp; E &nbsp; &nbsp;  O &nbsp; &nbsp;  M &nbsp; &nbsp; CCS &nbsp;  YGC &nbsp; &nbsp; YGCT &nbsp;  FGC &nbsp;  FGCT &nbsp; &nbsp; GCT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">0</span>.00 &nbsp;<span class="cm-number">99</span>.80 &nbsp;<span class="cm-number">16</span>.21 &nbsp;<span class="cm-number">26</span>.18 &nbsp;<span class="cm-number">93</span>.34 &nbsp;<span class="cm-number">90</span>.74 &nbsp; &nbsp; &nbsp;<span class="cm-number">9</span> &nbsp; &nbsp;<span class="cm-number">0</span>.056 &nbsp; &nbsp; <span class="cm-number">2</span> &nbsp; &nbsp;<span class="cm-number">0</span>.045 &nbsp; &nbsp;<span class="cm-number">0</span>.102</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç»“æœè¯´æ˜</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##########################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># S0ï¼šå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># S1ï¼šå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Eï¼šå¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Oï¼šoldä»£å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Pï¼špermä»£å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># YGCï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ¬¡æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># YGCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ‰€ç”¨æ—¶é—´(s)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># FGCï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ¬¡æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># FGCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ‰€ç”¨æ—¶é—´(s)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># GCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶gcç”¨çš„æ€»æ—¶é—´(s)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 367px;"></div><div class="CodeMirror-gutters" style="display: none; height: 367px;"></div></div></div></pre><p><strong><span>-gccapacity</span></strong><span>ï¼šå †å†…å­˜ç»Ÿè®¡</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[root@localhost ~]<span class="cm-comment"># jstat -gccapacity &lt;pid&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> NGCMN &nbsp;  NGCMX &nbsp; &nbsp; NGC &nbsp; &nbsp; S0C &nbsp; S1C &nbsp; &nbsp; &nbsp; EC &nbsp; &nbsp;  OGCMN &nbsp; &nbsp;  OGCMX &nbsp; &nbsp; &nbsp; OGC &nbsp; &nbsp; &nbsp; &nbsp; OC &nbsp; &nbsp;  PGCMN &nbsp;  PGCMX &nbsp; &nbsp; PGC &nbsp; &nbsp; &nbsp; PC &nbsp; &nbsp; YGC &nbsp;  FGC </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-number">84480</span>.0 <span class="cm-number">1349632</span>.0 <span class="cm-number">913408</span>.0 <span class="cm-number">54272</span>.0 <span class="cm-number">51200</span>.0 <span class="cm-number">502784</span>.0 &nbsp; <span class="cm-number">168448</span>.0 &nbsp;<span class="cm-number">2699264</span>.0 &nbsp; <span class="cm-number">168448</span>.0 &nbsp; <span class="cm-number">168448</span>.0 &nbsp;<span class="cm-number">21504</span>.0 &nbsp;<span class="cm-number">83968</span>.0 &nbsp;<span class="cm-number">51712</span>.0 &nbsp;<span class="cm-number">51712</span>.0 &nbsp; &nbsp; &nbsp;<span class="cm-number">9</span> &nbsp; &nbsp; <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç»“æœè¯´æ˜</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##########################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># NGCMNï¼šå¹´è½»ä»£(young)ä¸­åˆå§‹åŒ–(æœ€å°)çš„å¤§å° (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># NGCMXï¼šå¹´è½»ä»£(young)çš„æœ€å¤§å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># NGCï¼šå¹´è½»ä»£(young)ä¸­å½“å‰çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># S0Cï¼šå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># S1Cï¼šå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ECï¼šå¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># OGCMNï¼šoldä»£ä¸­åˆå§‹åŒ–(æœ€å°)çš„å¤§å° (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># OGCMXï¼šoldä»£çš„æœ€å¤§å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># OGCï¼šoldä»£å½“å‰æ–°ç”Ÿæˆçš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># OCï¼šOldä»£çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># PGCMNï¼špermä»£ä¸­åˆå§‹åŒ–(æœ€å°)çš„å¤§å° (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># PGCMXï¼špermä»£çš„æœ€å¤§å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># PGCï¼špermä»£å½“å‰æ–°ç”Ÿæˆçš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># PCï¼šPerm(æŒä¹…ä»£)çš„å®¹é‡ (kb)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># YGCï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ¬¡æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># GCTï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶gcç”¨çš„æ€»æ—¶é—´(s)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 540px;"></div><div class="CodeMirror-gutters" style="display: none; height: 540px;"></div></div></div></pre><p><strong><span>-gccause</span></strong><span>ï¼šåƒåœ¾æ”¶é›†ç»Ÿè®¡æ¦‚è¿°ï¼ˆåŒ-gcutilï¼‰ï¼Œé™„åŠ æœ€è¿‘ä¸¤æ¬¡åƒåœ¾å›æ”¶äº‹ä»¶çš„åŸå› </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[root@localhost ~]<span class="cm-comment"># jstat -gccause &lt;pid&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  S0 &nbsp; &nbsp; S1 &nbsp; &nbsp; E &nbsp; &nbsp;  O &nbsp; &nbsp;  P &nbsp; &nbsp; YGC &nbsp; &nbsp; YGCT &nbsp;  FGC &nbsp;  FGCT &nbsp; &nbsp; GCT &nbsp;  LGCC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GCC &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">0</span>.00 &nbsp;<span class="cm-number">79</span>.23 &nbsp;<span class="cm-number">39</span>.37 &nbsp;<span class="cm-number">39</span>.92 &nbsp;<span class="cm-number">99</span>.74 &nbsp; &nbsp; &nbsp;<span class="cm-number">9</span> &nbsp; &nbsp;<span class="cm-number">0</span>.198 &nbsp; &nbsp; <span class="cm-number">0</span> &nbsp; &nbsp;<span class="cm-number">0</span>.000 &nbsp; &nbsp;<span class="cm-number">0</span>.198 Allocation Failure &nbsp; No GC</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç»“æœè¯´æ˜</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##########################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># LGCCï¼šæœ€è¿‘åƒåœ¾å›æ”¶çš„åŸå› </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># GCCï¼šå½“å‰åƒåœ¾å›æ”¶çš„åŸå› </span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 194px;"></div><div class="CodeMirror-gutters" style="display: none; height: 194px;"></div></div></div></pre><p>&nbsp;</p><h2 id='jstack'><span>jstack</span></h2><p><span>jstack(Java Stack Trace)ä¸»è¦ç”¨äºæ‰“å°çº¿ç¨‹çš„å †æ ˆä¿¡æ¯ï¼Œæ˜¯JDKè‡ªå¸¦çš„å¾ˆå¼ºå¤§çš„çº¿ç¨‹åˆ†æå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ’æŸ¥ç¨‹åºè¿è¡Œæ—¶çš„çº¿ç¨‹çŠ¶æ€ã€æ­»é”çŠ¶æ€ç­‰ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># dumpå‡ºè¿›ç¨‹&lt;pid&gt;çš„çº¿ç¨‹å †æ ˆå¿«ç…§è‡³/data/1.logæ–‡ä»¶ä¸­</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">jstack <span class="cm-attribute">-l</span> &lt;pid&gt; &gt;/data/1.log</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å‚æ•°è¯´æ˜ï¼š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># -Fï¼šå¦‚æœæ­£å¸¸æ‰§è¡Œjstackå‘½ä»¤æ²¡æœ‰å“åº”ï¼ˆæ¯”å¦‚è¿›ç¨‹hungä½äº†ï¼‰ï¼Œå¯ä»¥åŠ ä¸Šæ­¤å‚æ•°å¼ºåˆ¶æ‰§è¡Œthread dump</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># -mï¼šé™¤äº†æ‰“å°Javaçš„æ–¹æ³•è°ƒç”¨æ ˆä¹‹å¤–ï¼Œè¿˜ä¼šè¾“å‡ºnativeæ–¹æ³•çš„æ ˆå¸§</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># -lï¼šæ‰“å°ä¸é”æœ‰å…³çš„é™„åŠ ä¿¡æ¯ã€‚ä½¿ç”¨æ­¤å‚æ•°ä¼šå¯¼è‡´JVMåœæ­¢æ—¶é—´å˜é•¿ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒéœ€æ…ç”¨</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 194px;"></div><div class="CodeMirror-gutters" style="display: none; height: 194px;"></div></div></div></pre><p><span>jstack dumpæ–‡ä»¶ä¸­å€¼å¾—å…³æ³¨çš„çº¿ç¨‹çŠ¶æ€æœ‰ï¼š</span></p><ul><li><p><strong><span>æ­»é”ï¼ˆDeadlockï¼‰ â€”â€” é‡ç‚¹å…³æ³¨</span></strong></p></li><li><p><span>æ‰§è¡Œä¸­ï¼ˆRunnableï¼‰  </span></p></li><li><p><strong><span>ç­‰å¾…èµ„æºï¼ˆWaiting on conditionï¼‰ â€”â€” é‡ç‚¹å…³æ³¨</span></strong></p><ul><li><span>ç­‰å¾…æŸä¸ªèµ„æºæˆ–æ¡ä»¶å‘ç”Ÿæ¥å”¤é†’è‡ªå·±ã€‚å…·ä½“éœ€ç»“åˆjstacktraceæ¥åˆ†æï¼Œå¦‚çº¿ç¨‹æ­£åœ¨sleepï¼Œç½‘ç»œè¯»å†™ç¹å¿™è€Œç­‰å¾…</span></li><li><span>å¦‚æœå¤§é‡çº¿ç¨‹åœ¨â€œwaiting on conditionâ€ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…ç½‘ç»œèµ„æºï¼Œå¯èƒ½æ˜¯ç½‘ç»œç“¶é¢ˆçš„å¾å…†</span></li></ul></li><li><p><strong><span>ç­‰å¾…è·å–ç›‘è§†å™¨ï¼ˆWaiting on monitor entryï¼‰ â€”â€” é‡ç‚¹å…³æ³¨</span></strong></p><ul><li><span>å¦‚æœå¤§é‡çº¿ç¨‹åœ¨â€œwaiting for monitor entryâ€ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå…¨å±€é”é˜»å¡ä½äº†å¤§é‡çº¿ç¨‹</span></li></ul></li><li><p><span>æš‚åœï¼ˆSuspendedï¼‰</span></p></li><li><p><span>å¯¹è±¡ç­‰å¾…ä¸­ï¼ˆObject.wait() æˆ– TIMED_WAITINGï¼‰</span></p></li><li><p><strong><span>é˜»å¡ï¼ˆBlockedï¼‰ â€”â€” é‡ç‚¹å…³æ³¨</span></strong></p></li><li><p><span>åœæ­¢ï¼ˆParkedï¼‰</span></p></li></ul><p>&nbsp;</p><p><strong><span>æ³¨æ„</span></strong><span>ï¼šå¦‚æœæŸä¸ªç›¸åŒçš„call stackç»å¸¸å‡ºç°ï¼Œ æˆ‘ä»¬æœ‰80%çš„ä»¥ä¸Šçš„ç†ç”±ç¡®å®šè¿™ä¸ªä»£ç å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼ˆè¯»ç½‘ç»œçš„éƒ¨åˆ†é™¤å¤–ï¼‰ã€‚</span></p><p>&nbsp;</p><p><strong><span>åœºæ™¯ä¸€ï¼šåˆ†æBLOCKEDé—®é¢˜</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"RMI TCP Connection(267865)-172.16.5.25"</span> daemon <span class="cm-def">prio</span><span class="cm-operator">=</span><span class="cm-number">10</span> <span class="cm-def">tid</span><span class="cm-operator">=</span>0x00007fd508371000 <span class="cm-def">nid</span><span class="cm-operator">=</span>0x55ae waiting <span class="cm-keyword">for</span> monitor entry [0x00007fd4f8684000]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; java.lang.Thread.State: BLOCKED (on object monitor)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">at org.apache.log4j.Category.callAppenders(Category.java:201)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">-</span> waiting to lock &lt;0x00000000acf4d0c0&gt; (a org.apache.log4j.Logger)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">at org.apache.log4j.Category.forcedLog(Category.java:388)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">at org.apache.log4j.Category.log(Category.java:853)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">at org.apache.commons.logging.impl.Log4JLogger.warn(Log4JLogger.java:234)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">at com.tuan.core.common.lang.cache.remote.SpyMemcachedClient.get(SpyMemcachedClient.java:110)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 302px;"></div><div class="CodeMirror-gutters" style="display: none; height: 302px;"></div></div></div></pre><ul><li><span>çº¿ç¨‹çŠ¶æ€æ˜¯ Blockedï¼Œé˜»å¡çŠ¶æ€ã€‚è¯´æ˜çº¿ç¨‹ç­‰å¾…èµ„æºè¶…æ—¶</span></li><li><span>â€œ waiting to lock &lt;0x00000000acf4d0c0&gt;â€æŒ‡ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…ç»™è¿™ä¸ª 0x00000000acf4d0c0 åœ°å€ä¸Šé”ï¼ˆè‹±æ–‡å¯æè¿°ä¸ºï¼štrying to obtain  0x00000000acf4d0c0 lockï¼‰</span></li><li><span>åœ¨ dump æ—¥å¿—é‡ŒæŸ¥æ‰¾å­—ç¬¦ä¸² 0x00000000acf4d0c0ï¼Œå‘ç°æœ‰å¤§é‡çº¿ç¨‹éƒ½åœ¨ç­‰å¾…ç»™è¿™ä¸ªåœ°å€ä¸Šé”ã€‚å¦‚æœèƒ½åœ¨æ—¥å¿—é‡Œæ‰¾åˆ°è°è·å¾—äº†è¿™ä¸ªé”ï¼ˆå¦‚locked &lt; 0x00000000acf4d0c0 &gt;ï¼‰ï¼Œå°±å¯ä»¥é¡ºè—¤æ‘¸ç“œäº†</span></li><li><span>â€œwaiting for monitor entryâ€è¯´æ˜æ­¤çº¿ç¨‹é€šè¿‡ synchronized(obj) {â€¦â€¦} ç”³è¯·è¿›å…¥äº†ä¸´ç•ŒåŒºï¼Œä»è€Œè¿›å…¥äº†ä¸‹å›¾1ä¸­çš„â€œEntry Setâ€é˜Ÿåˆ—ï¼Œä½†è¯¥ obj å¯¹åº”çš„ monitor è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼Œæ‰€ä»¥æœ¬çº¿ç¨‹åœ¨ Entry Set é˜Ÿåˆ—ä¸­ç­‰å¾…</span></li><li><span>ç¬¬ä¸€è¡Œé‡Œï¼Œ&quot;RMI TCP Connection(267865)-172.16.5.25&quot;æ˜¯ Thread Name ã€‚tidæŒ‡Java Thread idã€‚nidæŒ‡nativeçº¿ç¨‹çš„idã€‚prioæ˜¯çº¿ç¨‹ä¼˜å…ˆçº§ã€‚[0x00007fd4f8684000]æ˜¯çº¿ç¨‹æ ˆèµ·å§‹åœ°å€ã€‚</span></li></ul><p>&nbsp;</p><p><strong><span>åœºæ™¯äºŒï¼šåˆ†æCPUè¿‡é«˜é—®é¢˜</span></strong></p><p><span>1.topå‘½ä»¤æ‰¾å‡ºæœ€é«˜å ç”¨çš„è¿›ç¨‹ï¼ˆShift+Pï¼‰</span></p><p><span>2.æŸ¥çœ‹é«˜è´Ÿè½½è¿›ç¨‹ä¸‹çš„é«˜è´Ÿè½½çº¿ç¨‹ï¼ˆtop -Hp </span><PID><span>æˆ–ps -mp </span><PID><span> -o THREAD,tid,timeï¼‰</span></p><p><span>3.æ‰¾å‡ºæœ€é«˜å ç”¨çš„çº¿ç¨‹å¹¶è®°å½•thread_idï¼ŒæŠŠçº¿ç¨‹å·è¿›è¡Œæ¢ç®—æˆ16è¿›åˆ¶ç¼–å·ï¼ˆprintf &quot;%X\n&quot; thread_idï¼‰</span></p><p><span>4.ï¼ˆå¯é€‰ï¼‰æ‰§è¡ŒæŸ¥çœ‹é«˜è´Ÿè½½çš„çº¿ç¨‹åç§°ï¼ˆjstack 16143 | grep 3fb6ï¼‰</span></p><p><span>5.å¯¼å‡ºè¿›ç¨‹çš„å †æ ˆæ—¥å¿—ï¼Œæ‰¾åˆ°3fb6 è¿™ä¸ªçº¿ç¨‹å·ï¼ˆjstack 16143 &gt;/home/16143.logï¼‰</span></p><p><span>6.æ ¹æ®æ‰¾åˆ°çš„å †æ ˆä¿¡æ¯å…³è”åˆ°ä»£ç è¿›è¡Œå®šä½åˆ†æå³å¯</span></p><p>&nbsp;</p><h2 id='jmap'><span>jmap</span></h2><p><span>jmap(Java Memory Map)ä¸»è¦ç”¨äºæ‰“å°å†…å­˜æ˜ å°„ã€‚å¸¸ç”¨å‘½ä»¤ï¼š</span></p><p><code>jmap -dump:live,format=b,file=xxx.hprof &lt;pid&gt;</code></p><p><strong><span>æŸ¥çœ‹JVMå †æ ˆçš„ä½¿ç”¨æƒ…å†µ</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">root</span><span class="cm-variable-2">@localhost</span> <span class="cm-error">~</span><span class="cm-punctuation">]</span><span class="cm-comment"># jmap -heap 7243</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Attaching</span> <span class="cm-identifier">to</span> <span class="cm-keyword">process</span> <span class="cm-identifier">ID</span> <span class="cm-number">27900</span><span class="cm-punctuation">,</span> <span class="cm-identifier">please</span> <span class="cm-identifier">wait</span><span class="cm-operator">..</span><span class="cm-punctuation">.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Debugger</span> <span class="cm-identifier">attached</span> <span class="cm-identifier">successfully</span><span class="cm-punctuation">.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Client</span> <span class="cm-identifier">compiler</span> <span class="cm-identifier">detected</span><span class="cm-punctuation">.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">JVM</span> <span class="cm-identifier">version</span> <span class="cm-identifier">is</span> <span class="cm-number">20.45</span><span class="cm-operator">-</span><span class="cm-identifier">b01</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">using</span> <span class="cm-identifier">thread-local</span> <span class="cm-identifier">object</span> <span class="cm-identifier">allocation</span><span class="cm-punctuation">.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Mark</span> <span class="cm-identifier">Sweep</span> <span class="cm-identifier">Compact</span> <span class="cm-builtin">GC</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Heap</span> <span class="cm-identifier">Configuration</span><span class="cm-operator">:</span> <span class="cm-comment">#å †å†…å­˜åˆå§‹åŒ–é…ç½®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">MinHeapFreeRatio</span> <span class="cm-operator">=</span> <span class="cm-number">40</span> &nbsp; &nbsp; <span class="cm-comment">#-XX:MinHeapFreeRatioè®¾ç½®JVMå †æœ€å°ç©ºé—²æ¯”ç‡ &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">MaxHeapFreeRatio</span> <span class="cm-operator">=</span> <span class="cm-number">70</span> &nbsp; <span class="cm-comment">#-XX:MaxHeapFreeRatioè®¾ç½®JVMå †æœ€å¤§ç©ºé—²æ¯”ç‡ &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">MaxHeapSize</span> <span class="cm-operator">=</span> <span class="cm-number">100663296</span> <span class="cm-punctuation">(</span><span class="cm-number">96.0MB</span><span class="cm-punctuation">)</span> &nbsp; <span class="cm-comment">#-XX:MaxHeapSize=è®¾ç½®JVMå †çš„æœ€å¤§å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">NewSize</span> <span class="cm-operator">=</span> <span class="cm-number">1048576</span> <span class="cm-punctuation">(</span><span class="cm-number">1.0MB</span><span class="cm-punctuation">)</span> &nbsp; &nbsp; <span class="cm-comment">#-XX:NewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„é»˜è®¤å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">MaxNewSize</span> <span class="cm-operator">=</span> <span class="cm-number">4294901760</span> <span class="cm-punctuation">(</span><span class="cm-number">4095.9375MB</span><span class="cm-punctuation">)</span> <span class="cm-comment">#-XX:MaxNewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„æœ€å¤§å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">OldSize</span> <span class="cm-operator">=</span> <span class="cm-number">4194304</span> <span class="cm-punctuation">(</span><span class="cm-number">4.0MB</span><span class="cm-punctuation">)</span> &nbsp;<span class="cm-comment">#-XX:OldSize=è®¾ç½®JVMå †çš„â€˜è€ç”Ÿä»£â€™çš„å¤§å°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">NewRatio</span> <span class="cm-operator">=</span> <span class="cm-number">2</span> &nbsp; &nbsp;<span class="cm-comment">#-XX:NewRatio=:â€˜æ–°ç”Ÿä»£â€™å’Œâ€˜è€ç”Ÿä»£â€™çš„å¤§å°æ¯”ç‡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">SurvivorRatio</span> <span class="cm-operator">=</span> <span class="cm-number">8</span> &nbsp;<span class="cm-comment">#-XX:SurvivorRatio=è®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">PermSize</span> <span class="cm-operator">=</span> <span class="cm-number">12582912</span> <span class="cm-punctuation">(</span><span class="cm-number">12.0MB</span><span class="cm-punctuation">)</span> <span class="cm-comment">#-XX:PermSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜æŒä¹…ä»£â€™çš„åˆå§‹å¤§å° &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">MaxPermSize</span> <span class="cm-operator">=</span> <span class="cm-number">67108864</span> <span class="cm-punctuation">(</span><span class="cm-number">64.0MB</span><span class="cm-punctuation">)</span> <span class="cm-comment">#-XX:MaxPermSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜æŒä¹…ä»£â€™çš„æœ€å¤§å¤§å° &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Heap</span> <span class="cm-identifier">Usage</span><span class="cm-operator">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">New</span> <span class="cm-identifier">Generation</span> <span class="cm-punctuation">(</span><span class="cm-identifier">Eden</span> <span class="cm-operator">+</span> <span class="cm-number">1</span> <span class="cm-identifier">Survivor</span> <span class="cm-identifier">Space</span><span class="cm-punctuation">)</span><span class="cm-operator">:</span> <span class="cm-comment">#æ–°ç”Ÿä»£åŒºå†…å­˜åˆ†å¸ƒï¼ŒåŒ…å«ä¼Šç”¸å›­åŒº+1ä¸ªSurvivoråŒº</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">capacity</span> <span class="cm-operator">=</span> <span class="cm-number">30212096</span> <span class="cm-punctuation">(</span><span class="cm-number">28.8125MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">used</span> <span class="cm-operator">=</span> <span class="cm-number">27103784</span> <span class="cm-punctuation">(</span><span class="cm-number">25.848182678222656MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">free</span> <span class="cm-operator">=</span> <span class="cm-number">3108312</span> <span class="cm-punctuation">(</span><span class="cm-number">2.9643173217773438MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">89.71169693092462</span><span class="cm-operator">%</span> <span class="cm-identifier">used</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Eden</span> <span class="cm-identifier">Space</span><span class="cm-operator">:</span> <span class="cm-comment">#EdenåŒºå†…å­˜åˆ†å¸ƒ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">capacity</span> <span class="cm-operator">=</span> <span class="cm-number">26869760</span> <span class="cm-punctuation">(</span><span class="cm-number">25.625MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">used</span> <span class="cm-operator">=</span> <span class="cm-number">26869760</span> <span class="cm-punctuation">(</span><span class="cm-number">25.625MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">free</span> <span class="cm-operator">=</span> <span class="cm-number">0</span> <span class="cm-punctuation">(</span><span class="cm-number">0.0MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">100.0</span><span class="cm-operator">%</span> <span class="cm-identifier">used</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">From</span> <span class="cm-identifier">Space</span><span class="cm-operator">:</span> <span class="cm-comment">#å…¶ä¸­ä¸€ä¸ªSurvivoråŒºçš„å†…å­˜åˆ†å¸ƒ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">capacity</span> <span class="cm-operator">=</span> <span class="cm-number">3342336</span> <span class="cm-punctuation">(</span><span class="cm-number">3.1875MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">used</span> <span class="cm-operator">=</span> <span class="cm-number">234024</span> <span class="cm-punctuation">(</span><span class="cm-number">0.22318267822265625MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">free</span> <span class="cm-operator">=</span> <span class="cm-number">3108312</span> <span class="cm-punctuation">(</span><span class="cm-number">2.9643173217773438MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">7.001809512867647</span><span class="cm-operator">%</span> <span class="cm-identifier">used</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">To</span> <span class="cm-identifier">Space</span><span class="cm-operator">:</span> <span class="cm-comment">#å¦ä¸€ä¸ªSurvivoråŒºçš„å†…å­˜åˆ†å¸ƒ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">capacity</span> <span class="cm-operator">=</span> <span class="cm-number">3342336</span> <span class="cm-punctuation">(</span><span class="cm-number">3.1875MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">used</span> <span class="cm-operator">=</span> <span class="cm-number">0</span> <span class="cm-punctuation">(</span><span class="cm-number">0.0MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">free</span> <span class="cm-operator">=</span> <span class="cm-number">3342336</span> <span class="cm-punctuation">(</span><span class="cm-number">3.1875MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">0.0</span><span class="cm-operator">%</span> <span class="cm-identifier">used</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">PS</span> <span class="cm-identifier">Old</span> <span class="cm-identifier">Generation</span><span class="cm-operator">:</span> <span class="cm-comment">#å½“å‰çš„OldåŒºå†…å­˜åˆ†å¸ƒ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">capacity</span> <span class="cm-operator">=</span> <span class="cm-number">67108864</span> <span class="cm-punctuation">(</span><span class="cm-number">64.0MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">used</span> <span class="cm-operator">=</span> <span class="cm-number">67108816</span> <span class="cm-punctuation">(</span><span class="cm-number">63.99995422363281MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">free</span> <span class="cm-operator">=</span> <span class="cm-number">48</span> <span class="cm-punctuation">(</span><span class="cm-number">4.57763671875E-5MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">99.99992847442627</span><span class="cm-operator">%</span> <span class="cm-identifier">used</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">PS</span> <span class="cm-identifier">Perm</span> <span class="cm-identifier">Generation</span><span class="cm-operator">:</span> <span class="cm-comment">#å½“å‰çš„ â€œæŒä¹…ä»£â€ å†…å­˜åˆ†å¸ƒ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">capacity</span> <span class="cm-operator">=</span> <span class="cm-number">14417920</span> <span class="cm-punctuation">(</span><span class="cm-number">13.75MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">used</span> <span class="cm-operator">=</span> <span class="cm-number">14339216</span> <span class="cm-punctuation">(</span><span class="cm-number">13.674942016601562MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-identifier">free</span> <span class="cm-operator">=</span> <span class="cm-number">78704</span> <span class="cm-punctuation">(</span><span class="cm-number">0.0750579833984375MB</span><span class="cm-punctuation">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">99.45412375710227</span><span class="cm-operator">%</span> <span class="cm-identifier">used</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1252px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1252px;"></div></div></div></pre><p><span>æ–°ç”Ÿä»£å†…å­˜å›æ”¶å°±æ˜¯é‡‡ç”¨ç©ºé—´æ¢æ—¶é—´æ–¹å¼ï¼›å¦‚æœfromåŒºä½¿ç”¨ç‡ä¸€ç›´æ˜¯100% è¯´æ˜ç¨‹åºåˆ›å»ºå¤§é‡çš„çŸ­ç”Ÿå‘½å‘¨æœŸçš„å®ä¾‹ï¼Œä½¿ç”¨jstatç»Ÿè®¡jvmåœ¨å†…å­˜å›æ”¶ä¸­å‘ç”Ÿçš„é¢‘ç‡è€—æ—¶ä»¥åŠæ˜¯å¦æœ‰full gcï¼Œä½¿ç”¨è¿™ä¸ªæ•°æ®æ¥è¯„ä¼°ä¸€å†…å­˜é…ç½®å‚æ•°ã€gcå‚æ•°æ˜¯å¦åˆç†ã€‚</span></p><p><strong><span>ç»Ÿè®¡ä¸€ã€jmap -histoã€‘</span></strong><span>ï¼šç»Ÿè®¡æ‰€æœ‰ç±»çš„å®ä¾‹æ•°é‡å’Œæ‰€å ç”¨çš„å†…å­˜å®¹é‡</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">root</span><span class="cm-variable-2">@localhost</span> <span class="cm-error">~</span><span class="cm-punctuation">]</span><span class="cm-comment"># jmap -histo 7243</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-identifier">num</span> &nbsp; &nbsp; <span class="cm-comment">#instances &nbsp; &nbsp; &nbsp; &nbsp; #bytes  class name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">----------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">1</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">8969</span> &nbsp; &nbsp; &nbsp; <span class="cm-number">19781168</span> &nbsp;<span class="cm-punctuation">[</span><span class="cm-identifier">B</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">2</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">1835</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2296720</span> &nbsp;<span class="cm-punctuation">[</span><span class="cm-identifier">I</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">3</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">19735</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2050688</span> &nbsp;<span class="cm-punctuation">[</span><span class="cm-identifier">C</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">4</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">3448</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">385608</span> &nbsp;<span class="cm-identifier">java</span><span class="cm-punctuation">.</span><span class="cm-identifier">lang</span><span class="cm-punctuation">.</span><span class="cm-identifier">Class</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">5</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">3829</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">371456</span> &nbsp;<span class="cm-punctuation">[</span><span class="cm-identifier">Ljava</span><span class="cm-punctuation">.</span><span class="cm-identifier">lang</span><span class="cm-punctuation">.</span><span class="cm-identifier">Object</span><span class="cm-punctuation">;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">6</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">14634</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">351216</span> &nbsp;<span class="cm-identifier">java</span><span class="cm-punctuation">.</span><span class="cm-identifier">lang</span><span class="cm-punctuation">.</span><span class="cm-identifier">String</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">7</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">6695</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">214240</span> &nbsp;<span class="cm-identifier">java</span><span class="cm-punctuation">.</span><span class="cm-identifier">util</span><span class="cm-punctuation">.</span><span class="cm-identifier">concurrent</span><span class="cm-punctuation">.</span><span class="cm-identifier">ConcurrentHashMap</span><span class="cm-variable-2">$Node</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">8</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">6257</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">100112</span> &nbsp;<span class="cm-identifier">java</span><span class="cm-punctuation">.</span><span class="cm-identifier">lang</span><span class="cm-punctuation">.</span><span class="cm-identifier">Object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">9</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2155</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">68960</span> &nbsp;<span class="cm-identifier">java</span><span class="cm-punctuation">.</span><span class="cm-identifier">util</span><span class="cm-punctuation">.</span><span class="cm-identifier">HashMap</span><span class="cm-variable-2">$Node</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">10</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">723</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">63624</span> &nbsp;<span class="cm-identifier">java</span><span class="cm-punctuation">.</span><span class="cm-identifier">lang</span><span class="cm-punctuation">.</span><span class="cm-identifier">reflect</span><span class="cm-punctuation">.</span><span class="cm-identifier">Method</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">11</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">49</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">56368</span> &nbsp;<span class="cm-punctuation">[</span><span class="cm-identifier">Ljava</span><span class="cm-punctuation">.</span><span class="cm-identifier">util</span><span class="cm-punctuation">.</span><span class="cm-identifier">concurrent</span><span class="cm-punctuation">.</span><span class="cm-identifier">ConcurrentHashMap</span><span class="cm-variable-2">$Node</span><span class="cm-punctuation">;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">12</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">830</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">46480</span> &nbsp;<span class="cm-identifier">java</span><span class="cm-punctuation">.</span><span class="cm-identifier">util</span><span class="cm-punctuation">.</span><span class="cm-identifier">zip</span><span class="cm-punctuation">.</span><span class="cm-identifier">ZipFile</span><span class="cm-variable-2">$ZipFileInputStream</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">13</span><span class="cm-operator">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">1146</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">45840</span> &nbsp;<span class="cm-identifier">java</span><span class="cm-punctuation">.</span><span class="cm-identifier">lang</span><span class="cm-punctuation">.</span><span class="cm-identifier">ref</span><span class="cm-punctuation">.</span><span class="cm-identifier">Finalizer</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-operator">......</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 432px;"></div><div class="CodeMirror-gutters" style="display: none; height: 432px;"></div></div></div></pre><p><strong><span>ç»Ÿè®¡äºŒã€jmap -histoã€‘</span></strong><span>ï¼šæŸ¥çœ‹å¯¹è±¡æ•°æœ€å¤šçš„å¯¹è±¡ï¼Œå¹¶è¿‡æ»¤Mapå…³é”®è¯ï¼Œç„¶åæŒ‰é™åºæ’åºè¾“å‡º</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[root@localhost ~]<span class="cm-comment"># jmap -histo 7243 |grep Map|sort -k 2 -g -r|less</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Total &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">96237</span> &nbsp; &nbsp; &nbsp; <span class="cm-number">26875560</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">7</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">6695</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">214240</span>  java.util.concurrent.ConcurrentHashMap<span class="cm-def">$Node</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">9</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2155</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">68960</span>  java.util.HashMap<span class="cm-def">$Node</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">18</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">563</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">27024</span>  java.util.HashMap</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">21</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">505</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">20200</span>  java.util.LinkedHashMap<span class="cm-def">$Entry</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">16</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">337</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">34880</span>  [Ljava.util.HashMap<span class="cm-def">$Node</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">27</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">336</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">16128</span>  gnu.trove.THashMap</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">56</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">163</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">6520</span>  java.util.WeakHashMap<span class="cm-def">$Entry</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">60</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">127</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">6096</span>  java.util.WeakHashMap</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">38</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">127</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">10144</span>  [Ljava.util.WeakHashMap<span class="cm-def">$Entry</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">53</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">126</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">7056</span>  java.util.LinkedHashMap</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">......</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 302px;"></div><div class="CodeMirror-gutters" style="display: none; height: 302px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>ç»Ÿè®¡ä¸‰ã€jmap -histoã€‘</span></strong><span>ï¼šç»Ÿè®¡å®ä¾‹æ•°é‡æœ€å¤šçš„å‰10ä¸ªç±»</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[root@localhost ~]<span class="cm-comment"># jmap -histo 7243 | sort -n -r -k 2 | head -10</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> num &nbsp; &nbsp; <span class="cm-comment">#instances &nbsp; &nbsp; &nbsp; &nbsp; #bytes  class name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">----------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Total &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">96237</span> &nbsp; &nbsp; &nbsp; <span class="cm-number">26875560</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">3</span>: &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">19735</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2050688</span>  [C</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">6</span>: &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">14634</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">351216</span>  java.lang.String</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">1</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">8969</span> &nbsp; &nbsp; &nbsp; <span class="cm-number">19781168</span>  [B</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">7</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">6695</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">214240</span>  java.util.concurrent.ConcurrentHashMap<span class="cm-def">$Node</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">8</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">6257</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">100112</span>  java.lang.Object</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">5</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">3829</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">371456</span>  [Ljava.lang.Object;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">4</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">3448</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">385608</span>  java.lang.Class</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">9</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2155</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">68960</span>  java.util.HashMap<span class="cm-def">$Node</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">2</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">1835</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2296720</span>  [I</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 302px;"></div><div class="CodeMirror-gutters" style="display: none; height: 302px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>ç»Ÿè®¡å››ã€jmap -histoã€‘</span></strong><span>ï¼šç»Ÿè®¡åˆè®¡å®¹é‡æœ€å¤šçš„å‰10ä¸ªç±»</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[root@localhost ~]<span class="cm-comment"># jmap -histo 7243 | sort -n -r -k 3 | head -10</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> num &nbsp; &nbsp; <span class="cm-comment">#instances &nbsp; &nbsp; &nbsp; &nbsp; #bytes  class name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-attribute">----------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Total &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">96237</span> &nbsp; &nbsp; &nbsp; <span class="cm-number">26875560</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">1</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">8969</span> &nbsp; &nbsp; &nbsp; <span class="cm-number">19781168</span>  [B</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">2</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">1835</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2296720</span>  [I</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">3</span>: &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">19735</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2050688</span>  [C</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">4</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">3448</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">385608</span>  java.lang.Class</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">5</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">3829</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">371456</span>  [Ljava.lang.Object;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">6</span>: &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">14634</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">351216</span>  java.lang.String</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">7</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">6695</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">214240</span>  java.util.concurrent.ConcurrentHashMap<span class="cm-def">$Node</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">8</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">6257</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">100112</span>  java.lang.Object</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">9</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2155</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">68960</span>  java.util.HashMap<span class="cm-def">$Node</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 302px;"></div><div class="CodeMirror-gutters" style="display: none; height: 302px;"></div></div></div></pre><p><strong><span>dumpæ³¨æ„äº‹é¡¹</span></strong></p><ul><li><p><span>åœ¨åº”ç”¨å¿«è¦å‘ç”ŸFGCçš„æ—¶å€™æŠŠå †æ•°æ®å¯¼å‡ºæ¥</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">è€å¹´ä»£æˆ–æ–°ç”Ÿä»£usedæ¥è¿‘100%æ—¶ï¼Œå°±è¡¨ç¤ºå³å°†å‘ç”ŸGCï¼Œä¹Ÿå¯ä»¥å†JVMå‚æ•°ä¸­æŒ‡å®šè§¦å‘GCçš„é˜ˆå€¼ã€‚</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre><ul><li><span>æŸ¥çœ‹å¿«è¦å‘ç”ŸFGCä½¿ç”¨å‘½ä»¤ï¼šjmap -heap &lt; pid &gt;</span></li><li><span>æ•°æ®å¯¼å‡ºï¼šjmap -dump:format=b,file=heap.bin &lt; pid &gt;</span></li></ul></li><li><p><span>é€šè¿‡å‘½ä»¤æŸ¥çœ‹å¤§å¯¹è±¡ï¼šjmap -histo &lt; pid &gt;|less</span></p></li></ul><p>&nbsp;</p><p><strong><span>ä½¿ç”¨æ€»ç»“</span></strong></p><ul><li><span>å¦‚æœç¨‹åºå†…å­˜ä¸è¶³æˆ–è€…é¢‘ç¹GCï¼Œå¾ˆæœ‰å¯èƒ½å­˜åœ¨å†…å­˜æ³„éœ²æƒ…å†µï¼Œè¿™æ—¶å€™å°±è¦å€ŸåŠ©Javaå †DumpæŸ¥çœ‹å¯¹è±¡çš„æƒ…å†µ</span></li><li><span>è¦åˆ¶ä½œå †Dumpå¯ä»¥ç›´æ¥ä½¿ç”¨jvmè‡ªå¸¦çš„jmapå‘½ä»¤</span></li><li><span>å¯ä»¥å…ˆä½¿ç”¨</span><code>jmap -heap</code><span>å‘½ä»¤æŸ¥çœ‹å †çš„ä½¿ç”¨æƒ…å†µï¼Œçœ‹ä¸€ä¸‹å„ä¸ªå †ç©ºé—´çš„å ç”¨æƒ…å†µ</span></li><li><span>ä½¿ç”¨</span><code>jmap -histo:[live]</code><span>æŸ¥çœ‹å †å†…å­˜ä¸­çš„å¯¹è±¡çš„æƒ…å†µã€‚å¦‚æœæœ‰å¤§é‡å¯¹è±¡åœ¨æŒç»­è¢«å¼•ç”¨ï¼Œå¹¶æ²¡æœ‰è¢«é‡Šæ”¾æ‰ï¼Œé‚£å°±äº§ç”Ÿäº†å†…å­˜æ³„éœ²ï¼Œå°±è¦ç»“åˆä»£ç ï¼ŒæŠŠä¸ç”¨çš„å¯¹è±¡é‡Šæ”¾æ‰</span></li><li><span>ä¹Ÿå¯ä»¥ä½¿ç”¨ </span><code>jmap -dump:format=b,file=&lt;fileName&gt;</code><span>å‘½ä»¤å°†å †ä¿¡æ¯ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå†å€ŸåŠ©jhatå‘½ä»¤æŸ¥çœ‹è¯¦ç»†å†…å®¹</span></li><li><span>åœ¨å†…å­˜å‡ºç°æ³„éœ²ã€æº¢å‡ºæˆ–è€…å…¶å®ƒå‰ææ¡ä»¶ä¸‹ï¼Œå»ºè®®å¤šdumpå‡ æ¬¡å†…å­˜ï¼ŒæŠŠå†…å­˜æ–‡ä»¶è¿›è¡Œç¼–å·å½’æ¡£ï¼Œä¾¿äºåç»­å†…å­˜æ•´ç†åˆ†æ</span></li><li><span>åœ¨ç”¨cms gcçš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œjmap -heapæœ‰äº›æ—¶å€™ä¼šå¯¼è‡´è¿›ç¨‹å˜Tï¼Œå› æ­¤å¼ºçƒˆå»ºè®®åˆ«æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œå¦‚æœæƒ³è·å–å†…å­˜ç›®å‰æ¯ä¸ªåŒºåŸŸçš„ä½¿ç”¨çŠ¶å†µï¼Œå¯é€šè¿‡jstat -gcæˆ–jstat -gccapacityæ¥æ‹¿åˆ°</span></li></ul><p>&nbsp;</p><p>&nbsp;</p><h2 id='jhat'><span>jhat</span></h2><p><span>jhatï¼ˆJVM Heap Analysis Toolï¼‰å‘½ä»¤æ˜¯ä¸jmapæ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æjmapç”Ÿæˆçš„dumpï¼Œjhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/HTMLæœåŠ¡å™¨ï¼Œç”Ÿæˆdumpçš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚åœ¨æ­¤è¦æ³¨æ„ï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œåˆ†æï¼Œå› ä¸ºjhatæ˜¯ä¸€ä¸ªè€—æ—¶å¹¶ä¸”è€—è´¹ç¡¬ä»¶èµ„æºçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬æŠŠæœåŠ¡å™¨ç”Ÿæˆçš„dumpæ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°æˆ–å…¶ä»–æœºå™¨ä¸Šè¿›è¡Œåˆ†æã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è§£æJavaå †è½¬å‚¨æ–‡ä»¶,å¹¶å¯åŠ¨ä¸€ä¸ª web server</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">jhat</span> <span class="cm-identifier">heapDump</span><span class="cm-punctuation">.</span><span class="cm-identifier">dump</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre><p>&nbsp;</p><h2 id='jconsole'><span>jconsole</span></h2><p><span>jconsole(Java Monitoring and Management Console)æ˜¯ä¸€ä¸ªJava GUIç›‘è§†å·¥å…·ï¼Œå¯ä»¥ä»¥å›¾è¡¨åŒ–çš„å½¢å¼æ˜¾ç¤ºå„ç§æ•°æ®ï¼Œå¹¶å¯é€šè¿‡è¿œç¨‹è¿æ¥ç›‘è§†è¿œç¨‹çš„æœåŠ¡å™¨VMã€‚ç”¨javaå†™çš„GUIç¨‹åºï¼Œç”¨æ¥ç›‘æ§VMï¼Œå¹¶å¯ç›‘æ§è¿œç¨‹çš„VMï¼Œéå¸¸æ˜“ç”¨ï¼Œè€Œä¸”åŠŸèƒ½éå¸¸å¼ºã€‚å‘½ä»¤è¡Œé‡Œæ‰“jconsoleï¼Œé€‰åˆ™è¿›ç¨‹å°±å¯ä»¥äº†ã€‚</span></p><p><strong><span>ç¬¬ä¸€æ­¥</span></strong><span>ï¼šåœ¨è¿œç¨‹æœºçš„tomcatçš„catalina.shä¸­åŠ å…¥é…ç½®ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">JAVA_OPTS</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-variable-2">$JAVA_OPTS</span><span class="cm-string"> -Djava.rmi.server.hostname=192.168.202.121 -Dcom.sun.management.jmxremote"</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">JAVA_OPTS</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-variable-2">$JAVA_OPTS</span><span class="cm-string"> -Dcom.sun.management.jmxremote.port=12345"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">JAVA_OPTS</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-variable-2">$JAVA_OPTS</span><span class="cm-string"> -Dcom.sun.management.jmxremote.authenticate=true"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">JAVA_OPTS</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-variable-2">$JAVA_OPTS</span><span class="cm-string"> -Dcom.sun.management.jmxremote.ssl=false"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">JAVA_OPTS</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-variable-2">$JAVA_OPTS</span><span class="cm-string"> -Dcom.sun.management.jmxremote.pwd.file=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.101-3.b13.el7_2.x86_64/jre/lib/management/jmxremote.password"</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 216px;"></div><div class="CodeMirror-gutters" style="display: none; height: 216px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>ç¬¬äºŒæ­¥</span></strong><span>ï¼šé…ç½®æƒé™æ–‡ä»¶</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">root</span><span class="cm-variable-2">@localhost</span> <span class="cm-identifier">bin</span><span class="cm-punctuation">]</span><span class="cm-comment"># cd /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.101-3.b13.el7_2.x86_64/jre/lib/management/</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">root</span><span class="cm-variable-2">@localhost</span> <span class="cm-identifier">management</span><span class="cm-punctuation">]</span><span class="cm-comment"># cp jmxremote.password.template jmxremote.password</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">root</span><span class="cm-variable-2">@localhost</span> <span class="cm-identifier">management</span><span class="cm-punctuation">]</span><span class="cm-comment"># vi jmxremote.password</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 108px;"></div><div class="CodeMirror-gutters" style="display: none; height: 108px;"></div></div></div></pre><p><span>monitorRole QED</span>
<span>controlRole chenqimiao</span></p><p>&nbsp;</p><p><strong><span>ç¬¬ä¸‰æ­¥</span></strong><span>ï¼šé…ç½®æƒé™æ–‡ä»¶ä¸º600</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">root</span><span class="cm-variable-2">@localhost</span> <span class="cm-identifier">management</span><span class="cm-punctuation">]</span><span class="cm-comment"># chmod 600 jmxremote.password jmxremote.access</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre><p><span>è¿™æ ·åŸºæœ¬é…ç½®å°±ç»“æŸäº†ï¼Œä¸‹é¢è¯´ä¸¤ä¸ªå‘ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯é˜²ç«å¢™çš„é—®é¢˜ï¼Œè¦å¼€æ”¾æŒ‡å®šç«¯å£çš„é˜²ç«å¢™ï¼Œæˆ‘è¿™é‡Œé…ç½®çš„æ˜¯12345ç«¯å£ï¼Œç¬¬äºŒä¸ªæ˜¯hostnameçš„é—®é¢˜ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250305.png" referrerpolicy="no-referrer" alt="jconsole-ip2"></p><p><span>è¯·å°†127.0.0.1ä¿®æ”¹ä¸ºæœ¬åœ°çœŸå®çš„IP,æˆ‘çš„æœåŠ¡å™¨IPæ˜¯192.168.202.121ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250326.png" referrerpolicy="no-referrer" alt="jconsole-ip"></p><p><span> </span><strong><span>ç¬¬å››æ­¥</span></strong><span>ï¼šæŸ¥çœ‹JConsole</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250329.png" referrerpolicy="no-referrer" alt="JConsole-æ–°å»ºè¿æ¥"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250330.png" referrerpolicy="no-referrer" alt="JConsole-Console"></p><p>&nbsp;</p><h2 id='jvisualvm-2'><span>jvisualvm</span></h2><p><span>jvisualvm(JVM Monitoring/Troubleshooting/Profiling Tool)åŒjconsoleéƒ½æ˜¯ä¸€ä¸ªåŸºäºå›¾å½¢åŒ–ç•Œé¢çš„ã€å¯ä»¥æŸ¥çœ‹æœ¬åœ°åŠè¿œç¨‹çš„JAVA GUIç›‘æ§å·¥å…·ï¼ŒJvisualvmåŒjconsoleçš„ä½¿ç”¨æ–¹å¼ä¸€æ ·ï¼Œç›´æ¥åœ¨å‘½ä»¤è¡Œæ‰“å…¥Jvisualvmå³å¯å¯åŠ¨ï¼Œä¸è¿‡Jvisualvmç›¸æ¯”ï¼Œç•Œé¢æ›´ç¾è§‚ä¸€äº›ï¼Œæ•°æ®æ›´å®æ—¶ã€‚ jvisualvmçš„ä½¿ç”¨VisualVMè¿›è¡Œè¿œç¨‹è¿æ¥çš„é…ç½®å’ŒJConsoleæ˜¯ä¸€æ‘¸ä¸€æ ·çš„ï¼Œæœ€ç»ˆæ•ˆæœå›¾å¦‚ä¸‹</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250334.png" referrerpolicy="no-referrer" alt="jvisualvm"></p><p>&nbsp;</p><p><strong><span>Visual GC(ç›‘æ§åƒåœ¾å›æ”¶å™¨)</span></strong></p><p><span>Java VisualVMé»˜è®¤æ²¡æœ‰å®‰è£…Visual GCæ’ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ï¼ŒJDKçš„å®‰è£…ç›®å½•çš„binç›®éœ²ä¸‹åŒå‡» jvisualvm.shï¼Œå³å¯æ‰“å¼€Java VisualVMï¼Œç‚¹å‡»èœå•æ ï¼š </span><strong><span>å·¥å…·-&gt;æ’ä»¶</span></strong><span> å®‰è£…Visual GCï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250338.png" referrerpolicy="no-referrer" alt="Visual-GC"></p><p>&nbsp;</p><p><strong><span>å¤§dumpæ–‡ä»¶</span></strong></p><p><span>ä»æœåŠ¡å™¨dumpå †å†…å­˜åæ–‡ä»¶æ¯”è¾ƒå¤§ï¼ˆ5.5Gå·¦å³ï¼‰ï¼ŒåŠ è½½æ–‡ä»¶ã€æŸ¥çœ‹å®ä¾‹å¯¹è±¡éƒ½å¾ˆæ…¢ï¼Œè¿˜æç¤ºé…ç½®xmxå¤§å°ã€‚è¡¨æ˜ç»™VisualVMåˆ†é…çš„å †å†…å­˜ä¸å¤Ÿï¼Œæ‰¾åˆ°$JAVA_HOME/lib/visualvm}/etc/visualvm.confè¿™ä¸ªæ–‡ä»¶ï¼Œä¿®æ”¹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">default_options</span><span class="cm-operator">=</span><span class="cm-string">"-J-Xms24m -J-Xmx192m"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>å†é‡å¯VisualVMå°±è¡Œäº†ã€‚</span></p><p>&nbsp;</p><h2 id='jmc'><span>jmc</span></h2><p><span>jmcï¼ˆJava Mission Controlï¼‰æ˜¯JDKè‡ªå¸¦çš„ä¸€ä¸ªå›¾å½¢ç•Œé¢ç›‘æ§å·¥å…·ï¼Œç›‘æ§ä¿¡æ¯éå¸¸å…¨é¢ã€‚JMCæ‰“å¼€æ€§èƒ½æ—¥å¿—åï¼Œä¸»è¦åŒ…æ‹¬</span><strong><span>ä¸€èˆ¬ä¿¡æ¯ã€å†…å­˜ã€ä»£ç ã€çº¿ç¨‹ã€I/Oã€ç³»ç»Ÿã€äº‹ä»¶</span></strong><span> åŠŸèƒ½ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250493.jpg" referrerpolicy="no-referrer" alt="jmc-main"></p><p><span>JMCçš„æœ€ä¸»è¦çš„ç‰¹å¾å°±æ˜¯JFRï¼ˆJava Flight Recorderï¼‰ï¼Œæ˜¯åŸºäºJAVAçš„é£è¡Œè®°å½•å™¨ï¼ŒJFRçš„æ•°æ®æ˜¯ä¸€äº›åˆ—JVMäº‹ä»¶çš„å†å²çºªå½•ï¼Œå¯ä»¥ç”¨æ¥è¯Šæ–­JVMçš„æ€§èƒ½å’Œæ“ä½œï¼Œæ”¶é›†åçš„æ•°æ®å¯ä»¥ä½¿ç”¨JMCæ¥åˆ†æã€‚</span></p><p>&nbsp;</p><h3 id='å¯åŠ¨jfr'><span>å¯åŠ¨JFR</span></h3><p><span>åœ¨å•†ä¸šç‰ˆæœ¬ä¸Šé¢ï¼ŒJFRé»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡åœ¨å¯åŠ¨æ—¶å¢åŠ å‚æ•° </span><code>-XX:+UnlockCommercialFeatures -XX:+FlightRecorder</code><span> æ¥å¯åŠ¨åº”ç”¨ã€‚å¯åŠ¨ä¹‹åï¼Œä¹Ÿåªæ˜¯å¼€å¯äº†JFRç‰¹æ€§ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å¼€å§‹è¿›è¡Œäº‹ä»¶è®°å½•ã€‚è¿™å°±è¦é€šè¿‡GUIå’Œå‘½ä»¤è¡Œäº†ã€‚</span></p><ul><li><p><strong><span>é€šè¿‡Java Mission Controlå¯åŠ¨JFR</span></strong></p><p><span>æ‰“å¼€Java Mission Controlç‚¹å‡»å¯¹åº”çš„JVMå¯åŠ¨å³å¯ï¼Œäº‹ä»¶è®°å½•æœ‰ä¸¤ç§æ¨¡å¼ï¼ˆå¦‚æœé€‰æ‹©ç¬¬2ç§æ¨¡å¼ï¼Œé‚£ä¹ˆJVMä¼šä½¿ç”¨ä¸€ä¸ªå¾ªç¯ä½¿ç”¨çš„ç¼“å­˜æ¥å­˜æ”¾äº‹ä»¶æ•°æ®ï¼‰ï¼š</span></p><ul><li><span>è®°å½•å›ºå®šä¸€æ®µæ—¶é—´çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼š1åˆ†é’Ÿï¼‰</span></li><li><span>æŒç»­è¿›è¡Œè®°å½•</span></li></ul></li><li><p><strong><span>é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨JFR</span></strong></p><p><span>é€šè¿‡åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå¢åŠ å‚æ•°ï¼š</span><code>-XX:+FlightRecorderOptions=string</code><span> æ¥å¯åŠ¨çœŸæ­£åœ°äº‹ä»¶è®°å½•ï¼Œè¿™é‡Œçš„ </span><code>string</code><span> å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ï¼ˆä¸‹åˆ—å‚æ•°éƒ½å¯ä»¥ä½¿ç”¨jcmdå‘½ä»¤ï¼Œåœ¨JVMè¿è¡Œçš„æ—¶å€™è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼Œ</span><a href='https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html'><span>å‚è€ƒåœ°å€</span></a><span>ï¼‰ï¼š</span></p><ul><li><code>name=name</code><span>ï¼šæ ‡è¯†recordingçš„åå­—ï¼ˆä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªrecordingå­˜åœ¨ï¼Œå®ƒä»¬ä½¿ç”¨åå­—æ¥è¿›è¡ŒåŒºåˆ†ï¼‰</span></li><li><code>defaultrecording=&lt;ture|false&gt;</code><span>ï¼šæ˜¯å¦å¯åŠ¨recordingï¼Œé»˜è®¤æ˜¯falseï¼Œæˆ‘ä»¬è¦åˆ†æï¼Œå¿…é¡»è¦è®¾ç½®ä¸ºtrue</span></li><li><code>setting=paths</code><span>ï¼šåŒ…å«JFRé…ç½®çš„æ–‡ä»¶åå­—</span></li><li><code>delay=time</code><span>ï¼šå¯åŠ¨ä¹‹åï¼Œç»è¿‡å¤šé•¿æ—¶é—´ï¼ˆæ¯”å¦‚ï¼š30sï¼Œ1hï¼‰å¼€å§‹è¿›è¡Œrecording</span></li><li><code>duration=time</code><span>ï¼šåšå¤šé•¿æ—¶é—´çš„recording</span></li><li><code>filename=path</code><span>ï¼šrecorddingè®°å½•åˆ°é‚£ä¸ªæ–‡ä»¶é‡Œé¢</span></li><li><code>compress=&lt;ture|false&gt;</code><span>ï¼šæ˜¯å¦å¯¹recordingè¿›è¡Œå‹ç¼©ï¼ˆgzipï¼‰,é»˜è®¤ä¸ºfalse</span></li><li><code>maxage=time</code><span>ï¼šåœ¨å¾ªç¯ä½¿ç”¨çš„ç¼“å­˜ä¸­ï¼Œäº‹ä»¶æ•°æ®ä¿å­˜çš„æœ€å¤§æ—¶é•¿</span></li><li><code>maxsize=size</code><span>ï¼šäº‹ä»¶æ•°æ®ç¼“å­˜çš„æœ€å¤§å¤§å°ï¼ˆæ¯”å¦‚ï¼š1024kï¼Œ1Mï¼‰</span></li></ul></li></ul><p>&nbsp;</p><h3 id='å¸¸ç”¨jfrå‘½ä»¤'><span>å¸¸ç”¨JFRå‘½ä»¤</span></h3><ul><li><p><span>å¯åŠ¨recording</span></p><p><span>å‘½ä»¤æ ¼å¼ï¼š</span><code>jcmd process_id JFR.start [options_list]</code><span>ï¼Œå…¶ä¸­options_listå°±æ˜¯ä¸Šè¿°çš„å‚æ•°å€¼ã€‚</span></p></li><li><p><span>dumpå‡ºå¾ªç¯ç¼“å­˜ä¸­çš„æ•°æ®</span></p><p><span>å‘½ä»¤æ ¼å¼ï¼š</span><code>jcmd process_id JFR.dump [options_list]</code><span>ï¼Œå…¶ä¸­options_listå‚æ•°çš„å¯é€‰å€¼å¦‚ä¸‹ï¼š</span></p><ul><li><code>name=name</code><span>ï¼šrecordingçš„åå­—</span></li><li><code>recording=n</code><span>ï¼šJFR recordingçš„æ•°å­—ï¼ˆä¸€ä¸ªæ ‡è¯†recordingçš„éšæœºæ•°ï¼‰</span></li><li><code>filename=path</code><span>ï¼šdumpæ–‡ä»¶çš„ä¿å­˜è·¯å¾„</span></li></ul></li><li><p><span>æŸ¥çœ‹è¿›ç¨‹ä¸­æ‰€æœ‰recording</span></p><p><span>å‘½ä»¤æ ¼å¼ï¼š</span><code>jcmd process_id JFR.check [verbose]</code><span>ï¼Œä¸åŒrecordingä½¿ç”¨åå­—è¿›è¡ŒåŒºåˆ†ï¼ŒåŒæ—¶JVMè¿˜ä¸ºå®ƒåˆ†é…ä¸€ä¸ªéšæœºæ•°ã€‚</span></p></li><li><p><span>åœæ­¢recording</span></p><p><span>å‘½ä»¤æ ¼å¼ï¼š</span><code>jcmd process_id JFR.stop [options_list]</code><span>ï¼Œå…¶ä¸­options_listå‚æ•°çš„å¯é€‰å€¼å¦‚ä¸‹ï¼š</span></p><ul><li><code>name=name</code><span>ï¼šè¦åœæ­¢çš„recordingåå­—</span></li><li><code>recording=n</code><span>ï¼šè¦åœæ­¢çš„recordingçš„æ ‡è¯†æ•°å­—</span></li><li><code>discard=boolean</code><span>ï¼šå¦‚æœä¸ºtrueï¼Œæ•°æ®è¢«ä¸¢å¼ƒï¼Œè€Œä¸æ˜¯å†™å…¥ä¸‹é¢æŒ‡å®šçš„æ–‡ä»¶å½“ä¸­</span></li><li><code>filename=path</code><span>ï¼šå†™å…¥æ•°æ®çš„æ–‡ä»¶åç§°</span></li></ul></li></ul><p>&nbsp;</p><h3 id='å‘½ä»¤å¯åŠ¨jfræ¡ˆä¾‹'><span>å‘½ä»¤å¯åŠ¨JFRæ¡ˆä¾‹</span></h3><ul><li><p><strong><span>ç¬¬ä¸€æ­¥</span></strong><span>ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«äº†ä½ è‡ªå·±é…ç½®çš„JFRæ¨¡æ¿æ–‡ä»¶ï¼ˆ</span><code>template.jfc</code><span>ï¼‰ã€‚è¿è¡Œjmc, ç„¶åWindow-&gt;Flight Recording Template Manageèœå•ã€‚å‡†å¤‡å¥½æ¡£æ¡ˆåï¼Œå°±å¯ä»¥å¯¼å‡ºæ–‡ä»¶ï¼Œå¹¶ç§»åŠ¨åˆ°è¦æ’æŸ¥é—®é¢˜çš„ç¯å¢ƒä¸­</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250499.png" referrerpolicy="no-referrer" alt="jmc-jfc"></p></li><li><p><strong><span>ç¬¬äºŒæ­¥</span></strong><span>ï¼šç”±äºJFRéœ€è¦JDKçš„å•†ä¸šè¯ä¹¦ï¼Œè¿™ä¸€æ­¥éœ€è¦è§£é”jdkçš„å•†ä¸šç‰¹æ€§</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">root</span><span class="cm-variable-2">@localhost</span> <span class="cm-identifier">bin</span><span class="cm-punctuation">]</span><span class="cm-comment"># jcmd 12234 VM.unlock_commercial_features</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12234</span><span class="cm-operator">:</span> <span class="cm-identifier">Commercial</span> <span class="cm-identifier">Features</span> <span class="cm-identifier">already</span> <span class="cm-identifier">unlocked</span><span class="cm-punctuation">.</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre></li><li><p><strong><span>ç¬¬ä¸‰æ­¥</span></strong><span>ï¼šæœ€åä½ å°±å¯ä»¥å¯åŠ¨JFRï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">jcmd</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">PID</span><span class="cm-operator">&gt;</span> <span class="cm-identifier">JFR</span><span class="cm-punctuation">.</span><span class="cm-builtin">start</span> <span class="cm-identifier">name</span><span class="cm-operator">=</span><span class="cm-identifier">test</span> <span class="cm-identifier">duration</span><span class="cm-operator">=</span><span class="cm-number">60</span><span class="cm-identifier">s</span> <span class="cm-punctuation">[</span><span class="cm-identifier">settings</span><span class="cm-operator">=</span><span class="cm-identifier">template</span><span class="cm-punctuation">.</span><span class="cm-identifier">jfc</span><span class="cm-punctuation">]</span> <span class="cm-identifier">filename</span><span class="cm-operator">=</span><span class="cm-identifier">output</span><span class="cm-punctuation">.</span><span class="cm-identifier">jfr</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ä¸Šè¿°å‘½ä»¤ç«‹å³å¯åŠ¨JFRå¹¶å¼€å§‹ä½¿ç”¨ `template.jfc`ï¼ˆåœ¨ `$JAVA_HOME/jre/lib/jfr` ä¸‹æœ‰ `default.jfc` å’Œ `profile.jfc` æ¨¡æ¿ï¼‰çš„é…ç½®æ”¶é›† `60s` çš„JVMä¿¡æ¯ï¼Œè¾“å‡ºåˆ° `output.jfr` ä¸­ã€‚ä¸€æ—¦è®°å½•å®Œæˆä¹‹åï¼Œå°±å¯ä»¥å¤åˆ¶.jfræ–‡ä»¶åˆ°ä½ çš„å·¥ä½œç¯å¢ƒä½¿ç”¨jmc GUIæ¥åˆ†æã€‚å®ƒå‡ ä¹åŒ…å«äº†æ’æŸ¥jvmé—®é¢˜éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å †dumpæ—¶çš„å¼‚å¸¸ä¿¡æ¯ã€‚ä½¿ç”¨æ¡ˆä¾‹å¦‚ä¸‹ï¼š</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 108px;"></div><div class="CodeMirror-gutters" style="display: none; height: 108px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="powershell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">root</span><span class="cm-variable-2">@localhost</span> <span class="cm-identifier">bin</span><span class="cm-punctuation">]</span><span class="cm-comment"># jcmd 12234 JFR.start name=test duration=60s filename=output.jfr</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">12234</span><span class="cm-operator">:</span> <span class="cm-identifier">Started</span> <span class="cm-identifier">recording</span> <span class="cm-number">6.</span> <span class="cm-identifier">The</span> <span class="cm-identifier">result</span> <span class="cm-identifier">will</span> <span class="cm-identifier">be</span> <span class="cm-identifier">written</span> <span class="cm-identifier">to</span><span class="cm-operator">:</span> <span class="cm-operator">/</span><span class="cm-identifier">root</span><span class="cm-operator">/</span><span class="cm-identifier">zookeeper-3</span><span class="cm-number">.4.12</span><span class="cm-operator">/</span><span class="cm-identifier">bin</span><span class="cm-operator">/</span><span class="cm-identifier">output</span><span class="cm-punctuation">.</span><span class="cm-identifier">jfr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">root</span><span class="cm-variable-2">@localhost</span> <span class="cm-identifier">bin</span><span class="cm-punctuation">]</span><span class="cm-comment"># ls -l</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">-</span><span class="cm-identifier">rw-r--r</span><span class="cm-operator">--</span> <span class="cm-number">1</span> <span class="cm-identifier">root</span> <span class="cm-identifier">root</span> <span class="cm-number">298585</span> <span class="cm-number">6</span><span class="cm-error">æœˆ</span> &nbsp;<span class="cm-number">29</span> <span class="cm-number">11</span><span class="cm-operator">:</span><span class="cm-number">09</span> <span class="cm-identifier">output</span><span class="cm-punctuation">.</span><span class="cm-identifier">jfr</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="display: none; height: 130px;"></div></div></div></pre></li></ul><p>&nbsp;</p><p><strong><span>JFRï¼ˆJava Flight Recorderï¼‰</span></strong></p><ul><li><span>Java Mission Controlçš„æœ€ä¸»è¦çš„ç‰¹å¾å°±æ˜¯Java Flight Recorderã€‚æ­£å¦‚å®ƒçš„åå­—æ‰€ç¤ºï¼ŒJFRçš„æ•°æ®æ˜¯ä¸€äº›åˆ—JVMäº‹ä»¶çš„å†å²çºªå½•ï¼Œå¯ä»¥ç”¨æ¥è¯Šæ–­JVMçš„æ€§èƒ½å’Œæ“ä½œ</span></li><li><span>JFRçš„åŸºæœ¬æ“ä½œå°±æ˜¯å¼€å¯å“ªäº›äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šçº¿ç¨‹ç”±äºç­‰å¾…é”è€Œé˜»å¡çš„äº‹ä»¶ï¼‰ã€‚å½“å¼€å¯çš„äº‹ä»¶å‘ç”Ÿäº†ï¼Œäº‹ä»¶ç›¸å…³çš„æ•°æ®ä¼šè®°å½•åˆ°å†…å­˜æˆ–ç£ç›˜æ–‡ä»¶ä¸Šã€‚è®°å½•äº‹ä»¶æ•°æ®çš„ç¼“å­˜æ˜¯å¾ªç¯ä½¿ç”¨çš„ï¼Œåªæœ‰æœ€è¿‘å‘ç”Ÿçš„äº‹ä»¶æ‰èƒ½å¤Ÿä»ç¼“å­˜ä¸­æ‰¾åˆ°ï¼Œä¹‹å‰çš„éƒ½å› ä¸ºç¼“å­˜çš„é™åˆ¶è¢«åˆ é™¤äº†ã€‚Java Mission Controlèƒ½å¤Ÿå¯¹è¿™äº›äº‹ä»¶åœ¨ç•Œé¢ä¸Šè¿›è¡Œå±•ç¤ºï¼ˆä»JVMçš„å†…å­˜ä¸­è¯»å–æˆ–ä»äº‹ä»¶æ•°æ®æ–‡ä»¶ä¸­è¯»å–ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›äº‹ä»¶æ¥å¯¹JVMçš„æ€§èƒ½è¿›è¡Œè¯Šæ–­</span></li><li><span>äº‹ä»¶çš„ç±»å‹ã€ç¼“å­˜çš„å¤§å°ã€äº‹ä»¶æ•°æ®çš„å­˜å‚¨æ–¹å¼ç­‰ç­‰éƒ½æ˜¯é€šè¿‡JVMå‚æ•°ã€Java Mission Controlçš„GUIç•Œé¢ã€jcmdå‘½ä»¤æ¥æ§åˆ¶çš„ã€‚JFRé»˜è®¤æ˜¯ç¼–è¯‘è¿›ç¨‹åºçš„ï¼Œå› ä¸ºå®ƒçš„å¼€é”€å¾ˆå°ï¼Œä¸€èˆ¬æ¥è¯´å¯¹åº”ç”¨çš„å½±å“å°äº1%ã€‚ä¸è¿‡ï¼Œå¦‚æœæˆ‘ä»¬å¢åŠ äº†äº‹ä»¶çš„æ•°ç›®ã€ä¿®æ”¹äº†è®°å½•äº‹ä»¶çš„é˜ˆå€¼ï¼Œéƒ½æœ‰å¯èƒ½å¢åŠ JFRçš„å¼€é”€</span></li></ul><p>&nbsp;</p><h3 id='jfræ¦‚å†µ'><span>JFRæ¦‚å†µ</span></h3><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ä¸‹é¢å¯¹GlassFish webæœåŠ¡å™¨è¿›è¡ŒJFRè®°å½•çš„ä¾‹å­ï¼Œåœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šé¢è¿è¡Œç€åœ¨ç¬¬2ç« ä»‹ç»çš„è‚¡ç¥¨servletã€‚Java Mission ControlåŠ è½½å®ŒJFRè·å–çš„äº‹ä»¶ä¹‹åï¼Œå¤§æ¦‚æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 65px;"></div><div class="CodeMirror-gutters" style="display: none; height: 65px;"></div></div></div></pre><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250832.jpg" referrerpolicy="no-referrer" alt="jfr-main"></p><p><span>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼šCPUä½¿ç”¨ç‡ï¼ŒHeapä½¿ç”¨ç‡ï¼ŒJVMä¿¡æ¯ï¼ŒSystem Propertiesï¼ŒJFRçš„è®°å½•æƒ…å†µç­‰ç­‰ã€‚</span></p><p>&nbsp;</p><h3 id='jfrå†…å­˜è§†å›¾'><span>JFRå†…å­˜è§†å›¾</span></h3><p><span>Java Mission Control å¯ä»¥çœ‹åˆ°éå¸¸å¤šçš„ä¿¡æ¯ï¼Œä¸‹å›¾åªæ˜¾ç¤ºäº†ä¸€ä¸ªæ ‡ç­¾çš„å†…å®¹ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†JVM çš„å†…å­˜æ³¢åŠ¨éå¸¸é¢‘ç¹ï¼Œå› ä¸ºæ–°ç”Ÿä»£ç»å¸¸è¢«æ¸…é™¤ï¼ˆæœ‰æ„æ€çš„æ˜¯ï¼Œheadçš„å¤§å°å¹¶æ²¡æœ‰å¢é•¿ï¼‰ã€‚ä¸‹é¢å·¦è¾¹çš„é¢æ¿æ˜¾ç¤ºäº†æœ€è¿‘ä¸€æ®µæ—¶é—´çš„åƒåœ¾å›æ”¶æƒ…å†µï¼ŒåŒ…æ‹¬ï¼šGCçš„æ—¶é•¿å’Œåƒåœ¾å›æ”¶çš„ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬ç‚¹å‡»ä¸€ä¸ªäº‹ä»¶ï¼Œå³è¾¹çš„é¢æ¿ä¼šå±•ç¤ºè¿™ä¸ªäº‹ä»¶çš„å…·ä½“æƒ…å†µï¼ŒåŒ…æ‹¬ï¼šåƒåœ¾åƒåœ¾å›æ”¶çš„å„ä¸ªé˜¶æ®µåŠå…¶ç»Ÿè®¡ä¿¡æ¯ã€‚ä»é¢æ¿çš„æ ‡ç­¾å¯ä»¥çœ‹åˆ°ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶å®ƒä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šæœ‰å¤šå°‘å¯¹è±¡è¢«æ¸…é™¤äº†ï¼ŒèŠ±äº†å¤šé•¿æ—¶é—´ï¼›GCç®—æ³•çš„é…ç½®ï¼›åˆ†é…çš„å¯¹è±¡ä¿¡æ¯ç­‰ç­‰ã€‚åœ¨ç¬¬5ç« å’Œç¬¬6ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250844.jpg" referrerpolicy="no-referrer" alt="jfr-memory"></p><p>&nbsp;</p><h3 id='jfr-ä»£ç è§†å›¾'><span>JFR ä»£ç è§†å›¾</span></h3><p><span>è¿™å¼ å›¾ä¹Ÿæœ‰å¾ˆå¤štabï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªåŒ…çš„ä½¿ç”¨é¢‘ç‡å’Œç±»çš„ä½¿ç”¨æƒ…å†µã€å¼‚å¸¸ã€ç¼–è¯‘ã€ä»£ç ç¼“å­˜ã€ç±»åŠ è½½æƒ…å†µç­‰ç­‰ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250848.jpg" referrerpolicy="no-referrer" alt="jfr-code"></p><p>&nbsp;</p><h3 id='jfräº‹ä»¶è§†å›¾'><span>JFRäº‹ä»¶è§†å›¾</span></h3><p><span>ä¸‹å›¾æ˜¾ç¤ºäº†äº‹ä»¶çš„æ¦‚è¿°è§†å›¾ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250852.jpg" referrerpolicy="no-referrer" alt="jfr-event"></p><p>&nbsp;</p><h2 id='eclipsemat'><span>EclipseMAT</span></h2><p><span>è™½ç„¶Javaè™šæ‹Ÿæœºå¯ä»¥å¸®æˆ‘ä»¬å¯¹å†…å­˜è¿›è¡Œå›æ”¶ï¼Œä½†æ˜¯å…¶å›æ”¶çš„æ˜¯Javaè™šæ‹Ÿæœºä¸å†å¼•ç”¨çš„å¯¹è±¡ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿçš„IOæµã€Cursorã€Receiverå¦‚æœä¸åŠæ—¶é‡Šæ”¾ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼ˆOOMï¼‰ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šæ—¶å€™å†…å­˜æ³„æ¼çš„ç°è±¡ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œæ¯”å¦‚å†…éƒ¨ç±»ã€Handlerç›¸å…³çš„ä½¿ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼Œæˆ–è€…ä½ ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹libraryçš„ä¸€äº›å¼•ç”¨ï¼Œæ¯”è¾ƒæ¶ˆè€—èµ„æºï¼Œä½†åˆä¸æ˜¯åƒç³»ç»Ÿèµ„æºé‚£æ ·ä¼šå¼•èµ·ä½ è¶³å¤Ÿçš„æ³¨æ„å»æ‰‹åŠ¨é‡Šæ”¾å®ƒä»¬ã€‚ä»¥ä¸‹é€šè¿‡å†…å­˜æ³„æ¼åˆ†æã€é›†åˆä½¿ç”¨ç‡ã€Hashæ€§èƒ½åˆ†æå’ŒOQLå¿«è¯»å®šä½ç©ºé›†åˆæ¥ä½¿ç”¨MATã€‚</span></p><p>&nbsp;</p><p><strong><span>GC Roots</span></strong></p><p><span>JAVAè™šæ‹Ÿæœºé€šè¿‡å¯è¾¾æ€§ï¼ˆReachability)æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼ŒåŸºæœ¬æ€æƒ³ï¼š</span><code>ä»¥â€GC Rootsâ€çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹å‘ä¸‹æœç´¢ï¼Œæœç´¢å½¢æˆçš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼ˆå³ä¸å¯è¾¾çš„ï¼‰ï¼Œåˆ™è¯¥å¯¹è±¡è¢«åˆ¤å®šä¸ºå¯ä»¥è¢«å›æ”¶çš„å¯¹è±¡ï¼Œåä¹‹ä¸èƒ½è¢«å›æ”¶</code><span>ã€‚GC Rootså¯ä»¥æ˜¯ä»¥ä¸‹ä»»æ„å¯¹è±¡</span></p><ul><li><span>ä¸€ä¸ªåœ¨current threadï¼ˆå½“å‰çº¿ç¨‹ï¼‰çš„call stackï¼ˆè°ƒç”¨æ ˆï¼‰ä¸Šçš„å¯¹è±¡ï¼ˆå¦‚æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼‰</span></li><li><span>çº¿ç¨‹è‡ªèº«æˆ–è€…system class loaderï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼‰åŠ è½½çš„ç±»</span></li><li><span>native codeï¼ˆæœ¬åœ°ä»£ç ï¼‰ä¿ç•™çš„æ´»åŠ¨å¯¹è±¡</span></li></ul><p>&nbsp;</p><p><strong><span>å†…å­˜æ³„æ¼</span></strong></p><p><span>å½“å¯¹è±¡æ— ç”¨äº†ï¼Œä½†ä»ç„¶å¯è¾¾ï¼ˆæœªé‡Šæ”¾ï¼‰ï¼Œåƒåœ¾å›æ”¶å™¨æ— æ³•å›æ”¶ã€‚</span></p><p>&nbsp;</p><p><strong><span>Javaå››ç§å¼•ç”¨ç±»å‹</span></strong></p><ul><li><p><span>Strong Referencesï¼ˆå¼ºå¼•ç”¨ï¼‰</span></p><p><span>æ™®é€šçš„javaå¼•ç”¨ï¼Œæˆ‘ä»¬é€šå¸¸newçš„å¯¹è±¡å°±æ˜¯ï¼š</span><code>StringBuffer buffer = new StringBuffer();</code><span> å¦‚æœä¸€ä¸ªå¯¹è±¡é€šè¿‡ä¸€ä¸²å¼ºå¼•ç”¨é“¾å¯è¾¾ï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚ä½ è‚¯å®šä¸å¸Œæœ›è‡ªå·±æ­£åœ¨ä½¿ç”¨çš„å¼•ç”¨è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶å§ã€‚ä½†å¯¹äºé›†åˆä¸­çš„å¯¹è±¡ï¼Œåº”åœ¨ä¸ä½¿ç”¨çš„æ—¶å€™ç§»é™¤æ‰ï¼Œå¦åˆ™ä¼šå ç”¨æ›´å¤šçš„å†…å­˜ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</span></p></li><li><p><span>Soft Referenceï¼ˆè½¯å¼•ç”¨ï¼‰</span></p><p><span>å½“å¯¹è±¡æ˜¯Soft Referenceå¯è¾¾æ—¶ï¼Œgcä¼šå‘ç³»ç»Ÿç”³è¯·æ›´å¤šå†…å­˜ï¼Œè€Œä¸æ˜¯ç›´æ¥å›æ”¶å®ƒï¼Œå½“å†…å­˜ä¸è¶³çš„æ—¶å€™æ‰å›æ”¶å®ƒã€‚å› æ­¤Soft Referenceé€‚åˆç”¨äºæ„å»ºä¸€äº›ç¼“å­˜ç³»ç»Ÿï¼Œæ¯”å¦‚å›¾ç‰‡ç¼“å­˜ã€‚</span></p></li><li><p><span>Weak Referenceï¼ˆå¼±å¼•ç”¨ï¼‰</span></p><p><span>WeakReferenceä¸ä¼šå¼ºåˆ¶å¯¹è±¡ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å®ƒæ‹¥æœ‰æ¯”è¾ƒçŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸï¼Œå…è®¸ä½ ä½¿ç”¨åƒåœ¾å›æ”¶å™¨çš„èƒ½åŠ›å»æƒè¡¡ä¸€ä¸ªå¯¹è±¡çš„å¯è¾¾æ€§ã€‚åœ¨åƒåœ¾å›æ”¶å™¨æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸè¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦gcå‘ç°å¯¹è±¡æ˜¯Weak Referenceå¯è¾¾ï¼Œå°±ä¼šæŠŠå®ƒæ”¾åˆ° </span><code>Reference Queue</code><span> ä¸­ï¼Œç­‰ä¸‹æ¬¡gcæ—¶å›æ”¶å®ƒã€‚</span></p><p><span>ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº†WeakHashMapï¼Œå’ŒHashMapç±»ä¼¼ï¼Œåªæ˜¯å…¶keyä½¿ç”¨äº†weak referenceã€‚å¦‚æœWeakHashMapçš„æŸä¸ªkeyè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œé‚£ä¹ˆentityä¹Ÿä¼šè‡ªåŠ¨è¢«removeã€‚ç”±äºWeakReferenceè¢«GCå›æ”¶çš„å¯èƒ½æ€§è¾ƒå¤§ï¼Œå› æ­¤ï¼Œåœ¨ä½¿ç”¨å®ƒä¹‹å‰ï¼Œä½ éœ€è¦é€šè¿‡weakObj.get()å»åˆ¤æ–­ç›®çš„å¯¹è±¡å¼•ç”¨æ˜¯å¦å·²ç»è¢«å›æ”¶ã€‚ä¸€æ—¦WeakReference.get()è¿”å›nullï¼Œå®ƒæŒ‡å‘çš„å¯¹è±¡å°±ä¼šè¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆWeakReferenceå¯¹è±¡å°±æ²¡æœ‰ç”¨äº†ï¼Œæ„å‘³ç€ä½ åº”è¯¥è¿›è¡Œä¸€äº›æ¸…ç†ã€‚æ¯”å¦‚åœ¨WeakHashMapä¸­è¦æŠŠå›æ”¶è¿‡çš„keyä»Mapä¸­åˆ é™¤æ‰ï¼Œé¿å…æ— ç”¨çš„çš„weakReferenceä¸æ–­å¢é•¿ã€‚</span></p><p><span>ReferenceQueueå¯ä»¥è®©ä½ å¾ˆå®¹æ˜“åœ°è·Ÿè¸ªdead referencesã€‚WeakReferenceç±»çš„æ„é€ å‡½æ•°æœ‰ä¸€ä¸ªReferenceQueueå‚æ•°ï¼Œå½“æŒ‡å‘çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œä¼šæŠŠWeakReferenceå¯¹è±¡æ”¾åˆ°ReferenceQueueä¸­ã€‚è¿™æ ·ï¼Œéå†ReferenceQueueå¯ä»¥å¾—åˆ°æ‰€æœ‰å›æ”¶è¿‡çš„WeakReferenceã€‚</span></p></li><li><p><span>Phantom Referenceï¼ˆè™šå¼•ç”¨ï¼‰</span></p><p><span>å…¶ä½™Soft/Weak ReferenceåŒºåˆ«è¾ƒå¤§æ˜¯å®ƒçš„get()æ–¹æ³•æ€»æ˜¯è¿”å›nullã€‚è¿™æ„å‘³ç€ä½ åªèƒ½ç”¨Phantom Referenceæœ¬èº«ï¼Œè€Œå¾—ä¸åˆ°å®ƒæŒ‡å‘çš„å¯¹è±¡ã€‚å½“Weak ReferenceæŒ‡å‘çš„å¯¹è±¡å˜å¾—å¼±å¯è¾¾(weakly reachableï¼‰æ—¶ä¼šç«‹å³è¢«æ”¾åˆ°ReferenceQueueä¸­ï¼Œè¿™åœ¨finalizationã€garbage collectionä¹‹å‰å‘ç”Ÿã€‚ç†è®ºä¸Šï¼Œä½ å¯ä»¥åœ¨finalize()æ–¹æ³•ä¸­ä½¿å¯¹è±¡â€œå¤æ´»â€ï¼ˆä½¿ä¸€ä¸ªå¼ºå¼•ç”¨æŒ‡å‘å®ƒå°±è¡Œäº†ï¼Œgcä¸ä¼šå›æ”¶å®ƒï¼‰ã€‚ä½†æ²¡æ³•å¤æ´»PhantomReferenceæŒ‡å‘çš„å¯¹è±¡ã€‚è€ŒPhantomReferenceæ˜¯åœ¨garbage collectionä¹‹åè¢«æ”¾åˆ°ReferenceQueueä¸­çš„ï¼Œæ²¡æ³•å¤æ´»ã€‚</span></p></li></ul><p>&nbsp;</p><p><strong><span>MATè§†å›¾ä¸æ¦‚å¿µ</span></strong></p><ul><li><p><strong><span>Shallow Heap</span></strong></p><p><span>Shallow Sizeå°±æ˜¯å¯¹è±¡æœ¬èº«å ç”¨å†…å­˜çš„å¤§å°ï¼Œä¸åŒ…å«å…¶å¼•ç”¨çš„å¯¹è±¡å†…å­˜ï¼Œå®é™…åˆ†æä¸­ä½œç”¨ä¸å¤§ã€‚ å¸¸è§„å¯¹è±¡ï¼ˆéæ•°ç»„ï¼‰çš„Shallow Sizeç”±å…¶æˆå‘˜å˜é‡çš„æ•°é‡å’Œç±»å‹å†³å®šã€‚æ•°ç»„çš„Shallow Sizeæœ‰æ•°ç»„å…ƒç´ çš„ç±»å‹ï¼ˆå¯¹è±¡ç±»å‹ã€åŸºæœ¬ç±»å‹ï¼‰å’Œæ•°ç»„é•¿åº¦å†³å®šã€‚æ¡ˆä¾‹å¦‚ä¸‹ï¼š</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="java"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-variable-3">String</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">final</span> <span class="cm-keyword">class</span> <span class="cm-variable-3">String</span> {<span class="cm-number">8</span> <span class="cm-variable">Bytes</span> <span class="cm-variable">header</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">char</span> <span class="cm-variable">value</span>[]; <span class="cm-number">4</span> <span class="cm-variable">Bytes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">offset</span>; <span class="cm-number">4</span> <span class="cm-variable">Bytes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">count</span>; <span class="cm-number">4</span> <span class="cm-variable">Bytes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">hash</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-number">4</span> <span class="cm-variable">Bytes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// ......</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// "Shallow sizeâ€œ of a String ==24 Bytes12345678</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 194px;"></div><div class="CodeMirror-gutters" style="display: none; height: 194px;"></div></div></div></pre><p><span>Javaçš„å¯¹è±¡æˆå‘˜éƒ½æ˜¯äº›å¼•ç”¨ã€‚çœŸæ­£çš„å†…å­˜éƒ½åœ¨å †ä¸Šï¼Œçœ‹èµ·æ¥æ˜¯ä¸€å †åŸç”Ÿçš„byte[]ã€char[]ã€int[]ï¼Œå¯¹è±¡æœ¬èº«çš„å†…å­˜éƒ½å¾ˆå°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥Shallow Heapè¿›è¡Œæ’åºçš„Histogramå›¾ä¸­ï¼Œæ’åœ¨ç¬¬ä¸€ä½ç¬¬äºŒä½çš„æ˜¯byteå’Œcharã€‚</span></p><p>&nbsp;</p><ul><li><p><strong><span>Retained Heap</span></strong></p><p><span>Retained Heapå€¼çš„è®¡ç®—æ–¹å¼æ˜¯å°†Retained Setä¸­çš„æ‰€æœ‰å¯¹è±¡å¤§å°å åŠ ã€‚æˆ–è€…è¯´ï¼Œç”±äºXè¢«é‡Šæ”¾ï¼Œå¯¼è‡´å…¶å®ƒæ‰€æœ‰è¢«é‡Šæ”¾å¯¹è±¡ï¼ˆåŒ…æ‹¬è¢«é€’å½’é‡Šæ”¾çš„ï¼‰æ‰€å çš„Heapå¤§å°ã€‚å½“Xè¢«å›æ”¶æ—¶å“ªäº›å°†è¢«GCå›æ”¶çš„å¯¹è±¡é›†åˆã€‚æ¯”å¦‚: </span></p><p><span>ä¸€ä¸ªArrayListæŒæœ‰100000ä¸ªå¯¹è±¡ï¼Œæ¯ä¸€ä¸ªå ç”¨16 bytesï¼Œç§»é™¤è¿™äº›ArrayListå¯ä»¥é‡Šæ”¾16Ã—100000+Xï¼ŒXä»£è¡¨ArrayListçš„Shallowå¤§å°ã€‚ç›¸å¯¹äºShallow Heapï¼ŒRetained Heapå¯ä»¥æ›´ç²¾ç¡®çš„åæ˜ ä¸€ä¸ªå¯¹è±¡å®é™…å ç”¨çš„å¤§å°ï¼ˆå› ä¸ºå¦‚æœè¯¥å¯¹è±¡é‡Šæ”¾ï¼ŒRetained Heapéƒ½å¯ä»¥è¢«é‡Šæ”¾ï¼‰ã€‚</span></p></li></ul><p>&nbsp;</p><ul><li><p><strong><span>Histogram</span></strong></p><p><span>å¯åˆ—å‡ºæ¯ä¸€ä¸ªç±»çš„å®ä¾‹æ•°ã€‚æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥è®¡ç®—å‡ºè¯¥ç±»æ‰€æœ‰å¯¹è±¡çš„Retained Sizeã€‚</span></p></li></ul><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250863.jpg" referrerpolicy="no-referrer" alt="mat-histogram"></p><p>&nbsp;</p><ul><li><p><strong><span>Dominator Tree</span></strong></p><p><span>å¯¹è±¡ä¹‹é—´dominatorå…³ç³»æ ‘ã€‚å¦‚æœä»GC Rootåˆ°è¾¾Yçš„çš„æ‰€æœ‰pathéƒ½ç»è¿‡Xï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°X dominates Yï¼Œæˆ–è€…Xæ˜¯Yçš„Dominator Dominator Treeç”±ç³»ç»Ÿä¸­å¤æ‚çš„å¯¹è±¡å›¾è®¡ç®—è€Œæ¥ã€‚ä»MATçš„dominator treeä¸­å¯ä»¥çœ‹åˆ°å ç”¨å†…å­˜æœ€å¤§çš„å¯¹è±¡ä»¥åŠæ¯ä¸ªå¯¹è±¡çš„dominatorã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å³é”®é€‰æ‹©Immediate Dominatorâ€æ¥æŸ¥çœ‹æŸä¸ªå¯¹è±¡çš„dominatorã€‚</span></p></li></ul><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250994.jpg" referrerpolicy="no-referrer" alt="mat-dominator-tree"></p><p>&nbsp;</p><ul><li><p><strong><span>Path to GC Roots</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡åˆ°RC Rootsçš„å¼•ç”¨é“¾é€šå¸¸åœ¨æ’æŸ¥å†…å­˜æ³„æ¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©exclude all phantom/weak/soft etc.references, </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre><p><span>æ„æ€æ˜¯æŸ¥çœ‹æ’é™¤è™šå¼•ç”¨/å¼±å¼•ç”¨/è½¯å¼•ç”¨ç­‰çš„å¼•ç”¨é“¾ï¼Œå› ä¸ºè¢«è™šå¼•ç”¨/å¼±å¼•ç”¨/è½¯å¼•ç”¨çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¢«GCç»™å›æ”¶ï¼Œæˆ‘ä»¬è¦çœ‹çš„å°±æ˜¯æŸä¸ªå¯¹è±¡å¦è¿˜å­˜åœ¨Strong å¼•ç”¨é“¾ï¼ˆåœ¨å¯¼å‡ºHeapDumpä¹‹å‰è¦æ‰‹åŠ¨å‡ºå‘GCæ¥ä¿è¯ï¼‰ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¯´æ˜å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œç„¶åå†å»æ’æŸ¥å…·ä½“å¼•ç”¨ã€‚</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250995.jpg" referrerpolicy="no-referrer" alt="mat-path-to-gc-roots"></p><p><span>æŸ¥çœ‹å½“å‰Objectæ‰€æœ‰å¼•ç”¨,è¢«å¼•ç”¨çš„å¯¹è±¡ï¼š</span></p><ul><li><p><span>List objects with ï¼ˆä»¥Dominator Treeçš„æ–¹å¼æŸ¥çœ‹ï¼‰</span></p><ul><li><span>incoming references å¼•ç”¨åˆ°è¯¥å¯¹è±¡çš„å¯¹è±¡</span></li><li><span>outcoming references è¢«è¯¥å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡</span></li></ul></li><li><p><span>Show objects by class ï¼ˆä»¥classçš„æ–¹å¼æŸ¥çœ‹ï¼‰</span></p><ul><li><span>incoming references å¼•ç”¨åˆ°è¯¥å¯¹è±¡çš„å¯¹è±¡</span></li><li><span>outcoming references è¢«è¯¥å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡</span></li></ul></li></ul></li></ul><p>&nbsp;</p><ul><li><strong><span>OQL(Object Query Language)</span></strong></li></ul><p><span>ç±»ä¼¼SQLæŸ¥è¯¢è¯­è¨€ï¼šClassesï¼šTableã€Objectsï¼šRowsã€Filedsï¼šCols</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="mysql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> <span class="cm-operator">*</span> <span class="cm-keyword">from</span> com<span class="cm-variable-2">.example.mat.Listener</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æŸ¥æ‰¾sizeï¼0å¹¶ä¸”æœªä½¿ç”¨è¿‡çš„ArrayList</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> <span class="cm-operator">*</span> <span class="cm-keyword">from</span> java<span class="cm-variable-2">.util.ArrayList</span> <span class="cm-keyword">where</span> size<span class="cm-operator">=</span><span class="cm-number">0</span> <span class="cm-keyword">and</span> modCount<span class="cm-operator">=</span><span class="cm-number">01</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æŸ¥æ‰¾æ‰€æœ‰çš„Activity </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> <span class="cm-operator">*</span> <span class="cm-keyword">from</span> instanceof android<span class="cm-variable-2">.app.Activity</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 108px;"></div><div class="CodeMirror-gutters" style="display: none; height: 108px;"></div></div></div></pre><p>&nbsp;</p><ul><li><strong><span>å†…å­˜å¿«ç…§å¯¹æ¯”</span></strong></li></ul><p><span>æ–¹å¼ä¸€ï¼šCompare To Another Heap Dumpï¼ˆç›´æ¥è¿›è¡Œæ¯”è¾ƒï¼‰</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250003.jpg" referrerpolicy="no-referrer" alt="mat-compare-to-another-heap-dump-1"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250025.jpg" referrerpolicy="no-referrer" alt="mat-compare-to-another-heap-dump-2"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250028.jpg" referrerpolicy="no-referrer" alt="mat-compare-to-another-heap-dump-3"></p><p>&nbsp;</p><p><span>æ–¹å¼äºŒï¼šCompare Baseketï¼ˆæ›´å…¨é¢ï¼Œå¯ä»¥ç›´æ¥ç»™å‡ºç™¾åˆ†æ¯”ï¼‰</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250030.jpg" referrerpolicy="no-referrer" alt="mat-compare-baseket-1"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250448.jpg" referrerpolicy="no-referrer" alt="mat-compare-baseket-2"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250571.jpg" referrerpolicy="no-referrer" alt="mat-compare-baseket-3"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250588.jpg" referrerpolicy="no-referrer" alt="mat-compare-baseket-4"></p><p>&nbsp;</p><p><strong><span>MATå†…å­˜åˆ†æå®æˆ˜</span></strong></p><ul><li><p><strong><span>å®æˆ˜ä¸€ï¼šå†…å­˜æ³„æ¼åˆ†æ</span></strong></p><p><span>æŸ¥æ‰¾å¯¼è‡´å†…å­˜æ³„æ¼çš„ç±»ã€‚æ—¢ç„¶ç¯å¢ƒå·²ç»æ­å¥½ï¼Œheap dumpä¹ŸæˆåŠŸå€’å…¥ï¼Œæ¥ä¸‹æ¥å°±å»åˆ†æé—®é¢˜ã€‚</span></p><ul><li><p><span>æŸ¥æ‰¾ç›®æ ‡ç±» </span>
<span>å¦‚æœåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ çš„ç›®æ ‡å¾ˆæ˜ç¡®ï¼Œæ¯”å¦‚å°±æ˜¯æŸ¥æ‰¾è‡ªå·±è´Ÿè´£çš„æœåŠ¡ï¼Œé‚£ä¹ˆé€šè¿‡åŒ…åæˆ–è€…Classç­›é€‰ï¼ŒOQLæœç´¢éƒ½å¯ä»¥å¿«é€Ÿå®šä½åˆ°ã€‚ç‚¹å‡»OQLå›¾æ ‡ï¼Œåœ¨çª—å£è¾“å…¥ï¼Œå¹¶æŒ‰Ctrl + F5æˆ–è€…!æŒ‰é’®æ‰§è¡Œï¼š</span></p><p><code>select * from instanceof android.app.Activity</code></p></li><li><p><span>Paths to GC Rootsï¼šexclude all phantom/weak/soft etc.references </span></p><p><span>æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡åˆ°RC Rootsæ˜¯å¦å­˜åœ¨å¼•ç”¨é“¾ã€‚è¦å°†è™šå¼•ç”¨/å¼±å¼•ç”¨/è½¯å¼•ç”¨ç­‰æ’é™¤ï¼Œå› ä¸ºè¢«è™šå¼•ç”¨/å¼±å¼•ç”¨/è½¯å¼•ç”¨çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¢«GCç»™å›æ”¶</span></p></li><li><p><span>åˆ†æå…·ä½“çš„å¼•ç”¨ä¸ºä½•æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œå¹¶è¿›è¡Œä¿®å¤</span></p></li></ul></li></ul><p>&nbsp;</p><p><strong><span>å°æŠ€å·§ï¼š</span></strong></p><ul><li><span>å½“ç›®çš„ä¸æ˜ç¡®æ—¶ï¼Œå¯ä»¥ç›´æ¥å®šä½åˆ°RetainedHeapæœ€å¤§çš„Objectï¼ŒSelect incoming referencesï¼ŒæŸ¥çœ‹å¼•ç”¨é“¾ï¼Œå®šä½åˆ°å¯ç–‘çš„å¯¹è±¡ç„¶åPath to GC Rootsè¿›è¡Œå¼•ç”¨é“¾åˆ†æ</span></li><li><span>å¦‚æœå¤§å¯¹è±¡ç­›é€‰çœ‹ä¸å‡ºåŒºåˆ«ï¼Œå¯ä»¥è¯•è¯•æŒ‰ç…§classåˆ†ç»„ï¼Œå†å¯»æ‰¾å¯ç–‘å¯¹è±¡è¿›è¡ŒGCå¼•ç”¨é“¾åˆ†æ</span></li><li><span>ç›´æ¥æŒ‰ç…§åŒ…åç›´æ¥æŸ¥çœ‹GCå¼•ç”¨é“¾ï¼Œå¯ä»¥ä¸€æ¬¡æ€§ç­›é€‰å¤šä¸ªç±»ï¼Œä½†æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€‰é¡¹æ˜¯ Merge Shortest Path to GCRootsï¼Œè¿™ä¸ªé€‰é¡¹å…·ä½“ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œä¸è¿‡ä¹Ÿèƒ½ç­›é€‰å‡ºå­˜åœ¨GCå¼•ç”¨é“¾çš„ç±»ï¼Œè¿™ç§æ–¹å¼çš„å‡†ç¡®æ€§è¿˜å¾…éªŒè¯</span></li></ul><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250213.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µä¸€"></p><p><span>æ‰€ä»¥æœ‰æ—¶å€™è¿›è¡ŒMATåˆ†æè¿˜æ˜¯éœ€è¦ä¸€äº›ç»éªŒï¼Œèƒ½å¤Ÿå¸®ä½ æ›´å¿«æ›´å‡†ç¡®çš„å®šä½ã€‚</span></p><p>&nbsp;</p><ul><li><p><strong><span>å®æˆ˜äºŒï¼šé›†åˆä½¿ç”¨ç‡åˆ†æ</span></strong></p><p><span>é›†åˆåœ¨å¼€å‘ä¸­ä¼šç»å¸¸ä½¿ç”¨åˆ°ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„çš„é›†åˆï¼Œåˆå§‹å®¹é‡æ˜¯å¤šå°‘ï¼ˆå¤ªå°ï¼Œå¯èƒ½å¯¼è‡´é¢‘ç¹æ‰©å®¹ï¼‰ï¼Œå¤ªå¤§ï¼Œåˆä¼šå¼€é”€è·Ÿå¤šå†…å­˜ã€‚å½“è¿™äº›é—®é¢˜ä¸æ˜¯å¾ˆæ˜ç¡®æ—¶æˆ–è€…æƒ³æŸ¥çœ‹é›†åˆçš„ä½¿ç”¨æƒ…å†µæ—¶ï¼Œå¯ä»¥é€šè¿‡MATæ¥è¿›è¡Œåˆ†æã€‚</span></p><ul><li><p><strong><span>ç­›é€‰ç›®æ ‡å¯¹è±¡</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250230.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µäºŒ-1"></p></li><li><p><strong><span>Show Retained Setï¼ˆæŸ¥æ‰¾å½“Xè¢«å›æ”¶æ—¶é‚£äº›å°†è¢«GCå›æ”¶çš„å¯¹è±¡é›†åˆï¼‰</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250231.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µäºŒ-2"></p></li><li><p><strong><span>ç­›é€‰æŒ‡å®šçš„Objectï¼ˆHash Mapï¼ŒArrayListï¼‰å¹¶æŒ‰ç…§å¤§å°è¿›è¡Œåˆ†ç»„</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250235.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µäºŒ-3"></p></li><li><p><strong><span>æŸ¥çœ‹æŒ‡å®šç±»çš„Immediate dominators</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250432.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µäºŒ-4"></p></li></ul></li></ul><p>&nbsp;</p><p><strong><span>Collections fill ratio</span></strong></p><p><span>è¿™ç§æ–¹å¼åªèƒ½æŸ¥çœ‹é‚£äº›å…·æœ‰é¢„åˆ†é…å†…å­˜èƒ½åŠ›çš„é›†åˆï¼Œæ¯”å¦‚HashMapï¼ŒArrayListã€‚è®¡ç®—æ–¹å¼ï¼šâ€size / capacityâ€</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250675.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µäºŒ-5"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250692.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µäºŒ-6"></p><p>&nbsp;</p><ul><li><p><strong><span>å®æˆ˜ä¸‰ï¼šHashç›¸å…³æ€§èƒ½åˆ†æ</span></strong></p><p><span>å½“Hashé›†åˆä¸­è¿‡å¤šçš„å¯¹è±¡è¿”å›ç›¸åŒHashå€¼çš„æ—¶å€™ï¼Œä¼šä¸¥é‡å½±å“æ€§èƒ½ï¼ˆHashç®—æ³•åŸç†è‡ªè¡Œæœç´¢ï¼‰ï¼Œè¿™é‡Œæ¥æŸ¥æ‰¾å¯¼è‡´Hashé›†åˆçš„ç¢°æ’ç‡è¾ƒé«˜çš„ç½ªé­ç¥¸é¦–ã€‚</span></p><ul><li><p><strong><span>Map Collision Ratio</span></strong></p><p><span>æ£€æµ‹æ¯ä¸€ä¸ªHashMapæˆ–è€…HashTableå®ä¾‹å¹¶æŒ‰ç…§ç¢°æ’ç‡æ’åºï¼š</span><strong><span>ç¢°æ’ç‡ = ç¢°æ’çš„å®ä½“/Hashè¡¨ä¸­æ‰€æœ‰å®ä½“</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250694.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µä¸‰-1"></p></li><li><p><strong><span>æŸ¥çœ‹Immediate dominators</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250701.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µä¸‰-2"></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250699.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µä¸‰-3"></p></li><li><p><strong><span>é€šè¿‡HashEntriesæŸ¥çœ‹key value</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250711.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µä¸‰-4"></p></li><li><p><strong><span>Arrayç­‰å…¶å®ƒé›†åˆåˆ†ææ–¹æ³•ç±»ä¼¼</span></strong></p></li></ul></li></ul><p>&nbsp;</p><ul><li><p><strong><span>å®æˆ˜å››ï¼šé€šè¿‡OQLå¿«é€Ÿå®šä½æœªä½¿ç”¨çš„é›†åˆ</span></strong></p><ul><li><p><strong><span>é€šè¿‡OQLæŸ¥è¯¢emptyå¹¶ä¸”æœªä¿®æ”¹è¿‡çš„é›†åˆï¼š</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="mysql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.39844px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> <span class="cm-operator">*</span> <span class="cm-keyword">from</span> java<span class="cm-variable-2">.util.ArrayList</span> <span class="cm-keyword">where</span> size<span class="cm-operator">=</span><span class="cm-number">0</span> <span class="cm-keyword">and</span> modCount<span class="cm-operator">=</span><span class="cm-number">01</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> <span class="cm-operator">*</span> <span class="cm-keyword">from</span> java<span class="cm-variable-2">.util.HashMap</span> <span class="cm-keyword">where</span> size<span class="cm-operator">=</span><span class="cm-number">0</span> <span class="cm-keyword">and</span> modCount<span class="cm-operator">=</span><span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> <span class="cm-operator">*</span> <span class="cm-keyword">from</span> java<span class="cm-variable-2">.util.Hashtable</span> <span class="cm-keyword">where</span> <span class="cm-keyword">count</span><span class="cm-operator">=</span><span class="cm-number">0</span> <span class="cm-keyword">and</span> modCount<span class="cm-operator">=</span><span class="cm-number">012</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 108px;"></div><div class="CodeMirror-gutters" style="display: none; height: 108px;"></div></div></div></pre><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250712.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µå››-1"></p></li><li><p><strong><span>Immediate dominators(æŸ¥çœ‹å¼•ç”¨è€…)</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250086.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µå››-2"></p></li><li><p><strong><span>è®¡ç®—ç©ºé›†åˆçš„Retained Sizeå€¼ï¼ŒæŸ¥çœ‹æµªè´¹äº†å¤šå°‘å†…å­˜</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250092.jpg" referrerpolicy="no-referrer" alt="mat-å®è·µå››-3"></p></li></ul></li></ul><p>&nbsp;</p><h2 id='ğŸ”¥ç«ç„°å›¾'><span>ğŸ”¥ç«ç„°å›¾</span></h2><p><span>ç«ç„°å›¾æ˜¯ç”¨æ¥åˆ†æç¨‹åºè¿è¡Œç“¶é¢ˆçš„å·¥å…·ã€‚ç«ç„°å›¾ä¹Ÿå¯ä»¥ç”¨æ¥åˆ†æ Java åº”ç”¨ã€‚</span></p><h3 id='ç¯å¢ƒå®‰è£…'><span>ç¯å¢ƒå®‰è£…</span></h3><p><span>ç¡®è®¤ä½ çš„æœºå™¨å·²ç»å®‰è£…äº†</span><strong><span>gitã€jdkã€perlã€c++ç¼–è¯‘å™¨</span></strong><span>ã€‚</span></p><h4 id='å®‰è£…perl'><span>å®‰è£…Perl</span></h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">wget</span> http://www.cpan.org/src/5.0/perl-5.26.1.tar.gz</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">tar zxvf perl-5.26.1.tar.gz</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> perl-5.26.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">./Configure <span class="cm-attribute">-de</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">make</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">make</span> test</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">make</span> install</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 151px;"></div><div class="CodeMirror-gutters" style="display: none; height: 151px;"></div></div></div></pre><p><span>wgetåé¢çš„è·¯å¾„å¯ä»¥æŒ‰éœ€æ›´æ”¹ã€‚å®‰è£…è¿‡ç¨‹æ¯”è¾ƒè€—æ—¶é—´ï¼Œå®‰è£…å®Œæˆåå¯é€šè¿‡</span><strong><span>perl -version</span></strong><span>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚</span></p><p>&nbsp;</p><h4 id='cç¼–è¯‘å™¨'><span>C++ç¼–è¯‘å™¨</span></h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apt-get install g<span class="cm-operator">++</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>ä¸€èˆ¬ç”¨äºç¼–è¯‘c++ç¨‹åºï¼Œç¼ºå°‘è¿™ä¸ªç¼–è¯‘å™¨è¿›è¡Œmakeç¼–è¯‘c++ä»£ç æ—¶ï¼Œä¼šæŠ¥â€œg++: not foundâ€çš„é”™è¯¯ã€‚</span></p><p>&nbsp;</p><h4 id='cloneç›¸å…³é¡¹ç›®'><span>cloneç›¸å…³é¡¹ç›®</span></h4><p><span>ä¸‹è½½ä¸‹æ¥æ‰€éœ€è¦çš„ä¸¤ä¸ªé¡¹ç›®ï¼ˆè¿™é‡Œå»ºè®®æ”¾åˆ°dataç›®å½•ä¸‹ï¼‰ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> clone https://github.com/jvm-profiling-tools/async-profiler</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> clone https://github.com/brendangregg/FlameGraph</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre><p>&nbsp;</p><h4 id='ç¼–è¯‘é¡¹ç›®'><span>ç¼–è¯‘é¡¹ç›®</span></h4><p><span>ä¸‹è½½å¥½ä»¥åï¼Œéœ€è¦æ‰“å¼€async-profileræ–‡ä»¶ï¼Œè¾“å…¥makeæŒ‡ä»¤è¿›è¡Œç¼–è¯‘ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> async-profiler</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">make</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 43px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></pre><p>&nbsp;</p><h3 id='ç”Ÿæˆæ–‡ä»¶'><span>ç”Ÿæˆæ–‡ä»¶</span></h3><h4 id='ç”Ÿæˆç«ç„°å›¾æ•°æ®'><span>ç”Ÿæˆç«ç„°å›¾æ•°æ®</span></h4><p><span>å¯ä»¥ä» github ä¸Šä¸‹è½½ </span><a href='https://github.com/jvm-profiling-tools/async-profiler'><span>async-profiler</span></a><span> çš„å‹ç¼©åŒ…è¿›è¡Œç›¸å…³æ“ä½œã€‚è¿›å…¥async-profileré¡¹ç›®çš„ç›®å½•ä¸‹ï¼Œç„¶åè¾“å…¥å¦‚ä¸‹æŒ‡ä»¤ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">./profiler.sh <span class="cm-attribute">-d</span> <span class="cm-number">60</span> <span class="cm-attribute">-o</span> collapsed <span class="cm-attribute">-f</span> /tmp/test_01.txt <span class="cm-def">${pid}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>ä¸Šé¢çš„-dè¡¨ç¤ºçš„æ˜¯æŒç»­æ—¶é•¿ï¼Œåé¢60ä»£è¡¨æŒç»­é‡‡é›†æ—¶é—´60sï¼Œ-oè¡¨ç¤ºçš„æ˜¯é‡‡é›†è§„èŒƒï¼Œè¿™é‡Œç”¨çš„æ˜¯collapsedï¼Œ-fåé¢çš„è·¯å¾„ï¼Œè¡¨ç¤ºçš„æ˜¯æ•°æ®é‡‡é›†åç”Ÿæˆçš„æ•°æ®å­˜æ”¾çš„æ–‡ä»¶è·¯å¾„ï¼ˆè¿™é‡Œæ”¾åœ¨äº†/tmp/test_01.txtï¼‰ï¼Œ${pid}è¡¨ç¤ºçš„æ˜¯é‡‡é›†ç›®æ ‡è¿›ç¨‹çš„pidï¼Œå›è½¦è¿è¡Œï¼Œè¿è¡ŒæœŸé—´é˜»å¡ï¼ŒçŸ¥é“çº¦å®šæ—¶é—´å®Œæˆã€‚è¿è¡Œå®Œæˆåå»tmpä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰å¯¹åº”æ–‡ä»¶ã€‚</span></p><p>&nbsp;</p><h4 id='ç”Ÿæˆsvgæ–‡ä»¶'><span>ç”Ÿæˆsvgæ–‡ä»¶</span></h4><p><span>ä¸Šä¸€æ­¥äº§ç”Ÿçš„æ–‡ä»¶é‡Œçš„å†…å®¹ï¼Œè‚‰çœ¼æ˜¯å¾ˆéš¾çœ‹æ‡‚çš„ï¼Œæ‰€ä»¥ç°åœ¨</span><a href='https://github.com/brendangregg/FlameGraph'><span>FlameGraph</span></a><span>çš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº†ï¼Œå®ƒå¯ä»¥è¯»å–è¯¥æ–‡ä»¶å¹¶ç”Ÿæˆç›´è§‚çš„ç«ç„°å›¾ï¼Œç°åœ¨è¿›å…¥è¯¥é¡¹ç›®ç›®å½•ä¸‹é¢ï¼Œæ‰§è¡Œå¦‚ä¸‹è¯­å¥ï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="shell"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="shell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 8.79688px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style="text-rendering: auto;"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">perl flamegraph.pl <span class="cm-attribute">--colors</span><span class="cm-operator">=</span>java /tmp/test_01.txt &gt; test_01.svg</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>å› ä¸ºæ˜¯perlæ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨perlæŒ‡ä»¤è¿è¡Œè¯¥æ–‡ä»¶ï¼Œåé¢--colorsè¡¨ç¤ºç€è‰²é£æ ¼ï¼Œè¿™é‡Œæ˜¯javaï¼Œåé¢çš„æ˜¯æ•°æ®æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™é‡Œæ˜¯åˆšåˆšä¸Šé¢ç”Ÿæˆçš„é‚£ä¸ªæ–‡ä»¶/tmp/test_01.txtï¼Œæœ€åçš„test_01.svgå°±æ˜¯æœ€ç»ˆç”Ÿæˆçš„ç«ç„°å›¾æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„å’Œæ–‡ä»¶å‘½åï¼Œè¿™é‡Œæ˜¯å‘½åä¸ºtest_01.svgå¹¶ä¿å­˜åœ¨å½“å‰è·¯å¾„ï¼Œè¿è¡Œåçœ‹åˆ°è¯¥æ–‡ä»¶å·²ç»å­˜åœ¨äºå½“å‰ç›®å½•ä¸‹ã€‚</span></p><p>&nbsp;</p><h4 id='å±•ç¤ºç«ç„°å›¾'><span>å±•ç¤ºç«ç„°å›¾</span></h4><p><span>ç°åœ¨ä¸‹è½½ä¸‹æ¥è¯¥æ–‡ä»¶ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250037.svg" referrerpolicy="no-referrer" alt="ç«ç„°å›¾æ¡ˆä¾‹"></p><p>&nbsp;</p><h3 id='ç«ç„°å›¾æ¡ˆä¾‹'><span>ç«ç„°å›¾æ¡ˆä¾‹</span></h3><p><span>ç”Ÿæˆçš„</span><a href='images/DevOps/ç«ç„°å›¾æ¡ˆä¾‹.svg'><span>ç«ç„°å›¾æ¡ˆä¾‹</span></a><span>å¦‚ä¸‹ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250039.jpg" referrerpolicy="no-referrer" alt="ç«ç„°å›¾æ¡ˆä¾‹"></p><h4 id='ç“¶é¢ˆç‚¹1'><span>ç“¶é¢ˆç‚¹1</span></h4><p><span>CoohuaAnalytics$KafkaConsumer:::sendæ–¹æ³•ä¸­Gzipå‹ç¼©å æ¯”è¾ƒé«˜ã€‚å·²ç»å®šä½åˆ°æ–¹æ³•çº§åˆ«ï¼Œå†çœ‹ä»£ç å°±å¿«é€Ÿå¾ˆå¤šï¼Œç›´æ¥æ‰¾åˆ°å…·ä½“ä½ç½®ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¶ˆè€—å¤§æˆ·ï¼š</span><strong><span>Gzipå‹ç¼©</span></strong></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250044.jpg" referrerpolicy="no-referrer" alt="ç«ç„°å›¾-ç“¶é¢ˆç‚¹1"></p><p>&nbsp;</p><h4 id='ç“¶é¢ˆç‚¹2'><span>ç“¶é¢ˆç‚¹2</span></h4><p><span>å±•å¼€2è¿™ä¸ªæ³¢å³°ï¼ŒæŸ¥çœ‹åˆ°è¿™ä¸ªgetOurStackTraceæ–¹æ³•å ç”¨äº†å¤§æ¯”ä¾‹çš„CPUï¼Œæ€€ç–‘ä»£ç é‡Œé¢é¢‘ç¹ç”¨ä¸¢å¼‚å¸¸çš„æ–¹å¼è·å–å½“å‰ä»£ç æ ˆï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250045.jpg" referrerpolicy="no-referrer" alt="ç«ç„°å›¾-ç“¶é¢ˆç‚¹2"></p><p><span>ç›´æ¥çœ‹ä»£ç ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250051.jpg" referrerpolicy="no-referrer" alt="ç«ç„°å›¾-ç“¶é¢ˆç‚¹2-ä»£ç "></p><p><span>æœç„¶å¦‚æ¨æ–­ï¼Œæ‰¾åˆ°ç¬¬äºŒä¸ªCPUæ¶ˆè€—å¤§æˆ·ï¼šnew Exception().getStackTrace()ã€‚</span></p><p>&nbsp;</p><h4 id='ç“¶é¢ˆç‚¹3'><span>ç“¶é¢ˆç‚¹3</span></h4><p><span>å±•å¼€æ³¢å³°3ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è¿™ä¸ªGzipè§£å‹ç¼©ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250053.jpg" referrerpolicy="no-referrer" alt="ç«ç„°å›¾-ç“¶é¢ˆç‚¹3"></p><p><span>å®šä½åˆ°å…·ä½“çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°å¯¹æ¯ä¸ªè¯·æ±‚çš„å‚æ•°è¿›è¡Œäº†gzipè§£å‹ç¼©ï¼š</span></p><p><img src="https://tencent.cos.mobaijun.com//xxbj_img/202209171250464.jpg" referrerpolicy="no-referrer" alt="ç«ç„°å›¾-ç“¶é¢ˆç‚¹3-ä»£ç "></p></div></div>
</body>
</html>